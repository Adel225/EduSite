/*! For license information please see main.feb1480f.js.LICENSE.txt */
(()=>{var e={4:(e,t,n)=>{"use strict";var s=n(853),i=n(43),r=n(950);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function h(e){if(l(e)!==e)throw Error(a(188))}function u(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=u(e)))return t;e=e.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),w=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope");var E=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var T=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var M=Symbol.iterator;function j(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=M&&e[M]||e["@@iterator"])?e:null}var P=Symbol.for("react.client.reference");function O(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===P?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case m:return"Fragment";case y:return"Profiler";case v:return"StrictMode";case _:return"Suspense";case C:return"SuspenseList";case E:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case g:return"Portal";case w:return(e.displayName||"Context")+".Provider";case x:return(e._context.displayName||"Context")+".Consumer";case S:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:O(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return O(e(t))}catch(n){}}return null}var D=Array.isArray,N=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R={pending:!1,data:null,method:null,action:null},F=[],I=-1;function z(e){return{current:e}}function W(e){0>I||(e.current=F[I],F[I]=null,I--)}function B(e,t){I++,F[I]=e.current,e.current=t}var H=z(null),U=z(null),V=z(null),G=z(null);function X(e,t){switch(B(V,t),B(U,e),B(H,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?iu(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=ru(t=iu(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(H),B(H,e)}function Y(){W(H),W(U),W(V)}function q(e){null!==e.memoizedState&&B(G,e);var t=H.current,n=ru(t,e.type);t!==n&&(B(U,e),B(H,n))}function K(e){U.current===e&&(W(H),W(U)),G.current===e&&(W(G),qu._currentValue=R)}var Q=Object.prototype.hasOwnProperty,$=s.unstable_scheduleCallback,J=s.unstable_cancelCallback,Z=s.unstable_shouldYield,ee=s.unstable_requestPaint,te=s.unstable_now,ne=s.unstable_getCurrentPriorityLevel,se=s.unstable_ImmediatePriority,ie=s.unstable_UserBlockingPriority,re=s.unstable_NormalPriority,ae=s.unstable_LowPriority,oe=s.unstable_IdlePriority,le=s.log,ce=s.unstable_setDisableYieldValue,he=null,ue=null;function de(e){if("function"===typeof le&&ce(e),ue&&"function"===typeof ue.setStrictMode)try{ue.setStrictMode(he,e)}catch(t){}}var fe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(pe(e)/ge|0)|0},pe=Math.log,ge=Math.LN2;var me=256,ve=4194304;function ye(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function be(e,t,n){var s=e.pendingLanes;if(0===s)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes;e=e.warmLanes;var o=134217727&s;return 0!==o?0!==(s=o&~r)?i=ye(s):0!==(a&=o)?i=ye(a):n||0!==(n=o&~e)&&(i=ye(n)):0!==(o=s&~r)?i=ye(o):0!==a?i=ye(a):n||0!==(n=s&~e)&&(i=ye(n)),0===i?0:0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(n=t&-t)||32===r&&0!==(4194048&n))?t:i}function xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function we(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Se(){var e=me;return 0===(4194048&(me<<=1))&&(me=256),e}function _e(){var e=ve;return 0===(62914560&(ve<<=1))&&(ve=4194304),e}function Ce(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ke(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ae(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-fe(t);e.entangledLanes|=t,e.entanglements[s]=1073741824|e.entanglements[s]|4194090&n}function Ee(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-fe(n),i=1<<s;i&t|e[s]&t&&(e[s]|=t),n&=~i}}function Te(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Me(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function je(){var e=L.p;return 0!==e?e:void 0===(e=window.event)?32:cd(e.type)}var Pe=Math.random().toString(36).slice(2),Oe="__reactFiber$"+Pe,De="__reactProps$"+Pe,Ne="__reactContainer$"+Pe,Le="__reactEvents$"+Pe,Re="__reactListeners$"+Pe,Fe="__reactHandles$"+Pe,Ie="__reactResources$"+Pe,ze="__reactMarker$"+Pe;function We(e){delete e[Oe],delete e[De],delete e[Le],delete e[Re],delete e[Fe]}function Be(e){var t=e[Oe];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ne]||n[Oe]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=bu(e);null!==e;){if(n=e[Oe])return n;e=bu(e)}return t}n=(e=n).parentNode}return null}function He(e){if(e=e[Oe]||e[Ne]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ue(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function Ve(e){var t=e[Ie];return t||(t=e[Ie]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Ge(e){e[ze]=!0}var Xe=new Set,Ye={};function qe(e,t){Ke(e,t),Ke(e+"Capture",t)}function Ke(e,t){for(Ye[e]=t,e=0;e<t.length;e++)Xe.add(t[e])}var Qe,$e,Je=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ze={},et={};function tt(e,t,n){if(i=t,Q.call(et,i)||!Q.call(Ze,i)&&(Je.test(i)?et[i]=!0:(Ze[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var s=t.toLowerCase().slice(0,5);if("data-"!==s&&"aria-"!==s)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function st(e,t,n,s){if(null===s)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+s)}}function it(e){if(void 0===Qe)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Qe=t&&t[1]||"",$e=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Qe+e+$e}var rt=!1;function at(e,t){if(!e||rt)return"";rt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var s=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(r){s=r}e.call(n.prototype)}}else{try{throw Error()}catch(a){s=a}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(o){if(o&&s&&"string"===typeof o.stack)return[o.stack,s.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=s.DetermineComponentFrameRoot(),a=r[0],o=r[1];if(a&&o){var l=a.split("\n"),c=o.split("\n");for(i=s=0;s<l.length&&!l[s].includes("DetermineComponentFrameRoot");)s++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(s===l.length||i===c.length)for(s=l.length-1,i=c.length-1;1<=s&&0<=i&&l[s]!==c[i];)i--;for(;1<=s&&0<=i;s--,i--)if(l[s]!==c[i]){if(1!==s||1!==i)do{if(s--,0>--i||l[s]!==c[i]){var h="\n"+l[s].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),h}}while(1<=s&&0<=i);break}}}finally{rt=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?it(n):""}function ot(e){switch(e.tag){case 26:case 27:case 5:return it(e.type);case 16:return it("Lazy");case 13:return it("Suspense");case 19:return it("SuspenseList");case 0:case 15:return at(e.type,!1);case 11:return at(e.type.render,!1);case 1:return at(e.type,!0);case 31:return it("Activity");default:return""}}function lt(e){try{var t="";do{t+=ot(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ht(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ut(e){e._valueTracker||(e._valueTracker=function(e){var t=ht(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){s=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(e){s=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function dt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=ht(e)?e.checked?"true":"false":e.value),(e=s)!==n&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var pt=/[\n"\\]/g;function gt(e){return e.replace(pt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function mt(e,t,n,s,i,r,a,o){e.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?yt(e,a,ct(t)):null!=n?yt(e,a,ct(n)):null!=s&&e.removeAttribute("value"),null==i&&null!=r&&(e.defaultChecked=!!r),null!=i&&(e.checked=i&&"function"!==typeof i&&"symbol"!==typeof i),null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?e.name=""+ct(o):e.removeAttribute("name")}function vt(e,t,n,s,i,r,a,o){if(null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&"boolean"!==typeof r&&(e.type=r),null!=t||null!=n){if(!("submit"!==r&&"reset"!==r||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,o||t===e.value||(e.value=t),e.defaultValue=t}s="function"!==typeof(s=null!=s?s:i)&&"symbol"!==typeof s&&!!s,e.checked=o?e.checked:!!s,e.defaultChecked=!!s,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.name=a)}function yt(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function bt(e,t,n,s){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&s&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(s&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function wt(e,t,n,s){if(null==t){if(null!=s){if(null!=n)throw Error(a(92));if(D(s)){if(1<s.length)throw Error(a(93));s=s[0]}n=s}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(s=e.textContent)===n&&""!==s&&null!==s&&(e.value=s)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var _t=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ct(e,t,n){var s=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?s?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":s?e.setProperty(t,n):"number"!==typeof n||0===n||_t.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function kt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var s in n)!n.hasOwnProperty(s)||null!=t&&t.hasOwnProperty(s)||(0===s.indexOf("--")?e.setProperty(s,""):"float"===s?e.cssFloat="":e[s]="");for(var i in t)s=t[i],t.hasOwnProperty(i)&&n[i]!==s&&Ct(e,i,s)}else for(var r in t)t.hasOwnProperty(r)&&Ct(e,r,t[r])}function At(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Et=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mt(e){return Tt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var jt=null;function Pt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ot=null,Dt=null;function Nt(e){var t=He(e);if(t&&(e=t.stateNode)){var n=e[De]||null;e:switch(e=t.stateNode,t.type){case"input":if(mt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+gt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var i=s[De]||null;if(!i)throw Error(a(90));mt(s,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(s=n[t]).form===e.form&&dt(s)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&bt(e,!!n.multiple,t,!1)}}}var Lt=!1;function Rt(e,t,n){if(Lt)return e(t,n);Lt=!0;try{return e(t)}finally{if(Lt=!1,(null!==Ot||null!==Dt)&&(Bc(),Ot&&(t=Ot,e=Dt,Dt=Ot=null,Nt(t),e)))for(t=0;t<e.length;t++)Nt(e[t])}}function Ft(e,t){var n=e.stateNode;if(null===n)return null;var s=n[De]||null;if(null===s)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var It=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),zt=!1;if(It)try{var Wt={};Object.defineProperty(Wt,"passive",{get:function(){zt=!0}}),window.addEventListener("test",Wt,Wt),window.removeEventListener("test",Wt,Wt)}catch(Dd){zt=!1}var Bt=null,Ht=null,Ut=null;function Vt(){if(Ut)return Ut;var e,t,n=Ht,s=n.length,i="value"in Bt?Bt.value:Bt.textContent,r=i.length;for(e=0;e<s&&n[e]===i[e];e++);var a=s-e;for(t=1;t<=a&&n[s-t]===i[r-t];t++);return Ut=i.slice(e,1<t?1-t:void 0)}function Gt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Xt(){return!0}function Yt(){return!1}function qt(e){function t(t,n,s,i,r){for(var a in this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Xt:Yt,this.isPropagationStopped=Yt,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Xt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Xt)},persist:function(){},isPersistent:Xt}),t}var Kt,Qt,$t,Jt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zt=qt(Jt),en=d({},Jt,{view:0,detail:0}),tn=qt(en),nn=d({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$t&&($t&&"mousemove"===e.type?(Kt=e.screenX-$t.screenX,Qt=e.screenY-$t.screenY):Qt=Kt=0,$t=e),Kt)},movementY:function(e){return"movementY"in e?e.movementY:Qt}}),sn=qt(nn),rn=qt(d({},nn,{dataTransfer:0})),an=qt(d({},en,{relatedTarget:0})),on=qt(d({},Jt,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=qt(d({},Jt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=qt(d({},Jt,{data:0})),hn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},un={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=dn[e])&&!!t[e]}function pn(){return fn}var gn=qt(d({},en,{key:function(e){if(e.key){var t=hn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Gt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?un[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Gt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Gt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),mn=qt(d({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),vn=qt(d({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),yn=qt(d({},Jt,{propertyName:0,elapsedTime:0,pseudoElement:0})),bn=qt(d({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=qt(d({},Jt,{newState:0,oldState:0})),wn=[9,13,27,32],Sn=It&&"CompositionEvent"in window,_n=null;It&&"documentMode"in document&&(_n=document.documentMode);var Cn=It&&"TextEvent"in window&&!_n,kn=It&&(!Sn||_n&&8<_n&&11>=_n),An=String.fromCharCode(32),En=!1;function Tn(e,t){switch(e){case"keyup":return-1!==wn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Pn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function On(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Pn[e.type]:"textarea"===t}function Dn(e,t,n,s){Ot?Dt?Dt.push(s):Dt=[s]:Ot=s,0<(t=Vh(t,"onChange")).length&&(n=new Zt("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Nn=null,Ln=null;function Rn(e){Rh(e,0)}function Fn(e){if(dt(Ue(e)))return e}function In(e,t){if("change"===e)return t}var zn=!1;if(It){var Wn;if(It){var Bn="oninput"in document;if(!Bn){var Hn=document.createElement("div");Hn.setAttribute("oninput","return;"),Bn="function"===typeof Hn.oninput}Wn=Bn}else Wn=!1;zn=Wn&&(!document.documentMode||9<document.documentMode)}function Un(){Nn&&(Nn.detachEvent("onpropertychange",Vn),Ln=Nn=null)}function Vn(e){if("value"===e.propertyName&&Fn(Ln)){var t=[];Dn(t,Ln,e,Pt(e)),Rt(Rn,t)}}function Gn(e,t,n){"focusin"===e?(Un(),Ln=n,(Nn=t).attachEvent("onpropertychange",Vn)):"focusout"===e&&Un()}function Xn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Fn(Ln)}function Yn(e,t){if("click"===e)return Fn(t)}function qn(e,t){if("input"===e||"change"===e)return Fn(t)}var Kn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Qn(e,t){if(Kn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var i=n[s];if(!Q.call(t,i)||!Kn(e[i],t[i]))return!1}return!0}function $n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Jn(e,t){var n,s=$n(e);for(e=0;s;){if(3===s.nodeType){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=$n(s)}}function Zn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Zn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function es(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(s){n=!1}if(!n)break;t=ft((e=t.contentWindow).document)}return t}function ts(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ns=It&&"documentMode"in document&&11>=document.documentMode,ss=null,is=null,rs=null,as=!1;function os(e,t,n){var s=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;as||null==ss||ss!==ft(s)||("selectionStart"in(s=ss)&&ts(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},rs&&Qn(rs,s)||(rs=s,0<(s=Vh(is,"onSelect")).length&&(t=new Zt("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=ss)))}function ls(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var cs={animationend:ls("Animation","AnimationEnd"),animationiteration:ls("Animation","AnimationIteration"),animationstart:ls("Animation","AnimationStart"),transitionrun:ls("Transition","TransitionRun"),transitionstart:ls("Transition","TransitionStart"),transitioncancel:ls("Transition","TransitionCancel"),transitionend:ls("Transition","TransitionEnd")},hs={},us={};function ds(e){if(hs[e])return hs[e];if(!cs[e])return e;var t,n=cs[e];for(t in n)if(n.hasOwnProperty(t)&&t in us)return hs[e]=n[t];return e}It&&(us=document.createElement("div").style,"AnimationEvent"in window||(delete cs.animationend.animation,delete cs.animationiteration.animation,delete cs.animationstart.animation),"TransitionEvent"in window||delete cs.transitionend.transition);var fs=ds("animationend"),ps=ds("animationiteration"),gs=ds("animationstart"),ms=ds("transitionrun"),vs=ds("transitionstart"),ys=ds("transitioncancel"),bs=ds("transitionend"),xs=new Map,ws="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ss(e,t){xs.set(e,t),qe(t,[e])}ws.push("scrollEnd");var _s=new WeakMap;function Cs(e,t){if("object"===typeof e&&null!==e){var n=_s.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},_s.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var ks=[],As=0,Es=0;function Ts(){for(var e=As,t=Es=As=0;t<e;){var n=ks[t];ks[t++]=null;var s=ks[t];ks[t++]=null;var i=ks[t];ks[t++]=null;var r=ks[t];if(ks[t++]=null,null!==s&&null!==i){var a=s.pending;null===a?i.next=i:(i.next=a.next,a.next=i),s.pending=i}0!==r&&Os(n,i,r)}}function Ms(e,t,n,s){ks[As++]=e,ks[As++]=t,ks[As++]=n,ks[As++]=s,Es|=s,e.lanes|=s,null!==(e=e.alternate)&&(e.lanes|=s)}function js(e,t,n,s){return Ms(e,t,n,s),Ds(e)}function Ps(e,t){return Ms(e,null,null,t),Ds(e)}function Os(e,t,n){e.lanes|=n;var s=e.alternate;null!==s&&(s.lanes|=n);for(var i=!1,r=e.return;null!==r;)r.childLanes|=n,null!==(s=r.alternate)&&(s.childLanes|=n),22===r.tag&&(null===(e=r.stateNode)||1&e._visibility||(i=!0)),e=r,r=r.return;return 3===e.tag?(r=e.stateNode,i&&null!==t&&(i=31-fe(n),null===(s=(e=r.hiddenUpdates)[i])?e[i]=[t]:s.push(t),t.lane=536870912|n),r):null}function Ds(e){if(50<Oc)throw Oc=0,Dc=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ns={};function Ls(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rs(e,t,n,s){return new Ls(e,t,n,s)}function Fs(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Is(e,t){var n=e.alternate;return null===n?((n=Rs(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function zs(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Ws(e,t,n,s,i,r){var o=0;if(s=e,"function"===typeof e)Fs(e)&&(o=1);else if("string"===typeof e)o=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,H.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case E:return(e=Rs(31,n,t,i)).elementType=E,e.lanes=r,e;case m:return Bs(n.children,i,r,t);case v:o=8,i|=24;break;case y:return(e=Rs(12,n,t,2|i)).elementType=y,e.lanes=r,e;case _:return(e=Rs(13,n,t,i)).elementType=_,e.lanes=r,e;case C:return(e=Rs(19,n,t,i)).elementType=C,e.lanes=r,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case b:case w:o=10;break e;case x:o=9;break e;case S:o=11;break e;case k:o=14;break e;case A:o=16,s=null;break e}o=29,n=Error(a(130,null===e?"null":typeof e,"")),s=null}return(t=Rs(o,n,t,i)).elementType=e,t.type=s,t.lanes=r,t}function Bs(e,t,n,s){return(e=Rs(7,e,s,t)).lanes=n,e}function Hs(e,t,n){return(e=Rs(6,e,null,t)).lanes=n,e}function Us(e,t,n){return(t=Rs(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Vs=[],Gs=0,Xs=null,Ys=0,qs=[],Ks=0,Qs=null,$s=1,Js="";function Zs(e,t){Vs[Gs++]=Ys,Vs[Gs++]=Xs,Xs=e,Ys=t}function ei(e,t,n){qs[Ks++]=$s,qs[Ks++]=Js,qs[Ks++]=Qs,Qs=e;var s=$s;e=Js;var i=32-fe(s)-1;s&=~(1<<i),n+=1;var r=32-fe(t)+i;if(30<r){var a=i-i%5;r=(s&(1<<a)-1).toString(32),s>>=a,i-=a,$s=1<<32-fe(t)+i|n<<i|s,Js=r+e}else $s=1<<r|n<<i|s,Js=e}function ti(e){null!==e.return&&(Zs(e,1),ei(e,1,0))}function ni(e){for(;e===Xs;)Xs=Vs[--Gs],Vs[Gs]=null,Ys=Vs[--Gs],Vs[Gs]=null;for(;e===Qs;)Qs=qs[--Ks],qs[Ks]=null,Js=qs[--Ks],qs[Ks]=null,$s=qs[--Ks],qs[Ks]=null}var si=null,ii=null,ri=!1,ai=null,oi=!1,li=Error(a(519));function ci(e){throw gi(Cs(Error(a(418,"")),e)),li}function hi(e){var t=e.stateNode,n=e.type,s=e.memoizedProps;switch(t[Oe]=e,t[De]=s,n){case"dialog":Fh("cancel",t),Fh("close",t);break;case"iframe":case"object":case"embed":Fh("load",t);break;case"video":case"audio":for(n=0;n<Nh.length;n++)Fh(Nh[n],t);break;case"source":Fh("error",t);break;case"img":case"image":case"link":Fh("error",t),Fh("load",t);break;case"details":Fh("toggle",t);break;case"input":Fh("invalid",t),vt(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0),ut(t);break;case"select":Fh("invalid",t);break;case"textarea":Fh("invalid",t),wt(t,s.value,s.defaultValue,s.children),ut(t)}"string"!==typeof(n=s.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===s.suppressHydrationWarning||Qh(t.textContent,n)?(null!=s.popover&&(Fh("beforetoggle",t),Fh("toggle",t)),null!=s.onScroll&&Fh("scroll",t),null!=s.onScrollEnd&&Fh("scrollend",t),null!=s.onClick&&(t.onclick=$h),t=!0):t=!1,t||ci(e)}function ui(e){for(si=e.return;si;)switch(si.tag){case 5:case 13:return void(oi=!1);case 27:case 3:return void(oi=!0);default:si=si.return}}function di(e){if(e!==si)return!1;if(!ri)return ui(e),ri=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||au(e.type,e.memoizedProps)),t=!t),t&&ii&&ci(e),ui(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){ii=vu(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}ii=null}}else 27===n?(n=ii,fu(e.type)?(e=yu,yu=null,ii=e):ii=n):ii=si?vu(e.stateNode.nextSibling):null;return!0}function fi(){ii=si=null,ri=!1}function pi(){var e=ai;return null!==e&&(null===bc?bc=e:bc.push.apply(bc,e),ai=null),e}function gi(e){null===ai?ai=[e]:ai.push(e)}var mi=z(null),vi=null,yi=null;function bi(e,t,n){B(mi,t._currentValue),t._currentValue=n}function xi(e){e._currentValue=mi.current,W(mi)}function wi(e,t,n){for(;null!==e;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==s&&(s.childLanes|=t)):null!==s&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function Si(e,t,n,s){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var r=i.dependencies;if(null!==r){var o=i.child;r=r.firstContext;e:for(;null!==r;){var l=r;r=i;for(var c=0;c<t.length;c++)if(l.context===t[c]){r.lanes|=n,null!==(l=r.alternate)&&(l.lanes|=n),wi(r.return,n,e),s||(o=null);break e}r=l.next}}else if(18===i.tag){if(null===(o=i.return))throw Error(a(341));o.lanes|=n,null!==(r=o.alternate)&&(r.lanes|=n),wi(o,n,e),o=null}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===e){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}}function _i(e,t,n,s){e=null;for(var i=t,r=!1;null!==i;){if(!r)if(0!==(524288&i.flags))r=!0;else if(0!==(262144&i.flags))break;if(10===i.tag){var o=i.alternate;if(null===o)throw Error(a(387));if(null!==(o=o.memoizedProps)){var l=i.type;Kn(i.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(i===G.current){if(null===(o=i.alternate))throw Error(a(387));o.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(qu):e=[qu])}i=i.return}null!==e&&Si(t,e,n,s),t.flags|=262144}function Ci(e){for(e=e.firstContext;null!==e;){if(!Kn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ki(e){vi=e,yi=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ai(e){return Ti(vi,e)}function Ei(e,t){return null===vi&&ki(e),Ti(e,t)}function Ti(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===yi){if(null===e)throw Error(a(308));yi=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else yi=yi.next=t;return n}var Mi="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ji=s.unstable_scheduleCallback,Pi=s.unstable_NormalPriority,Oi={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Di(){return{controller:new Mi,data:new Map,refCount:0}}function Ni(e){e.refCount--,0===e.refCount&&ji(Pi,function(){e.controller.abort()})}var Li=null,Ri=0,Fi=0,Ii=null;function zi(){if(0===--Ri&&null!==Li){null!==Ii&&(Ii.status="fulfilled");var e=Li;Li=null,Fi=0,Ii=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Wi=N.S;N.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Li){var n=Li=[];Ri=0,Fi=Mh(),Ii={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ri++,t.then(zi,zi)}(0,t),null!==Wi&&Wi(e,t)};var Bi=z(null);function Hi(){var e=Bi.current;return null!==e?e:sc.pooledCache}function Ui(e,t){B(Bi,null===t?Bi.current:t.pool)}function Vi(){var e=Hi();return null===e?null:{parent:Oi._currentValue,pool:e}}var Gi=Error(a(460)),Xi=Error(a(474)),Yi=Error(a(542)),qi={then:function(){}};function Ki(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Qi(){}function $i(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Qi,Qi),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw er(e=t.reason),e;default:if("string"===typeof t.status)t.then(Qi,Qi);else{if(null!==(e=sc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw er(e=t.reason),e}throw Ji=t,Gi}}var Ji=null;function Zi(){if(null===Ji)throw Error(a(459));var e=Ji;return Ji=null,e}function er(e){if(e===Gi||e===Yi)throw Error(a(483))}var tr=!1;function nr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function sr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ir(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function rr(e,t,n){var s=e.updateQueue;if(null===s)return null;if(s=s.shared,0!==(2&nc)){var i=s.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),s.pending=t,t=Ds(e),Os(e,null,n),t}return Ms(e,s,t,n),Ds(e)}function ar(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,Ee(e,n)}}function or(e,t){var n=e.updateQueue,s=e.alternate;if(null!==s&&n===(s=s.updateQueue)){var i=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===r?i=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?i=r=t:r=r.next=t}else i=r=t;return n={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,callbacks:s.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var lr=!1;function cr(){if(lr){if(null!==Ii)throw Ii}}function hr(e,t,n,s){lr=!1;var i=e.updateQueue;tr=!1;var r=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?r=c:a.next=c,a=l;var h=e.alternate;null!==h&&((o=(h=h.updateQueue).lastBaseUpdate)!==a&&(null===o?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=l))}if(null!==r){var u=i.baseState;for(a=0,h=c=l=null,o=r;;){var f=-536870913&o.lane,p=f!==o.lane;if(p?(rc&f)===f:(s&f)===f){0!==f&&f===Fi&&(lr=!0),null!==h&&(h=h.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var g=e,m=o;f=t;var v=n;switch(m.tag){case 1:if("function"===typeof(g=m.payload)){u=g.call(v,u,f);break e}u=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(f="function"===typeof(g=m.payload)?g.call(v,u,f):g)||void 0===f)break e;u=d({},u,f);break e;case 2:tr=!0}}null!==(f=o.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[f]:p.push(f))}else p={lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(c=h=p,l=u):h=h.next=p,a|=f;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(p=o).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===h&&(l=u),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=h,null===r&&(i.shared.lanes=0),fc|=a,e.lanes=a,e.memoizedState=u}}function ur(e,t){if("function"!==typeof e)throw Error(a(191,e));e.call(t)}function dr(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ur(n[e],t)}var fr=z(null),pr=z(0);function gr(e,t){B(pr,e=uc),B(fr,t),uc=e|t.baseLanes}function mr(){B(pr,uc),B(fr,fr.current)}function vr(){uc=pr.current,W(fr),W(pr)}var yr=0,br=null,xr=null,wr=null,Sr=!1,_r=!1,Cr=!1,kr=0,Ar=0,Er=null,Tr=0;function Mr(){throw Error(a(321))}function jr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Kn(e[n],t[n]))return!1;return!0}function Pr(e,t,n,s,i,r){return yr=r,br=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,N.H=null===e||null===e.memoizedState?Ga:Xa,Cr=!1,r=n(s,i),Cr=!1,_r&&(r=Dr(t,n,s,i)),Or(e),r}function Or(e){N.H=Va;var t=null!==xr&&null!==xr.next;if(yr=0,wr=xr=br=null,Sr=!1,Ar=0,Er=null,t)throw Error(a(300));null===e||Eo||null!==(e=e.dependencies)&&Ci(e)&&(Eo=!0)}function Dr(e,t,n,s){br=e;var i=0;do{if(_r&&(Er=null),Ar=0,_r=!1,25<=i)throw Error(a(301));if(i+=1,wr=xr=null,null!=e.updateQueue){var r=e.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,null!=r.memoCache&&(r.memoCache.index=0)}N.H=Ya,r=t(n,s)}while(_r);return r}function Nr(){var e=N.H,t=e.useState()[0];return t="function"===typeof t.then?Wr(t):t,e=e.useState()[0],(null!==xr?xr.memoizedState:null)!==e&&(br.flags|=1024),t}function Lr(){var e=0!==kr;return kr=0,e}function Rr(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Fr(e){if(Sr){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Sr=!1}yr=0,wr=xr=br=null,_r=!1,Ar=kr=0,Er=null}function Ir(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wr?br.memoizedState=wr=e:wr=wr.next=e,wr}function zr(){if(null===xr){var e=br.alternate;e=null!==e?e.memoizedState:null}else e=xr.next;var t=null===wr?br.memoizedState:wr.next;if(null!==t)wr=t,xr=e;else{if(null===e){if(null===br.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(xr=e).memoizedState,baseState:xr.baseState,baseQueue:xr.baseQueue,queue:xr.queue,next:null},null===wr?br.memoizedState=wr=e:wr=wr.next=e}return wr}function Wr(e){var t=Ar;return Ar+=1,null===Er&&(Er=[]),e=$i(Er,e,t),t=br,null===(null===wr?t.memoizedState:wr.next)&&(t=t.alternate,N.H=null===t||null===t.memoizedState?Ga:Xa),e}function Br(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Wr(e);if(e.$$typeof===w)return Ai(e)}throw Error(a(438,String(e)))}function Hr(e){var t=null,n=br.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var s=br.alternate;null!==s&&(null!==(s=s.updateQueue)&&(null!=(s=s.memoCache)&&(t={data:s.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},br.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),s=0;s<e;s++)n[s]=T;return t.index++,n}function Ur(e,t){return"function"===typeof t?t(e):t}function Vr(e){return Gr(zr(),xr,e)}function Gr(e,t,n){var s=e.queue;if(null===s)throw Error(a(311));s.lastRenderedReducer=n;var i=e.baseQueue,r=s.pending;if(null!==r){if(null!==i){var o=i.next;i.next=r.next,r.next=o}t.baseQueue=i=r,s.pending=null}if(r=e.baseState,null===i)e.memoizedState=r;else{var l=o=null,c=null,h=t=i.next,u=!1;do{var d=-536870913&h.lane;if(d!==h.lane?(rc&d)===d:(yr&d)===d){var f=h.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),d===Fi&&(u=!0);else{if((yr&f)===f){h=h.next,f===Fi&&(u=!0);continue}d={lane:0,revertLane:h.revertLane,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},null===c?(l=c=d,o=r):c=c.next=d,br.lanes|=f,fc|=f}d=h.action,Cr&&n(r,d),r=h.hasEagerState?h.eagerState:n(r,d)}else f={lane:d,revertLane:h.revertLane,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},null===c?(l=c=f,o=r):c=c.next=f,br.lanes|=d,fc|=d;h=h.next}while(null!==h&&h!==t);if(null===c?o=r:c.next=l,!Kn(r,e.memoizedState)&&(Eo=!0,u&&null!==(n=Ii)))throw n;e.memoizedState=r,e.baseState=o,e.baseQueue=c,s.lastRenderedState=r}return null===i&&(s.lanes=0),[e.memoizedState,s.dispatch]}function Xr(e){var t=zr(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var s=n.dispatch,i=n.pending,r=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{r=e(r,o.action),o=o.next}while(o!==i);Kn(r,t.memoizedState)||(Eo=!0),t.memoizedState=r,null===t.baseQueue&&(t.baseState=r),n.lastRenderedState=r}return[r,s]}function Yr(e,t,n){var s=br,i=zr(),r=ri;if(r){if(void 0===n)throw Error(a(407));n=n()}else n=t();var o=!Kn((xr||i).memoizedState,n);if(o&&(i.memoizedState=n,Eo=!0),i=i.queue,ma(2048,8,Qr.bind(null,s,i,e),[e]),i.getSnapshot!==t||o||null!==wr&&1&wr.memoizedState.tag){if(s.flags|=2048,fa(9,{destroy:void 0,resource:void 0},Kr.bind(null,s,i,n,t),null),null===sc)throw Error(a(349));r||0!==(124&yr)||qr(s,t,n)}return n}function qr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=br.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},br.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Kr(e,t,n,s){t.value=n,t.getSnapshot=s,$r(t)&&Jr(e)}function Qr(e,t,n){return n(function(){$r(t)&&Jr(e)})}function $r(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Kn(e,n)}catch(s){return!0}}function Jr(e){var t=Ps(e,2);null!==t&&Rc(t,e,2)}function Zr(e){var t=Ir();if("function"===typeof e){var n=e;if(e=n(),Cr){de(!0);try{n()}finally{de(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ur,lastRenderedState:e},t}function ea(e,t,n,s){return e.baseState=n,Gr(e,xr,"function"===typeof s?s:Ur)}function ta(e,t,n,s,i){if(Ba(e))throw Error(a(485));if(null!==(e=t.action)){var r={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){r.listeners.push(e)}};null!==N.T?n(!0):r.isTransition=!1,s(r),null===(n=t.pending)?(r.next=t.pending=r,na(t,r)):(r.next=n.next,t.pending=n.next=r)}}function na(e,t){var n=t.action,s=t.payload,i=e.state;if(t.isTransition){var r=N.T,a={};N.T=a;try{var o=n(i,s),l=N.S;null!==l&&l(a,o),sa(e,t,o)}catch(c){ra(e,t,c)}finally{N.T=r}}else try{sa(e,t,r=n(i,s))}catch(h){ra(e,t,h)}}function sa(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){ia(e,t,n)},function(n){return ra(e,t,n)}):ia(e,t,n)}function ia(e,t,n){t.status="fulfilled",t.value=n,aa(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,na(e,n)))}function ra(e,t,n){var s=e.pending;if(e.pending=null,null!==s){s=s.next;do{t.status="rejected",t.reason=n,aa(t),t=t.next}while(t!==s)}e.action=null}function aa(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function oa(e,t){return t}function la(e,t){if(ri){var n=sc.formState;if(null!==n){e:{var s=br;if(ri){if(ii){t:{for(var i=ii,r=oi;8!==i.nodeType;){if(!r){i=null;break t}if(null===(i=vu(i.nextSibling))){i=null;break t}}i="F!"===(r=i.data)||"F"===r?i:null}if(i){ii=vu(i.nextSibling),s="F!"===i.data;break e}}ci(s)}s=!1}s&&(t=n[0])}}return(n=Ir()).memoizedState=n.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oa,lastRenderedState:t},n.queue=s,n=Ia.bind(null,br,s),s.dispatch=n,s=Zr(!1),r=Wa.bind(null,br,!1,s.queue),i={state:t,dispatch:null,action:e,pending:null},(s=Ir()).queue=i,n=ta.bind(null,br,i,r,n),i.dispatch=n,s.memoizedState=e,[t,n,!1]}function ca(e){return ha(zr(),xr,e)}function ha(e,t,n){if(t=Gr(e,t,oa)[0],e=Vr(Ur)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var s=Wr(t)}catch(a){if(a===Gi)throw Yi;throw a}else s=t;var i=(t=zr()).queue,r=i.dispatch;return n!==t.memoizedState&&(br.flags|=2048,fa(9,{destroy:void 0,resource:void 0},ua.bind(null,i,n),null)),[s,r,e]}function ua(e,t){e.action=t}function da(e){var t=zr(),n=xr;if(null!==n)return ha(t,n,e);zr(),t=t.memoizedState;var s=(n=zr()).queue.dispatch;return n.memoizedState=e,[t,s,!1]}function fa(e,t,n,s){return e={tag:e,create:n,deps:s,inst:t,next:null},null===(t=br.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},br.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e),e}function pa(){return zr().memoizedState}function ga(e,t,n,s){var i=Ir();s=void 0===s?null:s,br.flags|=e,i.memoizedState=fa(1|t,{destroy:void 0,resource:void 0},n,s)}function ma(e,t,n,s){var i=zr();s=void 0===s?null:s;var r=i.memoizedState.inst;null!==xr&&null!==s&&jr(s,xr.memoizedState.deps)?i.memoizedState=fa(t,r,n,s):(br.flags|=e,i.memoizedState=fa(1|t,r,n,s))}function va(e,t){ga(8390656,8,e,t)}function ya(e,t){ma(2048,8,e,t)}function ba(e,t){return ma(4,2,e,t)}function xa(e,t){return ma(4,4,e,t)}function wa(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Sa(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,ma(4,4,wa.bind(null,t,e),n)}function _a(){}function Ca(e,t){var n=zr();t=void 0===t?null:t;var s=n.memoizedState;return null!==t&&jr(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function ka(e,t){var n=zr();t=void 0===t?null:t;var s=n.memoizedState;if(null!==t&&jr(t,s[1]))return s[0];if(s=e(),Cr){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[s,t],s}function Aa(e,t,n){return void 0===n||0!==(1073741824&yr)?e.memoizedState=t:(e.memoizedState=n,e=Lc(),br.lanes|=e,fc|=e,n)}function Ea(e,t,n,s){return Kn(n,t)?n:null!==fr.current?(e=Aa(e,n,s),Kn(e,t)||(Eo=!0),e):0===(42&yr)?(Eo=!0,e.memoizedState=n):(e=Lc(),br.lanes|=e,fc|=e,t)}function Ta(e,t,n,s,i){var r=L.p;L.p=0!==r&&8>r?r:8;var a=N.T,o={};N.T=o,Wa(e,!1,t,n);try{var l=i(),c=N.S;if(null!==c&&c(o,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)za(e,t,function(e,t){var n=[],s={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){s.status="fulfilled",s.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(s.status="rejected",s.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),s}(l,s),Nc());else za(e,t,s,Nc())}catch(h){za(e,t,{then:function(){},status:"rejected",reason:h},Nc())}finally{L.p=r,N.T=a}}function Ma(){}function ja(e,t,n,s){if(5!==e.tag)throw Error(a(476));var i=Pa(e).queue;Ta(e,i,t,R,null===n?Ma:function(){return Oa(e),n(s)})}function Pa(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:R,baseState:R,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ur,lastRenderedState:R},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ur,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Oa(e){za(e,Pa(e).next.queue,{},Nc())}function Da(){return Ai(qu)}function Na(){return zr().memoizedState}function La(){return zr().memoizedState}function Ra(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Nc(),s=rr(t,e=ir(n),n);return null!==s&&(Rc(s,t,n),ar(s,t,n)),t={cache:Di()},void(e.payload=t)}t=t.return}}function Fa(e,t,n){var s=Nc();n={lane:s,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Ba(e)?Ha(t,n):null!==(n=js(e,t,n,s))&&(Rc(n,e,s),Ua(n,t,s))}function Ia(e,t,n){za(e,t,n,Nc())}function za(e,t,n,s){var i={lane:s,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ba(e))Ha(t,i);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=r(a,n);if(i.hasEagerState=!0,i.eagerState=o,Kn(o,a))return Ms(e,t,i,0),null===sc&&Ts(),!1}catch(l){}if(null!==(n=js(e,t,i,s)))return Rc(n,e,s),Ua(n,t,s),!0}return!1}function Wa(e,t,n,s){if(s={lane:2,revertLane:Mh(),action:s,hasEagerState:!1,eagerState:null,next:null},Ba(e)){if(t)throw Error(a(479))}else null!==(t=js(e,n,s,2))&&Rc(t,e,2)}function Ba(e){var t=e.alternate;return e===br||null!==t&&t===br}function Ha(e,t){_r=Sr=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ua(e,t,n){if(0!==(4194048&n)){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,Ee(e,n)}}var Va={readContext:Ai,use:Br,useCallback:Mr,useContext:Mr,useEffect:Mr,useImperativeHandle:Mr,useLayoutEffect:Mr,useInsertionEffect:Mr,useMemo:Mr,useReducer:Mr,useRef:Mr,useState:Mr,useDebugValue:Mr,useDeferredValue:Mr,useTransition:Mr,useSyncExternalStore:Mr,useId:Mr,useHostTransitionStatus:Mr,useFormState:Mr,useActionState:Mr,useOptimistic:Mr,useMemoCache:Mr,useCacheRefresh:Mr},Ga={readContext:Ai,use:Br,useCallback:function(e,t){return Ir().memoizedState=[e,void 0===t?null:t],e},useContext:Ai,useEffect:va,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,ga(4194308,4,wa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ga(4194308,4,e,t)},useInsertionEffect:function(e,t){ga(4,2,e,t)},useMemo:function(e,t){var n=Ir();t=void 0===t?null:t;var s=e();if(Cr){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[s,t],s},useReducer:function(e,t,n){var s=Ir();if(void 0!==n){var i=n(t);if(Cr){de(!0);try{n(t)}finally{de(!1)}}}else i=t;return s.memoizedState=s.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},s.queue=e,e=e.dispatch=Fa.bind(null,br,e),[s.memoizedState,e]},useRef:function(e){return e={current:e},Ir().memoizedState=e},useState:function(e){var t=(e=Zr(e)).queue,n=Ia.bind(null,br,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:_a,useDeferredValue:function(e,t){return Aa(Ir(),e,t)},useTransition:function(){var e=Zr(!1);return e=Ta.bind(null,br,e.queue,!0,!1),Ir().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var s=br,i=Ir();if(ri){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===sc)throw Error(a(349));0!==(124&rc)||qr(s,t,n)}i.memoizedState=n;var r={value:n,getSnapshot:t};return i.queue=r,va(Qr.bind(null,s,r,e),[e]),s.flags|=2048,fa(9,{destroy:void 0,resource:void 0},Kr.bind(null,s,r,n,t),null),n},useId:function(){var e=Ir(),t=sc.identifierPrefix;if(ri){var n=Js;t="\xab"+t+"R"+(n=($s&~(1<<32-fe($s)-1)).toString(32)+n),0<(n=kr++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Tr++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Da,useFormState:la,useActionState:la,useOptimistic:function(e){var t=Ir();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Wa.bind(null,br,!0,n),n.dispatch=t,[e,t]},useMemoCache:Hr,useCacheRefresh:function(){return Ir().memoizedState=Ra.bind(null,br)}},Xa={readContext:Ai,use:Br,useCallback:Ca,useContext:Ai,useEffect:ya,useImperativeHandle:Sa,useInsertionEffect:ba,useLayoutEffect:xa,useMemo:ka,useReducer:Vr,useRef:pa,useState:function(){return Vr(Ur)},useDebugValue:_a,useDeferredValue:function(e,t){return Ea(zr(),xr.memoizedState,e,t)},useTransition:function(){var e=Vr(Ur)[0],t=zr().memoizedState;return["boolean"===typeof e?e:Wr(e),t]},useSyncExternalStore:Yr,useId:Na,useHostTransitionStatus:Da,useFormState:ca,useActionState:ca,useOptimistic:function(e,t){return ea(zr(),0,e,t)},useMemoCache:Hr,useCacheRefresh:La},Ya={readContext:Ai,use:Br,useCallback:Ca,useContext:Ai,useEffect:ya,useImperativeHandle:Sa,useInsertionEffect:ba,useLayoutEffect:xa,useMemo:ka,useReducer:Xr,useRef:pa,useState:function(){return Xr(Ur)},useDebugValue:_a,useDeferredValue:function(e,t){var n=zr();return null===xr?Aa(n,e,t):Ea(n,xr.memoizedState,e,t)},useTransition:function(){var e=Xr(Ur)[0],t=zr().memoizedState;return["boolean"===typeof e?e:Wr(e),t]},useSyncExternalStore:Yr,useId:Na,useHostTransitionStatus:Da,useFormState:da,useActionState:da,useOptimistic:function(e,t){var n=zr();return null!==xr?ea(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Hr,useCacheRefresh:La},qa=null,Ka=0;function Qa(e){var t=Ka;return Ka+=1,null===qa&&(qa=[]),$i(qa,e,t)}function $a(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Ja(e,t){if(t.$$typeof===f)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Za(e){return(0,e._init)(e._payload)}function eo(e){function t(t,n){if(e){var s=t.deletions;null===s?(t.deletions=[n],t.flags|=16):s.push(n)}}function n(n,s){if(!e)return null;for(;null!==s;)t(n,s),s=s.sibling;return null}function s(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=Is(e,t)).index=0,e.sibling=null,e}function r(t,n,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<n?(t.flags|=67108866,n):s:(t.flags|=67108866,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,s){return null===t||6!==t.tag?((t=Hs(n,e.mode,s)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,s){var r=n.type;return r===m?u(e,t,n.props.children,s,n.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===A&&Za(r)===t.type)?($a(t=i(t,n.props),n),t.return=e,t):($a(t=Ws(n.type,n.key,n.props,null,e.mode,s),n),t.return=e,t)}function h(e,t,n,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Us(n,e.mode,s)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,s,r){return null===t||7!==t.tag?((t=Bs(n,e.mode,s,r)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Hs(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return $a(n=Ws(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case g:return(t=Us(t,e.mode,n)).return=e,t;case A:return d(e,t=(0,t._init)(t._payload),n)}if(D(t)||j(t))return(t=Bs(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return d(e,Qa(t),n);if(t.$$typeof===w)return d(e,Ei(e,t),n);Ja(e,t)}return null}function f(e,t,n,s){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==i?null:l(e,t,""+n,s);if("object"===typeof n&&null!==n){switch(n.$$typeof){case p:return n.key===i?c(e,t,n,s):null;case g:return n.key===i?h(e,t,n,s):null;case A:return f(e,t,n=(i=n._init)(n._payload),s)}if(D(n)||j(n))return null!==i?null:u(e,t,n,s,null);if("function"===typeof n.then)return f(e,t,Qa(n),s);if(n.$$typeof===w)return f(e,t,Ei(e,n),s);Ja(e,n)}return null}function v(e,t,n,s,i){if("string"===typeof s&&""!==s||"number"===typeof s||"bigint"===typeof s)return l(t,e=e.get(n)||null,""+s,i);if("object"===typeof s&&null!==s){switch(s.$$typeof){case p:return c(t,e=e.get(null===s.key?n:s.key)||null,s,i);case g:return h(t,e=e.get(null===s.key?n:s.key)||null,s,i);case A:return v(e,t,n,s=(0,s._init)(s._payload),i)}if(D(s)||j(s))return u(t,e=e.get(n)||null,s,i,null);if("function"===typeof s.then)return v(e,t,n,Qa(s),i);if(s.$$typeof===w)return v(e,t,n,Ei(t,s),i);Ja(t,s)}return null}function y(l,c,h,u){if("object"===typeof h&&null!==h&&h.type===m&&null===h.key&&(h=h.props.children),"object"===typeof h&&null!==h){switch(h.$$typeof){case p:e:{for(var b=h.key;null!==c;){if(c.key===b){if((b=h.type)===m){if(7===c.tag){n(l,c.sibling),(u=i(c,h.props.children)).return=l,l=u;break e}}else if(c.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===A&&Za(b)===c.type){n(l,c.sibling),$a(u=i(c,h.props),h),u.return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}h.type===m?((u=Bs(h.props.children,l.mode,u,h.key)).return=l,l=u):($a(u=Ws(h.type,h.key,h.props,null,l.mode,u),h),u.return=l,l=u)}return o(l);case g:e:{for(b=h.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===h.containerInfo&&c.stateNode.implementation===h.implementation){n(l,c.sibling),(u=i(c,h.children||[])).return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}(u=Us(h,l.mode,u)).return=l,l=u}return o(l);case A:return y(l,c,h=(b=h._init)(h._payload),u)}if(D(h))return function(i,a,o,l){for(var c=null,h=null,u=a,p=a=0,g=null;null!==u&&p<o.length;p++){u.index>p?(g=u,u=null):g=u.sibling;var m=f(i,u,o[p],l);if(null===m){null===u&&(u=g);break}e&&u&&null===m.alternate&&t(i,u),a=r(m,a,p),null===h?c=m:h.sibling=m,h=m,u=g}if(p===o.length)return n(i,u),ri&&Zs(i,p),c;if(null===u){for(;p<o.length;p++)null!==(u=d(i,o[p],l))&&(a=r(u,a,p),null===h?c=u:h.sibling=u,h=u);return ri&&Zs(i,p),c}for(u=s(u);p<o.length;p++)null!==(g=v(u,i,p,o[p],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?p:g.key),a=r(g,a,p),null===h?c=g:h.sibling=g,h=g);return e&&u.forEach(function(e){return t(i,e)}),ri&&Zs(i,p),c}(l,c,h,u);if(j(h)){if("function"!==typeof(b=j(h)))throw Error(a(150));return function(i,o,l,c){if(null==l)throw Error(a(151));for(var h=null,u=null,p=o,g=o=0,m=null,y=l.next();null!==p&&!y.done;g++,y=l.next()){p.index>g?(m=p,p=null):m=p.sibling;var b=f(i,p,y.value,c);if(null===b){null===p&&(p=m);break}e&&p&&null===b.alternate&&t(i,p),o=r(b,o,g),null===u?h=b:u.sibling=b,u=b,p=m}if(y.done)return n(i,p),ri&&Zs(i,g),h;if(null===p){for(;!y.done;g++,y=l.next())null!==(y=d(i,y.value,c))&&(o=r(y,o,g),null===u?h=y:u.sibling=y,u=y);return ri&&Zs(i,g),h}for(p=s(p);!y.done;g++,y=l.next())null!==(y=v(p,i,g,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?g:y.key),o=r(y,o,g),null===u?h=y:u.sibling=y,u=y);return e&&p.forEach(function(e){return t(i,e)}),ri&&Zs(i,g),h}(l,c,h=b.call(h),u)}if("function"===typeof h.then)return y(l,c,Qa(h),u);if(h.$$typeof===w)return y(l,c,Ei(l,h),u);Ja(l,h)}return"string"===typeof h&&""!==h||"number"===typeof h||"bigint"===typeof h?(h=""+h,null!==c&&6===c.tag?(n(l,c.sibling),(u=i(c,h)).return=l,l=u):(n(l,c),(u=Hs(h,l.mode,u)).return=l,l=u),o(l)):n(l,c)}return function(e,t,n,s){try{Ka=0;var i=y(e,t,n,s);return qa=null,i}catch(a){if(a===Gi||a===Yi)throw a;var r=Rs(29,a,null,e.mode);return r.lanes=s,r.return=e,r}}}var to=eo(!0),no=eo(!1),so=z(null),io=null;function ro(e){var t=e.alternate;B(co,1&co.current),B(so,e),null===io&&(null===t||null!==fr.current||null!==t.memoizedState)&&(io=e)}function ao(e){if(22===e.tag){if(B(co,co.current),B(so,e),null===io){var t=e.alternate;null!==t&&null!==t.memoizedState&&(io=e)}}else oo()}function oo(){B(co,co.current),B(so,so.current)}function lo(e){W(so),io===e&&(io=null),W(co)}var co=z(0);function ho(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||mu(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function uo(e,t,n,s){n=null===(n=n(s,t=e.memoizedState))||void 0===n?t:d({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fo={enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Nc(),i=ir(s);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=rr(e,i,s))&&(Rc(t,e,s),ar(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Nc(),i=ir(s);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=rr(e,i,s))&&(Rc(t,e,s),ar(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Nc(),s=ir(n);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=rr(e,s,n))&&(Rc(t,e,n),ar(t,e,n))}};function po(e,t,n,s,i,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(s,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!Qn(n,s)||!Qn(i,r))}function go(e,t,n,s){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,s),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&fo.enqueueReplaceState(t,t.state,null)}function mo(e,t){var n=t;if("ref"in t)for(var s in n={},t)"ref"!==s&&(n[s]=t[s]);if(e=e.defaultProps)for(var i in n===t&&(n=d({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}var vo="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function yo(e){vo(e)}function bo(e){console.error(e)}function xo(e){vo(e)}function wo(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function So(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(s){setTimeout(function(){throw s})}}function _o(e,t,n){return(n=ir(n)).tag=3,n.payload={element:null},n.callback=function(){wo(e,t)},n}function Co(e){return(e=ir(e)).tag=3,e}function ko(e,t,n,s){var i=n.type.getDerivedStateFromError;if("function"===typeof i){var r=s.value;e.payload=function(){return i(r)},e.callback=function(){So(t,n,s)}}var a=n.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(e.callback=function(){So(t,n,s),"function"!==typeof i&&(null===Cc?Cc=new Set([this]):Cc.add(this));var e=s.stack;this.componentDidCatch(s.value,{componentStack:null!==e?e:""})})}var Ao=Error(a(461)),Eo=!1;function To(e,t,n,s){t.child=null===e?no(t,null,n,s):to(t,e.child,n,s)}function Mo(e,t,n,s,i){n=n.render;var r=t.ref;if("ref"in s){var a={};for(var o in s)"ref"!==o&&(a[o]=s[o])}else a=s;return ki(t),s=Pr(e,t,n,a,r,i),o=Lr(),null===e||Eo?(ri&&o&&ti(t),t.flags|=1,To(e,t,s,i),t.child):(Rr(e,t,i),Ko(e,t,i))}function jo(e,t,n,s,i){if(null===e){var r=n.type;return"function"!==typeof r||Fs(r)||void 0!==r.defaultProps||null!==n.compare?((e=Ws(n.type,null,s,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Po(e,t,r,s,i))}if(r=e.child,!Qo(e,i)){var a=r.memoizedProps;if((n=null!==(n=n.compare)?n:Qn)(a,s)&&e.ref===t.ref)return Ko(e,t,i)}return t.flags|=1,(e=Is(r,s)).ref=t.ref,e.return=t,t.child=e}function Po(e,t,n,s,i){if(null!==e){var r=e.memoizedProps;if(Qn(r,s)&&e.ref===t.ref){if(Eo=!1,t.pendingProps=s=r,!Qo(e,i))return t.lanes=e.lanes,Ko(e,t,i);0!==(131072&e.flags)&&(Eo=!0)}}return Lo(e,t,n,s,i)}function Oo(e,t,n){var s=t.pendingProps,i=s.children,r=null!==e?e.memoizedState:null;if("hidden"===s.mode){if(0!==(128&t.flags)){if(s=null!==r?r.baseLanes|n:n,null!==e){for(i=t.child=e.child,r=0;null!==i;)r=r|i.lanes|i.childLanes,i=i.sibling;t.childLanes=r&~s}else t.childLanes=0,t.child=null;return Do(e,t,s,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Do(e,t,null!==r?r.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Ui(0,null!==r?r.cachePool:null),null!==r?gr(t,r):mr(),ao(t)}else null!==r?(Ui(0,r.cachePool),gr(t,r),oo(),t.memoizedState=null):(null!==e&&Ui(0,null),mr(),oo());return To(e,t,i,n),t.child}function Do(e,t,n,s){var i=Hi();return i=null===i?null:{parent:Oi._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&Ui(0,null),mr(),ao(t),null!==e&&_i(e,t,s,!0),null}function No(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Lo(e,t,n,s,i){return ki(t),n=Pr(e,t,n,s,void 0,i),s=Lr(),null===e||Eo?(ri&&s&&ti(t),t.flags|=1,To(e,t,n,i),t.child):(Rr(e,t,i),Ko(e,t,i))}function Ro(e,t,n,s,i,r){return ki(t),t.updateQueue=null,n=Dr(t,s,n,i),Or(e),s=Lr(),null===e||Eo?(ri&&s&&ti(t),t.flags|=1,To(e,t,n,r),t.child):(Rr(e,t,r),Ko(e,t,r))}function Fo(e,t,n,s,i){if(ki(t),null===t.stateNode){var r=Ns,a=n.contextType;"object"===typeof a&&null!==a&&(r=Ai(a)),r=new n(s,r),t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r.updater=fo,t.stateNode=r,r._reactInternals=t,(r=t.stateNode).props=s,r.state=t.memoizedState,r.refs={},nr(t),a=n.contextType,r.context="object"===typeof a&&null!==a?Ai(a):Ns,r.state=t.memoizedState,"function"===typeof(a=n.getDerivedStateFromProps)&&(uo(t,n,a,s),r.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(a=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),a!==r.state&&fo.enqueueReplaceState(r,r.state,null),hr(t,s,r,i),cr(),r.state=t.memoizedState),"function"===typeof r.componentDidMount&&(t.flags|=4194308),s=!0}else if(null===e){r=t.stateNode;var o=t.memoizedProps,l=mo(n,o);r.props=l;var c=r.context,h=n.contextType;a=Ns,"object"===typeof h&&null!==h&&(a=Ai(h));var u=n.getDerivedStateFromProps;h="function"===typeof u||"function"===typeof r.getSnapshotBeforeUpdate,o=t.pendingProps!==o,h||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(o||c!==a)&&go(t,r,s,a),tr=!1;var d=t.memoizedState;r.state=d,hr(t,s,r,i),cr(),c=t.memoizedState,o||d!==c||tr?("function"===typeof u&&(uo(t,n,u,s),c=t.memoizedState),(l=tr||po(t,n,l,s,d,c,a))?(h||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||("function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"===typeof r.componentDidMount&&(t.flags|=4194308)):("function"===typeof r.componentDidMount&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),r.props=s,r.state=c,r.context=a,s=l):("function"===typeof r.componentDidMount&&(t.flags|=4194308),s=!1)}else{r=t.stateNode,sr(e,t),h=mo(n,a=t.memoizedProps),r.props=h,u=t.pendingProps,d=r.context,c=n.contextType,l=Ns,"object"===typeof c&&null!==c&&(l=Ai(c)),(c="function"===typeof(o=n.getDerivedStateFromProps)||"function"===typeof r.getSnapshotBeforeUpdate)||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(a!==u||d!==l)&&go(t,r,s,l),tr=!1,d=t.memoizedState,r.state=d,hr(t,s,r,i),cr();var f=t.memoizedState;a!==u||d!==f||tr||null!==e&&null!==e.dependencies&&Ci(e.dependencies)?("function"===typeof o&&(uo(t,n,o,s),f=t.memoizedState),(h=tr||po(t,n,h,s,d,f,l)||null!==e&&null!==e.dependencies&&Ci(e.dependencies))?(c||"function"!==typeof r.UNSAFE_componentWillUpdate&&"function"!==typeof r.componentWillUpdate||("function"===typeof r.componentWillUpdate&&r.componentWillUpdate(s,f,l),"function"===typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(s,f,l)),"function"===typeof r.componentDidUpdate&&(t.flags|=4),"function"===typeof r.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof r.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=f),r.props=s,r.state=f,r.context=l,s=h):("function"!==typeof r.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),s=!1)}return r=s,No(e,t),s=0!==(128&t.flags),r||s?(r=t.stateNode,n=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render(),t.flags|=1,null!==e&&s?(t.child=to(t,e.child,null,i),t.child=to(t,null,n,i)):To(e,t,n,i),t.memoizedState=r.state,e=t.child):e=Ko(e,t,i),e}function Io(e,t,n,s){return fi(),t.flags|=256,To(e,t,n,s),t.child}var zo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wo(e){return{baseLanes:e,cachePool:Vi()}}function Bo(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=mc),e}function Ho(e,t,n){var s,i=t.pendingProps,r=!1,o=0!==(128&t.flags);if((s=o)||(s=(null===e||null!==e.memoizedState)&&0!==(2&co.current)),s&&(r=!0,t.flags&=-129),s=0!==(32&t.flags),t.flags&=-33,null===e){if(ri){if(r?ro(t):oo(),ri){var l,c=ii;if(l=c){e:{for(l=c,c=oi;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=vu(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Qs?{id:$s,overflow:Js}:null,retryLane:536870912,hydrationErrors:null},(l=Rs(18,null,null,0)).stateNode=c,l.return=t,t.child=l,si=t,ii=null,l=!0):l=!1}l||ci(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return mu(c)?t.lanes=32:t.lanes=536870912,null;lo(t)}return c=i.children,i=i.fallback,r?(oo(),c=Vo({mode:"hidden",children:c},r=t.mode),i=Bs(i,r,n,null),c.return=t,i.return=t,c.sibling=i,t.child=c,(r=t.child).memoizedState=Wo(n),r.childLanes=Bo(e,s,n),t.memoizedState=zo,i):(ro(t),Uo(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(o)256&t.flags?(ro(t),t.flags&=-257,t=Go(e,t,n)):null!==t.memoizedState?(oo(),t.child=e.child,t.flags|=128,t=null):(oo(),r=i.fallback,c=t.mode,i=Vo({mode:"visible",children:i.children},c),(r=Bs(r,c,n,null)).flags|=2,i.return=t,r.return=t,i.sibling=r,t.child=i,to(t,e.child,null,n),(i=t.child).memoizedState=Wo(n),i.childLanes=Bo(e,s,n),t.memoizedState=zo,t=r);else if(ro(t),mu(c)){if(s=c.nextSibling&&c.nextSibling.dataset)var h=s.dgst;s=h,(i=Error(a(419))).stack="",i.digest=s,gi({value:i,source:null,stack:null}),t=Go(e,t,n)}else if(Eo||_i(e,t,n,!1),s=0!==(n&e.childLanes),Eo||s){if(null!==(s=sc)&&(0!==(i=0!==((i=0!==(42&(i=n&-n))?1:Te(i))&(s.suspendedLanes|n))?0:i)&&i!==l.retryLane))throw l.retryLane=i,Ps(e,i),Rc(s,e,i),Ao;"$?"===c.data||Yc(),t=Go(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,ii=vu(c.nextSibling),si=t,ri=!0,ai=null,oi=!1,null!==e&&(qs[Ks++]=$s,qs[Ks++]=Js,qs[Ks++]=Qs,$s=e.id,Js=e.overflow,Qs=t),(t=Uo(t,i.children)).flags|=4096);return t}return r?(oo(),r=i.fallback,c=t.mode,h=(l=e.child).sibling,(i=Is(l,{mode:"hidden",children:i.children})).subtreeFlags=65011712&l.subtreeFlags,null!==h?r=Is(h,r):(r=Bs(r,c,n,null)).flags|=2,r.return=t,i.return=t,i.sibling=r,t.child=i,i=r,r=t.child,null===(c=e.child.memoizedState)?c=Wo(n):(null!==(l=c.cachePool)?(h=Oi._currentValue,l=l.parent!==h?{parent:h,pool:h}:l):l=Vi(),c={baseLanes:c.baseLanes|n,cachePool:l}),r.memoizedState=c,r.childLanes=Bo(e,s,n),t.memoizedState=zo,i):(ro(t),e=(n=e.child).sibling,(n=Is(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n)}function Uo(e,t){return(t=Vo({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Vo(e,t){return(e=Rs(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Go(e,t,n){return to(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Xo(e,t,n){e.lanes|=t;var s=e.alternate;null!==s&&(s.lanes|=t),wi(e.return,t,n)}function Yo(e,t,n,s,i){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:i}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=n,r.tailMode=i)}function qo(e,t,n){var s=t.pendingProps,i=s.revealOrder,r=s.tail;if(To(e,t,s.children,n),0!==(2&(s=co.current)))s=1&s|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Xo(e,n,t);else if(19===e.tag)Xo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}switch(B(co,s),i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ho(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Yo(t,!1,i,n,r);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ho(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Yo(t,!0,n,null,r);break;case"together":Yo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ko(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),fc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(_i(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Is(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Is(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Qo(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ci(e))}function $o(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Eo=!0;else{if(!Qo(e,n)&&0===(128&t.flags))return Eo=!1,function(e,t,n){switch(t.tag){case 3:X(t,t.stateNode.containerInfo),bi(0,Oi,e.memoizedState.cache),fi();break;case 27:case 5:q(t);break;case 4:X(t,t.stateNode.containerInfo);break;case 10:bi(0,t.type,t.memoizedProps.value);break;case 13:var s=t.memoizedState;if(null!==s)return null!==s.dehydrated?(ro(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Ho(e,t,n):(ro(t),null!==(e=Ko(e,t,n))?e.sibling:null);ro(t);break;case 19:var i=0!==(128&e.flags);if((s=0!==(n&t.childLanes))||(_i(e,t,n,!1),s=0!==(n&t.childLanes)),i){if(s)return qo(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),B(co,co.current),s)break;return null;case 22:case 23:return t.lanes=0,Oo(e,t,n);case 24:bi(0,Oi,e.memoizedState.cache)}return Ko(e,t,n)}(e,t,n);Eo=0!==(131072&e.flags)}else Eo=!1,ri&&0!==(1048576&t.flags)&&ei(t,Ys,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var s=t.elementType,i=s._init;if(s=i(s._payload),t.type=s,"function"!==typeof s){if(void 0!==s&&null!==s){if((i=s.$$typeof)===S){t.tag=11,t=Mo(null,t,s,e,n);break e}if(i===k){t.tag=14,t=jo(null,t,s,e,n);break e}}throw t=O(s)||s,Error(a(306,t,""))}Fs(s)?(e=mo(s,e),t.tag=1,t=Fo(null,t,s,e,n)):(t.tag=0,t=Lo(null,t,s,e,n))}return t;case 0:return Lo(e,t,t.type,t.pendingProps,n);case 1:return Fo(e,t,s=t.type,i=mo(s,t.pendingProps),n);case 3:e:{if(X(t,t.stateNode.containerInfo),null===e)throw Error(a(387));s=t.pendingProps;var r=t.memoizedState;i=r.element,sr(e,t),hr(t,s,null,n);var o=t.memoizedState;if(s=o.cache,bi(0,Oi,s),s!==r.cache&&Si(t,[Oi],n,!0),cr(),s=o.element,r.isDehydrated){if(r={element:s,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=r,t.memoizedState=r,256&t.flags){t=Io(e,t,s,n);break e}if(s!==i){gi(i=Cs(Error(a(424)),t)),t=Io(e,t,s,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ii=vu(e.firstChild),si=t,ri=!0,ai=null,oi=!0,n=no(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),s===i){t=Ko(e,t,n);break e}To(e,t,s,n)}t=t.child}return t;case 26:return No(e,t),null===e?(n=Tu(t.type,null,t.pendingProps,null))?t.memoizedState=n:ri||(n=t.type,e=t.pendingProps,(s=su(V.current).createElement(n))[Oe]=t,s[De]=e,eu(s,n,e),Ge(s),t.stateNode=s):t.memoizedState=Tu(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return q(t),null===e&&ri&&(s=t.stateNode=xu(t.type,t.pendingProps,V.current),si=t,oi=!0,i=ii,fu(t.type)?(yu=i,ii=vu(s.firstChild)):ii=i),To(e,t,t.pendingProps.children,n),No(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&ri&&((i=s=ii)&&(null!==(s=function(e,t,n,s){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(s){if(!e[ze])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(r=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(r!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((r=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&r&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var r=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===r)return e}if(null===(e=vu(e.nextSibling)))break}return null}(s,t.type,t.pendingProps,oi))?(t.stateNode=s,si=t,ii=vu(s.firstChild),oi=!1,i=!0):i=!1),i||ci(t)),q(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children,au(i,r)?s=null:null!==o&&au(i,o)&&(t.flags|=32),null!==t.memoizedState&&(i=Pr(e,t,Nr,null,null,n),qu._currentValue=i),No(e,t),To(e,t,s,n),t.child;case 6:return null===e&&ri&&((e=n=ii)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=vu(e.nextSibling)))return null}return e}(n,t.pendingProps,oi))?(t.stateNode=n,si=t,ii=null,e=!0):e=!1),e||ci(t)),null;case 13:return Ho(e,t,n);case 4:return X(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=to(t,null,s,n):To(e,t,s,n),t.child;case 11:return Mo(e,t,t.type,t.pendingProps,n);case 7:return To(e,t,t.pendingProps,n),t.child;case 8:case 12:return To(e,t,t.pendingProps.children,n),t.child;case 10:return s=t.pendingProps,bi(0,t.type,s.value),To(e,t,s.children,n),t.child;case 9:return i=t.type._context,s=t.pendingProps.children,ki(t),s=s(i=Ai(i)),t.flags|=1,To(e,t,s,n),t.child;case 14:return jo(e,t,t.type,t.pendingProps,n);case 15:return Po(e,t,t.type,t.pendingProps,n);case 19:return qo(e,t,n);case 31:return s=t.pendingProps,n=t.mode,s={mode:s.mode,children:s.children},null===e?((n=Vo(s,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Is(e.child,s)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Oo(e,t,n);case 24:return ki(t),s=Ai(Oi),null===e?(null===(i=Hi())&&(i=sc,r=Di(),i.pooledCache=r,r.refCount++,null!==r&&(i.pooledCacheLanes|=n),i=r),t.memoizedState={parent:s,cache:i},nr(t),bi(0,Oi,i)):(0!==(e.lanes&n)&&(sr(e,t),hr(t,null,null,n),cr()),i=e.memoizedState,r=t.memoizedState,i.parent!==s?(i={parent:s,cache:s},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),bi(0,Oi,s)):(s=r.cache,bi(0,Oi,s),s!==i.cache&&Si(t,[Oi],n,!0))),To(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}function Jo(e){e.flags|=4}function Zo(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Bu(t)){if(null!==(t=so.current)&&((4194048&rc)===rc?null!==io:(62914560&rc)!==rc&&0===(536870912&rc)||t!==io))throw Ji=qi,Xi;e.flags|=8192}}function el(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?_e():536870912,e.lanes|=t,vc|=t)}function tl(e,t){if(!ri)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;null!==n;)null!==n.alternate&&(s=n),n=n.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function nl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,s=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,s|=65011712&i.subtreeFlags,s|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function sl(e,t,n){var s=t.pendingProps;switch(ni(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(t),null;case 3:return n=t.stateNode,s=null,null!==e&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),xi(Oi),Y(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(di(t)?Jo(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,pi())),nl(t),null;case 26:return n=t.memoizedState,null===e?(Jo(t),null!==n?(nl(t),Zo(t,n)):(nl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Jo(t),nl(t),Zo(t,n)):(nl(t),t.flags&=-16777217):(e.memoizedProps!==s&&Jo(t),nl(t),t.flags&=-16777217),null;case 27:K(t),n=V.current;var i=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==s&&Jo(t);else{if(!s){if(null===t.stateNode)throw Error(a(166));return nl(t),null}e=H.current,di(t)?hi(t):(e=xu(i,s,n),t.stateNode=e,Jo(t))}return nl(t),null;case 5:if(K(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&Jo(t);else{if(!s){if(null===t.stateNode)throw Error(a(166));return nl(t),null}if(e=H.current,di(t))hi(t);else{switch(i=su(V.current),e){case 1:e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=i.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof s.is?i.createElement("select",{is:s.is}):i.createElement("select"),s.multiple?e.multiple=!0:s.size&&(e.size=s.size);break;default:e="string"===typeof s.is?i.createElement(n,{is:s.is}):i.createElement(n)}}e[Oe]=t,e[De]=s;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=e;e:switch(eu(e,n,s),n){case"button":case"input":case"select":case"textarea":e=!!s.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Jo(t)}}return nl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==s&&Jo(t);else{if("string"!==typeof s&&null===t.stateNode)throw Error(a(166));if(e=V.current,di(t)){if(e=t.stateNode,n=t.memoizedProps,s=null,null!==(i=si))switch(i.tag){case 27:case 5:s=i.memoizedProps}e[Oe]=t,(e=!!(e.nodeValue===n||null!==s&&!0===s.suppressHydrationWarning||Qh(e.nodeValue,n)))||ci(t)}else(e=su(e).createTextNode(s))[Oe]=t,t.stateNode=e}return nl(t),null;case 13:if(s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=di(t),null!==s&&null!==s.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[Oe]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nl(t),i=!1}else i=pi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(lo(t),t):(lo(t),null)}if(lo(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==s,e=null!==e&&null!==e.memoizedState,n){i=null,null!==(s=t.child).alternate&&null!==s.alternate.memoizedState&&null!==s.alternate.memoizedState.cachePool&&(i=s.alternate.memoizedState.cachePool.pool);var r=null;null!==s.memoizedState&&null!==s.memoizedState.cachePool&&(r=s.memoizedState.cachePool.pool),r!==i&&(s.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),el(t,t.updateQueue),nl(t),null;case 4:return Y(),null===e&&Wh(t.stateNode.containerInfo),nl(t),null;case 10:return xi(t.type),nl(t),null;case 19:if(W(co),null===(i=t.memoizedState))return nl(t),null;if(s=0!==(128&t.flags),null===(r=i.rendering))if(s)tl(i,!1);else{if(0!==dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(r=ho(e))){for(t.flags|=128,tl(i,!1),e=r.updateQueue,t.updateQueue=e,el(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)zs(n,e),n=n.sibling;return B(co,1&co.current|2),t.child}e=e.sibling}null!==i.tail&&te()>Sc&&(t.flags|=128,s=!0,tl(i,!1),t.lanes=4194304)}else{if(!s)if(null!==(e=ho(r))){if(t.flags|=128,s=!0,e=e.updateQueue,t.updateQueue=e,el(t,e),tl(i,!0),null===i.tail&&"hidden"===i.tailMode&&!r.alternate&&!ri)return nl(t),null}else 2*te()-i.renderingStartTime>Sc&&536870912!==n&&(t.flags|=128,s=!0,tl(i,!1),t.lanes=4194304);i.isBackwards?(r.sibling=t.child,t.child=r):(null!==(e=i.last)?e.sibling=r:t.child=r,i.last=r)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=te(),t.sibling=null,e=co.current,B(co,s?1&e|2:1&e),t):(nl(t),null);case 22:case 23:return lo(t),vr(),s=null!==t.memoizedState,null!==e?null!==e.memoizedState!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?0!==(536870912&n)&&0===(128&t.flags)&&(nl(t),6&t.subtreeFlags&&(t.flags|=8192)):nl(t),null!==(n=t.updateQueue)&&el(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),s=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(s=t.memoizedState.cachePool.pool),s!==n&&(t.flags|=2048),null!==e&&W(Bi),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),xi(Oi),nl(t),null;case 25:case 30:return null}throw Error(a(156,t.tag))}function il(e,t){switch(ni(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return xi(Oi),Y(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return K(t),null;case 13:if(lo(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return W(co),null;case 4:return Y(),null;case 10:return xi(t.type),null;case 22:case 23:return lo(t),vr(),null!==e&&W(Bi),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return xi(Oi),null;default:return null}}function rl(e,t){switch(ni(t),t.tag){case 3:xi(Oi),Y();break;case 26:case 27:case 5:K(t);break;case 4:Y();break;case 13:lo(t);break;case 19:W(co);break;case 10:xi(t.type);break;case 22:case 23:lo(t),vr(),null!==e&&W(Bi);break;case 24:xi(Oi)}}function al(e,t){try{var n=t.updateQueue,s=null!==n?n.lastEffect:null;if(null!==s){var i=s.next;n=i;do{if((n.tag&e)===e){s=void 0;var r=n.create,a=n.inst;s=r(),a.destroy=s}n=n.next}while(n!==i)}}catch(o){hh(t,t.return,o)}}function ol(e,t,n){try{var s=t.updateQueue,i=null!==s?s.lastEffect:null;if(null!==i){var r=i.next;s=r;do{if((s.tag&e)===e){var a=s.inst,o=a.destroy;if(void 0!==o){a.destroy=void 0,i=t;var l=n,c=o;try{c()}catch(h){hh(i,l,h)}}}s=s.next}while(s!==r)}}catch(h){hh(t,t.return,h)}}function ll(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{dr(t,n)}catch(s){hh(e,e.return,s)}}}function cl(e,t,n){n.props=mo(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(s){hh(e,t,s)}}function hl(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;default:s=e.stateNode}"function"===typeof n?e.refCleanup=n(s):n.current=s}}catch(i){hh(e,t,i)}}function ul(e,t){var n=e.ref,s=e.refCleanup;if(null!==n)if("function"===typeof s)try{s()}catch(i){hh(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(r){hh(e,t,r)}else n.current=null}function dl(e){var t=e.type,n=e.memoizedProps,s=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&s.focus();break e;case"img":n.src?s.src=n.src:n.srcSet&&(s.srcset=n.srcSet)}}catch(i){hh(e,e.return,i)}}function fl(e,t,n){try{var s=e.stateNode;!function(e,t,n,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,r=null,o=null,l=null,c=null,h=null,u=null;for(p in n){var d=n[p];if(n.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":c=d;default:s.hasOwnProperty(p)||Jh(e,t,p,null,s,d)}}for(var f in s){var p=s[f];if(d=n[f],s.hasOwnProperty(f)&&(null!=p||null!=d))switch(f){case"type":r=p;break;case"name":i=p;break;case"checked":h=p;break;case"defaultChecked":u=p;break;case"value":o=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(a(137,t));break;default:p!==d&&Jh(e,t,f,p,s,d)}}return void mt(e,o,l,c,h,u,r,i);case"select":for(r in p=o=l=f=null,n)if(c=n[r],n.hasOwnProperty(r)&&null!=c)switch(r){case"value":break;case"multiple":p=c;default:s.hasOwnProperty(r)||Jh(e,t,r,null,s,c)}for(i in s)if(r=s[i],c=n[i],s.hasOwnProperty(i)&&(null!=r||null!=c))switch(i){case"value":f=r;break;case"defaultValue":l=r;break;case"multiple":o=r;default:r!==c&&Jh(e,t,i,r,s,c)}return t=l,n=o,s=p,void(null!=f?bt(e,!!n,f,!1):!!s!==!!n&&(null!=t?bt(e,!!n,t,!0):bt(e,!!n,n?[]:"",!1)));case"textarea":for(l in p=f=null,n)if(i=n[l],n.hasOwnProperty(l)&&null!=i&&!s.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Jh(e,t,l,null,s,i)}for(o in s)if(i=s[o],r=n[o],s.hasOwnProperty(o)&&(null!=i||null!=r))switch(o){case"value":f=i;break;case"defaultValue":p=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(a(91));break;default:i!==r&&Jh(e,t,o,i,s,r)}return void xt(e,f,p);case"option":for(var g in n)if(f=n[g],n.hasOwnProperty(g)&&null!=f&&!s.hasOwnProperty(g))if("selected"===g)e.selected=!1;else Jh(e,t,g,null,s,f);for(c in s)if(f=s[c],p=n[c],s.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))if("selected"===c)e.selected=f&&"function"!==typeof f&&"symbol"!==typeof f;else Jh(e,t,c,f,s,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)f=n[m],n.hasOwnProperty(m)&&null!=f&&!s.hasOwnProperty(m)&&Jh(e,t,m,null,s,f);for(h in s)if(f=s[h],p=n[h],s.hasOwnProperty(h)&&f!==p&&(null!=f||null!=p))switch(h){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t));break;default:Jh(e,t,h,f,s,p)}return;default:if(At(t)){for(var v in n)f=n[v],n.hasOwnProperty(v)&&void 0!==f&&!s.hasOwnProperty(v)&&Zh(e,t,v,void 0,s,f);for(u in s)f=s[u],p=n[u],!s.hasOwnProperty(u)||f===p||void 0===f&&void 0===p||Zh(e,t,u,f,s,p);return}}for(var y in n)f=n[y],n.hasOwnProperty(y)&&null!=f&&!s.hasOwnProperty(y)&&Jh(e,t,y,null,s,f);for(d in s)f=s[d],p=n[d],!s.hasOwnProperty(d)||f===p||null==f&&null==p||Jh(e,t,d,f,s,p)}(s,e.type,n,t),s[De]=t}catch(i){hh(e,e.return,i)}}function pl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&fu(e.type)||4===e.tag}function gl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||pl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&fu(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ml(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$h));else if(4!==s&&(27===s&&fu(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(ml(e,t,n),e=e.sibling;null!==e;)ml(e,t,n),e=e.sibling}function vl(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==s&&(27===s&&fu(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(vl(e,t,n),e=e.sibling;null!==e;)vl(e,t,n),e=e.sibling}function yl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var s=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);eu(t,s,n),t[Oe]=e,t[De]=n}catch(r){hh(e,e.return,r)}}var bl=!1,xl=!1,wl=!1,Sl="function"===typeof WeakSet?WeakSet:Set,_l=null;function Cl(e,t,n){var s=n.flags;switch(n.tag){case 0:case 11:case 15:Fl(e,n),4&s&&al(5,n);break;case 1:if(Fl(e,n),4&s)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(a){hh(n,n.return,a)}else{var i=mo(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){hh(n,n.return,o)}}64&s&&ll(n),512&s&&hl(n,n.return);break;case 3:if(Fl(e,n),64&s&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{dr(e,t)}catch(a){hh(n,n.return,a)}}break;case 27:null===t&&4&s&&yl(n);case 26:case 5:Fl(e,n),null===t&&4&s&&dl(n),512&s&&hl(n,n.return);break;case 12:Fl(e,n);break;case 13:Fl(e,n),4&s&&jl(e,n),64&s&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var s=function(){t(),n.removeEventListener("DOMContentLoaded",s)};n.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}(e,n=ph.bind(null,n))));break;case 22:if(!(s=null!==n.memoizedState||bl)){t=null!==t&&null!==t.memoizedState||xl,i=bl;var r=xl;bl=s,(xl=t)&&!r?zl(e,n,0!==(8772&n.subtreeFlags)):Fl(e,n),bl=i,xl=r}break;case 30:break;default:Fl(e,n)}}function kl(e){var t=e.alternate;null!==t&&(e.alternate=null,kl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&We(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Al=null,El=!1;function Tl(e,t,n){for(n=n.child;null!==n;)Ml(e,t,n),n=n.sibling}function Ml(e,t,n){if(ue&&"function"===typeof ue.onCommitFiberUnmount)try{ue.onCommitFiberUnmount(he,n)}catch(r){}switch(n.tag){case 26:xl||ul(n,t),Tl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:xl||ul(n,t);var s=Al,i=El;fu(n.type)&&(Al=n.stateNode,El=!1),Tl(e,t,n),wu(n.stateNode),Al=s,El=i;break;case 5:xl||ul(n,t);case 6:if(s=Al,i=El,Al=null,Tl(e,t,n),El=i,null!==(Al=s))if(El)try{(9===Al.nodeType?Al.body:"HTML"===Al.nodeName?Al.ownerDocument.body:Al).removeChild(n.stateNode)}catch(a){hh(n,t,a)}else try{Al.removeChild(n.stateNode)}catch(a){hh(n,t,a)}break;case 18:null!==Al&&(El?(pu(9===(e=Al).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Ed(e)):pu(Al,n.stateNode));break;case 4:s=Al,i=El,Al=n.stateNode.containerInfo,El=!0,Tl(e,t,n),Al=s,El=i;break;case 0:case 11:case 14:case 15:xl||ol(2,n,t),xl||ol(4,n,t),Tl(e,t,n);break;case 1:xl||(ul(n,t),"function"===typeof(s=n.stateNode).componentWillUnmount&&cl(n,t,s)),Tl(e,t,n);break;case 21:Tl(e,t,n);break;case 22:xl=(s=xl)||null!==n.memoizedState,Tl(e,t,n),xl=s;break;default:Tl(e,t,n)}}function jl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Ed(e)}catch(n){hh(t,t.return,n)}}function Pl(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Sl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Sl),t;default:throw Error(a(435,e.tag))}}(e);t.forEach(function(t){var s=gh.bind(null,e,t);n.has(t)||(n.add(t),t.then(s,s))})}function Ol(e,t){var n=t.deletions;if(null!==n)for(var s=0;s<n.length;s++){var i=n[s],r=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:if(fu(l.type)){Al=l.stateNode,El=!1;break e}break;case 5:Al=l.stateNode,El=!1;break e;case 3:case 4:Al=l.stateNode.containerInfo,El=!0;break e}l=l.return}if(null===Al)throw Error(a(160));Ml(r,o,i),Al=null,El=!1,null!==(r=i.alternate)&&(r.return=null),i.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Nl(t,e),t=t.sibling}var Dl=null;function Nl(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Ol(t,e),Ll(e),4&s&&(ol(3,e,e.return),al(3,e),ol(5,e,e.return));break;case 1:Ol(t,e),Ll(e),512&s&&(xl||null===n||ul(n,n.return)),64&s&&bl&&(null!==(e=e.updateQueue)&&(null!==(s=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?s:n.concat(s))));break;case 26:var i=Dl;if(Ol(t,e),Ll(e),512&s&&(xl||null===n||ul(n,n.return)),4&s){var r=null!==n?n.memoizedState:null;if(s=e.memoizedState,null===n)if(null===s)if(null===e.stateNode){e:{s=e.type,n=e.memoizedProps,i=i.ownerDocument||i;t:switch(s){case"title":(!(r=i.getElementsByTagName("title")[0])||r[ze]||r[Oe]||"http://www.w3.org/2000/svg"===r.namespaceURI||r.hasAttribute("itemprop"))&&(r=i.createElement(s),i.head.insertBefore(r,i.querySelector("head > title"))),eu(r,s,n),r[Oe]=e,Ge(r),s=r;break e;case"link":var o=zu("link","href",i).get(s+(n.href||""));if(o)for(var l=0;l<o.length;l++)if((r=o[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&r.getAttribute("rel")===(null==n.rel?null:n.rel)&&r.getAttribute("title")===(null==n.title?null:n.title)&&r.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){o.splice(l,1);break t}eu(r=i.createElement(s),s,n),i.head.appendChild(r);break;case"meta":if(o=zu("meta","content",i).get(s+(n.content||"")))for(l=0;l<o.length;l++)if((r=o[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&r.getAttribute("name")===(null==n.name?null:n.name)&&r.getAttribute("property")===(null==n.property?null:n.property)&&r.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&r.getAttribute("charset")===(null==n.charSet?null:n.charSet)){o.splice(l,1);break t}eu(r=i.createElement(s),s,n),i.head.appendChild(r);break;default:throw Error(a(468,s))}r[Oe]=e,Ge(r),s=r}e.stateNode=s}else Wu(i,e.type,e.stateNode);else e.stateNode=Nu(i,s,e.memoizedProps);else r!==s?(null===r?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):r.count--,null===s?Wu(i,e.type,e.stateNode):Nu(i,s,e.memoizedProps)):null===s&&null!==e.stateNode&&fl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Ol(t,e),Ll(e),512&s&&(xl||null===n||ul(n,n.return)),null!==n&&4&s&&fl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Ol(t,e),Ll(e),512&s&&(xl||null===n||ul(n,n.return)),32&e.flags){i=e.stateNode;try{St(i,"")}catch(p){hh(e,e.return,p)}}4&s&&null!=e.stateNode&&fl(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&s&&(wl=!0);break;case 6:if(Ol(t,e),Ll(e),4&s){if(null===e.stateNode)throw Error(a(162));s=e.memoizedProps,n=e.stateNode;try{n.nodeValue=s}catch(p){hh(e,e.return,p)}}break;case 3:if(Iu=null,i=Dl,Dl=Cu(t.containerInfo),Ol(t,e),Dl=i,Ll(e),4&s&&null!==n&&n.memoizedState.isDehydrated)try{Ed(t.containerInfo)}catch(p){hh(e,e.return,p)}wl&&(wl=!1,Rl(e));break;case 4:s=Dl,Dl=Cu(e.stateNode.containerInfo),Ol(t,e),Ll(e),Dl=s;break;case 12:default:Ol(t,e),Ll(e);break;case 13:Ol(t,e),Ll(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(wc=te()),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Pl(e,s)));break;case 22:i=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,h=bl,u=xl;if(bl=h||i,xl=u||c,Ol(t,e),xl=u,bl=h,Ll(e),8192&s)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===n||c||bl||xl||Il(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(r=c.stateNode,i)"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,f=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(p){hh(c,c.return,p)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(p){hh(c,c.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&s&&(null!==(s=e.updateQueue)&&(null!==(n=s.retryQueue)&&(s.retryQueue=null,Pl(e,n))));break;case 19:Ol(t,e),Ll(e),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Pl(e,s)));case 30:case 21:}}function Ll(e){var t=e.flags;if(2&t){try{for(var n,s=e.return;null!==s;){if(pl(s)){n=s;break}s=s.return}if(null==n)throw Error(a(160));switch(n.tag){case 27:var i=n.stateNode;vl(e,gl(e),i);break;case 5:var r=n.stateNode;32&n.flags&&(St(r,""),n.flags&=-33),vl(e,gl(e),r);break;case 3:case 4:var o=n.stateNode.containerInfo;ml(e,gl(e),o);break;default:throw Error(a(161))}}catch(l){hh(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Rl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Rl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Fl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Cl(e,t.alternate,t),t=t.sibling}function Il(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:ol(4,t,t.return),Il(t);break;case 1:ul(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&cl(t,t.return,n),Il(t);break;case 27:wu(t.stateNode);case 26:case 5:ul(t,t.return),Il(t);break;case 22:null===t.memoizedState&&Il(t);break;default:Il(t)}e=e.sibling}}function zl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var s=t.alternate,i=e,r=t,a=r.flags;switch(r.tag){case 0:case 11:case 15:zl(i,r,n),al(4,r);break;case 1:if(zl(i,r,n),"function"===typeof(i=(s=r).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){hh(s,s.return,c)}if(null!==(i=(s=r).updateQueue)){var o=s.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)ur(l[i],o)}catch(c){hh(s,s.return,c)}}n&&64&a&&ll(r),hl(r,r.return);break;case 27:yl(r);case 26:case 5:zl(i,r,n),n&&null===s&&4&a&&dl(r),hl(r,r.return);break;case 12:zl(i,r,n);break;case 13:zl(i,r,n),n&&4&a&&jl(i,r);break;case 22:null===r.memoizedState&&zl(i,r,n),hl(r,r.return);break;case 30:break;default:zl(i,r,n)}t=t.sibling}}function Wl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Ni(n))}function Bl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ni(e))}function Hl(e,t,n,s){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Ul(e,t,n,s),t=t.sibling}function Ul(e,t,n,s){var i=t.flags;switch(t.tag){case 0:case 11:case 15:Hl(e,t,n,s),2048&i&&al(9,t);break;case 1:case 13:default:Hl(e,t,n,s);break;case 3:Hl(e,t,n,s),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ni(e)));break;case 12:if(2048&i){Hl(e,t,n,s),e=t.stateNode;try{var r=t.memoizedProps,a=r.id,o=r.onPostCommit;"function"===typeof o&&o(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){hh(t,t.return,l)}}else Hl(e,t,n,s);break;case 23:break;case 22:r=t.stateNode,a=t.alternate,null!==t.memoizedState?2&r._visibility?Hl(e,t,n,s):Gl(e,t):2&r._visibility?Hl(e,t,n,s):(r._visibility|=2,Vl(e,t,n,s,0!==(10256&t.subtreeFlags))),2048&i&&Wl(a,t);break;case 24:Hl(e,t,n,s),2048&i&&Bl(t.alternate,t)}}function Vl(e,t,n,s,i){for(i=i&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var r=e,a=t,o=n,l=s,c=a.flags;switch(a.tag){case 0:case 11:case 15:Vl(r,a,o,l,i),al(8,a);break;case 23:break;case 22:var h=a.stateNode;null!==a.memoizedState?2&h._visibility?Vl(r,a,o,l,i):Gl(r,a):(h._visibility|=2,Vl(r,a,o,l,i)),i&&2048&c&&Wl(a.alternate,a);break;case 24:Vl(r,a,o,l,i),i&&2048&c&&Bl(a.alternate,a);break;default:Vl(r,a,o,l,i)}t=t.sibling}}function Gl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,s=t,i=s.flags;switch(s.tag){case 22:Gl(n,s),2048&i&&Wl(s.alternate,s);break;case 24:Gl(n,s),2048&i&&Bl(s.alternate,s);break;default:Gl(n,s)}t=t.sibling}}var Xl=8192;function Yl(e){if(e.subtreeFlags&Xl)for(e=e.child;null!==e;)ql(e),e=e.sibling}function ql(e){switch(e.tag){case 26:Yl(e),e.flags&Xl&&null!==e.memoizedState&&function(e,t,n){if(null===Hu)throw Error(a(475));var s=Hu;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var i=Mu(n.href),r=e.querySelector(ju(i));if(r)return null!==(e=r._p)&&"object"===typeof e&&"function"===typeof e.then&&(s.count++,s=Vu.bind(s),e.then(s,s)),t.state.loading|=4,t.instance=r,void Ge(r);r=e.ownerDocument||e,n=Pu(n),(i=Su.get(i))&&Ru(n,i),Ge(r=r.createElement("link"));var o=r;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),eu(r,"link",n),t.instance=r}null===s.stylesheets&&(s.stylesheets=new Map),s.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(s.count++,t=Vu.bind(s),e.addEventListener("load",t),e.addEventListener("error",t))}}(Dl,e.memoizedState,e.memoizedProps);break;case 5:default:Yl(e);break;case 3:case 4:var t=Dl;Dl=Cu(e.stateNode.containerInfo),Yl(e),Dl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Xl,Xl=16777216,Yl(e),Xl=t):Yl(e))}}function Kl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Ql(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var s=t[n];_l=s,Zl(s,e)}Kl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)$l(e),e=e.sibling}function $l(e){switch(e.tag){case 0:case 11:case 15:Ql(e),2048&e.flags&&ol(9,e,e.return);break;case 3:case 12:default:Ql(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Jl(e)):Ql(e)}}function Jl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var s=t[n];_l=s,Zl(s,e)}Kl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:ol(8,t,t.return),Jl(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Jl(t));break;default:Jl(t)}e=e.sibling}}function Zl(e,t){for(;null!==_l;){var n=_l;switch(n.tag){case 0:case 11:case 15:ol(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var s=n.memoizedState.cachePool.pool;null!=s&&s.refCount++}break;case 24:Ni(n.memoizedState.cache)}if(null!==(s=n.child))s.return=n,_l=s;else e:for(n=e;null!==_l;){var i=(s=_l).sibling,r=s.return;if(kl(s),s===n){_l=null;break e}if(null!==i){i.return=r,_l=i;break e}_l=r}}}var ec={getCacheForType:function(e){var t=Ai(Oi),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tc="function"===typeof WeakMap?WeakMap:Map,nc=0,sc=null,ic=null,rc=0,ac=0,oc=null,lc=!1,cc=!1,hc=!1,uc=0,dc=0,fc=0,pc=0,gc=0,mc=0,vc=0,yc=null,bc=null,xc=!1,wc=0,Sc=1/0,_c=null,Cc=null,kc=0,Ac=null,Ec=null,Tc=0,Mc=0,jc=null,Pc=null,Oc=0,Dc=null;function Nc(){if(0!==(2&nc)&&0!==rc)return rc&-rc;if(null!==N.T){return 0!==Fi?Fi:Mh()}return je()}function Lc(){0===mc&&(mc=0===(536870912&rc)||ri?Se():536870912);var e=so.current;return null!==e&&(e.flags|=32),mc}function Rc(e,t,n){(e!==sc||2!==ac&&9!==ac)&&null===e.cancelPendingCommit||(Uc(e,0),Wc(e,rc,mc,!1)),ke(e,n),0!==(2&nc)&&e===sc||(e===sc&&(0===(2&nc)&&(pc|=n),4===dc&&Wc(e,rc,mc,!1)),Sh(e))}function Fc(e,t,n){if(0!==(6&nc))throw Error(a(327));for(var s=!n&&0===(124&t)&&0===(t&e.expiredLanes)||xe(e,t),i=s?function(e,t){var n=nc;nc|=2;var s=Gc(),i=Xc();sc!==e||rc!==t?(_c=null,Sc=te()+500,Uc(e,t)):cc=xe(e,t);e:for(;;)try{if(0!==ac&&null!==ic){t=ic;var r=oc;t:switch(ac){case 1:ac=0,oc=null,Zc(e,t,r,1);break;case 2:case 9:if(Ki(r)){ac=0,oc=null,Jc(t);break}t=function(){2!==ac&&9!==ac||sc!==e||(ac=7),Sh(e)},r.then(t,t);break e;case 3:ac=7;break e;case 4:ac=5;break e;case 7:Ki(r)?(ac=0,oc=null,Jc(t)):(ac=0,oc=null,Zc(e,t,r,7));break;case 5:var o=null;switch(ic.tag){case 26:o=ic.memoizedState;case 5:case 27:var l=ic;if(!o||Bu(o)){ac=0,oc=null;var c=l.sibling;if(null!==c)ic=c;else{var h=l.return;null!==h?(ic=h,eh(h)):ic=null}break t}}ac=0,oc=null,Zc(e,t,r,5);break;case 6:ac=0,oc=null,Zc(e,t,r,6);break;case 8:Hc(),dc=6;break e;default:throw Error(a(462))}}Qc();break}catch(u){Vc(e,u)}return yi=vi=null,N.H=s,N.A=i,nc=n,null!==ic?0:(sc=null,rc=0,Ts(),dc)}(e,t):qc(e,t,!0),r=s;;){if(0===i){cc&&!s&&Wc(e,t,0,!1);break}if(n=e.current.alternate,!r||zc(n)){if(2===i){if(r=t,e.errorRecoveryDisabledLanes&r)var o=0;else o=0!==(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;i=yc;var c=l.current.memoizedState.isDehydrated;if(c&&(Uc(l,o).flags|=256),2!==(o=qc(l,o,!1))){if(hc&&!c){l.errorRecoveryDisabledLanes|=r,pc|=r,i=4;break e}r=bc,bc=i,null!==r&&(null===bc?bc=r:bc.push.apply(bc,r))}i=o}if(r=!1,2!==i)continue}}if(1===i){Uc(e,0),Wc(e,t,0,!0);break}e:{switch(s=e,r=i){case 0:case 1:throw Error(a(345));case 4:if((4194048&t)!==t)break;case 6:Wc(s,t,mc,!lc);break e;case 2:bc=null;break;case 3:case 5:break;default:throw Error(a(329))}if((62914560&t)===t&&10<(i=wc+300-te())){if(Wc(s,t,mc,!lc),0!==be(s,0,!0))break e;s.timeoutHandle=lu(Ic.bind(null,s,n,bc,_c,xc,t,mc,pc,vc,lc,r,2,-0,0),i)}else Ic(s,n,bc,_c,xc,t,mc,pc,vc,lc,r,0,-0,0)}break}i=qc(e,t,!1),r=!1}Sh(e)}function Ic(e,t,n,s,i,r,o,l,c,h,u,d,f,p){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||16785408===(16785408&d))&&(Hu={stylesheets:null,count:0,unsuspend:Uu},ql(t),null!==(d=function(){if(null===Hu)throw Error(a(475));var e=Hu;return e.stylesheets&&0===e.count&&Xu(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Xu(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(nh.bind(null,e,t,r,n,s,i,o,l,c,u,1,f,p)),void Wc(e,r,o,!h);nh(e,t,r,n,s,i,o,l,c)}function zc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var s=0;s<n.length;s++){var i=n[s],r=i.getSnapshot;i=i.value;try{if(!Kn(r(),i))return!1}catch(a){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Wc(e,t,n,s){t&=~gc,t&=~pc,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var i=t;0<i;){var r=31-fe(i),a=1<<r;s[r]=-1,i&=~a}0!==n&&Ae(e,n,t)}function Bc(){return 0!==(6&nc)||(_h(0,!1),!1)}function Hc(){if(null!==ic){if(0===ac)var e=ic.return;else yi=vi=null,Fr(e=ic),qa=null,Ka=0,e=ic;for(;null!==e;)rl(e.alternate,e),e=e.return;ic=null}}function Uc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,cu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Hc(),sc=e,ic=n=Is(e.current,null),rc=t,ac=0,oc=null,lc=!1,cc=xe(e,t),hc=!1,vc=mc=gc=pc=fc=dc=0,bc=yc=null,xc=!1,0!==(8&t)&&(t|=32&t);var s=e.entangledLanes;if(0!==s)for(e=e.entanglements,s&=t;0<s;){var i=31-fe(s),r=1<<i;t|=e[i],s&=~r}return uc=t,Ts(),n}function Vc(e,t){br=null,N.H=Va,t===Gi||t===Yi?(t=Zi(),ac=3):t===Xi?(t=Zi(),ac=4):ac=t===Ao?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,oc=t,null===ic&&(dc=1,wo(e,Cs(t,e.current)))}function Gc(){var e=N.H;return N.H=Va,null===e?Va:e}function Xc(){var e=N.A;return N.A=ec,e}function Yc(){dc=4,lc||(4194048&rc)!==rc&&null!==so.current||(cc=!0),0===(134217727&fc)&&0===(134217727&pc)||null===sc||Wc(sc,rc,mc,!1)}function qc(e,t,n){var s=nc;nc|=2;var i=Gc(),r=Xc();sc===e&&rc===t||(_c=null,Uc(e,t)),t=!1;var a=dc;e:for(;;)try{if(0!==ac&&null!==ic){var o=ic,l=oc;switch(ac){case 8:Hc(),a=6;break e;case 3:case 2:case 9:case 6:null===so.current&&(t=!0);var c=ac;if(ac=0,oc=null,Zc(e,o,l,c),n&&cc){a=0;break e}break;default:c=ac,ac=0,oc=null,Zc(e,o,l,c)}}Kc(),a=dc;break}catch(h){Vc(e,h)}return t&&e.shellSuspendCounter++,yi=vi=null,nc=s,N.H=i,N.A=r,null===ic&&(sc=null,rc=0,Ts()),a}function Kc(){for(;null!==ic;)$c(ic)}function Qc(){for(;null!==ic&&!Z();)$c(ic)}function $c(e){var t=$o(e.alternate,e,uc);e.memoizedProps=e.pendingProps,null===t?eh(e):ic=t}function Jc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ro(n,t,t.pendingProps,t.type,void 0,rc);break;case 11:t=Ro(n,t,t.pendingProps,t.type.render,t.ref,rc);break;case 5:Fr(t);default:rl(n,t),t=$o(n,t=ic=zs(t,uc),uc)}e.memoizedProps=e.pendingProps,null===t?eh(e):ic=t}function Zc(e,t,n,s){yi=vi=null,Fr(t),qa=null,Ka=0;var i=t.return;try{if(function(e,t,n,s,i){if(n.flags|=32768,null!==s&&"object"===typeof s&&"function"===typeof s.then){if(null!==(t=n.alternate)&&_i(t,n,i,!0),null!==(n=so.current)){switch(n.tag){case 13:return null===io?Yc():null===n.alternate&&0===dc&&(dc=3),n.flags&=-257,n.flags|=65536,n.lanes=i,s===qi?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([s]):t.add(s),uh(e,s,i)),!1;case 22:return n.flags|=65536,s===qi?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([s]):n.add(s),uh(e,s,i)),!1}throw Error(a(435,n.tag))}return uh(e,s,i),Yc(),!1}if(ri)return null!==(t=so.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,s!==li&&gi(Cs(e=Error(a(422),{cause:s}),n))):(s!==li&&gi(Cs(t=Error(a(423),{cause:s}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,s=Cs(s,n),or(e,i=_o(e.stateNode,s,i)),4!==dc&&(dc=2)),!1;var r=Error(a(520),{cause:s});if(r=Cs(r,n),null===yc?yc=[r]:yc.push(r),4!==dc&&(dc=2),null===t)return!0;s=Cs(s,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,or(n,e=_o(n.stateNode,s,e)),!1;case 1:if(t=n.type,r=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==r&&"function"===typeof r.componentDidCatch&&(null===Cc||!Cc.has(r))))return n.flags|=65536,i&=-i,n.lanes|=i,ko(i=Co(i),e,n,s),or(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,rc))return dc=1,wo(e,Cs(n,e.current)),void(ic=null)}catch(r){if(null!==i)throw ic=i,r;return dc=1,wo(e,Cs(n,e.current)),void(ic=null)}32768&t.flags?(ri||1===s?e=!0:cc||0!==(536870912&rc)?e=!1:(lc=e=!0,(2===s||9===s||3===s||6===s)&&(null!==(s=so.current)&&13===s.tag&&(s.flags|=16384))),th(t,e)):eh(t)}function eh(e){var t=e;do{if(0!==(32768&t.flags))return void th(t,lc);e=t.return;var n=sl(t.alternate,t,uc);if(null!==n)return void(ic=n);if(null!==(t=t.sibling))return void(ic=t);ic=t=e}while(null!==t);0===dc&&(dc=5)}function th(e,t){do{var n=il(e.alternate,e);if(null!==n)return n.flags&=32767,void(ic=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(ic=e);ic=e=n}while(null!==e);dc=6,ic=null}function nh(e,t,n,s,i,r,o,l,c){e.cancelPendingCommit=null;do{oh()}while(0!==kc);if(0!==(6&nc))throw Error(a(327));if(null!==t){if(t===e.current)throw Error(a(177));if(r=t.lanes|t.childLanes,function(e,t,n,s,i,r){var a=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=a&~n;0<n;){var h=31-fe(n),u=1<<h;o[h]=0,l[h]=-1;var d=c[h];if(null!==d)for(c[h]=null,h=0;h<d.length;h++){var f=d[h];null!==f&&(f.lane&=-536870913)}n&=~u}0!==s&&Ae(e,s,0),0!==r&&0===i&&0!==e.tag&&(e.suspendedLanes|=r&~(a&~t))}(e,n,r|=Es,o,l,c),e===sc&&(ic=sc=null,rc=0),Ec=t,Ac=e,Tc=n,Mc=r,jc=i,Pc=s,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,$(re,function(){return lh(),null})):(e.callbackNode=null,e.callbackPriority=0),s=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||s){s=N.T,N.T=null,i=L.p,L.p=2,o=nc,nc|=4;try{!function(e,t){if(e=e.containerInfo,tu=nd,ts(e=es(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(s&&0!==s.rangeCount){n=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{n.nodeType,r.nodeType}catch(m){n=null;break e}var o=0,l=-1,c=-1,h=0,u=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(l=o+i),d!==r||0!==s&&3!==d.nodeType||(c=o+s),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++h===i&&(l=o),f===r&&++u===s&&(c=o),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nu={focusedElem:e,selectionRange:n},nd=!1,_l=t;null!==_l;)if(e=(t=_l).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,_l=e;else for(;null!==_l;){switch(r=(t=_l).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==r){e=void 0,n=t,i=r.memoizedProps,r=r.memoizedState,s=n.stateNode;try{var g=mo(n.type,i,(n.elementType,n.type));e=s.getSnapshotBeforeUpdate(g,r),s.__reactInternalSnapshotBeforeUpdate=e}catch(v){hh(n,n.return,v)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))gu(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":gu(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,_l=e;break}_l=t.return}}(e,t)}finally{nc=o,L.p=i,N.T=s}}kc=1,sh(),ih(),rh()}}function sh(){if(1===kc){kc=0;var e=Ac,t=Ec,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=N.T,N.T=null;var s=L.p;L.p=2;var i=nc;nc|=4;try{Nl(t,e);var r=nu,a=es(e.containerInfo),o=r.focusedElem,l=r.selectionRange;if(a!==o&&o&&o.ownerDocument&&Zn(o.ownerDocument.documentElement,o)){if(null!==l&&ts(o)){var c=l.start,h=l.end;if(void 0===h&&(h=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(h,o.value.length);else{var u=o.ownerDocument||document,d=u&&u.defaultView||window;if(d.getSelection){var f=d.getSelection(),p=o.textContent.length,g=Math.min(l.start,p),m=void 0===l.end?g:Math.min(l.end,p);!f.extend&&g>m&&(a=m,m=g,g=a);var v=Jn(o,g),y=Jn(o,m);if(v&&y&&(1!==f.rangeCount||f.anchorNode!==v.node||f.anchorOffset!==v.offset||f.focusNode!==y.node||f.focusOffset!==y.offset)){var b=u.createRange();b.setStart(v.node,v.offset),f.removeAllRanges(),g>m?(f.addRange(b),f.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),f.addRange(b))}}}}for(u=[],f=o;f=f.parentNode;)1===f.nodeType&&u.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"===typeof o.focus&&o.focus(),o=0;o<u.length;o++){var x=u[o];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}nd=!!tu,nu=tu=null}finally{nc=i,L.p=s,N.T=n}}e.current=t,kc=2}}function ih(){if(2===kc){kc=0;var e=Ac,t=Ec,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=N.T,N.T=null;var s=L.p;L.p=2;var i=nc;nc|=4;try{Cl(e,t.alternate,t)}finally{nc=i,L.p=s,N.T=n}}kc=3}}function rh(){if(4===kc||3===kc){kc=0,ee();var e=Ac,t=Ec,n=Tc,s=Pc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?kc=5:(kc=0,Ec=Ac=null,ah(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(Cc=null),Me(n),t=t.stateNode,ue&&"function"===typeof ue.onCommitFiberRoot)try{ue.onCommitFiberRoot(he,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==s){t=N.T,i=L.p,L.p=2,N.T=null;try{for(var r=e.onRecoverableError,a=0;a<s.length;a++){var o=s[a];r(o.value,{componentStack:o.stack})}}finally{N.T=t,L.p=i}}0!==(3&Tc)&&oh(),Sh(e),i=e.pendingLanes,0!==(4194090&n)&&0!==(42&i)?e===Dc?Oc++:(Oc=0,Dc=e):Oc=0,_h(0,!1)}}function ah(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Ni(t)))}function oh(e){return sh(),ih(),rh(),lh()}function lh(){if(5!==kc)return!1;var e=Ac,t=Mc;Mc=0;var n=Me(Tc),s=N.T,i=L.p;try{L.p=32>n?32:n,N.T=null,n=jc,jc=null;var r=Ac,o=Tc;if(kc=0,Ec=Ac=null,Tc=0,0!==(6&nc))throw Error(a(331));var l=nc;if(nc|=4,$l(r.current),Ul(r,r.current,o,n),nc=l,_h(0,!1),ue&&"function"===typeof ue.onPostCommitFiberRoot)try{ue.onPostCommitFiberRoot(he,r)}catch(c){}return!0}finally{L.p=i,N.T=s,ah(e,t)}}function ch(e,t,n){t=Cs(n,t),null!==(e=rr(e,t=_o(e.stateNode,t,2),2))&&(ke(e,2),Sh(e))}function hh(e,t,n){if(3===e.tag)ch(e,e,n);else for(;null!==t;){if(3===t.tag){ch(t,e,n);break}if(1===t.tag){var s=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof s.componentDidCatch&&(null===Cc||!Cc.has(s))){e=Cs(n,e),null!==(s=rr(t,n=Co(2),2))&&(ko(n,s,t,e),ke(s,2),Sh(s));break}}t=t.return}}function uh(e,t,n){var s=e.pingCache;if(null===s){s=e.pingCache=new tc;var i=new Set;s.set(t,i)}else void 0===(i=s.get(t))&&(i=new Set,s.set(t,i));i.has(n)||(hc=!0,i.add(n),e=dh.bind(null,e,t,n),t.then(e,e))}function dh(e,t,n){var s=e.pingCache;null!==s&&s.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,sc===e&&(rc&n)===n&&(4===dc||3===dc&&(62914560&rc)===rc&&300>te()-wc?0===(2&nc)&&Uc(e,0):gc|=n,vc===rc&&(vc=0)),Sh(e)}function fh(e,t){0===t&&(t=_e()),null!==(e=Ps(e,t))&&(ke(e,t),Sh(e))}function ph(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),fh(e,n)}function gh(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==s&&s.delete(t),fh(e,n)}var mh=null,vh=null,yh=!1,bh=!1,xh=!1,wh=0;function Sh(e){e!==vh&&null===e.next&&(null===vh?mh=vh=e:vh=vh.next=e),bh=!0,yh||(yh=!0,uu(function(){0!==(6&nc)?$(se,Ch):kh()}))}function _h(e,t){if(!xh&&bh){xh=!0;do{for(var n=!1,s=mh;null!==s;){if(!t)if(0!==e){var i=s.pendingLanes;if(0===i)var r=0;else{var a=s.suspendedLanes,o=s.pingedLanes;r=(1<<31-fe(42|e)+1)-1,r=201326741&(r&=i&~(a&~o))?201326741&r|1:r?2|r:0}0!==r&&(n=!0,Th(s,r))}else r=rc,0===(3&(r=be(s,s===sc?r:0,null!==s.cancelPendingCommit||-1!==s.timeoutHandle)))||xe(s,r)||(n=!0,Th(s,r));s=s.next}}while(n);xh=!1}}function Ch(){kh()}function kh(){bh=yh=!1;var e=0;0!==wh&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ou&&(ou=e,!0);return ou=null,!1}()&&(e=wh),wh=0);for(var t=te(),n=null,s=mh;null!==s;){var i=s.next,r=Ah(s,t);0===r?(s.next=null,null===n?mh=i:n.next=i,null===i&&(vh=n)):(n=s,(0!==e||0!==(3&r))&&(bh=!0)),s=i}_h(e,!1)}function Ah(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,i=e.expirationTimes,r=-62914561&e.pendingLanes;0<r;){var a=31-fe(r),o=1<<a,l=i[a];-1===l?0!==(o&n)&&0===(o&s)||(i[a]=we(o,t)):l<=t&&(e.expiredLanes|=o),r&=~o}if(n=rc,n=be(e,e===(t=sc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),s=e.callbackNode,0===n||e===t&&(2===ac||9===ac)||null!==e.cancelPendingCommit)return null!==s&&null!==s&&J(s),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==s&&J(s),Me(n)){case 2:case 8:n=ie;break;case 32:default:n=re;break;case 268435456:n=oe}return s=Eh.bind(null,e),n=$(n,s),e.callbackPriority=t,e.callbackNode=n,t}return null!==s&&null!==s&&J(s),e.callbackPriority=2,e.callbackNode=null,2}function Eh(e,t){if(0!==kc&&5!==kc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(oh()&&e.callbackNode!==n)return null;var s=rc;return 0===(s=be(e,e===sc?s:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Fc(e,s,t),Ah(e,te()),null!=e.callbackNode&&e.callbackNode===n?Eh.bind(null,e):null)}function Th(e,t){if(oh())return null;Fc(e,t,!0)}function Mh(){return 0===wh&&(wh=Se()),wh}function jh(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Mt(""+e)}function Ph(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Oh=0;Oh<ws.length;Oh++){var Dh=ws[Oh];Ss(Dh.toLowerCase(),"on"+(Dh[0].toUpperCase()+Dh.slice(1)))}Ss(fs,"onAnimationEnd"),Ss(ps,"onAnimationIteration"),Ss(gs,"onAnimationStart"),Ss("dblclick","onDoubleClick"),Ss("focusin","onFocus"),Ss("focusout","onBlur"),Ss(ms,"onTransitionRun"),Ss(vs,"onTransitionStart"),Ss(ys,"onTransitionCancel"),Ss(bs,"onTransitionEnd"),Ke("onMouseEnter",["mouseout","mouseover"]),Ke("onMouseLeave",["mouseout","mouseover"]),Ke("onPointerEnter",["pointerout","pointerover"]),Ke("onPointerLeave",["pointerout","pointerover"]),qe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),qe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),qe("onBeforeInput",["compositionend","keypress","textInput","paste"]),qe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),qe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),qe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Nh));function Rh(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var s=e[n],i=s.event;s=s.listeners;e:{var r=void 0;if(t)for(var a=s.length-1;0<=a;a--){var o=s[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&i.isPropagationStopped())break e;r=o,i.currentTarget=c;try{r(i)}catch(h){vo(h)}i.currentTarget=null,r=l}else for(a=0;a<s.length;a++){if(l=(o=s[a]).instance,c=o.currentTarget,o=o.listener,l!==r&&i.isPropagationStopped())break e;r=o,i.currentTarget=c;try{r(i)}catch(h){vo(h)}i.currentTarget=null,r=l}}}}function Fh(e,t){var n=t[Le];void 0===n&&(n=t[Le]=new Set);var s=e+"__bubble";n.has(s)||(Bh(t,e,2,!1),n.add(s))}function Ih(e,t,n){var s=0;t&&(s|=4),Bh(n,e,s,t)}var zh="_reactListening"+Math.random().toString(36).slice(2);function Wh(e){if(!e[zh]){e[zh]=!0,Xe.forEach(function(t){"selectionchange"!==t&&(Lh.has(t)||Ih(t,!1,e),Ih(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zh]||(t[zh]=!0,Ih("selectionchange",!1,t))}}function Bh(e,t,n,s){switch(cd(t)){case 2:var i=sd;break;case 8:i=id;break;default:i=rd}n=i.bind(null,t,n,e),i=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),s?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hh(e,t,n,s,i){var r=s;if(0===(1&t)&&0===(2&t)&&null!==s)e:for(;;){if(null===s)return;var a=s.tag;if(3===a||4===a){var o=s.stateNode.containerInfo;if(o===i)break;if(4===a)for(a=s.return;null!==a;){var c=a.tag;if((3===c||4===c)&&a.stateNode.containerInfo===i)return;a=a.return}for(;null!==o;){if(null===(a=Be(o)))return;if(5===(c=a.tag)||6===c||26===c||27===c){s=r=a;continue e}o=o.parentNode}}s=s.return}Rt(function(){var s=r,i=Pt(n),a=[];e:{var o=xs.get(e);if(void 0!==o){var c=Zt,h=e;switch(e){case"keypress":if(0===Gt(n))break e;case"keydown":case"keyup":c=gn;break;case"focusin":h="focus",c=an;break;case"focusout":h="blur",c=an;break;case"beforeblur":case"afterblur":c=an;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=sn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=rn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=vn;break;case fs:case ps:case gs:c=on;break;case bs:c=yn;break;case"scroll":case"scrollend":c=tn;break;case"wheel":c=bn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=mn;break;case"toggle":case"beforetoggle":c=xn}var u=0!==(4&t),d=!u&&("scroll"===e||"scrollend"===e),f=u?null!==o?o+"Capture":null:o;u=[];for(var p,g=s;null!==g;){var m=g;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===f||null!=(m=Ft(g,f))&&u.push(Uh(g,m,p)),d)break;g=g.return}0<u.length&&(o=new c(o,h,null,n,i),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===jt||!(h=n.relatedTarget||n.fromElement)||!Be(h)&&!h[Ne])&&(c||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=s,null!==(h=(h=n.relatedTarget||n.toElement)?Be(h):null)&&(d=l(h),u=h.tag,h!==d||5!==u&&27!==u&&6!==u)&&(h=null)):(c=null,h=s),c!==h)){if(u=sn,m="onMouseLeave",f="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=mn,m="onPointerLeave",f="onPointerEnter",g="pointer"),d=null==c?o:Ue(c),p=null==h?o:Ue(h),(o=new u(m,g+"leave",c,n,i)).target=d,o.relatedTarget=p,m=null,Be(i)===s&&((u=new u(f,g+"enter",h,n,i)).target=p,u.relatedTarget=d,m=u),d=m,c&&h)e:{for(f=h,g=0,p=u=c;p;p=Gh(p))g++;for(p=0,m=f;m;m=Gh(m))p++;for(;0<g-p;)u=Gh(u),g--;for(;0<p-g;)f=Gh(f),p--;for(;g--;){if(u===f||null!==f&&u===f.alternate)break e;u=Gh(u),f=Gh(f)}u=null}else u=null;null!==c&&Xh(a,o,c,u,!1),null!==h&&null!==d&&Xh(a,d,h,u,!0)}if("select"===(c=(o=s?Ue(s):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var v=In;else if(On(o))if(zn)v=qn;else{v=Xn;var y=Gn}else!(c=o.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?s&&At(s.elementType)&&(v=In):v=Yn;switch(v&&(v=v(e,s))?Dn(a,v,n,i):(y&&y(e,o,s),"focusout"===e&&s&&"number"===o.type&&null!=s.memoizedProps.value&&yt(o,"number",o.value)),y=s?Ue(s):window,e){case"focusin":(On(y)||"true"===y.contentEditable)&&(ss=y,is=s,rs=null);break;case"focusout":rs=is=ss=null;break;case"mousedown":as=!0;break;case"contextmenu":case"mouseup":case"dragend":as=!1,os(a,n,i);break;case"selectionchange":if(ns)break;case"keydown":case"keyup":os(a,n,i)}var b;if(Sn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else jn?Tn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(kn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==x?"onCompositionEnd"===x&&jn&&(b=Vt()):(Ht="value"in(Bt=i)?Bt.value:Bt.textContent,jn=!0)),0<(y=Vh(s,x)).length&&(x=new cn(x,e,null,n,i),a.push({event:x,listeners:y}),b?x.data=b:null!==(b=Mn(n))&&(x.data=b))),(b=Cn?function(e,t){switch(e){case"compositionend":return Mn(t);case"keypress":return 32!==t.which?null:(En=!0,An);case"textInput":return(e=t.data)===An&&En?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!Sn&&Tn(e,t)?(e=Vt(),Ut=Ht=Bt=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return kn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=Vh(s,"onBeforeInput")).length&&(y=new cn("onBeforeInput","beforeinput",null,n,i),a.push({event:y,listeners:x}),y.data=b)),function(e,t,n,s,i){if("submit"===t&&n&&n.stateNode===i){var r=jh((i[De]||null).action),a=s.submitter;a&&null!==(t=(t=a[De]||null)?jh(t.formAction):a.getAttribute("formAction"))&&(r=t,a=null);var o=new Zt("action","action",null,s,i);e.push({event:o,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(0!==wh){var e=a?Ph(i,a):new FormData(i);ja(n,{pending:!0,data:e,method:i.method,action:r},null,e)}}else"function"===typeof r&&(o.preventDefault(),e=a?Ph(i,a):new FormData(i),ja(n,{pending:!0,data:e,method:i.method,action:r},r,e))},currentTarget:i}]})}}(a,e,s,n,i)}Rh(a,t)})}function Uh(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Vh(e,t){for(var n=t+"Capture",s=[];null!==e;){var i=e,r=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===r||(null!=(i=Ft(e,n))&&s.unshift(Uh(e,i,r)),null!=(i=Ft(e,t))&&s.push(Uh(e,i,r))),3===e.tag)return s;e=e.return}return[]}function Gh(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Xh(e,t,n,s,i){for(var r=t._reactName,a=[];null!==n&&n!==s;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===s)break;5!==o&&26!==o&&27!==o||null===c||(l=c,i?null!=(c=Ft(n,r))&&a.unshift(Uh(n,c,l)):i||null!=(c=Ft(n,r))&&a.push(Uh(n,c,l))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Yh=/\r\n?/g,qh=/\u0000|\uFFFD/g;function Kh(e){return("string"===typeof e?e:""+e).replace(Yh,"\n").replace(qh,"")}function Qh(e,t){return t=Kh(t),Kh(e)===t}function $h(){}function Jh(e,t,n,s,i,r){switch(n){case"children":"string"===typeof s?"body"===t||"textarea"===t&&""===s||St(e,s):("number"===typeof s||"bigint"===typeof s)&&"body"!==t&&St(e,""+s);break;case"className":nt(e,"class",s);break;case"tabIndex":nt(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,s);break;case"style":kt(e,s,r);break;case"data":if("object"!==t){nt(e,"data",s);break}case"src":case"href":if(""===s&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==s||"function"===typeof s||"symbol"===typeof s||"boolean"===typeof s){e.removeAttribute(n);break}s=Mt(""+s),e.setAttribute(n,s);break;case"action":case"formAction":if("function"===typeof s){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof r&&("formAction"===n?("input"!==t&&Jh(e,t,"name",i.name,i,null),Jh(e,t,"formEncType",i.formEncType,i,null),Jh(e,t,"formMethod",i.formMethod,i,null),Jh(e,t,"formTarget",i.formTarget,i,null)):(Jh(e,t,"encType",i.encType,i,null),Jh(e,t,"method",i.method,i,null),Jh(e,t,"target",i.target,i,null))),null==s||"symbol"===typeof s||"boolean"===typeof s){e.removeAttribute(n);break}s=Mt(""+s),e.setAttribute(n,s);break;case"onClick":null!=s&&(e.onclick=$h);break;case"onScroll":null!=s&&Fh("scroll",e);break;case"onScrollEnd":null!=s&&Fh("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!==typeof s||!("__html"in s))throw Error(a(61));if(null!=(n=s.__html)){if(null!=i.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=s&&"function"!==typeof s&&"symbol"!==typeof s;break;case"muted":e.muted=s&&"function"!==typeof s&&"symbol"!==typeof s;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==s||"function"===typeof s||"boolean"===typeof s||"symbol"===typeof s){e.removeAttribute("xlink:href");break}n=Mt(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=s&&"function"!==typeof s&&"symbol"!==typeof s?e.setAttribute(n,""+s):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&"function"!==typeof s&&"symbol"!==typeof s?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===s?e.setAttribute(n,""):!1!==s&&null!=s&&"function"!==typeof s&&"symbol"!==typeof s?e.setAttribute(n,s):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&!isNaN(s)&&1<=s?e.setAttribute(n,s):e.removeAttribute(n);break;case"rowSpan":case"start":null==s||"function"===typeof s||"symbol"===typeof s||isNaN(s)?e.removeAttribute(n):e.setAttribute(n,s);break;case"popover":Fh("beforetoggle",e),Fh("toggle",e),tt(e,"popover",s);break;case"xlinkActuate":st(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":st(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":st(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":st(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":st(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":st(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":st(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":st(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":st(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":tt(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Et.get(n)||n,s)}}function Zh(e,t,n,s,i,r){switch(n){case"style":kt(e,s,r);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!==typeof s||!("__html"in s))throw Error(a(61));if(null!=(n=s.__html)){if(null!=i.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"===typeof s?St(e,s):("number"===typeof s||"bigint"===typeof s)&&St(e,""+s);break;case"onScroll":null!=s&&Fh("scroll",e);break;case"onScrollEnd":null!=s&&Fh("scrollend",e);break;case"onClick":null!=s&&(e.onclick=$h);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ye.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"===typeof(r=null!=(r=e[De]||null)?r[n]:null)&&e.removeEventListener(t,r,i),"function"!==typeof s)?n in e?e[n]=s:!0===s?e.setAttribute(n,""):tt(e,n,s):("function"!==typeof r&&null!==r&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,s,i)))}}function eu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Fh("error",e),Fh("load",e);var s,i=!1,r=!1;for(s in n)if(n.hasOwnProperty(s)){var o=n[s];if(null!=o)switch(s){case"src":i=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Jh(e,t,s,o,n,null)}}return r&&Jh(e,t,"srcSet",n.srcSet,n,null),void(i&&Jh(e,t,"src",n.src,n,null));case"input":Fh("invalid",e);var l=s=o=r=null,c=null,h=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(null!=u)switch(i){case"name":r=u;break;case"type":o=u;break;case"checked":c=u;break;case"defaultChecked":h=u;break;case"value":s=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,t));break;default:Jh(e,t,i,u,n,null)}}return vt(e,s,l,c,h,o,r,!1),void ut(e);case"select":for(r in Fh("invalid",e),i=o=s=null,n)if(n.hasOwnProperty(r)&&null!=(l=n[r]))switch(r){case"value":s=l;break;case"defaultValue":o=l;break;case"multiple":i=l;default:Jh(e,t,r,l,n,null)}return t=s,n=o,e.multiple=!!i,void(null!=t?bt(e,!!i,t,!1):null!=n&&bt(e,!!i,n,!0));case"textarea":for(o in Fh("invalid",e),s=r=i=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":i=l;break;case"defaultValue":r=l;break;case"children":s=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:Jh(e,t,o,l,n,null)}return wt(e,i,r,s),void ut(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(i=n[c]))if("selected"===c)e.selected=i&&"function"!==typeof i&&"symbol"!==typeof i;else Jh(e,t,c,i,n,null);return;case"dialog":Fh("beforetoggle",e),Fh("toggle",e),Fh("cancel",e),Fh("close",e);break;case"iframe":case"object":Fh("load",e);break;case"video":case"audio":for(i=0;i<Nh.length;i++)Fh(Nh[i],e);break;case"image":Fh("error",e),Fh("load",e);break;case"details":Fh("toggle",e);break;case"embed":case"source":case"link":Fh("error",e),Fh("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(h in n)if(n.hasOwnProperty(h)&&null!=(i=n[h]))switch(h){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Jh(e,t,h,i,n,null)}return;default:if(At(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(i=n[u])&&Zh(e,t,u,i,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(i=n[l])&&Jh(e,t,l,i,n,null))}var tu=null,nu=null;function su(e){return 9===e.nodeType?e:e.ownerDocument}function iu(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ru(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function au(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ou=null;var lu="function"===typeof setTimeout?setTimeout:void 0,cu="function"===typeof clearTimeout?clearTimeout:void 0,hu="function"===typeof Promise?Promise:void 0,uu="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof hu?function(e){return hu.resolve(null).then(e).catch(du)}:lu;function du(e){setTimeout(function(){throw e})}function fu(e){return"head"===e}function pu(e,t){var n=t,s=0,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0<s&&8>s){n=s;var a=e.ownerDocument;if(1&n&&wu(a.documentElement),2&n&&wu(a.body),4&n)for(wu(n=a.head),a=n.firstChild;a;){var o=a.nextSibling,l=a.nodeName;a[ze]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===a.rel.toLowerCase()||n.removeChild(a),a=o}}if(0===i)return e.removeChild(r),void Ed(t);i--}else"$"===n||"$?"===n||"$!"===n?i++:s=n.charCodeAt(0)-48;else s=0;n=r}while(n);Ed(t)}function gu(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":gu(n),We(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function mu(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function vu(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var yu=null;function bu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function xu(e,t,n){switch(t=su(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}function wu(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);We(e)}var Su=new Map,_u=new Set;function Cu(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var ku=L.d;L.d={f:function(){var e=ku.f(),t=Bc();return e||t},r:function(e){var t=He(e);null!==t&&5===t.tag&&"form"===t.type?Oa(t):ku.r(e)},D:function(e){ku.D(e),Eu("dns-prefetch",e,null)},C:function(e,t){ku.C(e,t),Eu("preconnect",e,t)},L:function(e,t,n){ku.L(e,t,n);var s=Au;if(s&&e&&t){var i='link[rel="preload"][as="'+gt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+gt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(i+='[imagesizes="'+gt(n.imageSizes)+'"]')):i+='[href="'+gt(e)+'"]';var r=i;switch(t){case"style":r=Mu(e);break;case"script":r=Ou(e)}Su.has(r)||(e=d({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Su.set(r,e),null!==s.querySelector(i)||"style"===t&&s.querySelector(ju(r))||"script"===t&&s.querySelector(Du(r))||(eu(t=s.createElement("link"),"link",e),Ge(t),s.head.appendChild(t)))}},m:function(e,t){ku.m(e,t);var n=Au;if(n&&e){var s=t&&"string"===typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+gt(s)+'"][href="'+gt(e)+'"]',r=i;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=Ou(e)}if(!Su.has(r)&&(e=d({rel:"modulepreload",href:e},t),Su.set(r,e),null===n.querySelector(i))){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Du(r)))return}eu(s=n.createElement("link"),"link",e),Ge(s),n.head.appendChild(s)}}},X:function(e,t){ku.X(e,t);var n=Au;if(n&&e){var s=Ve(n).hoistableScripts,i=Ou(e),r=s.get(i);r||((r=n.querySelector(Du(i)))||(e=d({src:e,async:!0},t),(t=Su.get(i))&&Fu(e,t),Ge(r=n.createElement("script")),eu(r,"link",e),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},s.set(i,r))}},S:function(e,t,n){ku.S(e,t,n);var s=Au;if(s&&e){var i=Ve(s).hoistableStyles,r=Mu(e);t=t||"default";var a=i.get(r);if(!a){var o={loading:0,preload:null};if(a=s.querySelector(ju(r)))o.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Su.get(r))&&Ru(e,n);var l=a=s.createElement("link");Ge(l),eu(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,Lu(a,t,s)}a={type:"stylesheet",instance:a,count:1,state:o},i.set(r,a)}}},M:function(e,t){ku.M(e,t);var n=Au;if(n&&e){var s=Ve(n).hoistableScripts,i=Ou(e),r=s.get(i);r||((r=n.querySelector(Du(i)))||(e=d({src:e,async:!0,type:"module"},t),(t=Su.get(i))&&Fu(e,t),Ge(r=n.createElement("script")),eu(r,"link",e),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},s.set(i,r))}}};var Au="undefined"===typeof document?null:document;function Eu(e,t,n){var s=Au;if(s&&"string"===typeof t&&t){var i=gt(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"===typeof n&&(i+='[crossorigin="'+n+'"]'),_u.has(i)||(_u.add(i),e={rel:e,crossOrigin:n,href:t},null===s.querySelector(i)&&(eu(t=s.createElement("link"),"link",e),Ge(t),s.head.appendChild(t)))}}function Tu(e,t,n,s){var i,r,o,l,c=(c=V.current)?Cu(c):null;if(!c)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Mu(n.href),(s=(n=Ve(c).hoistableStyles).get(t))||(s={type:"style",instance:null,count:0,state:null},n.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Mu(n.href);var h=Ve(c).hoistableStyles,u=h.get(e);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,u),(h=c.querySelector(ju(e)))&&!h._p&&(u.instance=h,u.state.loading=5),Su.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Su.set(e,n),h||(i=c,r=e,o=n,l=u.state,i.querySelector('link[rel="preload"][as="style"]['+r+"]")?l.loading=1:(r=i.createElement("link"),l.preload=r,r.addEventListener("load",function(){return l.loading|=1}),r.addEventListener("error",function(){return l.loading|=2}),eu(r,"link",o),Ge(r),i.head.appendChild(r))))),t&&null===s)throw Error(a(528,""));return u}if(t&&null!==s)throw Error(a(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Ou(n),(s=(n=Ve(c).hoistableScripts).get(t))||(s={type:"script",instance:null,count:0,state:null},n.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Mu(e){return'href="'+gt(e)+'"'}function ju(e){return'link[rel="stylesheet"]['+e+"]"}function Pu(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Ou(e){return'[src="'+gt(e)+'"]'}function Du(e){return"script[async]"+e}function Nu(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+gt(n.href)+'"]');if(s)return t.instance=s,Ge(s),s;var i=d({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Ge(s=(e.ownerDocument||e).createElement("style")),eu(s,"style",i),Lu(s,n.precedence,e),t.instance=s;case"stylesheet":i=Mu(n.href);var r=e.querySelector(ju(i));if(r)return t.state.loading|=4,t.instance=r,Ge(r),r;s=Pu(n),(i=Su.get(i))&&Ru(s,i),Ge(r=(e.ownerDocument||e).createElement("link"));var o=r;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),eu(r,"link",s),t.state.loading|=4,Lu(r,n.precedence,e),t.instance=r;case"script":return r=Ou(n.src),(i=e.querySelector(Du(r)))?(t.instance=i,Ge(i),i):(s=n,(i=Su.get(r))&&Fu(s=d({},n),i),Ge(i=(e=e.ownerDocument||e).createElement("script")),eu(i,"link",s),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(s=t.instance,t.state.loading|=4,Lu(s,n.precedence,e));return t.instance}function Lu(e,t,n){for(var s=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=s.length?s[s.length-1]:null,r=i,a=0;a<s.length;a++){var o=s[a];if(o.dataset.precedence===t)r=o;else if(r!==i)break}r?r.parentNode.insertBefore(e,r.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Ru(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Fu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Iu=null;function zu(e,t,n){if(null===Iu){var s=new Map,i=Iu=new Map;i.set(n,s)}else(s=(i=Iu).get(n))||(s=new Map,i.set(n,s));if(s.has(e))return s;for(s.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var r=n[i];if(!(r[ze]||r[Oe]||"link"===e&&"stylesheet"===r.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==r.namespaceURI){var a=r.getAttribute(t)||"";a=e+a;var o=s.get(a);o?o.push(r):s.set(a,[r])}}return s}function Wu(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Bu(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Hu=null;function Uu(){}function Vu(){if(this.count--,0===this.count)if(this.stylesheets)Xu(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Gu=null;function Xu(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Gu=new Map,t.forEach(Yu,e),Gu=null,Vu.call(e))}function Yu(e,t){if(!(4&t.state.loading)){var n=Gu.get(e);if(n)var s=n.get(null);else{n=new Map,Gu.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<i.length;r++){var a=i[r];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(n.set(a.dataset.precedence,a),s=a)}s&&n.set(null,s)}a=(i=t.instance).getAttribute("data-precedence"),(r=n.get(a)||s)===s&&n.set(null,i),n.set(a,i),this.count++,s=Vu.bind(this),i.addEventListener("load",s),i.addEventListener("error",s),r?r.parentNode.insertBefore(i,r.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var qu={$$typeof:w,Provider:null,Consumer:null,_currentValue:R,_currentValue2:R,_threadCount:0};function Ku(e,t,n,s,i,r,a,o){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ce(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ce(0),this.hiddenUpdates=Ce(null),this.identifierPrefix=s,this.onUncaughtError=i,this.onCaughtError=r,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function Qu(e,t,n,s,i,r,a,o,l,c,h,u){return e=new Ku(e,t,n,a,o,l,c,u),t=1,!0===r&&(t|=24),r=Rs(3,null,null,t),e.current=r,r.stateNode=e,(t=Di()).refCount++,e.pooledCache=t,t.refCount++,r.memoizedState={element:s,isDehydrated:n,cache:t},nr(r),e}function $u(e){return e?e=Ns:Ns}function Ju(e,t,n,s,i,r){i=$u(i),null===s.context?s.context=i:s.pendingContext=i,(s=ir(t)).payload={element:n},null!==(r=void 0===r?null:r)&&(s.callback=r),null!==(n=rr(e,s,t))&&(Rc(n,0,t),ar(n,e,t))}function Zu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ed(e,t){Zu(e,t),(e=e.alternate)&&Zu(e,t)}function td(e){if(13===e.tag){var t=Ps(e,67108864);null!==t&&Rc(t,0,67108864),ed(e,67108864)}}var nd=!0;function sd(e,t,n,s){var i=N.T;N.T=null;var r=L.p;try{L.p=2,rd(e,t,n,s)}finally{L.p=r,N.T=i}}function id(e,t,n,s){var i=N.T;N.T=null;var r=L.p;try{L.p=8,rd(e,t,n,s)}finally{L.p=r,N.T=i}}function rd(e,t,n,s){if(nd){var i=ad(s);if(null===i)Hh(e,t,s,od,n),yd(e,s);else if(function(e,t,n,s,i){switch(t){case"focusin":return ud=bd(ud,e,t,n,s,i),!0;case"dragenter":return dd=bd(dd,e,t,n,s,i),!0;case"mouseover":return fd=bd(fd,e,t,n,s,i),!0;case"pointerover":var r=i.pointerId;return pd.set(r,bd(pd.get(r)||null,e,t,n,s,i)),!0;case"gotpointercapture":return r=i.pointerId,gd.set(r,bd(gd.get(r)||null,e,t,n,s,i)),!0}return!1}(i,e,t,n,s))s.stopPropagation();else if(yd(e,s),4&t&&-1<vd.indexOf(e)){for(;null!==i;){var r=He(i);if(null!==r)switch(r.tag){case 3:if((r=r.stateNode).current.memoizedState.isDehydrated){var a=ye(r.pendingLanes);if(0!==a){var o=r;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var l=1<<31-fe(a);o.entanglements[1]|=l,a&=~l}Sh(r),0===(6&nc)&&(Sc=te()+500,_h(0,!1))}}break;case 13:null!==(o=Ps(r,2))&&Rc(o,0,2),Bc(),ed(r,2)}if(null===(r=ad(s))&&Hh(e,t,s,od,n),r===i)break;i=r}null!==i&&s.stopPropagation()}else Hh(e,t,s,null,n)}}function ad(e){return ld(e=Pt(e))}var od=null;function ld(e){if(od=null,null!==(e=Be(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return od=e,null}function cd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case se:return 2;case ie:return 8;case re:case ae:return 32;case oe:return 268435456;default:return 32}default:return 32}}var hd=!1,ud=null,dd=null,fd=null,pd=new Map,gd=new Map,md=[],vd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yd(e,t){switch(e){case"focusin":case"focusout":ud=null;break;case"dragenter":case"dragleave":dd=null;break;case"mouseover":case"mouseout":fd=null;break;case"pointerover":case"pointerout":pd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gd.delete(t.pointerId)}}function bd(e,t,n,s,i,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},null!==t&&(null!==(t=He(t))&&td(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function xd(e){var t=Be(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void function(e,t){var n=L.p;try{return L.p=e,t()}finally{L.p=n}}(e.priority,function(){if(13===n.tag){var e=Nc();e=Te(e);var t=Ps(n,e);null!==t&&Rc(t,0,e),ed(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function wd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=ad(e.nativeEvent);if(null!==n)return null!==(t=He(n))&&td(t),e.blockedOn=n,!1;var s=new(n=e.nativeEvent).constructor(n.type,n);jt=s,n.target.dispatchEvent(s),jt=null,t.shift()}return!0}function Sd(e,t,n){wd(e)&&n.delete(t)}function _d(){hd=!1,null!==ud&&wd(ud)&&(ud=null),null!==dd&&wd(dd)&&(dd=null),null!==fd&&wd(fd)&&(fd=null),pd.forEach(Sd),gd.forEach(Sd)}function Cd(e,t){e.blockedOn===t&&(e.blockedOn=null,hd||(hd=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,_d)))}var kd=null;function Ad(e){kd!==e&&(kd=e,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){kd===e&&(kd=null);for(var t=0;t<e.length;t+=3){var n=e[t],s=e[t+1],i=e[t+2];if("function"!==typeof s){if(null===ld(s||n))continue;break}var r=He(n);null!==r&&(e.splice(t,3),t-=3,ja(r,{pending:!0,data:i,method:n.method,action:s},s,i))}}))}function Ed(e){function t(t){return Cd(t,e)}null!==ud&&Cd(ud,e),null!==dd&&Cd(dd,e),null!==fd&&Cd(fd,e),pd.forEach(t),gd.forEach(t);for(var n=0;n<md.length;n++){var s=md[n];s.blockedOn===e&&(s.blockedOn=null)}for(;0<md.length&&null===(n=md[0]).blockedOn;)xd(n),null===n.blockedOn&&md.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(s=0;s<n.length;s+=3){var i=n[s],r=n[s+1],a=i[De]||null;if("function"===typeof r)a||Ad(n);else if(a){var o=null;if(r&&r.hasAttribute("formAction")){if(i=r,a=r[De]||null)o=a.formAction;else if(null!==ld(i))continue}else o=a.action;"function"===typeof o?n[s+1]=o:(n.splice(s,3),s-=3),Ad(n)}}}function Td(e){this._internalRoot=e}function Md(e){this._internalRoot=e}Md.prototype.render=Td.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Ju(t.current,Nc(),e,t,null,null)},Md.prototype.unmount=Td.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Ju(e.current,2,null,e,null,null),Bc(),t[Ne]=null}},Md.prototype.unstable_scheduleHydration=function(e){if(e){var t=je();e={blockedOn:null,target:e,priority:t};for(var n=0;n<md.length&&0!==t&&t<md[n].priority;n++);md.splice(n,0,e),0===n&&xd(e)}};var jd=i.version;if("19.1.0"!==jd)throw Error(a(527,jd,"19.1.0"));L.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,s=t;;){var i=n.return;if(null===i)break;var r=i.alternate;if(null===r){if(null!==(s=i.return)){n=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===n)return h(i),e;if(r===s)return h(i),t;r=r.sibling}throw Error(a(188))}if(n.return!==s.return)n=i,s=r;else{for(var o=!1,c=i.child;c;){if(c===n){o=!0,n=i,s=r;break}if(c===s){o=!0,s=i,n=r;break}c=c.sibling}if(!o){for(c=r.child;c;){if(c===n){o=!0,n=r,s=i;break}if(c===s){o=!0,s=r,n=i;break}c=c.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==s)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?u(e):null)?null:e.stateNode};var Pd={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.1.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Od=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Od.isDisabled&&Od.supportsFiber)try{he=Od.inject(Pd),ue=Od}catch(Nd){}}t.createRoot=function(e,t){if(!o(e))throw Error(a(299));var n=!1,s="",i=yo,r=bo,l=xo;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(r=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Qu(e,1,!1,null,0,n,s,i,r,l,0,null),e[Ne]=t.current,Wh(e),new Td(t)},t.hydrateRoot=function(e,t,n){if(!o(e))throw Error(a(299));var s=!1,i="",r=yo,l=bo,c=xo,h=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onUncaughtError&&(r=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(h=n.formState)),(t=Qu(e,1,!0,t,0,s,i,r,l,c,0,h)).context=$u(null),n=t.current,(i=ir(s=Te(s=Nc()))).callback=null,rr(n,i,s),n=s,t.current.lanes=n,ke(t,n),Sh(t),e[Ne]=t.current,Wh(e),new Md(t)},t.version="19.1.0"},43:(e,t,n)=>{"use strict";e.exports=n(288)},62:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){for(var e=[a,o],t=0;t<e.length;t++){var n=e[t];n&&(n.parentNode&&n.parentNode.removeChild(n))}a=o=null,l=[]},t.log=function(){console.log("bodyTrap ----------"),console.log(l.length);for(var e=[a,o],t=0;t<e.length;t++){var n=e[t]||{};console.log(n.nodeName,n.className,n.id)}console.log("edn bodyTrap ----------")};var s,i=n(959),r=(s=i)&&s.__esModule?s:{default:s};var a=void 0,o=void 0,l=[];function c(){0!==l.length&&l[l.length-1].focusContent()}r.default.subscribe(function(e,t){a||o||((a=document.createElement("div")).setAttribute("data-react-modal-body-trap",""),a.style.position="absolute",a.style.opacity="0",a.setAttribute("tabindex","0"),a.addEventListener("focus",c),(o=a.cloneNode()).addEventListener("focus",c)),(l=t).length>0?(document.body.firstChild!==a&&document.body.insertBefore(a,document.body.firstChild),document.body.lastChild!==o&&document.body.appendChild(o)):(a.parentElement&&a.parentElement.removeChild(a),o.parentElement&&o.parentElement.removeChild(o))})},173:(e,t,n)=>{e.exports=n(497)()},175:(e,t)=>{"use strict";const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,s=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,o=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function l(e,t,n){do{const n=e.charCodeAt(t);if(32!==n&&9!==n)return t}while(++t<n);return n}function c(e,t,n){for(;t>n;){const n=e.charCodeAt(--t);if(32!==n&&9!==n)return t+1}return n}function h(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},206:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,r.default)(e);if(!n.length)return void t.preventDefault();var s=void 0,i=t.shiftKey,o=n[0],l=n[n.length-1],c=a();if(e===c){if(!i)return;s=l}l!==c||i||(s=o);o===c&&i&&(s=l);if(s)return t.preventDefault(),void s.focus();var h=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);if(null==h||"Chrome"==h[1]||null!=/\biPod\b|\biPad\b/g.exec(navigator.userAgent))return;var u=n.indexOf(c);u>-1&&(u+=i?-1:1);if("undefined"===typeof(s=n[u]))return t.preventDefault(),void(s=i?l:o).focus();t.preventDefault(),s.focus()};var s,i=n(682),r=(s=i)&&s.__esModule?s:{default:s};function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return e.activeElement.shadowRoot?a(e.activeElement.shadowRoot):e.activeElement}e.exports=t.default},218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,g(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S={H:null,A:null,T:null,S:null,V:null},_=Object.prototype.hasOwnProperty;function C(e,t,s,i,r,a){return s=a.ref,{$$typeof:n,type:e,key:t,ref:void 0!==s?s:null,props:a}}function k(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(){}function M(e,t,i,r,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l,c,h=!1;if(null===e)h=!0;else switch(o){case"bigint":case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case n:case s:h=!0;break;case d:return M((h=e._init)(e._payload),t,i,r,a)}}if(h)return a=a(e),h=""===r?"."+E(e,0):r,w(a)?(i="",null!=h&&(i=h.replace(A,"$&/")+"/"),M(a,t,i,"",function(e){return e})):null!=a&&(k(a)&&(l=a,c=i+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(A,"$&/")+"/")+h,a=C(l.type,c,void 0,0,0,l.props)),t.push(a)),1;h=0;var u,p=""===r?".":r+":";if(w(e))for(var g=0;g<e.length;g++)h+=M(r=e[g],t,i,o=p+E(r,g),a);else if("function"===typeof(g=null===(u=e)||"object"!==typeof u?null:"function"===typeof(u=f&&u[f]||u["@@iterator"])?u:null))for(e=g.call(e),g=0;!(r=e.next()).done;)h+=M(r=r.value,t,i,o=p+E(r,g++),a);else if("object"===o){if("function"===typeof e.then)return M(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(T,T):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,i,r,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return h}function j(e,t,n){if(null==e)return e;var s=[],i=0;return M(e,s,"","",function(e){return t.call(n,e,i++)}),s}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function D(){}t.Children={map:j,forEach:function(e,t,n){j(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return j(e,function(){t++}),t},toArray:function(e){return j(e,function(e){return e})||[]},only:function(e){if(!k(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=a,t.PureComponent=b,t.StrictMode=r,t.Suspense=h,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return S.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var s=g({},e.props),i=e.key;if(null!=t)for(r in void 0!==t.ref&&void 0,void 0!==t.key&&(i=""+t.key),t)!_.call(t,r)||"key"===r||"__self"===r||"__source"===r||"ref"===r&&void 0===t.ref||(s[r]=t[r]);var r=arguments.length-2;if(1===r)s.children=n;else if(1<r){for(var a=Array(r),o=0;o<r;o++)a[o]=arguments[o+2];s.children=a}return C(e.type,i,void 0,0,0,s)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},t.createElement=function(e,t,n){var s,i={},r=null;if(null!=t)for(s in void 0!==t.key&&(r=""+t.key),t)_.call(t,s)&&"key"!==s&&"__self"!==s&&"__source"!==s&&(i[s]=t[s]);var a=arguments.length-2;if(1===a)i.children=n;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];i.children=o}if(e&&e.defaultProps)for(s in a=e.defaultProps)void 0===i[s]&&(i[s]=a[s]);return C(e,r,void 0,0,0,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var s=e(),i=S.S;null!==i&&i(n,s),"object"===typeof s&&null!==s&&"function"===typeof s.then&&s.then(D,O)}catch(r){O(r)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var s=S.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return s.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.1.0"},391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},396:(e,t,n)=>{var s;!function(){"use strict";var i=!("undefined"===typeof window||!window.document||!window.document.createElement),r={canUseDOM:i,canUseWorkers:"undefined"!==typeof Worker,canUseEventListeners:i&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:i&&!!window.screen};void 0===(s=function(){return r}.call(t,n,t,e))||(e.exports=s)}()},439:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a=n(43),o=m(n(173)),l=g(n(774)),c=m(n(206)),h=g(n(619)),u=g(n(841)),d=n(821),f=m(d),p=m(n(959));function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}n(62);var v={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},y=0,b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.setOverlayRef=function(e){n.overlay=e,n.props.overlayRef&&n.props.overlayRef(e)},n.setContentRef=function(e){n.content=e,n.props.contentRef&&n.props.contentRef(e)},n.afterClose=function(){var e=n.props,t=e.appElement,s=e.ariaHideApp,i=e.htmlOpenClassName,r=e.bodyOpenClassName,a=e.parentSelector,o=a&&a().ownerDocument||document;r&&u.remove(o.body,r),i&&u.remove(o.getElementsByTagName("html")[0],i),s&&y>0&&0===(y-=1)&&h.show(t),n.props.shouldFocusAfterRender&&(n.props.shouldReturnFocusAfterClose?(l.returnFocus(n.props.preventScroll),l.teardownScopedFocus()):l.popWithoutFocus()),n.props.onAfterClose&&n.props.onAfterClose(),p.default.deregister(n)},n.open=function(){n.beforeOpen(),n.state.afterOpen&&n.state.beforeClose?(clearTimeout(n.closeTimer),n.setState({beforeClose:!1})):(n.props.shouldFocusAfterRender&&(l.setupScopedFocus(n.node),l.markForFocusLater()),n.setState({isOpen:!0},function(){n.openAnimationFrame=requestAnimationFrame(function(){n.setState({afterOpen:!0}),n.props.isOpen&&n.props.onAfterOpen&&n.props.onAfterOpen({overlayEl:n.overlay,contentEl:n.content})})}))},n.close=function(){n.props.closeTimeoutMS>0?n.closeWithTimeout():n.closeWithoutTimeout()},n.focusContent=function(){return n.content&&!n.contentHasFocus()&&n.content.focus({preventScroll:!0})},n.closeWithTimeout=function(){var e=Date.now()+n.props.closeTimeoutMS;n.setState({beforeClose:!0,closesAt:e},function(){n.closeTimer=setTimeout(n.closeWithoutTimeout,n.state.closesAt-Date.now())})},n.closeWithoutTimeout=function(){n.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},n.afterClose)},n.handleKeyDown=function(e){(function(e){return"Tab"===e.code||9===e.keyCode})(e)&&(0,c.default)(n.content,e),n.props.shouldCloseOnEsc&&function(e){return"Escape"===e.code||27===e.keyCode}(e)&&(e.stopPropagation(),n.requestClose(e))},n.handleOverlayOnClick=function(e){null===n.shouldClose&&(n.shouldClose=!0),n.shouldClose&&n.props.shouldCloseOnOverlayClick&&(n.ownerHandlesClose()?n.requestClose(e):n.focusContent()),n.shouldClose=null},n.handleContentOnMouseUp=function(){n.shouldClose=!1},n.handleOverlayOnMouseDown=function(e){n.props.shouldCloseOnOverlayClick||e.target!=n.overlay||e.preventDefault()},n.handleContentOnClick=function(){n.shouldClose=!1},n.handleContentOnMouseDown=function(){n.shouldClose=!1},n.requestClose=function(e){return n.ownerHandlesClose()&&n.props.onRequestClose(e)},n.ownerHandlesClose=function(){return n.props.onRequestClose},n.shouldBeClosed=function(){return!n.state.isOpen&&!n.state.beforeClose},n.contentHasFocus=function(){return document.activeElement===n.content||n.content.contains(document.activeElement)},n.buildClassName=function(e,t){var s="object"===("undefined"===typeof t?"undefined":i(t))?t:{base:v[e],afterOpen:v[e]+"--after-open",beforeClose:v[e]+"--before-close"},r=s.base;return n.state.afterOpen&&(r=r+" "+s.afterOpen),n.state.beforeClose&&(r=r+" "+s.beforeClose),"string"===typeof t&&t?r+" "+t:r},n.attributesFromObject=function(e,t){return Object.keys(t).reduce(function(n,s){return n[e+"-"+s]=t[s],n},{})},n.state={afterOpen:!1,beforeClose:!1},n.shouldClose=null,n.moveFromContentToOverlay=null,n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(e,t){this.props.isOpen&&!e.isOpen?this.open():!this.props.isOpen&&e.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!t.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,n=e.ariaHideApp,s=e.htmlOpenClassName,i=e.bodyOpenClassName,r=e.parentSelector,a=r&&r().ownerDocument||document;i&&u.add(a.body,i),s&&u.add(a.getElementsByTagName("html")[0],s),n&&(y+=1,h.hide(t)),p.default.register(this)}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.className,i=e.overlayClassName,r=e.defaultStyles,a=e.children,o=n?{}:r.content,l=i?{}:r.overlay;if(this.shouldBeClosed())return null;var c={ref:this.setOverlayRef,className:this.buildClassName("overlay",i),style:s({},l,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},h=s({id:t,ref:this.setContentRef,style:s({},o,this.props.style.content),className:this.buildClassName("content",n),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",s({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),u=this.props.contentElement(h,a);return this.props.overlayElement(c,u)}}]),t}(a.Component);b.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},b.propTypes={isOpen:o.default.bool.isRequired,defaultStyles:o.default.shape({content:o.default.object,overlay:o.default.object}),style:o.default.shape({content:o.default.object,overlay:o.default.object}),className:o.default.oneOfType([o.default.string,o.default.object]),overlayClassName:o.default.oneOfType([o.default.string,o.default.object]),parentSelector:o.default.func,bodyOpenClassName:o.default.string,htmlOpenClassName:o.default.string,ariaHideApp:o.default.bool,appElement:o.default.oneOfType([o.default.instanceOf(f.default),o.default.instanceOf(d.SafeHTMLCollection),o.default.instanceOf(d.SafeNodeList),o.default.arrayOf(o.default.instanceOf(f.default))]),onAfterOpen:o.default.func,onAfterClose:o.default.func,onRequestClose:o.default.func,closeTimeoutMS:o.default.number,shouldFocusAfterRender:o.default.bool,shouldCloseOnOverlayClick:o.default.bool,shouldReturnFocusAfterClose:o.default.bool,preventScroll:o.default.bool,role:o.default.string,contentLabel:o.default.string,aria:o.default.object,data:o.default.object,children:o.default.node,shouldCloseOnEsc:o.default.bool,overlayRef:o.default.func,contentRef:o.default.func,id:o.default.string,overlayElement:o.default.func,contentElement:o.default.func,testId:o.default.string},t.default=b,e.exports=t.default},440:e=>{"use strict";var t=function(){};e.exports=t},484:(e,t,n)=>{"use strict";function s(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!==e&&void 0!==e&&this.setState(e)}function i(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!==n&&void 0!==n?n:null}.bind(this))}function r(e,t){try{var n=this.props,s=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,s)}finally{this.props=n,this.state=s}}function a(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!==typeof e.getDerivedStateFromProps&&"function"!==typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,o=null;if("function"===typeof t.componentWillMount?n="componentWillMount":"function"===typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"===typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"===typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"===typeof t.componentWillUpdate?o="componentWillUpdate":"function"===typeof t.UNSAFE_componentWillUpdate&&(o="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==o){var l=e.displayName||e.name,c="function"===typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+c+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==o?"\n  "+o:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"===typeof e.getDerivedStateFromProps&&(t.componentWillMount=s,t.componentWillReceiveProps=i),"function"===typeof t.getSnapshotBeforeUpdate){if("function"!==typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=r;var h=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var s=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;h.call(this,e,t,s)}}return e}n.r(t),n.d(t,{polyfill:()=>a}),s.__suppressDeprecationWarning=!0,i.__suppressDeprecationWarning=!0,r.__suppressDeprecationWarning=!0},497:(e,t,n)=>{"use strict";var s=n(218);function i(){}function r(){}r.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,r,a){if(a!==s){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:r,resetWarningCache:i};return n.PropTypes=n,n}},579:(e,t,n)=>{"use strict";e.exports=n(799)},619:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){o&&(o.removeAttribute?o.removeAttribute("aria-hidden"):null!=o.length?o.forEach(function(e){return e.removeAttribute("aria-hidden")}):document.querySelectorAll(o).forEach(function(e){return e.removeAttribute("aria-hidden")}));o=null},t.log=function(){0},t.assertNodeList=l,t.setElement=function(e){var t=e;if("string"===typeof t&&a.canUseDOM){var n=document.querySelectorAll(t);l(n,t),t=n}return o=t||o},t.validateElement=c,t.hide=function(e){var t=!0,n=!1,s=void 0;try{for(var i,r=c(e)[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.setAttribute("aria-hidden","true")}}catch(a){n=!0,s=a}finally{try{!t&&r.return&&r.return()}finally{if(n)throw s}}},t.show=function(e){var t=!0,n=!1,s=void 0;try{for(var i,r=c(e)[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.removeAttribute("aria-hidden")}}catch(a){n=!0,s=a}finally{try{!t&&r.return&&r.return()}finally{if(n)throw s}}},t.documentNotReadyOrSSRTesting=function(){o=null};var s,i=n(440),r=(s=i)&&s.__esModule?s:{default:s},a=n(821);var o=null;function l(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function c(e){var t=e||o;return t?Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList?t:[t]:((0,r.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}},672:(e,t,n)=>{"use strict";var s=n(43);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var a={d:{f:r,r:function(){throw Error(i(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},o=Symbol.for("react.portal");var l=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:o,key:null==s?null:""+s,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=a.p;try{if(l.T=null,a.p=2,e)return e()}finally{l.T=t,a.p=n,a.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,s=c(n,t.crossOrigin),i="string"===typeof t.integrity?t.integrity:void 0,r="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?a.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:s,integrity:i,fetchPriority:r}):"script"===n&&a.d.X(e,{crossOrigin:s,integrity:i,fetchPriority:r,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,s=c(n,t.crossOrigin);a.d.L(e,n,{crossOrigin:s,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);a.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.0"},682:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var n=[].slice.call(t.querySelectorAll("*"),0).reduce(function(t,n){return t.concat(n.shadowRoot?e(n.shadowRoot):[n])},[]);return n.filter(o)};var n="none",s="contents",i=/^(input|select|textarea|button|object|iframe)$/;function r(e){var t=e.offsetWidth<=0&&e.offsetHeight<=0;if(t&&!e.innerHTML)return!0;try{var i=window.getComputedStyle(e),r=i.getPropertyValue("display");return t?r!==s&&function(e,t){return"visible"!==t.getPropertyValue("overflow")||e.scrollWidth<=0&&e.scrollHeight<=0}(e,i):r===n}catch(a){return console.warn("Failed to inspect element style"),!1}}function a(e,t){var n=e.nodeName.toLowerCase();return(i.test(n)&&!e.disabled||"a"===n&&e.href||t)&&function(e){for(var t=e,n=e.getRootNode&&e.getRootNode();t&&t!==document.body;){if(n&&t===n&&(t=n.host.parentNode),r(t))return!1;t=t.parentNode}return!0}(e)}function o(e){var t=e.getAttribute("tabindex");null===t&&(t=void 0);var n=isNaN(t);return(n||t>=0)&&a(e,!n)}e.exports=t.default},765:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bodyOpenClassName=t.portalClassName=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),r=n(43),a=p(r),o=p(n(950)),l=p(n(173)),c=p(n(439)),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(619)),u=n(821),d=p(u),f=n(484);function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var m=t.portalClassName="ReactModalPortal",v=t.bodyOpenClassName="ReactModal__Body--open",y=u.canUseDOM&&void 0!==o.default.createPortal,b=function(e){return document.createElement(e)},x=function(){return y?o.default.createPortal:o.default.unstable_renderSubtreeIntoContainer};function w(e){return e()}var S=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,l=Array(r),h=0;h<r;h++)l[h]=arguments[h];return n=i=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.removePortal=function(){!y&&o.default.unmountComponentAtNode(i.node);var e=w(i.props.parentSelector);e&&e.contains(i.node)?e.removeChild(i.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},i.portalRef=function(e){i.portal=e},i.renderPortal=function(e){var n=x()(i,a.default.createElement(c.default,s({defaultStyles:t.defaultStyles},e)),i.node);i.portalRef(n)},g(i,n)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentDidMount",value:function(){u.canUseDOM&&(y||(this.node=b("div")),this.node.className=this.props.portalClassName,w(this.props.parentSelector).appendChild(this.node),!y&&this.renderPortal(this.props))}},{key:"getSnapshotBeforeUpdate",value:function(e){return{prevParent:w(e.parentSelector),nextParent:w(this.props.parentSelector)}}},{key:"componentDidUpdate",value:function(e,t,n){if(u.canUseDOM){var s=this.props,i=s.isOpen,r=s.portalClassName;e.portalClassName!==r&&(this.node.className=r);var a=n.prevParent,o=n.nextParent;o!==a&&(a.removeChild(this.node),o.appendChild(this.node)),(e.isOpen||i)&&!y&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(u.canUseDOM&&this.node&&this.portal){var e=this.portal.state,t=Date.now(),n=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS);n?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,n-t)):this.removePortal()}}},{key:"render",value:function(){return u.canUseDOM&&y?(!this.node&&y&&(this.node=b("div")),x()(a.default.createElement(c.default,s({ref:this.portalRef,defaultStyles:t.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){h.setElement(e)}}]),t}(r.Component);S.propTypes={isOpen:l.default.bool.isRequired,style:l.default.shape({content:l.default.object,overlay:l.default.object}),portalClassName:l.default.string,bodyOpenClassName:l.default.string,htmlOpenClassName:l.default.string,className:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),overlayClassName:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),appElement:l.default.oneOfType([l.default.instanceOf(d.default),l.default.instanceOf(u.SafeHTMLCollection),l.default.instanceOf(u.SafeNodeList),l.default.arrayOf(l.default.instanceOf(d.default))]),onAfterOpen:l.default.func,onRequestClose:l.default.func,closeTimeoutMS:l.default.number,ariaHideApp:l.default.bool,shouldFocusAfterRender:l.default.bool,shouldCloseOnOverlayClick:l.default.bool,shouldReturnFocusAfterClose:l.default.bool,preventScroll:l.default.bool,parentSelector:l.default.func,aria:l.default.object,data:l.default.object,role:l.default.string,contentLabel:l.default.string,shouldCloseOnEsc:l.default.bool,overlayRef:l.default.func,contentRef:l.default.func,id:l.default.string,overlayElement:l.default.func,contentElement:l.default.func},S.defaultProps={isOpen:!1,portalClassName:m,bodyOpenClassName:v,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(e,t){return a.default.createElement("div",e,t)},contentElement:function(e,t){return a.default.createElement("div",e,t)}},S.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},(0,f.polyfill)(S),t.default=S},774:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){a=[]},t.log=function(){0},t.handleBlur=c,t.handleFocus=h,t.markForFocusLater=function(){a.push(document.activeElement)},t.returnFocus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;try{return void(0!==a.length&&(t=a.pop()).focus({preventScroll:e}))}catch(n){console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}},t.popWithoutFocus=function(){a.length>0&&a.pop()},t.setupScopedFocus=function(e){o=e,window.addEventListener?(window.addEventListener("blur",c,!1),document.addEventListener("focus",h,!0)):(window.attachEvent("onBlur",c),document.attachEvent("onFocus",h))},t.teardownScopedFocus=function(){o=null,window.addEventListener?(window.removeEventListener("blur",c),document.removeEventListener("focus",h)):(window.detachEvent("onBlur",c),document.detachEvent("onFocus",h))};var s,i=n(682),r=(s=i)&&s.__esModule?s:{default:s};var a=[],o=null,l=!1;function c(){l=!0}function h(){if(l){if(l=!1,!o)return;setTimeout(function(){o.contains(document.activeElement)||((0,r.default)(o)[0]||o).focus()},0)}}},799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function i(e,t,s){var i=null;if(void 0!==s&&(i=""+s),void 0!==t.key&&(i=""+t.key),"key"in t)for(var r in s={},t)"key"!==r&&(s[r]=t[r]);else s=t;return t=s.ref,{$$typeof:n,type:e,key:i,ref:void 0!==t?t:null,props:s}}t.Fragment=s,t.jsx=i,t.jsxs=i},821:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canUseDOM=t.SafeNodeList=t.SafeHTMLCollection=void 0;var s,i=n(396);var r=((s=i)&&s.__esModule?s:{default:s}).default,a=r.canUseDOM?window.HTMLElement:{};t.SafeHTMLCollection=r.canUseDOM?window.HTMLCollection:{},t.SafeNodeList=r.canUseDOM?window.NodeList:{},t.canUseDOM=r.canUseDOM;t.default=a},841:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){var e=document.getElementsByTagName("html")[0];for(var t in n)i(e,n[t]);var r=document.body;for(var a in s)i(r,s[a]);n={},s={}},t.log=function(){0};var n={},s={};function i(e,t){e.classList.remove(t)}t.add=function(e,t){return i=e.classList,r="html"==e.nodeName.toLowerCase()?n:s,void t.split(" ").forEach(function(e){!function(e,t){e[t]||(e[t]=0),e[t]+=1}(r,e),i.add(e)});var i,r},t.remove=function(e,t){return i=e.classList,r="html"==e.nodeName.toLowerCase()?n:s,void t.split(" ").forEach(function(e){!function(e,t){e[t]&&(e[t]-=1)}(r,e),0===r[e]&&i.remove(e)});var i,r}},853:(e,t,n)=>{"use strict";e.exports=n(896)},896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var s=n-1>>>1,i=e[s];if(!(0<r(i,t)))break e;e[s]=t,e[n]=i,n=s}}function s(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var s=0,i=e.length,a=i>>>1;s<a;){var o=2*(s+1)-1,l=e[o],c=o+1,h=e[c];if(0>r(l,n))c<i&&0>r(h,l)?(e[s]=h,e[c]=n,s=c):(e[s]=l,e[o]=n,s=o);else{if(!(c<i&&0>r(h,n)))break e;e[s]=h,e[c]=n,s=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],h=[],u=1,d=null,f=3,p=!1,g=!1,m=!1,v=!1,y="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=s(h);null!==t;){if(null===t.callback)i(h);else{if(!(t.startTime<=e))break;i(h),t.sortIndex=t.expirationTime,n(c,t)}t=s(h)}}function S(e){if(m=!1,w(e),!g)if(null!==s(c))g=!0,C||(C=!0,_());else{var t=s(h);null!==t&&O(S,t.startTime-e)}}var _,C=!1,k=-1,A=5,E=-1;function T(){return!!v||!(t.unstable_now()-E<A)}function M(){if(v=!1,C){var e=t.unstable_now();E=e;var n=!0;try{e:{g=!1,m&&(m=!1,b(k),k=-1),p=!0;var r=f;try{t:{for(w(e),d=s(c);null!==d&&!(d.expirationTime>e&&T());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var o=a(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof o){d.callback=o,w(e),n=!0;break t}d===s(c)&&i(c),w(e)}else i(c);d=s(c)}if(null!==d)n=!0;else{var l=s(h);null!==l&&O(S,l.startTime-e),n=!1}}break e}finally{d=null,f=r,p=!1}n=void 0}}finally{n?_():C=!1}}}if("function"===typeof x)_=function(){x(M)};else if("undefined"!==typeof MessageChannel){var j=new MessageChannel,P=j.port2;j.port1.onmessage=M,_=function(){P.postMessage(null)}}else _=function(){y(M,0)};function O(e,n){k=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_requestPaint=function(){v=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,r){var a=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?a+r:a:r=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:i,priorityLevel:e,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>a?(e.sortIndex=r,n(h,e),null===s(c)&&e===s(h)&&(m?(b(k),k=-1):m=!0,O(S,r-a))):(e.sortIndex=o,n(c,e),g||p||(g=!0,C||(C=!0,_()))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)},959:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=function(){console.log("portalOpenInstances ----------"),console.log(s.openInstances.length),s.openInstances.forEach(function(e){return console.log(e)}),console.log("end portalOpenInstances ----------")},t.resetState=function(){s=new n};var n=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.register=function(e){-1===t.openInstances.indexOf(e)&&(t.openInstances.push(e),t.emit("register"))},this.deregister=function(e){var n=t.openInstances.indexOf(e);-1!==n&&(t.openInstances.splice(n,1),t.emit("deregister"))},this.subscribe=function(e){t.subscribers.push(e)},this.emit=function(e){t.subscribers.forEach(function(n){return n(e,t.openInstances.slice())})},this.openInstances=[],this.subscribers=[]},s=new n;t.default=s},963:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=n(765),r=(s=i)&&s.__esModule?s:{default:s};t.default=r.default,e.exports=t.default}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,s)=>(n.f[s](e,t),t),[])),n.u=e=>"static/js/"+e+".dff87da4.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="website:";n.l=(s,i,r,a)=>{if(e[s])e[s].push(i);else{var o,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==t+r){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+r),o.src=s),e[s]=[i];var d=(t,n)=>{o.onerror=o.onload=null,clearTimeout(f);var i=e[s];if(delete e[s],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach(e=>e(n)),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/EduSite/",(()=>{var e={792:0};n.f.j=(t,s)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var r=new Promise((n,s)=>i=e[t]=[n,s]);s.push(i[2]=r);var a=n.p+n.u(t),o=new Error;n.l(a,s=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",o.name="ChunkLoadError",o.type=r,o.request=a,i[1](o)}},"chunk-"+t,t)}};var t=(t,s)=>{var i,r,a=s[0],o=s[1],l=s[2],c=0;if(a.some(t=>0!==e[t])){for(i in o)n.o(o,i)&&(n.m[i]=o[i]);if(l)l(n)}for(t&&t(s);c<a.length;c++)r=a[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0},s=self.webpackChunkwebsite=self.webpackChunkwebsite||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{dU:()=>av,ng:()=>ov,EA:()=>lv,Tm:()=>cv,D6:()=>hv,YE:()=>uv});var t=n(43),s=n(391);function i(e,t){if(null==e)return{};var n,s,i=function(e,t){if(null==e)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(-1!==t.indexOf(s))continue;n[s]=e[s]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function o(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n(175);const h=["sri"],u=["page"],d=["page","matches"],f=["onClick","discover","prefetch","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],p=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],g=["discover","fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition"];var m="popstate";function v(){return C(function(e,t){let{pathname:n="/",search:s="",hash:i=""}=_(e.location.hash.substring(1));return n.startsWith("/")||n.startsWith(".")||(n="/"+n),w("",{pathname:n,search:s,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){let n=e.document.querySelector("base"),s="";if(n&&n.getAttribute("href")){let t=e.location.href,n=t.indexOf("#");s=-1===n?t:t.slice(0,n)}return s+"#"+("string"===typeof t?t:S(t))},function(e,t){b("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push(".concat(JSON.stringify(t),")"))},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function y(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function b(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(xy){}}}function x(e,t){return{usr:e.state,key:e.key,idx:t}}function w(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0;return c(c({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?_(t):t),{},{state:n,key:t&&t.key||s||Math.random().toString(36).substring(2,10)})}function S(e){let{pathname:t="/",search:n="",hash:s=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),s&&"#"!==s&&(t+="#"===s.charAt(0)?s:"#"+s),t}function _(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substring(s),e=e.substring(0,s)),e&&(t.pathname=e)}return t}function C(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:i=document.defaultView,v5Compat:r=!1}=s,a=i.history,o="POP",l=null,h=u();function u(){return(a.state||{idx:null}).idx}function d(){o="POP";let e=u(),t=null==e?null:e-h;h=e,l&&l({action:o,location:p.location,delta:t})}function f(e){return k(e)}null==h&&(h=0,a.replaceState(c(c({},a.state),{},{idx:h}),""));let p={get action(){return o},get location(){return e(i,a)},listen(e){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(m,d),l=e,()=>{i.removeEventListener(m,d),l=null}},createHref:e=>t(i,e),createURL:f,encodeLocation(e){let t=f(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){o="PUSH";let s=w(p.location,e,t);n&&n(s,e),h=u()+1;let c=x(s,h),d=p.createHref(s);try{a.pushState(c,"",d)}catch(f){if(f instanceof DOMException&&"DataCloneError"===f.name)throw f;i.location.assign(d)}r&&l&&l({action:o,location:p.location,delta:1})},replace:function(e,t){o="REPLACE";let s=w(p.location,e,t);n&&n(s,e),h=u();let i=x(s,h),c=p.createHref(s);a.replaceState(i,"",c),r&&l&&l({action:o,location:p.location,delta:0})},go:e=>a.go(e)};return p}function k(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="http://localhost";"undefined"!==typeof window&&(n="null"!==window.location.origin?window.location.origin:window.location.href),y(n,"No window.location.(origin|href) available to create URL");let s="string"===typeof e?e:S(e);return s=s.replace(/ $/,"%20"),!t&&s.startsWith("//")&&(s=n+s),new URL(s,n)}new WeakMap;function A(e,t){return E(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function E(e,t,n,s){let i=H(("string"===typeof t?_(t):t).pathname||"/",n);if(null==i)return null;let r=T(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(r);let a=null;for(let o=0;null==a&&o<r.length;++o){let e=B(i);a=I(r[o],e,s)}return a}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=(e,i,r)=>{let a={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(y(a.relativePath.startsWith(s),'Absolute route path "'.concat(a.relativePath,'" nested under path "').concat(s,'" is not valid. An absolute child route path must start with the combined path of all its parent routes.')),a.relativePath=a.relativePath.slice(s.length));let o=Y([s,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(y(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'.concat(o,'".')),T(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:F(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!==(n=e.path)&&void 0!==n&&n.includes("?"))for(let s of M(e.path))i(e,t,s);else i(e,t)}),t}function M(e){let t=e.split("/");if(0===t.length)return[];let[n,...s]=t,i=n.endsWith("?"),r=n.replace(/\?$/,"");if(0===s.length)return i?[r,""]:[r];let a=M(s.join("/")),o=[];return o.push(...a.map(e=>""===e?r:[r,e].join("/"))),i&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}var j=/^:[\w-]+$/,P=3,O=2,D=1,N=10,L=-2,R=e=>"*"===e;function F(e,t){let n=e.split("/"),s=n.length;return n.some(R)&&(s+=L),t&&(s+=O),n.filter(e=>!R(e)).reduce((e,t)=>e+(j.test(t)?P:""===t?D:N),s)}function I(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:s}=e,i={},r="/",a=[];for(let o=0;o<s.length;++o){let e=s[o],l=o===s.length-1,c="/"===r?t:t.slice(r.length)||"/",h=z({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!h&&l&&n&&!s[s.length-1].route.index&&(h=z({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!h)return null;Object.assign(i,h.params),a.push({params:i,pathname:Y([r,h.pathname]),pathnameBase:q(Y([r,h.pathnameBase])),route:u}),"/"!==h.pathnameBase&&(r=Y([r,h.pathnameBase]))}return a}function z(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=W(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let r=i[0],a=r.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:s.reduce((e,t,n)=>{let{paramName:s,isOptional:i}=t;if("*"===s){let e=o[n]||"";a=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[s]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:r,pathnameBase:a,pattern:e}}function W(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];b("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'.concat(e,'" will be treated as if it were "').concat(e.replace(/\*$/,"/*"),'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "').concat(e.replace(/\*$/,"/*"),'".'));let s=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(s.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),s]}function B(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return b(!1,'The URL path "'.concat(e,'" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (').concat(t,").")),e}}function H(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&"/"!==s?null:e.slice(n)||"/"}function U(e,t,n,s){return"Cannot include a '".concat(e,"' character in a manually specified `to.").concat(t,"` field [").concat(JSON.stringify(s),"].  Please separate it out to the `to.").concat(n,'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.')}function V(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function G(e){let t=V(e);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function X(e,t,n){let s,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?s=_(e):(s=c({},e),y(!s.pathname||!s.pathname.includes("?"),U("?","pathname","search",s)),y(!s.pathname||!s.pathname.includes("#"),U("#","pathname","hash",s)),y(!s.search||!s.search.includes("#"),U("#","search","hash",s)));let r,a=""===e||""===s.pathname,o=a?"/":s.pathname;if(null==o)r=n;else{let e=t.length-1;if(!i&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}r=e>=0?t[e]:"/"}let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:n,search:s="",hash:i=""}="string"===typeof e?_(e):e,r=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:r,search:K(s),hash:Q(i)}}(s,r),h=o&&"/"!==o&&o.endsWith("/"),u=(a||"."===o)&&n.endsWith("/");return l.pathname.endsWith("/")||!h&&!u||(l.pathname+="/"),l}var Y=e=>e.join("/").replace(/\/\/+/g,"/"),q=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),K=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",Q=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function $(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var J=["POST","PUT","PATCH","DELETE"],Z=(new Set(J),["GET",...J]);new Set(Z),Symbol("ResetLoaderData");var ee=t.createContext(null);ee.displayName="DataRouter";var te=t.createContext(null);te.displayName="DataRouterState";var ne=t.createContext({isTransitioning:!1});ne.displayName="ViewTransition";var se=t.createContext(new Map);se.displayName="Fetchers";var ie=t.createContext(null);ie.displayName="Await";var re=t.createContext(null);re.displayName="Navigation";var ae=t.createContext(null);ae.displayName="Location";var oe=t.createContext({outlet:null,matches:[],isDataRoute:!1});oe.displayName="Route";var le=t.createContext(null);le.displayName="RouteError";function ce(){return null!=t.useContext(ae)}function he(){return y(ce(),"useLocation() may be used only in the context of a <Router> component."),t.useContext(ae).location}var ue="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function de(e){t.useContext(re).static||t.useLayoutEffect(e)}function fe(){let{isDataRoute:e}=t.useContext(oe);return e?function(){let{router:e}=_e("useNavigate"),n=ke("useNavigate"),s=t.useRef(!1);de(()=>{s.current=!0});let i=t.useCallback(async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(s.current,ue),s.current&&("number"===typeof t?e.navigate(t):await e.navigate(t,c({fromRouteId:n},i)))},[e,n]);return i}():function(){y(ce(),"useNavigate() may be used only in the context of a <Router> component.");let e=t.useContext(ee),{basename:n,navigator:s}=t.useContext(re),{matches:i}=t.useContext(oe),{pathname:r}=he(),a=JSON.stringify(G(i)),o=t.useRef(!1);de(()=>{o.current=!0});let l=t.useCallback(function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(b(o.current,ue),!o.current)return;if("number"===typeof t)return void s.go(t);let l=X(t,JSON.parse(a),r,"path"===i.relative);null==e&&"/"!==n&&(l.pathname="/"===l.pathname?n:Y([n,l.pathname])),(i.replace?s.replace:s.push)(l,i.state,i)},[n,s,a,r,e]);return l}()}t.createContext(null);function pe(){let{matches:e}=t.useContext(oe),n=e[e.length-1];return n?n.params:{}}function ge(e){let{relative:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:s}=t.useContext(oe),{pathname:i}=he(),r=JSON.stringify(G(s));return t.useMemo(()=>X(e,JSON.parse(r),i,"path"===n),[e,r,i,n])}function me(e,n,s,i){y(ce(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=t.useContext(re),{matches:a}=t.useContext(oe),o=a[a.length-1],l=o?o.params:{},h=o?o.pathname:"/",u=o?o.pathnameBase:"/",d=o&&o.route;{let e=d&&d.path||"";Te(h,!d||e.endsWith("*")||e.endsWith("*?"),'You rendered descendant <Routes> (or called `useRoutes()`) at "'.concat(h,'" (under <Route path="').concat(e,'">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won\'t match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="').concat(e,'"> to <Route path="').concat("/"===e?"*":"".concat(e,"/*"),'">.'))}let f,p=he();if(n){var g;let e="string"===typeof n?_(n):n;y("/"===u||(null===(g=e.pathname)||void 0===g?void 0:g.startsWith(u)),'When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "'.concat(u,'" but pathname "').concat(e.pathname,'" was given in the `location` prop.')),f=e}else f=p;let m=f.pathname||"/",v=m;if("/"!==u){let e=u.replace(/^\//,"").split("/");v="/"+m.replace(/^\//,"").split("/").slice(e.length).join("/")}let x=A(e,{pathname:v});b(d||null!=x,'No routes matched location "'.concat(f.pathname).concat(f.search).concat(f.hash,'" ')),b(null==x||void 0!==x[x.length-1].route.element||void 0!==x[x.length-1].route.Component||void 0!==x[x.length-1].route.lazy,'Matched leaf route at location "'.concat(f.pathname).concat(f.search).concat(f.hash,'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.'));let w=we(x&&x.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:Y([u,r.encodeLocation?r.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:Y([u,r.encodeLocation?r.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),a,s,i);return n&&w?t.createElement(ae.Provider,{value:{location:c({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:"POP"}},w):w}function ve(){let e=Ae(),n=$(e)?"".concat(e.status," ").concat(e.statusText):e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i},a={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",e),o=t.createElement(t.Fragment,null,t.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),t.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",t.createElement("code",{style:a},"ErrorBoundary")," or"," ",t.createElement("code",{style:a},"errorElement")," prop on your route.")),t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),s?t.createElement("pre",{style:r},s):null,o)}var ye=t.createElement(ve,null),be=class extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(oe.Provider,{value:this.props.routeContext},t.createElement(le.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function xe(e){let{routeContext:n,match:s,children:i}=e,r=t.useContext(ee);return r&&r.static&&r.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=s.route.id),t.createElement(oe.Provider,{value:n},i)}function we(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==e){if(!s)return null;if(s.errors)e=s.matches;else{if(0!==n.length||s.initialized||!(s.matches.length>0))return null;e=s.matches}}let i=e,r=null===s||void 0===s?void 0:s.errors;if(null!=r){let e=i.findIndex(e=>e.route.id&&void 0!==(null===r||void 0===r?void 0:r[e.route.id]));y(e>=0,"Could not find a matching route for errors on route IDs: ".concat(Object.keys(r).join(","))),i=i.slice(0,Math.min(i.length,e+1))}let a=!1,o=-1;if(s)for(let t=0;t<i.length;t++){let e=i[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(o=t),e.route.id){let{loaderData:t,errors:n}=s,r=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!n||void 0===n[e.route.id]);if(e.route.lazy||r){a=!0,i=o>=0?i.slice(0,o+1):[i[0]];break}}}return i.reduceRight((e,l,c)=>{let h,u=!1,d=null,f=null;s&&(h=r&&l.route.id?r[l.route.id]:void 0,d=l.route.errorElement||ye,a&&(o<0&&0===c?(Te("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,f=null):o===c&&(u=!0,f=l.route.hydrateFallbackElement||null)));let p=n.concat(i.slice(0,c+1)),g=()=>{let n;return n=h?d:u?f:l.route.Component?t.createElement(l.route.Component,null):l.route.element?l.route.element:e,t.createElement(xe,{match:l,routeContext:{outlet:e,matches:p,isDataRoute:null!=s},children:n})};return s&&(l.route.ErrorBoundary||l.route.errorElement||0===c)?t.createElement(be,{location:s.location,revalidation:s.revalidation,component:d,error:h,children:g(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):g()},null)}function Se(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function _e(e){let n=t.useContext(ee);return y(n,Se(e)),n}function Ce(e){let n=t.useContext(te);return y(n,Se(e)),n}function ke(e){let n=function(e){let n=t.useContext(oe);return y(n,Se(e)),n}(e),s=n.matches[n.matches.length-1];return y(s.route.id,"".concat(e,' can only be used on routes that contain a unique "id"')),s.route.id}function Ae(){var e;let n=t.useContext(le),s=Ce("useRouteError"),i=ke("useRouteError");return void 0!==n?n:null===(e=s.errors)||void 0===e?void 0:e[i]}var Ee={};function Te(e,t,n){t||Ee[e]||(Ee[e]=!0,b(!1,n))}t.memo(function(e){let{routes:t,future:n,state:s}=e;return me(t,void 0,s,n)});function Me(e){let{to:n,replace:s,state:i,relative:r}=e;y(ce(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=t.useContext(re);b(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=t.useContext(oe),{pathname:l}=he(),c=fe(),h=X(n,G(o),l,"path"===r),u=JSON.stringify(h);return t.useEffect(()=>{c(JSON.parse(u),{replace:s,state:i,relative:r})},[c,u,r,s,i]),null}function je(e){y(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Pe(e){let{basename:n="/",children:s=null,location:i,navigationType:r="POP",navigator:a,static:o=!1}=e;y(!ce(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=n.replace(/^\/*/,"/"),c=t.useMemo(()=>({basename:l,navigator:a,static:o,future:{}}),[l,a,o]);"string"===typeof i&&(i=_(i));let{pathname:h="/",search:u="",hash:d="",state:f=null,key:p="default"}=i,g=t.useMemo(()=>{let e=H(h,l);return null==e?null:{location:{pathname:e,search:u,hash:d,state:f,key:p},navigationType:r}},[l,h,u,d,f,p,r]);return b(null!=g,'<Router basename="'.concat(l,'"> is not able to match the URL "').concat(h).concat(u).concat(d,"\" because it does not start with the basename, so the <Router> won't render anything.")),null==g?null:t.createElement(re.Provider,{value:c},t.createElement(ae.Provider,{children:s,value:g}))}function Oe(e){let{children:t,location:n}=e;return me(De(t),n)}t.Component;function De(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=[];return t.Children.forEach(e,(e,i)=>{if(!t.isValidElement(e))return;let r=[...n,i];if(e.type===t.Fragment)return void s.push.apply(s,De(e.props.children,r));y(e.type===je,"[".concat("string"===typeof e.type?e.type:e.type.name,"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>")),y(!e.props.index||!e.props.children,"An index route cannot have child routes.");let a={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=De(e.props.children,r)),s.push(a)}),s}var Ne="get",Le="application/x-www-form-urlencoded";function Re(e){return null!=e&&"string"===typeof e.tagName}var Fe=null;var Ie=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ze(e){return null==e||Ie.has(e)?e:(b(!1,'"'.concat(e,'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` and will default to "').concat(Le,'"')),null)}function We(e,t){let n,s,i,r,a;if(Re(o=e)&&"form"===o.tagName.toLowerCase()){let a=e.getAttribute("action");s=a?H(a,t):null,n=e.getAttribute("method")||Ne,i=ze(e.getAttribute("enctype"))||Le,r=new FormData(e)}else if(function(e){return Re(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return Re(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let a=e.form;if(null==a)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=e.getAttribute("formaction")||a.getAttribute("action");if(s=o?H(o,t):null,n=e.getAttribute("formmethod")||a.getAttribute("method")||Ne,i=ze(e.getAttribute("formenctype"))||ze(a.getAttribute("enctype"))||Le,r=new FormData(a,e),!function(){if(null===Fe)try{new FormData(document.createElement("form"),0),Fe=!1}catch(xy){Fe=!0}return Fe}()){let{name:t,type:n,value:s}=e;if("image"===n){let e=t?"".concat(t,"."):"";r.append("".concat(e,"x"),"0"),r.append("".concat(e,"y"),"0")}else t&&r.append(t,s)}}else{if(Re(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Ne,s=null,i=Le,a=e}var o;return r&&"text/plain"===i&&(a=r,r=void 0),{action:s,method:n.toLowerCase(),encType:i,formData:r,body:a}}function Be(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}async function He(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error("Error loading route module `".concat(e.module,"`, reloading page...")),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Ue(e){return null!=e&&"string"===typeof e.page}function Ve(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function Ge(e,t,n,s,i,r){let a=(e,t)=>!n[t]||e.route.id!==n[t].route.id,o=(e,t)=>{var s;return n[t].pathname!==e.pathname||(null===(s=n[t].route.path)||void 0===s?void 0:s.endsWith("*"))&&n[t].params["*"]!==e.params["*"]};return"assets"===r?t.filter((e,t)=>a(e,t)||o(e,t)):"data"===r?t.filter((t,r)=>{let l=s.routes[t.route.id];if(!l||!l.hasLoader)return!1;if(a(t,r)||o(t,r))return!0;if(t.route.shouldRevalidate){var c;let s=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:(null===(c=n[0])||void 0===c?void 0:c.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof s)return s}return!0}):[]}function Xe(e,t){let{includeHydrateFallback:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s=e.map(e=>{let s=t.routes[e.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1),[...new Set(s)];var s}function Ye(e,t){let n=new Set,s=new Set(t);return e.reduce((e,i)=>{if(t&&!Ue(i)&&"script"===i.as&&i.href&&s.has(i.href))return e;let r=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let s of n)t[s]=e[s];return t}(i));return n.has(r)||(n.add(r),e.push({key:r,link:i})),e},[])}function qe(e){return{__html:e}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;Symbol("SingleFetchRedirect");var Ke=new Set([100,101,204,205]);function Qe(e,t){let n="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===n.pathname?n.pathname="_root.data":t&&"/"===H(n.pathname,t)?n.pathname="".concat(t.replace(/\/$/,""),"/_root.data"):n.pathname="".concat(n.pathname.replace(/\/$/,""),".data"),n}t.Component;function $e(e){let{error:n,isOutsideRemixApp:s}=e;console.error(n);let i,r=t.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if($(n))return t.createElement(Je,{title:"Unhandled Thrown Response!"},t.createElement("h1",{style:{fontSize:"24px"}},n.status," ",n.statusText),r);if(n instanceof Error)0;else{let e=null==n?"Unknown Error":"object"===typeof n&&"toString"in n?n.toString():JSON.stringify(n);new Error(e)}return t.createElement(Je,{title:"Application Error!",isOutsideRemixApp:s},t.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),t.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},i.stack),r)}function Je(e){var n;let{title:s,renderScripts:i,isOutsideRemixApp:r,children:a}=e,{routeModules:o}=st();return null!==o.root&&void 0!==n&&n.Layout&&!r?a:t.createElement("html",{lang:"en"},t.createElement("head",null,t.createElement("meta",{charSet:"utf-8"}),t.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),t.createElement("title",null,s)),t.createElement("body",null,t.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},a,i?t.createElement(ht,null):null)))}function Ze(e,t){return"lazy"===e.mode&&!0===t}function et(){let e=t.useContext(ee);return Be(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function tt(){let e=t.useContext(te);return Be(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var nt=t.createContext(void 0);function st(){let e=t.useContext(nt);return Be(e,"You must render this element inside a <HydratedRouter> element"),e}function it(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function rt(e,t,n){if(n&&!ct)return[e[0]];if(t){let n=e.findIndex(e=>void 0!==t[e.route.id]);return e.slice(0,n+1)}return e}function at(e){let{page:n}=e,s=i(e,u),{router:r}=et(),a=t.useMemo(()=>A(r.routes,n,r.basename),[r.routes,n,r.basename]);return a?t.createElement(lt,c({page:n,matches:a},s)):null}function ot(e){let{manifest:n,routeModules:s}=st(),[i,r]=t.useState([]);return t.useEffect(()=>{let t=!1;return async function(e,t,n){return Ye((await Promise.all(e.map(async e=>{let s=t.routes[e.route.id];if(s){let e=await He(s,n);return e.links?e.links():[]}return[]}))).flat(1).filter(Ve).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?c(c({},e),{},{rel:"prefetch",as:"style"}):c(c({},e),{},{rel:"prefetch"})))}(e,n,s).then(e=>{t||r(e)}),()=>{t=!0}},[e,n,s]),i}function lt(e){let{page:n,matches:s}=e,r=i(e,d),a=he(),{manifest:o,routeModules:l}=st(),{basename:h}=et(),{loaderData:u,matches:f}=tt(),p=t.useMemo(()=>Ge(n,s,f,o,a,"data"),[n,s,f,o,a]),g=t.useMemo(()=>Ge(n,s,f,o,a,"assets"),[n,s,f,o,a]),m=t.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let e=new Set,t=!1;if(s.forEach(n=>{var s;let i=o.routes[n.route.id];i&&i.hasLoader&&(!p.some(e=>e.route.id===n.route.id)&&n.route.id in u&&null!==(s=l[n.route.id])&&void 0!==s&&s.shouldRevalidate||i.hasClientLoader?t=!0:e.add(n.route.id))}),0===e.size)return[];let i=Qe(n,h);return t&&e.size>0&&i.searchParams.set("_routes",s.filter(t=>e.has(t.route.id)).map(e=>e.route.id).join(",")),[i.pathname+i.search]},[h,u,a,o,p,s,n,l]),v=t.useMemo(()=>Xe(g,o),[g,o]),y=ot(g);return t.createElement(t.Fragment,null,m.map(e=>t.createElement("link",c({key:e,rel:"prefetch",as:"fetch",href:e},r))),v.map(e=>t.createElement("link",c({key:e,rel:"modulepreload",href:e},r))),y.map(e=>{let{key:n,link:s}=e;return t.createElement("link",c({key:n},s))}))}nt.displayName="FrameworkContext";var ct=!1;function ht(e){let{manifest:n,serverHandoffString:s,isSpaMode:r,renderMeta:a,routeDiscovery:o,ssr:l}=st(),{router:u,static:d,staticContext:f}=et(),{matches:p}=tt(),g=Ze(o,l);a&&(a.didRenderScripts=!0);let m=rt(p,null,r);t.useEffect(()=>{0},[]);let v=t.useMemo(()=>{var r;let a=f?"window.__reactRouterContext = ".concat(s,";").concat("window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());"):" ",o=d?"".concat(null!==n.hmr&&void 0!==r&&r.runtime?"import ".concat(JSON.stringify(n.hmr.runtime),";"):"").concat(g?"":"import ".concat(JSON.stringify(n.url)),";\n").concat(m.map((e,t)=>{let s="route".concat(t),i=n.routes[e.route.id];Be(i,"Route ".concat(e.route.id," not found in manifest"));let{clientActionModule:r,clientLoaderModule:a,clientMiddlewareModule:o,hydrateFallbackModule:l,module:c}=i,h=[...r?[{module:r,varName:"".concat(s,"_clientAction")}]:[],...a?[{module:a,varName:"".concat(s,"_clientLoader")}]:[],...o?[{module:o,varName:"".concat(s,"_clientMiddleware")}]:[],...l?[{module:l,varName:"".concat(s,"_HydrateFallback")}]:[],{module:c,varName:"".concat(s,"_main")}];return 1===h.length?"import * as ".concat(s," from ").concat(JSON.stringify(c),";"):[h.map(e=>"import * as ".concat(e.varName,' from "').concat(e.module,'";')).join("\n"),"const ".concat(s," = {").concat(h.map(e=>"...".concat(e.varName)).join(","),"};")].join("\n")}).join("\n"),"\n  ").concat(g?"window.__reactRouterManifest = ".concat(JSON.stringify(function(e,t){let{sri:n}=e,s=i(e,h),r=new Set(t.state.matches.map(e=>e.route.id)),a=t.state.location.pathname.split("/").filter(Boolean),o=["/"];for(a.pop();a.length>0;)o.push("/".concat(a.join("/"))),a.pop();o.forEach(e=>{let n=A(t.routes,e,t.basename);n&&n.forEach(e=>r.add(e.route.id))});let l=[...r].reduce((e,t)=>Object.assign(e,{[t]:s.routes[t]}),{});return c(c({},s),{},{routes:l,sri:!!n||void 0})}(n,u),null,2),";"):"","\n  window.__reactRouterRouteModules = {").concat(m.map((e,t)=>"".concat(JSON.stringify(e.route.id),":route").concat(t)).join(","),"};\n\nimport(").concat(JSON.stringify(n.entry.module),");"):" ";return t.createElement(t.Fragment,null,t.createElement("script",c(c({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:qe(a),type:void 0})),t.createElement("script",c(c({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:qe(o),type:"module",async:!0})))},[]),y=ct?[]:(n.entry.imports.concat(Xe(m,n,{includeHydrateFallback:!0})),[...new Set(b)]);var b;let x="object"===typeof n.sri?n.sri:{};return ct?null:t.createElement(t.Fragment,null,"object"===typeof n.sri?t.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:x})}}):null,g?null:t.createElement("link",{rel:"modulepreload",href:n.url,crossOrigin:e.crossOrigin,integrity:x[n.url],suppressHydrationWarning:!0}),t.createElement("link",{rel:"modulepreload",href:n.entry.module,crossOrigin:e.crossOrigin,integrity:x[n.entry.module],suppressHydrationWarning:!0}),y.map(n=>t.createElement("link",{key:n,rel:"modulepreload",href:n,crossOrigin:e.crossOrigin,integrity:x[n],suppressHydrationWarning:!0})),v)}function ut(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{t.forEach(t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)})}}var dt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{dt&&(window.__reactRouterVersion="7.6.2")}catch(xy){}function ft(e){let{basename:n,children:s,window:i}=e,r=t.useRef();null==r.current&&(r.current=v({window:i,v5Compat:!0}));let a=r.current,[o,l]=t.useState({action:a.action,location:a.location}),c=t.useCallback(e=>{t.startTransition(()=>l(e))},[l]);return t.useLayoutEffect(()=>a.listen(c),[a,c]),t.createElement(Pe,{basename:n,children:s,location:o.location,navigationType:o.action,navigator:a})}var pt=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gt=t.forwardRef(function(e,n){let s,{onClick:r,discover:a="render",prefetch:o="none",relative:l,reloadDocument:h,replace:u,state:d,target:p,to:g,preventScrollReset:m,viewTransition:v}=e,x=i(e,f),{basename:w}=t.useContext(re),_="string"===typeof g&&pt.test(g),C=!1;if("string"===typeof g&&_&&(s=g,dt))try{let e=new URL(window.location.href),t=g.startsWith("//")?new URL(e.protocol+g):new URL(g),n=H(t.pathname,w);t.origin===e.origin&&null!=n?g=n+t.search+t.hash:C=!0}catch(xy){b(!1,'<Link to="'.concat(g,'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.'))}let k=function(e){let{relative:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(ce(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:i}=t.useContext(re),{hash:r,pathname:a,search:o}=ge(e,{relative:n}),l=a;return"/"!==s&&(l="/"===a?s:Y([s,a])),i.createHref({pathname:l,search:o,hash:r})}(g,{relative:l}),[A,E,T]=function(e,n){let s=t.useContext(nt),[i,r]=t.useState(!1),[a,o]=t.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:h,onMouseLeave:u,onTouchStart:d}=n,f=t.useRef(null);t.useEffect(()=>{if("render"===e&&o(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{o(e.isIntersecting)})},{threshold:.5});return f.current&&e.observe(f.current),()=>{e.disconnect()}}},[e]),t.useEffect(()=>{if(i){let e=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(e)}}},[i]);let p=()=>{r(!0)},g=()=>{r(!1),o(!1)};return s?"intent"!==e?[a,f,{}]:[a,f,{onFocus:it(l,p),onBlur:it(c,g),onMouseEnter:it(h,p),onMouseLeave:it(u,g),onTouchStart:it(d,p)}]:[!1,f,{}]}(o,x),M=function(e){let{target:n,replace:s,state:i,preventScrollReset:r,relative:a,viewTransition:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=fe(),c=he(),h=ge(e,{relative:a});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==s?s:S(c)===S(h);l(e,{replace:n,state:i,preventScrollReset:r,relative:a,viewTransition:o})}},[c,l,h,s,i,n,e,r,a,o])}(g,{replace:u,state:d,target:p,preventScrollReset:m,relative:l,viewTransition:v});let j=t.createElement("a",c(c(c({},x),T),{},{href:s||k,onClick:C||h?r:function(e){r&&r(e),e.defaultPrevented||M(e)},ref:ut(n,E),target:p,"data-discover":_||"render"!==a?void 0:"true"}));return A&&!_?t.createElement(t.Fragment,null,j,t.createElement(at,{page:k})):j});gt.displayName="Link";var mt=t.forwardRef(function(e,n){let{"aria-current":s="page",caseSensitive:r=!1,className:a="",end:o=!1,style:l,to:h,viewTransition:u,children:d}=e,f=i(e,p),g=ge(h,{relative:f.relative}),m=he(),v=t.useContext(te),{navigator:b,basename:x}=t.useContext(re),w=null!=v&&function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.useContext(ne);y(null!=s,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=bt("useViewTransitionState"),r=ge(e,{relative:n.relative});if(!s.isTransitioning)return!1;let a=H(s.currentLocation.pathname,i)||s.currentLocation.pathname,o=H(s.nextLocation.pathname,i)||s.nextLocation.pathname;return null!=z(r.pathname,o)||null!=z(r.pathname,a)}(g)&&!0===u,S=b.encodeLocation?b.encodeLocation(g).pathname:g.pathname,_=m.pathname,C=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;r||(_=_.toLowerCase(),C=C?C.toLowerCase():null,S=S.toLowerCase()),C&&x&&(C=H(C,x)||C);const k="/"!==S&&S.endsWith("/")?S.length-1:S.length;let A,E=_===S||!o&&_.startsWith(S)&&"/"===_.charAt(k),T=null!=C&&(C===S||!o&&C.startsWith(S)&&"/"===C.charAt(S.length)),M={isActive:E,isPending:T,isTransitioning:w},j=E?s:void 0;A="function"===typeof a?a(M):[a,E?"active":null,T?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let P="function"===typeof l?l(M):l;return t.createElement(gt,c(c({},f),{},{"aria-current":j,className:A,ref:n,style:P,to:h,viewTransition:u}),"function"===typeof d?d(M):d)});mt.displayName="NavLink";var vt=t.forwardRef((e,n)=>{let{discover:s="render",fetcherKey:r,navigate:a,reloadDocument:o,replace:l,state:h,method:u=Ne,action:d,onSubmit:f,relative:p,preventScrollReset:m,viewTransition:v}=e,b=i(e,g),x=St(),w=function(e){let{relative:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:s}=t.useContext(re),i=t.useContext(oe);y(i,"useFormAction must be used inside a RouteContext");let[r]=i.matches.slice(-1),a=c({},ge(e||".",{relative:n})),o=he();if(null==e){a.search=o.search;let e=new URLSearchParams(a.search),t=e.getAll("index"),n=t.some(e=>""===e);if(n){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let n=e.toString();a.search=n?"?".concat(n):""}}e&&"."!==e||!r.route.index||(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index");"/"!==s&&(a.pathname="/"===a.pathname?s:Y([s,a.pathname]));return S(a)}(d,{relative:p}),_="get"===u.toLowerCase()?"get":"post",C="string"===typeof d&&pt.test(d);return t.createElement("form",c(c({ref:n,method:_,action:w,onSubmit:o?f:e=>{if(f&&f(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,n=(null===t||void 0===t?void 0:t.getAttribute("formmethod"))||u;x(t||e.currentTarget,{fetcherKey:r,method:n,navigate:a,replace:l,state:h,relative:p,preventScrollReset:m,viewTransition:v})}},b),{},{"data-discover":C||"render"!==s?void 0:"true"}))});function yt(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function bt(e){let n=t.useContext(ee);return y(n,yt(e)),n}vt.displayName="Form";var xt=0,wt=()=>"__".concat(String(++xt),"__");function St(){let{router:e}=bt("useSubmit"),{basename:n}=t.useContext(re),s=ke("useRouteId");return t.useCallback(async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:r,method:a,encType:o,formData:l,body:c}=We(t,n);if(!1===i.navigate){let t=i.fetcherKey||wt();await e.fetch(t,s,i.action||r,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||a,formEncType:i.encType||o,flushSync:i.flushSync})}else await e.navigate(i.action||r,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||a,formEncType:i.encType||o,replace:i.replace,state:i.state,fromRouteId:s,flushSync:i.flushSync,viewTransition:i.viewTransition})},[e,n,s])}var _t=n(579);const Ct=()=>(0,_t.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,_t.jsx)("path",{d:"M4 6H20M4 12H20M4 18H20",stroke:"#333",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),kt=e=>{let{onToggleSidebar:t,isMobile:n}=e;const s=fe();return(0,_t.jsxs)("div",{className:"header",children:[n&&(0,_t.jsx)("button",{className:"hamburger-button",onClick:t,children:(0,_t.jsx)(Ct,{})}),(0,_t.jsx)("h1",{className:"header-name",children:"Mona AboElazm"}),(0,_t.jsx)("button",{className:"logout-button",onClick:()=>{localStorage.removeItem("token"),sessionStorage.removeItem("token"),s("/login")},children:"Logout"})]})},At=e=>{let{SidebarComponent:n,children:s}=e;const[i,r]=(0,t.useState)(!1),[a,o]=(0,t.useState)(window.innerWidth<768),l=()=>{a&&r(!i)};return(0,t.useEffect)(()=>{const e=()=>{const e=window.innerWidth<768;o(e),e||r(!1)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,_t.jsxs)("div",{className:"layout-wrapper",children:[" ",(0,_t.jsx)(kt,{onToggleSidebar:l,isMobile:a})," ",(0,_t.jsxs)("div",{className:"app",children:[" ",(0,_t.jsx)(n,{isOpen:i,onNavLinkClick:()=>{a&&i&&r(!1)},isMobile:a}),a&&i&&(0,_t.jsx)("div",{className:"overlay",onClick:l}),(0,_t.jsxs)("main",{className:"main-content",children:[" ",s]})]})]})},Et="https://backend-edu-site-5cnm.vercel.app",Tt=()=>(0,_t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,_t.jsx)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),(0,_t.jsx)("polyline",{points:"22 4 12 14.01 9 11.01"})]}),Mt=()=>(0,_t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,_t.jsx)("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),(0,_t.jsx)("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),jt=()=>(0,_t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,_t.jsx)("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),(0,_t.jsx)("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),(0,_t.jsx)("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),Pt=()=>{const e=fe(),[n,s]=(0,t.useState)({name:"",email:"",phone:"",grade:"",message:""}),[i,r]=(0,t.useState)({message:"",type:""}),a=e=>{const{name:t,value:n}=e.target;s(e=>c(c({},e),{},{[t]:n}))};return(0,_t.jsxs)("div",{className:"welcome-page",children:[(0,_t.jsx)("header",{className:"welcome-header",children:(0,_t.jsx)("div",{className:"container",children:(0,_t.jsxs)("nav",{className:"welcome-nav",children:[(0,_t.jsx)("div",{className:"nav-brand",children:"Mona AboElazm"}),(0,_t.jsxs)("div",{className:"nav-links",children:[(0,_t.jsx)("button",{onClick:()=>{const t=localStorage.getItem("token")||sessionStorage.getItem("token");e(t?"/redirecting":"/login")},className:"nav-button login",children:"Login"}),(0,_t.jsx)(gt,{to:"/signup",className:"nav-button signup",children:"Sign Up"})]})]})})}),(0,_t.jsxs)("main",{children:[(0,_t.jsx)("section",{className:"hero-section",children:(0,_t.jsxs)("div",{className:"container",children:[(0,_t.jsx)("h1",{className:"hero-title",children:"Unlock Your Full Potential in Mathematics"}),(0,_t.jsx)("p",{className:"hero-subtitle",children:"Personalized resources and dedicated support for students in grades 9-12."}),(0,_t.jsx)("a",{href:"#contact",className:"hero-button",children:"Get Started"})]})}),(0,_t.jsx)("section",{id:"about",className:"welcome-section",children:(0,_t.jsxs)("div",{className:"container about-container",children:[(0,_t.jsx)("div",{className:"about-image"}),(0,_t.jsxs)("div",{className:"about-text",children:[(0,_t.jsx)("h2",{className:"section-title",children:"About the Teacher"}),(0,_t.jsx)("p",{children:"[Placeholder] With a passion for mathematics and years of teaching experience, Mona AboElazm is dedicated to helping students not just learn, but excel. Believing in a personalized approach, the focus is on building a strong conceptual foundation and fostering confidence in every student."})]})]})}),(0,_t.jsx)("section",{id:"features",className:"welcome-section features-section",children:(0,_t.jsxs)("div",{className:"container",children:[(0,_t.jsx)("h2",{className:"section-title text-center",children:"What We Offer"}),(0,_t.jsxs)("div",{className:"features-grid",children:[(0,_t.jsxs)("div",{className:"feature-card",children:[(0,_t.jsx)("div",{className:"feature-icon",children:(0,_t.jsx)(Mt,{})}),(0,_t.jsx)("h3",{children:"Comprehensive Materials"}),(0,_t.jsx)("p",{children:"Access a rich library of curated notes, practice problems, and session materials, all in one place."})]}),(0,_t.jsxs)("div",{className:"feature-card",children:[(0,_t.jsx)("div",{className:"feature-icon",children:(0,_t.jsx)(Tt,{})}),(0,_t.jsx)("h3",{children:"Personalized Feedback"}),(0,_t.jsx)("p",{children:"Receive detailed, one-on-one feedback on assignments and exams to pinpoint areas for improvement."})]}),(0,_t.jsxs)("div",{className:"feature-card",children:[(0,_t.jsx)("div",{className:"feature-icon",children:(0,_t.jsx)(jt,{})}),(0,_t.jsx)("h3",{children:"Tracked Progress"}),(0,_t.jsx)("p",{children:"Monitor your performance and growth over time with a clear view of your scores and submissions."})]})]})]})}),(0,_t.jsx)("section",{id:"contact",className:"welcome-section contact-section",children:(0,_t.jsxs)("div",{className:"container",children:[(0,_t.jsx)("h2",{className:"section-title text-center",children:"Send Your Feedback"}),(0,_t.jsx)("p",{className:"section-subtitle",children:"Have a question or a suggestion? I'd love to hear from you."}),(0,_t.jsxs)("form",{className:"feedback-form",onSubmit:async e=>{e.preventDefault(),r({message:"Sending...",type:"loading"});try{if(!(await fetch("".concat(Et,"/feedback/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Something went wrong. Please try again.");r({message:"Thank you for your feedback!",type:"success"}),s({name:"",email:"",phone:"",grade:"",message:""})}catch(t){r({message:t.message,type:"error"})}},children:[(0,_t.jsxs)("div",{className:"form-grid",children:[(0,_t.jsx)("input",{type:"text",name:"name",placeholder:"Your Name",value:n.name,onChange:a,required:!0}),(0,_t.jsx)("input",{type:"email",name:"email",placeholder:"Your Email",value:n.email,onChange:a,required:!0}),(0,_t.jsx)("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:n.phone,onChange:a}),(0,_t.jsxs)("select",{name:"grade",value:n.grade,onChange:a,required:!0,children:[(0,_t.jsx)("option",{value:"",children:"Select Grade Level"}),(0,_t.jsx)("option",{value:"9",children:"Grade 9"}),(0,_t.jsx)("option",{value:"10",children:"Grade 10"}),(0,_t.jsx)("option",{value:"11",children:"Grade 11"}),(0,_t.jsx)("option",{value:"12",children:"Grade 12"})]})]}),(0,_t.jsx)("textarea",{name:"message",placeholder:"Your Message",value:n.message,onChange:a,required:!0}),(0,_t.jsx)("button",{type:"submit",className:"submit-button",children:"Send Message"}),i.message&&(0,_t.jsx)("p",{className:"submit-message ".concat(i.type),children:i.message})]})]})})]}),(0,_t.jsx)("footer",{className:"welcome-footer",children:(0,_t.jsx)("p",{children:"\xa9 2025 Mona AboElazm. All Rights Reserved."})})]})};const Ot=n.p+"static/media/exams.36f59b78fb11a79fc30e3e80247279d0.svg";const Dt=n.p+"static/media/assignment.b22e777e1b3d978faa73fd563c5cee62.svg";const Nt=n.p+"static/media/materials.026eb556e178f44026648518f62bdafe.svg";const Lt=n.p+"static/media/groups.d605d8a43f60476f91617b970206952f.svg";const Rt=n.p+"static/media/session.dd6535fb6ce40079a53ce6dcc78e3bac.svg",Ft=e=>{let{isOpen:t,onNavLinkClick:n,isMobile:s}=e;const i="sidebar ".concat(s?t?"open":"closed":"desktop-visible");return(0,_t.jsxs)("div",{className:i,children:[" ",(0,_t.jsx)("div",{className:"menu",children:"Menu"}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)("div",{children:[(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/dashboard/sessions",onClick:n,children:[(0,_t.jsx)("img",{src:Rt,alt:"Sessions"})," Sessions"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/dashboard/exams",onClick:n,children:[(0,_t.jsx)("img",{src:Ot,alt:"Exams"})," Exams"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/dashboard/assignments",onClick:n,children:[(0,_t.jsx)("img",{src:Dt,alt:"Assignments"})," Assignments"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/dashboard/materials",onClick:n,children:[(0,_t.jsx)("img",{src:Nt,alt:"Materials"})," Materials"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/dashboard/groups",onClick:n,children:[(0,_t.jsx)("img",{src:Lt,alt:"Groups"})," Groups"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{})]})]})};n.p;const It=n.p+"static/media/profile.ad8d1a0632ad482edcb916941eaa4474.svg",zt=e=>{let{isOpen:t,onNavLinkClick:n,isMobile:s}=e;const i="sidebar student-sidebar ".concat(s?t?"open":"closed":"desktop-visible");return(0,_t.jsxs)("div",{className:i,children:[(0,_t.jsx)("div",{className:"menu",children:"Student Menu"}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)("div",{children:[(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/student/sessions",onClick:n,children:[(0,_t.jsx)("img",{src:Nt,alt:"Sessions"})," Sessions"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/student/assignments",onClick:n,children:[(0,_t.jsx)("img",{src:Dt,alt:"Assignments"})," Assignments"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/student/exams",onClick:n,children:[(0,_t.jsx)("img",{src:Ot,alt:"Exams"})," Exams"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/student/materials",onClick:n,children:[(0,_t.jsx)("img",{src:Rt,alt:"Materials"})," Materials"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{}),(0,_t.jsxs)(mt,{className:e=>{let{isActive:t}=e;return t?"active-link":"li"},to:"/student/profile",onClick:n,children:[(0,_t.jsx)("img",{src:It,alt:"Profile"})," Profile"]}),(0,_t.jsx)("br",{}),(0,_t.jsx)("br",{})]})]})};var Wt=n(963),Bt=n.n(Wt);const Ht=e=>{if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return"";const n=6e4*t.getTimezoneOffset();return new Date(t.getTime()-n).toISOString().slice(0,16)},Ut=()=>{const e=fe(),[n,s]=(0,t.useState)(""),[i,r]=(0,t.useState)([]),[a,o]=(0,t.useState)([]),[l,h]=(0,t.useState)([]),[u,d]=(0,t.useState)(""),[f,p]=(0,t.useState)(!1),[g,m]=(0,t.useState)(!1),[v,y]=(0,t.useState)(null),[b,x]=(0,t.useState)(""),[w,S]=(0,t.useState)(null),[_,C]=(0,t.useState)({name:"",file:null,startDate:"",endDate:""}),[k,A]=(0,t.useState)(!1),[E,T]=(0,t.useState)(null),[M,j]=(0,t.useState)({name:"",file:null,startDate:"",endDate:"",allowSubmissionsAfterDueDate:!1}),P=[12,11,10,9],O=e=>{const t=e.target.value;s(t),r([]),t?(async e=>{p(!0),y(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/group/grades?grade=").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Groups fetched successfully"===s.Message?(o(s.groups),s.groups.length>0&&d(s.groups[0].gradeid)):y("Failed to fetch groups")}catch(t){y("Error loading groups")}finally{p(!1)}})(t):o([])},D=async e=>{S(e),m(!0),y(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/exams?groupId=").concat(e),{method:"GET",headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Exams fetched successfully"===s.message?h(s.data||[]):(y("Failed to fetch exams"),h([]))}catch(t){console.error("Error fetching exams:",t),y("Error loading exams"),h([])}finally{m(!1)}},N=t=>{w?e("/dashboard/exams/grade/".concat(n,"/group/").concat(w,"/exam/").concat(t._id)):y("No group selected")},L=()=>A(!1),R=e=>new Date(e).toLocaleString();return(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsxs)("div",{className:"exams-page",children:[(0,_t.jsxs)("div",{className:"exams-left",children:[(0,_t.jsx)("h2",{children:"Select Grade"}),(0,_t.jsx)("div",{className:"grades-list",children:P.map(e=>(0,_t.jsx)("div",{className:"grade-card ".concat(n===e?"selected":""),onClick:()=>O({target:{value:e}}),children:(0,_t.jsxs)("h3",{children:["Grade ",e]})},e))}),n&&(0,_t.jsxs)("div",{className:"groups-section",children:[(0,_t.jsxs)("h3",{children:["Groups in Grade ",n]}),f?(0,_t.jsx)("div",{className:"loading",children:"Loading groups..."}):v?(0,_t.jsx)("div",{className:"error",children:v}):(0,_t.jsx)("div",{className:"groups-list",children:a.map(e=>(0,_t.jsx)("div",{className:"group-item ".concat(w===e._id?"selected":""),onClick:()=>D(e._id),children:e.groupname},e._id))})]}),l.length>0||g?(0,_t.jsxs)("div",{className:"exams-section",children:[(0,_t.jsx)("h3",{children:"Exams"}),g?(0,_t.jsx)("div",{className:"loading",children:"Loading exams..."}):(0,_t.jsx)("ul",{className:"exams-list",children:l.map(e=>(0,_t.jsxs)("li",{className:"exam-card",onClick:()=>N(e),style:{position:"relative"},children:[(0,_t.jsx)("button",{className:"delete-btn delete-btn-corner",style:{position:"absolute",bottom:10,right:10,zIndex:2},onClick:async t=>{if(t.stopPropagation(),window.confirm("Are you sure you want to delete this exam?"))try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/exams/delete"),{method:"DELETE",headers:{Authorization:"MonaEdu ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({examId:e._id})}),s=await n.json();window.alert(s.message||"Exam deleted."),w&&D(w)}catch(n){window.alert("Failed to delete exam.")}},children:"Delete"}),(0,_t.jsx)("button",{className:"view-btn",style:{position:"absolute",bottom:10,right:90,zIndex:2},onClick:t=>{t.stopPropagation(),e.path?window.open(e.path,"_blank"):window.alert("No file available for this exam.")},children:"View"}),(0,_t.jsx)("button",{className:"edit-btn",style:{position:"absolute",bottom:10,right:158,zIndex:2},onClick:t=>{t.stopPropagation(),(e=>{T(e),j({name:e.Name,startDate:Ht(e.startdate),endDate:Ht(e.enddate),allowSubmissionsAfterDueDate:e.allowSubmissionsAfterDueDate,file:null}),console.log({name:e.Name,startDate:Ht(e.startdate),endDate:Ht(e.enddate),allowSubmissionsAfterDueDate:e.allowSubmissionsAfterDueDate,file:null}),A(!0)})(e)},children:"Edit"}),(0,_t.jsxs)("div",{className:"exam-info",onClick:()=>N(e),children:[(0,_t.jsx)("span",{className:"exam-name",children:e.Name}),(0,_t.jsxs)("span",{className:"exam-dates",children:["Start: ",R(e.startdate)," ",(0,_t.jsx)("br",{}),"End: ",R(e.enddate)]})]})]},e._id))})]}):null]}),(0,_t.jsxs)("div",{className:"exams-right",children:[(0,_t.jsx)("h2",{children:"Upload new Exam"}),(0,_t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),n&&0!==i.length){x("Uploading exam..."),y(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=new FormData;t.append("Name",_.name),t.append("file",_.file),t.append("startdate",_.startDate),t.append("enddate",_.endDate),i.forEach(e=>t.append("groupIds",e)),t.append("gradeId",u),t.append("allowSubmissionsAfterDueDate",!1);const n=await fetch("".concat(Et,"/exams/create"),{method:"POST",headers:{Authorization:"MonaEdu ".concat(e)},body:t}),s=await n.json();if(!n.ok)throw new Error(s.message||"Failed to upload exam");if("Exam created successfully"!==s.message||!s.exam)throw new Error("Unexpected response format from server");x('Exam "'.concat(s.exam.Name,'" created successfully')),C({name:"",file:null,startDate:"",endDate:""}),r([]),document.getElementById("exam-file-input").value=null,w&&D(w)}catch(t){y(t.message||"Error uploading exam. Please try again."),x("")}}else y("Please select both grade and at least one group")},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Grade:"}),(0,_t.jsxs)("select",{value:n,onChange:O,required:!0,children:[(0,_t.jsx)("option",{value:"",children:"Select Grade"}),P.map(e=>(0,_t.jsxs)("option",{value:e,children:["Grade ",e]},e))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Groups:"}),(0,_t.jsxs)("div",{className:"groups-list checkbox-style",children:[(0,_t.jsx)("div",{className:"select-all group-checkbox-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",onChange:e=>r(e.target.checked?a.map(e=>e._id):[]),checked:i.length===a.length&&a.length>0})," Select All Groups"]})}),a.map(e=>(0,_t.jsx)("div",{className:"group-checkbox-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",checked:i.includes(e._id),onChange:()=>r(t=>t.includes(e._id)?t.filter(t=>t!==e._id):[...t,e._id])}),e.groupname]})},e._id))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Exam Name:"}),(0,_t.jsx)("input",{type:"text",value:_.name,onChange:e=>C(c(c({},_),{},{name:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Exam File:"}),(0,_t.jsx)("input",{type:"file",id:"exam-file-input",accept:".pdf",onChange:e=>C(c(c({},_),{},{file:e.target.files[0]})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Start Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:_.startDate,onChange:e=>C(c(c({},_),{},{startDate:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"End Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:_.endDate,onChange:e=>C(c(c({},_),{},{endDate:e.target.value})),required:!0})]}),v&&(0,_t.jsx)("div",{className:"error-message",children:v}),b&&(0,_t.jsx)("div",{className:"submit-status",children:b}),(0,_t.jsx)("button",{type:"submit",disabled:b.includes("..."),children:"Submit"})]})]})]}),(0,_t.jsxs)(Bt(),{isOpen:k,onRequestClose:L,contentLabel:"Edit Exam",className:"form-modal",overlayClassName:"form-modal-overlay",children:[(0,_t.jsx)("h2",{children:"Edit Exam"}),(0,_t.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),x("Updating exam..."),y(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=new FormData;t.append("examId",E._id),t.append("Name",M.name),t.append("startdate",M.startDate),t.append("enddate",M.endDate),t.append("allowSubmissionsAfterDueDate",M.allowSubmissionsAfterDueDate),i.forEach(e=>t.append("groupIds",e)),M.file&&t.append("file",M.file);const n=await fetch("".concat(Et,"/exams/edit"),{method:"PUT",headers:{Authorization:"MonaEdu ".concat(e)},body:t}),s=await n.json();if(console.log(s),!n.ok)throw new Error(s.message||"Failed to update exam");x("Exam updated successfully!"),w&&D(w),setTimeout(L,1500)}catch(t){y(t.message||"Error updating exam."),x("")}},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Exam Name:"}),(0,_t.jsx)("input",{type:"text",value:M.name,onChange:e=>j(c(c({},M),{},{name:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Exam File (Leave blank to keep existing):"}),(0,_t.jsx)("input",{type:"file",onChange:e=>j(c(c({},M),{},{file:e.target.files[0]}))})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Start Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:M.startDate,onChange:e=>j(c(c({},M),{},{startDate:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"End Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:M.endDate,onChange:e=>j(c(c({},M),{},{endDate:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group checkbox-group",children:[(0,_t.jsx)("input",{type:"checkbox",id:"allowLateSubmissionsExam",checked:M.allowSubmissionsAfterDueDate,onChange:e=>j(c(c({},M),{},{allowSubmissionsAfterDueDate:e.target.checked}))}),(0,_t.jsx)("label",{htmlFor:"allowLateSubmissionsExam",children:"Allow submissions after due date"})]}),v&&(0,_t.jsx)("div",{className:"error-message",children:v}),b&&(0,_t.jsx)("div",{className:"submit-status",children:b}),(0,_t.jsxs)("div",{className:"form-actions",children:[(0,_t.jsx)("button",{type:"button",className:"cancel-btn",onClick:L,children:"Cancel"}),(0,_t.jsx)("button",{type:"submit",disabled:b.includes("..."),children:"Save Changes"})]})]})]})]})},Vt=e=>{if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return"";const n=6e4*t.getTimezoneOffset();return new Date(t.getTime()-n).toISOString().slice(0,16)},Gt=()=>{const e=fe(),[n,s]=(0,t.useState)(""),[i,r]=(0,t.useState)([]),[a,o]=(0,t.useState)([]),[l,h]=(0,t.useState)([]),[u,d]=(0,t.useState)(""),[f,p]=(0,t.useState)(!1),[g,m]=(0,t.useState)(!1),[v,y]=(0,t.useState)(null),[b,x]=(0,t.useState)(""),[w,S]=(0,t.useState)(null),[_,C]=(0,t.useState)({name:"",file:null,startDate:"",endDate:""}),[k,A]=(0,t.useState)(!1),[E,T]=(0,t.useState)(null),[M,j]=(0,t.useState)({name:"",file:null,startDate:"",endDate:"",allowSubmissionsAfterDueDate:!1}),P=[12,11,10,9],O=e=>{const t=e.target.value;s(t),r([]),t?(async e=>{p(!0),y(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/group/grades?grade=").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Groups fetched successfully"===s.Message?(o(s.groups),s.groups.length>0&&d(s.groups[0].gradeid)):y("Failed to fetch groups")}catch(t){y("Error loading groups")}finally{p(!1)}})(t):o([])},D=async e=>{S(e),m(!0),y(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/assignments/group/all?groupId=").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Assignments fetched successfully"===s.message?h(s.data||[]):h([])}catch(t){y("Error loading assignments")}finally{m(!1)}},N=()=>A(!1),L=e=>new Date(e).toLocaleString();return(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsxs)("div",{className:"assignments-page",children:[(0,_t.jsxs)("div",{className:"assignments-left",children:[(0,_t.jsx)("h2",{children:"Select Grade"}),(0,_t.jsx)("div",{className:"grades-list",children:P.map(e=>(0,_t.jsx)("div",{className:"grade-card ".concat(n===String(e)?"selected":""),onClick:()=>O({target:{value:e}}),children:(0,_t.jsxs)("h3",{children:["Grade ",e]})},e))}),n&&(0,_t.jsxs)("div",{className:"groups-section",children:[(0,_t.jsxs)("h3",{children:["Groups in Grade ",n]}),f?(0,_t.jsx)("div",{className:"loading",children:"Loading..."}):(0,_t.jsx)("div",{className:"groups-list",children:a.map(e=>(0,_t.jsx)("div",{className:"group-item ".concat(w===e._id?"selected":""),onClick:()=>D(e._id),children:e.groupname},e._id))})]}),w&&(0,_t.jsxs)("div",{className:"assignments-section",children:[(0,_t.jsx)("h3",{children:"Assignments"}),g?(0,_t.jsx)("div",{className:"loading",children:"Loading..."}):(0,_t.jsx)("ul",{className:"assignments-list",children:l.length>0?l.map(t=>(0,_t.jsxs)("li",{className:"assignment-card",children:[(0,_t.jsxs)("div",{className:"assignment-info",onClick:()=>(t=>{w&&e("/dashboard/assignments/grade/".concat(n,"/group/").concat(w,"/assignment/").concat(t._id))})(t),children:[(0,_t.jsx)("span",{className:"assignment-name",children:t.name}),(0,_t.jsxs)("span",{className:"assignment-dates",children:["Start: ",L(t.startDate),(0,_t.jsx)("br",{}),"End: ",L(t.endDate)]})]}),(0,_t.jsxs)("div",{className:"assignment-actions",children:[(0,_t.jsx)("button",{className:"view-btn",onClick:e=>{e.stopPropagation(),t.path?window.open(t.path,"_blank"):window.alert("No file available for this assignment.")},children:"View"}),(0,_t.jsx)("button",{className:"edit-btn",onClick:e=>{e.stopPropagation(),(e=>{T(e),j({name:e.name,startDate:Vt(e.startDate),endDate:Vt(e.endDate),allowSubmissionsAfterDueDate:e.allowSubmissionsAfterDueDate||!1,file:null}),A(!0)})(t)},children:"Edit"}),(0,_t.jsx)("button",{className:"delete-btn",onClick:e=>{e.stopPropagation(),window.confirm("Are you sure you want to delete this assignment?")&&(async e=>{try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/assignments/delete"),{method:"DELETE",headers:{Authorization:"MonaEdu ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({assignmentId:e})}),s=await n.json();if(!n.ok)throw new Error(s.message||"Failed to delete assignment");alert("Assignment deleted successfully!"),w&&D(w)}catch(t){alert(t.message||"An error occurred while deleting.")}})(t._id)},children:"Delete"})]})]},t._id)):(0,_t.jsx)("p",{children:"No assignments found for this group."})})]})]}),(0,_t.jsxs)("div",{className:"assignments-right",children:[(0,_t.jsx)("h2",{children:"Upload new Assignment"}),(0,_t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),n&&0!==i.length){x("Uploading assignment..."),y(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=new FormData;t.append("name",_.name),t.append("file",_.file),t.append("startDate",_.startDate),t.append("endDate",_.endDate),i.forEach(e=>t.append("groupIds",e)),t.append("gradeId",u);const n=await fetch("".concat(Et,"/assignments/create"),{method:"POST",headers:{Authorization:"MonaEdu ".concat(e)},body:t}),s=await n.json();if(!n.ok)throw new Error(s.message||"Failed to upload assignment");if("Assignment created successfully"!==s.message)throw new Error("Unexpected response format");x('Assignment "'.concat(s.assignment.name,'" created successfully')),C({name:"",file:null,startDate:"",endDate:""}),r([]),document.getElementById("assignment-file-input").value=null,w&&D(w)}catch(t){y(t.message||"Error uploading assignment."),x("")}}else y("Please select both grade and at least one group")},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Grade:"}),(0,_t.jsxs)("select",{value:n,onChange:O,required:!0,children:[(0,_t.jsx)("option",{value:"",children:"Select Grade"}),P.map(e=>(0,_t.jsxs)("option",{value:e,children:["Grade ",e]},e))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Groups:"}),(0,_t.jsxs)("div",{className:"groups-list checkbox-style",children:[(0,_t.jsx)("div",{className:"select-all-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",checked:i.length===a.length&&a.length>0,onChange:()=>r(i.length===a.length?[]:a.map(e=>e._id))})," Select All Groups"]})}),a.map(e=>(0,_t.jsx)("div",{className:"group-checkbox-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",checked:i.includes(e._id),onChange:()=>r(t=>t.includes(e._id)?t.filter(t=>t!==e._id):[...t,e._id])}),e.groupname]})},e._id))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Assignment Name:"}),(0,_t.jsx)("input",{type:"text",value:_.name,onChange:e=>C(c(c({},_),{},{name:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Assignment File:"}),(0,_t.jsx)("input",{type:"file",id:"assignment-file-input",accept:".pdf",onChange:e=>C(c(c({},_),{},{file:e.target.files[0]})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Start Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:_.startDate,onChange:e=>C(c(c({},_),{},{startDate:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"End Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:_.endDate,onChange:e=>C(c(c({},_),{},{endDate:e.target.value})),required:!0})]}),v&&(0,_t.jsx)("div",{className:"error-message",children:v}),b&&(0,_t.jsx)("div",{className:"submit-status",children:b}),(0,_t.jsx)("button",{type:"submit",disabled:b.includes("..."),children:"Submit"})]})]})]}),(0,_t.jsxs)(Bt(),{isOpen:k,onRequestClose:N,contentLabel:"Edit Assignment",className:"form-modal",overlayClassName:"form-modal-overlay",children:[(0,_t.jsx)("h2",{children:"Edit Assignment"}),(0,_t.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),x("Updating assignment..."),y(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=new FormData;t.append("assignmentId",E._id),t.append("name",M.name),t.append("startDate",M.startDate),t.append("endDate",M.endDate),t.append("allowSubmissionsAfterDueDate",M.allowSubmissionsAfterDueDate),M.file&&t.append("file",M.file);const n=await fetch("".concat(Et,"/assignments/edit"),{method:"PUT",headers:{Authorization:"MonaEdu ".concat(e)},body:t}),s=await n.json();if(!n.ok)throw new Error(s.message||"Failed to update assignment");x("Assignment updated successfully!"),w&&D(w),setTimeout(N,1500)}catch(t){y(t.message||"Error updating assignment."),x("")}},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Assignment Name:"}),(0,_t.jsx)("input",{type:"text",value:M.name,onChange:e=>j(c(c({},M),{},{name:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Assignment File (Leave blank to keep existing):"}),(0,_t.jsx)("input",{type:"file",onChange:e=>j(c(c({},M),{},{file:e.target.files[0]}))})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Start Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:M.startDate,onChange:e=>j(c(c({},M),{},{startDate:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"End Date:"}),(0,_t.jsx)("input",{type:"datetime-local",value:M.endDate,onChange:e=>j(c(c({},M),{},{endDate:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group checkbox-group",children:[(0,_t.jsx)("input",{type:"checkbox",id:"allowLateSubmissions",checked:M.allowSubmissionsAfterDueDate,onChange:e=>j(c(c({},M),{},{allowSubmissionsAfterDueDate:e.target.checked}))}),(0,_t.jsx)("label",{htmlFor:"allowLateSubmissions",children:"Allow submissions after due date"})]}),v&&(0,_t.jsx)("div",{className:"error-message",children:v}),b&&(0,_t.jsx)("div",{className:"submit-status",children:b}),(0,_t.jsxs)("div",{className:"form-actions",children:[(0,_t.jsx)("button",{type:"button",className:"cancel-btn",onClick:N,children:"Cancel"}),(0,_t.jsx)("button",{type:"submit",disabled:b.includes("..."),children:"Save Changes"})]})]})]})]})};function Xt(e,t,n){t||(t=[]);var s=t.length++;return Object.defineProperty({},"_",{set:function(i){t[s]=i,e.apply(n,t)}})}function Yt(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function qt(e,t){Yt(e,t),t.add(e)}function Kt(e,t,n){Yt(e,t),t.set(e,n)}function Qt(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function $t(e,t,n){return n(Qt(e,t))}function Jt(e,t){return e.get(Qt(e,t))}function Zt(e,t,n){return e.set(Qt(e,t),n),n}var en,tn,nn,sn,rn,an,on,ln,cn,hn,un,dn,fn={d:(e,t)=>{for(var n in t)fn.o(t,n)&&!fn.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},pn=globalThis.pdfjsLib={};fn.d(pn,{AbortException:()=>As,AnnotationEditorLayer:()=>Vm,AnnotationEditorParamsType:()=>Mn,AnnotationEditorType:()=>Tn,AnnotationEditorUIManager:()=>Ur,AnnotationLayer:()=>Jd,AnnotationMode:()=>En,ColorPicker:()=>Mp,DOMSVGFactory:()=>_u,DrawLayer:()=>nv,FeatureTest:()=>js,GlobalWorkerOptions:()=>Fl,ImageKind:()=>Fn,InvalidPDFException:()=>Ss,MissingPDFException:()=>_s,OPS:()=>ls,OutputScale:()=>pi,PDFDataRangeTransport:()=>Lh,PDFDateString:()=>oi,PDFWorker:()=>Yh,PasswordResponses:()=>cs,PermissionFlag:()=>jn,PixelsPerInch:()=>Ks,RenderingCancelledException:()=>Js,TextLayer:()=>dh,UnexpectedResponseException:()=>Cs,Util:()=>Os,VerbosityLevel:()=>os,XfaLayer:()=>Cu,build:()=>yu,createValidAbsoluteUrl:()=>vs,fetchData:()=>Qs,getDocument:()=>Ph,getFilenameFromUrl:()=>ti,getPdfFilenameFromUrl:()=>ni,getXfaPageViewport:()=>ci,isDataScheme:()=>Zs,isPdfFile:()=>ei,noContextMenu:()=>ri,normalizeUnicode:()=>Fs,setLayerDimensions:()=>fi,shadow:()=>ys,version:()=>vu});const gn="object"===typeof process&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),mn=[1,0,0,1,0,0],vn=[.001,0,0,.001,0,0],yn=1.35,bn=1,xn=2,wn=4,Sn=16,_n=32,Cn=64,kn=128,An=256,En={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Tn={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Mn={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},jn={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Pn=0,On=1,Dn=2,Nn=3,Ln=3,Rn=4,Fn={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},In=1,zn=2,Wn=3,Bn=4,Hn=5,Un=6,Vn=7,Gn=8,Xn=9,Yn=10,qn=11,Kn=12,Qn=13,$n=14,Jn=15,Zn=16,es=17,ts=20,ns=1,ss=2,is=3,rs=4,as=5,os={ERRORS:0,WARNINGS:1,INFOS:5},ls={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},cs={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let hs=os.WARNINGS;function us(e){Number.isInteger(e)&&(hs=e)}function ds(){return hs}function fs(e){hs>=os.INFOS&&console.log("Info: ".concat(e))}function ps(e){hs>=os.WARNINGS&&console.log("Warning: ".concat(e))}function gs(e){throw new Error(e)}function ms(e,t){e||gs(t)}function vs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return null;try{if(n&&"string"===typeof e){if(n.addDefaultProtocol&&e.startsWith("www.")){const t=e.match(/\./g);(null===t||void 0===t?void 0:t.length)>=2&&(e="http://".concat(e))}if(n.tryConvertEncoding)try{e=decodeURIComponent(escape(e))}catch(s){}}const i=t?new URL(e,t):new URL(e);if(function(e){switch(null===e||void 0===e?void 0:e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i))return i}catch(i){}return null}function ys(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(e,t,{value:n,enumerable:!s,configurable:!0,writable:!1}),n}const bs=function(){function e(e,t){this.message=e,this.name=t}return e.prototype=new Error,e.constructor=e,e}();class xs extends bs{constructor(e,t){super(e,"PasswordException"),this.code=t}}class ws extends bs{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Ss extends bs{constructor(e){super(e,"InvalidPDFException")}}class _s extends bs{constructor(e){super(e,"MissingPDFException")}}class Cs extends bs{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class ks extends bs{constructor(e){super(e,"FormatError")}}class As extends bs{constructor(e){super(e,"AbortException")}}function Es(e){"object"===typeof e&&void 0!==(null===e||void 0===e?void 0:e.length)||gs("Invalid argument for bytesToString");const t=e.length,n=8192;if(t<n)return String.fromCharCode.apply(null,e);const s=[];for(let i=0;i<t;i+=n){const r=Math.min(i+n,t),a=e.subarray(i,r);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function Ts(e){"string"!==typeof e&&gs("Invalid argument for stringToBytes");const t=e.length,n=new Uint8Array(t);for(let s=0;s<t;++s)n[s]=255&e.charCodeAt(s);return n}function Ms(e){const t=Object.create(null);for(const[n,s]of e)t[n]=s;return t}class js{static get isLittleEndian(){return ys(this,"isLittleEndian",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return ys(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(e){return!1}}())}static get isOffscreenCanvasSupported(){return ys(this,"isOffscreenCanvasSupported","undefined"!==typeof OffscreenCanvas)}static get platform(){var e,t;return"undefined"!==typeof navigator&&"string"===typeof(null===(e=navigator)||void 0===e?void 0:e.platform)?ys(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:"string"===typeof(null===(t=navigator)||void 0===t?void 0:t.userAgent)&&navigator.userAgent.includes("Firefox")}):ys(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return ys(this,"isCSSRoundSupported",null===(e=globalThis.CSS)||void 0===e||null===(t=e.supports)||void 0===t?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Ps=Array.from(Array(256).keys(),e=>e.toString(16).padStart(2,"0"));class Os{static makeHexColor(e,t,n){return"#".concat(Ps[e]).concat(Ps[t]).concat(Ps[n])}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n]}static getAxialAlignedBoundingBox(e,t){const n=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),i=this.applyTransform([e[0],e[3]],t),r=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],s[0],i[0],r[0]),Math.min(n[1],s[1],i[1],r[1]),Math.max(n[0],s[0],i[0],r[0]),Math.max(n[1],s[1],i[1],r[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],r=e[2]*t[1]+e[3]*t[3],a=(n+r)/2,o=Math.sqrt((n+r)**2-4*(n*r-i*s))/2,l=a+o||1,c=a-o||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>r?null:[n,i,s,r]}static bezierBoundingBox(e,t,n,s,i,r,a,o,l){return l?(l[0]=Math.min(l[0],e,a),l[1]=Math.min(l[1],t,o),l[2]=Math.max(l[2],e,a),l[3]=Math.max(l[3],t,o)):l=[Math.min(e,a),Math.min(t,o),Math.max(e,a),Math.max(t,o)],Qt(Os,this,Ns).call(this,e,n,i,a,t,s,r,o,3*(3*(n-i)-e+a),6*(e-2*n+i),3*(n-e),l),Qt(Os,this,Ns).call(this,e,n,i,a,t,s,r,o,3*(3*(s-r)-t+o),6*(t-2*s+r),3*(s-t),l),l}}function Ds(e,t,n,s,i,r,a,o,l,c){if(l<=0||l>=1)return;const h=1-l,u=l*l,d=u*l,f=h*(h*(h*e+3*l*t)+3*u*n)+d*s,p=h*(h*(h*i+3*l*r)+3*u*a)+d*o;c[0]=Math.min(c[0],f),c[1]=Math.min(c[1],p),c[2]=Math.max(c[2],f),c[3]=Math.max(c[3],p)}function Ns(e,t,n,s,i,r,a,o,l,c,h,u){if(Math.abs(l)<1e-12)return void(Math.abs(c)>=1e-12&&Qt(en,this,Ds).call(this,e,t,n,s,i,r,a,o,-h/c,u));const d=c**2-4*h*l;if(d<0)return;const f=Math.sqrt(d),p=2*l;Qt(en,this,Ds).call(this,e,t,n,s,i,r,a,o,(-c+f)/p,u),Qt(en,this,Ds).call(this,e,t,n,s,i,r,a,o,(-c-f)/p,u)}en=Os;let Ls=null,Rs=null;function Fs(e){return Ls||(Ls=/([\xA0\xB5\u037E\u0EB3\u2000-\u200A\u202F\u2126\uFB00-\uFB04\uFB06\uFB20-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBA1\uFBA4-\uFBA9\uFBAE-\uFBB1\uFBD3-\uFBDC\uFBDE-\uFBE7\uFBEA-\uFBF8\uFBFC\uFBFD\uFC00-\uFC5D\uFC64-\uFCF1\uFCF5-\uFD3D\uFD88\uFDF4\uFDFA\uFDFB\uFE71\uFE77\uFE79\uFE7B\uFE7D]+)|(\uFB05+)/g,Rs=new Map([["\ufb05","\u017ft"]])),e.replaceAll(Ls,(e,t,n)=>t?t.normalize("NFKC"):Rs.get(n))}const Is="pdfjs_internal_id_",zs=0,Ws=1,Bs=2,Hs=3,Us=4,Vs=5,Gs=6,Xs=7,Ys=8;const qs="http://www.w3.org/2000/svg";class Ks{}async function Qs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(ii(e,document.baseURI)){const n=await fetch(e);if(!n.ok)throw new Error(n.statusText);switch(t){case"arraybuffer":return n.arrayBuffer();case"blob":return n.blob();case"json":return n.json()}return n.text()}return new Promise((n,s)=>{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE)if(200!==i.status&&0!==i.status)s(new Error(i.statusText));else{switch(t){case"arraybuffer":case"blob":case"json":return void n(i.response)}n(i.responseText)}},i.send(null)})}tn=Ks,o(Ks,"CSS",96),o(Ks,"PDF",72),o(Ks,"PDF_TO_CSS_UNITS",tn.CSS/tn.PDF);class $s{constructor(e){let{viewBox:t,scale:n,rotation:s,offsetX:i=0,offsetY:r=0,dontFlip:a=!1}=e;this.viewBox=t,this.scale=n,this.rotation=s,this.offsetX=i,this.offsetY=r;const o=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let c,h,u,d,f,p,g,m;switch(s%=360,s<0&&(s+=360),s){case 180:c=-1,h=0,u=0,d=1;break;case 90:c=0,h=1,u=1,d=0;break;case 270:c=0,h=-1,u=-1,d=0;break;case 0:c=1,h=0,u=0,d=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(u=-u,d=-d),0===c?(f=Math.abs(l-t[1])*n+i,p=Math.abs(o-t[0])*n+r,g=(t[3]-t[1])*n,m=(t[2]-t[0])*n):(f=Math.abs(o-t[0])*n+i,p=Math.abs(l-t[1])*n+r,g=(t[2]-t[0])*n,m=(t[3]-t[1])*n),this.transform=[c*n,h*n,u*n,d*n,f-c*n*o-u*n*l,p-h*n*o-d*n*l],this.width=g,this.height=m}get rawDims(){const{viewBox:e}=this;return ys(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone(){let{scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new $s({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:i})}convertToViewportPoint(e,t){return Os.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=Os.applyTransform([e[0],e[1]],this.transform),n=Os.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return Os.applyInverseTransform([e,t],this.transform)}}class Js extends bs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super(e,"RenderingCancelledException"),this.extraDelay=t}}function Zs(e){const t=e.length;let n=0;for(;n<t&&""===e[n].trim();)n++;return"data:"===e.substring(n,n+5).toLowerCase()}function ei(e){return"string"===typeof e&&/\.pdf$/i.test(e)}function ti(e){return[e]=e.split(/[#?]/,1),e.substring(e.lastIndexOf("/")+1)}function ni(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!==typeof e)return t;if(Zs(e))return ps('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e);let i=n.exec(s[1])||n.exec(s[2])||n.exec(s[3]);if(i&&(i=i[0],i.includes("%")))try{i=n.exec(decodeURIComponent(i))[0]}catch(r){}return i||t}class si{constructor(){o(this,"started",Object.create(null)),o(this,"times",[])}time(e){e in this.started&&ps("Timer is already running for ".concat(e)),this.started[e]=Date.now()}timeEnd(e){e in this.started||ps("Timer has not been started for ".concat(e)),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:s,end:i}of this.times)e.push("".concat(n.padEnd(t)," ").concat(i-s,"ms\n"));return e.join("")}}function ii(e,t){try{const{protocol:n}=t?new URL(e,t):new URL(e);return"http:"===n||"https:"===n}catch(n){return!1}}function ri(e){e.preventDefault()}function ai(e){console.log("Deprecated API usage: "+e)}class oi{static toDateObject(e){if(!e||"string"!==typeof e)return null;Qt(oi,this,li)._||(li._=Qt(oi,this,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?")));const t=Qt(oi,this,li)._.exec(e);if(!t)return null;const n=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let o=parseInt(t[6],10);o=o>=0&&o<=59?o:0;const l=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,"-"===l?(r+=c,a+=h):"+"===l&&(r-=c,a-=h),new Date(Date.UTC(n,s,i,r,a,o))}}var li={_:void 0};function ci(e,t){let{scale:n=1,rotation:s=0}=t;const{width:i,height:r}=e.attributes.style,a=[0,0,parseInt(i),parseInt(r)];return new $s({viewBox:a,scale:n,rotation:s})}function hi(e){if(e.startsWith("#")){const t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map(e=>parseInt(e)):e.startsWith("rgba(")?e.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(ps('Not a valid color format: "'.concat(e,'"')),[0,0,0])}function ui(e){const{a:t,b:n,c:s,d:i,e:r,f:a}=e.getTransform();return[t,n,s,i,r,a]}function di(e){const{a:t,b:n,c:s,d:i,e:r,f:a}=e.getTransform().invertSelf();return[t,n,s,i,r,a]}function fi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(t instanceof $s){const{pageWidth:s,pageHeight:i}=t.rawDims,{style:r}=e,a=js.isCSSRoundSupported,o="var(--scale-factor) * ".concat(s,"px"),l="var(--scale-factor) * ".concat(i,"px"),c=a?"round(down, ".concat(o,", var(--scale-round-x, 1px))"):"calc(".concat(o,")"),h=a?"round(down, ".concat(l,", var(--scale-round-y, 1px))"):"calc(".concat(l,")");n&&t.rotation%180!==0?(r.width=h,r.height=c):(r.width=c,r.height=h)}s&&e.setAttribute("data-main-rotation",t.rotation)}class pi{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}}var gi=new WeakMap,mi=new WeakMap,vi=new WeakMap,yi=new WeakMap,bi=new WeakMap,xi=new WeakSet;class wi{constructor(e){qt(this,xi),Kt(this,gi,null),Kt(this,mi,null),Kt(this,vi,void 0),Kt(this,yi,null),Kt(this,bi,null),Zt(vi,this,e),Ti._||(Ti._=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=Zt(gi,this,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=Jt(vi,this)._uiManager._signal;e.addEventListener("contextmenu",ri,{signal:t}),e.addEventListener("pointerdown",Si,{signal:t});const n=Zt(yi,this,document.createElement("div"));n.className="buttons",e.append(n);const s=Jt(vi,this).toolbarPosition;if(s){const{style:t}=e,n="ltr"===Jt(vi,this)._uiManager.direction?1-s[0]:s[0];t.insetInlineEnd="".concat(100*n,"%"),t.top="calc(".concat(100*s[1],"% + var(--editor-toolbar-vert-offset))")}return Qt(xi,this,Ai).call(this),e}get div(){return Jt(gi,this)}hide(){var e;Jt(gi,this).classList.add("hidden"),null===(e=Jt(mi,this))||void 0===e||e.hideDropdown()}show(){var e;Jt(gi,this).classList.remove("hidden"),null===(e=Jt(bi,this))||void 0===e||e.shown()}async addAltText(e){const t=await e.render();Qt(xi,this,ki).call(this,t),Jt(yi,this).prepend(t,$t(xi,this,Ei)),Zt(bi,this,e)}addColorPicker(e){Zt(mi,this,e);const t=e.renderButton();Qt(xi,this,ki).call(this,t),Jt(yi,this).prepend(t,$t(xi,this,Ei))}remove(){var e;Jt(gi,this).remove(),null===(e=Jt(mi,this))||void 0===e||e.destroy(),Zt(mi,this,null)}}function Si(e){e.stopPropagation()}function _i(e){Jt(vi,this)._focusEventsAllowed=!1,e.preventDefault(),e.stopPropagation()}function Ci(e){Jt(vi,this)._focusEventsAllowed=!0,e.preventDefault(),e.stopPropagation()}function ki(e){const t=Jt(vi,this)._uiManager._signal;e.addEventListener("focusin",Qt(xi,this,_i).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",Qt(xi,this,Ci).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",ri,{signal:t})}function Ai(){const{editorType:e,_uiManager:t}=Jt(vi,this),n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",Ti._[e]),Qt(xi,this,ki).call(this,n),n.addEventListener("click",e=>{t.delete()},{signal:t._signal}),Jt(yi,this).append(n)}function Ei(e){const t=document.createElement("div");return t.className="divider",t}var Ti={_:null},Mi=new WeakMap,ji=new WeakMap,Pi=new WeakMap,Oi=new WeakSet;class Di{constructor(e){qt(this,Oi),Kt(this,Mi,null),Kt(this,ji,null),Kt(this,Pi,void 0),Zt(Pi,this,e)}show(e,t,n){const[s,i]=Qt(Oi,this,Li).call(this,t,n),{style:r}=Jt(ji,this)||Zt(ji,this,Qt(Oi,this,Ni).call(this));e.append(Jt(ji,this)),r.insetInlineEnd="".concat(100*s,"%"),r.top="calc(".concat(100*i,"% + var(--editor-toolbar-vert-offset))")}hide(){Jt(ji,this).remove()}}function Ni(){const e=Zt(ji,this,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",ri,{signal:Jt(Pi,this)._signal});const t=Zt(Mi,this,document.createElement("div"));return t.className="buttons",e.append(t),Qt(Oi,this,Ri).call(this),e}function Li(e,t){let n=0,s=0;for(const i of e){const e=i.y+i.height;if(e<n)continue;const r=i.x+(t?i.width:0);e>n?(s=r,n=e):t?r>s&&(s=r):r<s&&(s=r)}return[t?1-s:s,n]}function Ri(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=Jt(Pi,this)._signal;e.addEventListener("contextmenu",ri,{signal:n}),e.addEventListener("click",()=>{Jt(Pi,this).highlightSelection("floating_button")},{signal:n}),Jt(Mi,this).append(e)}function Fi(e,t,n){for(const s of n)t.addEventListener(s,e[s].bind(e))}var Ii=new WeakMap;class zi{constructor(){Kt(this,Ii,0)}get id(){var e,t;return"".concat("pdfjs_internal_editor_").concat((Zt(Ii,this,(e=Jt(Ii,this),t=e++,e)),t))}}var Wi=new WeakMap,Bi=new WeakMap,Hi=new WeakMap,Ui=new WeakSet;class Vi{constructor(){qt(this,Ui),Kt(this,Wi,function(){var e,t;if("undefined"!==typeof crypto&&"function"===typeof(null===(e=crypto)||void 0===e?void 0:e.randomUUID))return crypto.randomUUID();const n=new Uint8Array(32);if("undefined"!==typeof crypto&&"function"===typeof(null===(t=crypto)||void 0===t?void 0:t.getRandomValues))crypto.getRandomValues(n);else for(let s=0;s<32;s++)n[s]=Math.floor(255*Math.random());return Es(n)}()),Kt(this,Bi,0),Kt(this,Hi,null)}static get _isSVGFittingCanvas(){const e=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),t=new Image;t.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';return ys(this,"_isSVGFittingCanvas",t.decode().then(()=>(e.drawImage(t,0,0,1,1,0,0,1,3),0===new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0])))}async getFromFile(e){const{lastModified:t,name:n,size:s,type:i}=e;return Qt(Ui,this,Gi).call(this,"".concat(t,"_").concat(n,"_").concat(s,"_").concat(i),e)}async getFromUrl(e){return Qt(Ui,this,Gi).call(this,e,e)}async getFromBlob(e,t){const n=await t;return Qt(Ui,this,Gi).call(this,e,n)}async getFromId(e){Jt(Hi,this)||Zt(Hi,this,new Map);const t=Jt(Hi,this).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:e}=t;return delete t.blobPromise,this.getFromBlob(t.id,e)}return this.getFromUrl(t.url)}getFromCanvas(e,t){var n,s,i;Jt(Hi,this)||Zt(Hi,this,new Map);let r=Jt(Hi,this).get(e);if(null!==(i=r)&&void 0!==i&&i.bitmap)return r.refCounter+=1,r;const a=new OffscreenCanvas(t.width,t.height);return a.getContext("2d").drawImage(t,0,0),r={bitmap:a.transferToImageBitmap(),id:"image_".concat(Jt(Wi,this),"_").concat((Zt(Bi,this,(n=Jt(Bi,this),s=n++,n)),s)),refCounter:1,isSvg:!1},Jt(Hi,this).set(e,r),Jt(Hi,this).set(r.id,r),r}getSvgUrl(e){const t=Jt(Hi,this).get(e);return null!==t&&void 0!==t&&t.isSvg?t.svgUrl:null}deleteId(e){var t;Jt(Hi,this)||Zt(Hi,this,new Map);const n=Jt(Hi,this).get(e);if(!n)return;if(n.refCounter-=1,0!==n.refCounter)return;const{bitmap:s}=n;if(!n.url&&!n.file){const e=new OffscreenCanvas(s.width,s.height);e.getContext("bitmaprenderer").transferFromImageBitmap(s),n.blobPromise=e.convertToBlob()}null===(t=s.close)||void 0===t||t.call(s),n.bitmap=null}isValidId(e){return e.startsWith("image_".concat(Jt(Wi,this),"_"))}}async function Gi(e,t){var n;Jt(Hi,this)||Zt(Hi,this,new Map);let s=Jt(Hi,this).get(e);if(null===s)return null;if(null!==(n=s)&&void 0!==n&&n.bitmap)return s.refCounter+=1,s;try{var i,r;let e;if(s||(s={bitmap:null,id:"image_".concat(Jt(Wi,this),"_").concat((Zt(Bi,this,(i=Jt(Bi,this),r=i++,i)),r)),refCounter:0,isSvg:!1}),"string"===typeof t?(s.url=t,e=await Qs(t,"blob")):t instanceof File?e=s.file=t:t instanceof Blob&&(e=t),"image/svg+xml"===e.type){const t=nn._isSVGFittingCanvas,n=new FileReader,i=new Image,r=new Promise((e,r)=>{i.onload=()=>{s.bitmap=i,s.isSvg=!0,e()},n.onload=async()=>{const e=s.svgUrl=n.result;i.src=await t?"".concat(e,"#svgView(preserveAspectRatio(none))"):e},i.onerror=n.onerror=r});n.readAsDataURL(e),await r}else s.bitmap=await createImageBitmap(e);s.refCounter=1}catch(xy){console.error(xy),s=null}return Jt(Hi,this).set(e,s),s&&Jt(Hi,this).set(s.id,s),s}nn=Vi;var Xi=new WeakMap,Yi=new WeakMap,qi=new WeakMap,Ki=new WeakMap;class Qi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;Kt(this,Xi,[]),Kt(this,Yi,!1),Kt(this,qi,void 0),Kt(this,Ki,-1),Zt(qi,this,e)}add(e){let{cmd:t,undo:n,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}=e;if(i&&t(),Jt(Yi,this))return;const l={cmd:t,undo:n,post:s,type:r};if(-1===Jt(Ki,this))return Jt(Xi,this).length>0&&(Jt(Xi,this).length=0),Zt(Ki,this,0),void Jt(Xi,this).push(l);if(a&&Jt(Xi,this)[Jt(Ki,this)].type===r)return o&&(l.undo=Jt(Xi,this)[Jt(Ki,this)].undo),void(Jt(Xi,this)[Jt(Ki,this)]=l);const c=Jt(Ki,this)+1;c===Jt(qi,this)?Jt(Xi,this).splice(0,1):(Zt(Ki,this,c),c<Jt(Xi,this).length&&Jt(Xi,this).splice(c)),Jt(Xi,this).push(l)}undo(){if(-1===Jt(Ki,this))return;Zt(Yi,this,!0);const{undo:e,post:t}=Jt(Xi,this)[Jt(Ki,this)];e(),null===t||void 0===t||t(),Zt(Yi,this,!1),Zt(Ki,this,Jt(Ki,this)-1)}redo(){if(Jt(Ki,this)<Jt(Xi,this).length-1){Zt(Ki,this,Jt(Ki,this)+1),Zt(Yi,this,!0);const{cmd:e,post:t}=Jt(Xi,this)[Jt(Ki,this)];e(),null===t||void 0===t||t(),Zt(Yi,this,!1)}}hasSomethingToUndo(){return-1!==Jt(Ki,this)}hasSomethingToRedo(){return Jt(Ki,this)<Jt(Xi,this).length-1}destroy(){Zt(Xi,this,null)}}var $i=new WeakSet;class Ji{constructor(e){qt(this,$i),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=js.platform;for(const[n,s,i={}]of e)for(const e of n){const n=e.startsWith("mac+");t&&n?(this.callbacks.set(e.slice(4),{callback:s,options:i}),this.allKeys.add(e.split("+").at(-1))):t||n||(this.callbacks.set(e,{callback:s,options:i}),this.allKeys.add(e.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(Qt($i,this,Zi).call(this,t));if(!n)return;const{callback:s,options:{bubbles:i=!1,args:r=[],checker:a=null}}=n;a&&!a(e,t)||(s.bind(e,...r,t)(),i||(t.stopPropagation(),t.preventDefault()))}}function Zi(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}class er{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return function(e){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const n of e.keys()){t.style.color=n;const s=window.getComputedStyle(t).color;e.set(n,hi(s))}t.remove()}(e),ys(this,"_colors",e)}convert(e){const t=hi(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,s]of this._colors)if(s.every((e,n)=>e===t[n]))return er._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Os.makeHexColor(...t):e}}o(er,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var tr=new WeakMap,nr=new WeakMap,sr=new WeakMap,ir=new WeakMap,rr=new WeakMap,ar=new WeakMap,or=new WeakMap,lr=new WeakMap,cr=new WeakMap,hr=new WeakMap,ur=new WeakMap,dr=new WeakMap,fr=new WeakMap,pr=new WeakMap,gr=new WeakMap,mr=new WeakMap,vr=new WeakMap,yr=new WeakMap,br=new WeakMap,xr=new WeakMap,wr=new WeakMap,Sr=new WeakMap,_r=new WeakMap,Cr=new WeakMap,kr=new WeakMap,Ar=new WeakMap,Er=new WeakMap,Tr=new WeakMap,Mr=new WeakMap,jr=new WeakMap,Pr=new WeakMap,Or=new WeakMap,Dr=new WeakMap,Nr=new WeakMap,Lr=new WeakMap,Rr=new WeakMap,Fr=new WeakMap,Ir=new WeakMap,zr=new WeakMap,Wr=new WeakMap,Br=new WeakMap,Hr=new WeakSet;class Ur{static get _keyboardManager(){const e=Ur.prototype,t=e=>Jt(zr,e).contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&e.hasSomethingToControl(),n=(e,t)=>{let{target:n}=t;if(n instanceof HTMLInputElement){const{type:e}=n;return"text"!==e&&"number"!==e}return!0},s=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return ys(this,"_keyboardManager",new Ji([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(e,t)=>{let{target:n}=t;return!(n instanceof HTMLButtonElement)&&Jt(zr,e).contains(n)&&!e.isEnterHandled}}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(e,t)=>{let{target:n}=t;return!(n instanceof HTMLButtonElement)&&Jt(zr,e).contains(document.activeElement)}}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}constructor(e,t,n,s,i,r,a,o,l,c,h){qt(this,Hr),Kt(this,tr,new AbortController),Kt(this,nr,null),Kt(this,sr,new Map),Kt(this,ir,new Map),Kt(this,rr,null),Kt(this,ar,null),Kt(this,or,null),Kt(this,lr,new Qi),Kt(this,cr,null),Kt(this,hr,0),Kt(this,ur,new Set),Kt(this,dr,null),Kt(this,fr,null),Kt(this,pr,new Set),Kt(this,gr,!1),Kt(this,mr,!1),Kt(this,vr,!1),Kt(this,yr,null),Kt(this,br,null),Kt(this,xr,null),Kt(this,wr,null),Kt(this,Sr,!1),Kt(this,_r,null),Kt(this,Cr,new zi),Kt(this,kr,!1),Kt(this,Ar,!1),Kt(this,Er,null),Kt(this,Tr,null),Kt(this,Mr,null),Kt(this,jr,null),Kt(this,Pr,Tn.NONE),Kt(this,Or,new Set),Kt(this,Dr,null),Kt(this,Nr,null),Kt(this,Lr,null),Kt(this,Rr,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}),Kt(this,Fr,[0,0]),Kt(this,Ir,null),Kt(this,zr,null),Kt(this,Wr,null),Kt(this,Br,null);const u=this._signal=Jt(tr,this).signal;Zt(zr,this,e),Zt(Wr,this,t),Zt(rr,this,n),this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:u}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:u}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:u}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:u}),s._on("setpreference",this.onSetPreference.bind(this),{signal:u}),s._on("switchannotationeditorparams",e=>this.updateParams(e.type,e.value),{signal:u}),Qt(Hr,this,Kr).call(this),Qt(Hr,this,na).call(this),Qt(Hr,this,Jr).call(this),Zt(ar,this,i.annotationStorage),Zt(yr,this,i.filterFactory),Zt(Nr,this,r),Zt(wr,this,a||null),Zt(gr,this,o),Zt(mr,this,l),Zt(vr,this,c),Zt(jr,this,h||null),this.viewParameters={realScale:Ks.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){var e,t,n,s;null===(e=Jt(Br,this))||void 0===e||e.resolve(),Zt(Br,this,null),null===(t=Jt(tr,this))||void 0===t||t.abort(),Zt(tr,this,null),this._signal=null;for(const i of Jt(ir,this).values())i.destroy();Jt(ir,this).clear(),Jt(sr,this).clear(),Jt(pr,this).clear(),Zt(nr,this,null),Jt(Or,this).clear(),Jt(lr,this).destroy(),null===(n=Jt(rr,this))||void 0===n||n.destroy(),null===(s=Jt(_r,this))||void 0===s||s.hide(),Zt(_r,this,null),Jt(br,this)&&(clearTimeout(Jt(br,this)),Zt(br,this,null)),Jt(Ir,this)&&(clearTimeout(Jt(Ir,this)),Zt(Ir,this,null))}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return Jt(jr,this)}get useNewAltTextFlow(){return Jt(mr,this)}get useNewAltTextWhenAddingImage(){return Jt(vr,this)}get hcmFilter(){return ys(this,"hcmFilter",Jt(Nr,this)?Jt(yr,this).addHCMFilter(Jt(Nr,this).foreground,Jt(Nr,this).background):"none")}get direction(){return ys(this,"direction",getComputedStyle(Jt(zr,this)).direction)}get highlightColors(){return ys(this,"highlightColors",Jt(wr,this)?new Map(Jt(wr,this).split(",").map(e=>e.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return ys(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setMainHighlightColorPicker(e){Zt(Mr,this,e)}editAltText(e){var t;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null===(t=Jt(rr,this))||void 0===t||t.editAltText(this,e,n)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference(e){let{name:t,value:n}=e;if("enableNewAltTextWhenAddingImage"===t)Zt(vr,this,n)}onPageChanging(e){let{pageNumber:t}=e;Zt(hr,this,t-1)}focusMainContainer(){Jt(zr,this).focus()}findParent(e,t){for(const n of Jt(ir,this).values()){const{x:s,y:i,width:r,height:a}=n.div.getBoundingClientRect();if(e>=s&&e<=s+r&&t>=i&&t<=i+a)return n}return null}disableUserSelect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Jt(Wr,this).classList.toggle("noUserSelect",e)}addShouldRescale(e){Jt(pr,this).add(e)}removeShouldRescale(e){Jt(pr,this).delete(e)}onScaleChanging(e){let{scale:t}=e;this.commitOrRemove(),this.viewParameters.realScale=t*Ks.PDF_TO_CSS_UNITS;for(const n of Jt(pr,this))n.onScaleChanging()}onRotationChanging(e){let{pagesRotation:t}=e;this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:n,anchorOffset:s,focusNode:i,focusOffset:r}=t,a=t.toString(),o=Qt(Hr,this,Vr).call(this,t).closest(".textLayer"),l=this.getSelectionBoxes(o);if(!l)return;t.empty();const c=Qt(Hr,this,Gr).call(this,o),h=Jt(Pr,this)===Tn.NONE,u=()=>{null===c||void 0===c||c.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:l,anchorNode:n,anchorOffset:s,focusNode:i,focusOffset:r,text:a}),h&&this.showAllEditors("highlight",!0,!0)};h?this.switchToMode(Tn.HIGHLIGHT,u):u()}addToAnnotationStorage(e){e.isEmpty()||!Jt(ar,this)||Jt(ar,this).has(e.id)||Jt(ar,this).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,Jt(Sr,this)&&(Zt(Sr,this,!1),Qt(Hr,this,qr).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of Jt(Or,this))if(t.div.contains(e)){Zt(Tr,this,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!Jt(Tr,this))return;const[e,t]=Jt(Tr,this);Zt(Tr,this,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){Qt(Hr,this,Jr).call(this),Qt(Hr,this,ea).call(this)}removeEditListeners(){Qt(Hr,this,Zr).call(this),Qt(Hr,this,ta).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of Jt(fr,this))if(n.isHandlingMimeForPasting(t))return e.dataTransfer.dropEffect="copy",void e.preventDefault()}drop(e){for(const t of e.dataTransfer.items)for(const n of Jt(fr,this))if(n.isHandlingMimeForPasting(t.type))return n.paste(t,this.currentLayer),void e.preventDefault()}copy(e){var t;if(e.preventDefault(),null===(t=Jt(nr,this))||void 0===t||t.commitOrRemove(),!this.hasSelection)return;const n=[];for(const s of Jt(Or,this)){const e=s.serialize(!0);e&&n.push(e)}0!==n.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(n))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const e of Jt(fr,this))if(e.isHandlingMimeForPasting(r.type))return void e.paste(r,this.currentLayer);let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(i){return void ps('paste: "'.concat(i.message,'".'))}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const e=[];for(const r of n){const t=await s.deserialize(r);if(!t)return;e.push(t)}const t=()=>{for(const t of e)Qt(Hr,this,oa).call(this,t);Qt(Hr,this,ha).call(this,e)},i=()=>{for(const t of e)t.remove()};this.addCommands({cmd:t,undo:i,mustExec:!0})}catch(i){ps('paste: "'.concat(i.message,'".'))}}keydown(e){this.isShiftKeyDown||"Shift"!==e.key||(this.isShiftKeyDown=!0),Jt(Pr,this)===Tn.NONE||this.isEditorHandlingKeyboard||Ur._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&"Shift"===e.key&&(this.isShiftKeyDown=!1,Jt(Sr,this)&&(Zt(Sr,this,!1),Qt(Hr,this,qr).call(this,"main_toolbar")))}onEditingAction(e){let{name:t}=e;switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu")}}setEditingState(e){e?(Qt(Hr,this,Qr).call(this),Qt(Hr,this,ea).call(this),Qt(Hr,this,sa).call(this,{isEditing:Jt(Pr,this)!==Tn.NONE,isEmpty:Qt(Hr,this,ca).call(this),hasSomethingToUndo:Jt(lr,this).hasSomethingToUndo(),hasSomethingToRedo:Jt(lr,this).hasSomethingToRedo(),hasSelectedEditor:!1})):(Qt(Hr,this,$r).call(this),Qt(Hr,this,ta).call(this),Qt(Hr,this,sa).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!Jt(fr,this)){Zt(fr,this,e);for(const e of Jt(fr,this))Qt(Hr,this,ia).call(this,e.defaultPropertiesToUpdate)}}getId(){return Jt(Cr,this).id}get currentLayer(){return Jt(ir,this).get(Jt(hr,this))}getLayer(e){return Jt(ir,this).get(e)}get currentPageIndex(){return Jt(hr,this)}addLayer(e){Jt(ir,this).set(e.pageIndex,e),Jt(kr,this)?e.enable():e.disable()}removeLayer(e){Jt(ir,this).delete(e.pageIndex)}async updateMode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Jt(Pr,this)!==e&&(!Jt(Br,this)||(await Jt(Br,this).promise,Jt(Br,this)))){if(Zt(Br,this,Promise.withResolvers()),Zt(Pr,this,e),e===Tn.NONE)return this.setEditingState(!1),Qt(Hr,this,aa).call(this),void Jt(Br,this).resolve();this.setEditingState(!0),await Qt(Hr,this,ra).call(this),this.unselectAll();for(const t of Jt(ir,this).values())t.updateMode(e);if(!t)return n&&this.addNewEditorFromKeyboard(),void Jt(Br,this).resolve();for(const e of Jt(sr,this).values())e.annotationElementId===t?(this.setSelected(e),e.enterInEditMode()):e.unselect();Jt(Br,this).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==Jt(Pr,this)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var n;if(Jt(fr,this)){switch(e){case Mn.CREATE:return void this.currentLayer.addNewEditor();case Mn.HIGHLIGHT_DEFAULT_COLOR:null===(n=Jt(Mr,this))||void 0===n||n.updateColor(t);break;case Mn.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(Jt(Lr,this)||Zt(Lr,this,new Map)).set(e,t),this.showAllEditors("highlight",t)}for(const n of Jt(Or,this))n.updateParams(e,t);for(const n of Jt(fr,this))n.updateDefaultParams(e,t)}}showAllEditors(e,t){var n,s;for(const i of Jt(sr,this).values())i.editorType===e&&i.show(t);(null===(n=null===(s=Jt(Lr,this))||void 0===s?void 0:s.get(Mn.HIGHLIGHT_SHOW_ALL))||void 0===n||n)!==t&&Qt(Hr,this,ia).call(this,[[Mn.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Jt(Ar,this)!==e){Zt(Ar,this,e);for(const t of Jt(ir,this).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const n of Jt(sr,this).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return Jt(sr,this).get(e)}addEditor(e){Jt(sr,this).set(e.id,e)}removeEditor(e){var t;(e.div.contains(document.activeElement)&&(Jt(br,this)&&clearTimeout(Jt(br,this)),Zt(br,this,setTimeout(()=>{this.focusMainContainer(),Zt(br,this,null)},0))),Jt(sr,this).delete(e.id),this.unselect(e),e.annotationElementId&&Jt(ur,this).has(e.annotationElementId))||(null===(t=Jt(ar,this))||void 0===t||t.remove(e.id))}addDeletedAnnotationElement(e){Jt(ur,this).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return Jt(ur,this).has(e)}removeDeletedAnnotationElement(e){Jt(ur,this).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){Jt(nr,this)!==e&&(Zt(nr,this,e),e&&Qt(Hr,this,ia).call(this,e.propertiesToUpdate))}updateUI(e){$t(Hr,this,la)===e&&Qt(Hr,this,ia).call(this,e.propertiesToUpdate)}toggleSelected(e){if(Jt(Or,this).has(e))return Jt(Or,this).delete(e),e.unselect(),void Qt(Hr,this,sa).call(this,{hasSelectedEditor:this.hasSelection});Jt(Or,this).add(e),e.select(),Qt(Hr,this,ia).call(this,e.propertiesToUpdate),Qt(Hr,this,sa).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const t of Jt(Or,this))t!==e&&t.unselect();Jt(Or,this).clear(),Jt(Or,this).add(e),e.select(),Qt(Hr,this,ia).call(this,e.propertiesToUpdate),Qt(Hr,this,sa).call(this,{hasSelectedEditor:!0})}isSelected(e){return Jt(Or,this).has(e)}get firstSelectedEditor(){return Jt(Or,this).values().next().value}unselect(e){e.unselect(),Jt(Or,this).delete(e),Qt(Hr,this,sa).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==Jt(Or,this).size}get isEnterHandled(){return 1===Jt(Or,this).size&&this.firstSelectedEditor.isEnterHandled}undo(){Jt(lr,this).undo(),Qt(Hr,this,sa).call(this,{hasSomethingToUndo:Jt(lr,this).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Qt(Hr,this,ca).call(this)})}redo(){Jt(lr,this).redo(),Qt(Hr,this,sa).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:Jt(lr,this).hasSomethingToRedo(),isEmpty:Qt(Hr,this,ca).call(this)})}addCommands(e){Jt(lr,this).add(e),Qt(Hr,this,sa).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Qt(Hr,this,ca).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...Jt(Or,this)];this.addCommands({cmd:()=>{for(const t of e)t.remove()},undo:()=>{for(const t of e)Qt(Hr,this,oa).call(this,t)},mustExec:!0})}commitOrRemove(){var e;null===(e=Jt(nr,this))||void 0===e||e.commitOrRemove()}hasSomethingToControl(){return Jt(nr,this)||this.hasSelection}selectAll(){for(const e of Jt(Or,this))e.commit();Qt(Hr,this,ha).call(this,Jt(sr,this).values())}unselectAll(){if((!Jt(nr,this)||(Jt(nr,this).commitOrRemove(),Jt(Pr,this)===Tn.NONE))&&this.hasSelection){for(const e of Jt(Or,this))e.unselect();Jt(Or,this).clear(),Qt(Hr,this,sa).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||this.commitOrRemove(),!this.hasSelection)return;Jt(Fr,this)[0]+=e,Jt(Fr,this)[1]+=t;const[n,s]=Jt(Fr,this),i=[...Jt(Or,this)];Jt(Ir,this)&&clearTimeout(Jt(Ir,this)),Zt(Ir,this,setTimeout(()=>{Zt(Ir,this,null),Jt(Fr,this)[0]=Jt(Fr,this)[1]=0,this.addCommands({cmd:()=>{for(const e of i)Jt(sr,this).has(e.id)&&e.translateInPage(n,s)},undo:()=>{for(const e of i)Jt(sr,this).has(e.id)&&e.translateInPage(-n,-s)},mustExec:!1})},1e3));for(const r of i)r.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),Zt(dr,this,new Map);for(const e of Jt(Or,this))Jt(dr,this).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!Jt(dr,this))return!1;this.disableUserSelect(!1);const e=Jt(dr,this);Zt(dr,this,null);let t=!1;for(const[{x:s,y:i,pageIndex:r},a]of e)a.newX=s,a.newY=i,a.newPageIndex=r,t||(t=s!==a.savedX||i!==a.savedY||r!==a.savedPageIndex);if(!t)return!1;const n=(e,t,n,s)=>{if(Jt(sr,this).has(e.id)){const i=Jt(ir,this).get(s);i?e._setParentAndPosition(i,t,n):(e.pageIndex=s,e.x=t,e.y=n)}};return this.addCommands({cmd:()=>{for(const[t,{newX:s,newY:i,newPageIndex:r}]of e)n(t,s,i,r)},undo:()=>{for(const[t,{savedX:s,savedY:i,savedPageIndex:r}]of e)n(t,s,i,r)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(Jt(dr,this))for(const n of Jt(dr,this).keys())n.drag(e,t)}rebuild(e){if(null===e.parent){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return(null===(e=this.getActive())||void 0===e?void 0:e.shouldGetKeyboardEvents())||1===Jt(Or,this).size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return Jt(nr,this)===e}getActive(){return Jt(nr,this)}getMode(){return Jt(Pr,this)}get imageManager(){return ys(this,"imageManager",new Vi)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let l=0,c=t.rangeCount;l<c;l++)if(!e.contains(t.getRangeAt(l).commonAncestorContainer))return null;const{x:n,y:s,width:i,height:r}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(e,t,a,o)=>({x:(t-s)/r,y:1-(e+a-n)/i,width:o/r,height:a/i});break;case"180":a=(e,t,a,o)=>({x:1-(e+a-n)/i,y:1-(t+o-s)/r,width:a/i,height:o/r});break;case"270":a=(e,t,a,o)=>({x:1-(t+o-s)/r,y:(e-n)/i,width:o/r,height:a/i});break;default:a=(e,t,a,o)=>({x:(e-n)/i,y:(t-s)/r,width:a/i,height:o/r})}const o=[];for(let l=0,c=t.rangeCount;l<c;l++){const e=t.getRangeAt(l);if(!e.collapsed)for(const{x:t,y:n,width:s,height:i}of e.getClientRects())0!==s&&0!==i&&o.push(a(t,n,s,i))}return 0===o.length?null:o}addChangedExistingAnnotation(e){let{annotationElementId:t,id:n}=e;(Jt(or,this)||Zt(or,this,new Map)).set(t,n)}removeChangedExistingAnnotation(e){var t;let{annotationElementId:n}=e;null===(t=Jt(or,this))||void 0===t||t.delete(n)}renderAnnotationElement(e){var t;const n=null===(t=Jt(or,this))||void 0===t?void 0:t.get(e.data.id);if(!n)return;const s=Jt(ar,this).getRawValue(n);s&&(Jt(Pr,this)!==Tn.NONE||s.hasBeenModified)&&s.renderAnnotationElement(e)}}function Vr(e){let{anchorNode:t}=e;return t.nodeType===Node.TEXT_NODE?t.parentElement:t}function Gr(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of Jt(ir,this).values())if(n.hasTextLayer(e))return n;return null}function Xr(){const e=document.getSelection();if(!e||e.isCollapsed)return;const t=Qt(Hr,this,Vr).call(this,e).closest(".textLayer"),n=this.getSelectionBoxes(t);n&&(Jt(_r,this)||Zt(_r,this,new Di(this)),Jt(_r,this).show(t,n,"ltr"===this.direction))}function Yr(){var e;const t=document.getSelection();if(!t||t.isCollapsed){var n;if(Jt(Dr,this))null===(n=Jt(_r,this))||void 0===n||n.hide(),Zt(Dr,this,null),Qt(Hr,this,sa).call(this,{hasSelectedText:!1});return}const{anchorNode:s}=t;if(s===Jt(Dr,this))return;const i=Qt(Hr,this,Vr).call(this,t).closest(".textLayer");var r;if(i){if(null===(e=Jt(_r,this))||void 0===e||e.hide(),Zt(Dr,this,s),Qt(Hr,this,sa).call(this,{hasSelectedText:!0}),(Jt(Pr,this)===Tn.HIGHLIGHT||Jt(Pr,this)===Tn.NONE)&&(Jt(Pr,this)===Tn.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),Zt(Sr,this,this.isShiftKeyDown),!this.isShiftKeyDown)){const e=Jt(Pr,this)===Tn.HIGHLIGHT?Qt(Hr,this,Gr).call(this,i):null;null===e||void 0===e||e.toggleDrawing();const t=new AbortController,n=this.combinedSignal(t),s=n=>{"pointerup"===n.type&&0!==n.button||(t.abort(),null===e||void 0===e||e.toggleDrawing(!0),"pointerup"===n.type&&Qt(Hr,this,qr).call(this,"main_toolbar"))};window.addEventListener("pointerup",s,{signal:n}),window.addEventListener("blur",s,{signal:n})}}else Jt(Dr,this)&&(null===(r=Jt(_r,this))||void 0===r||r.hide(),Zt(Dr,this,null),Qt(Hr,this,sa).call(this,{hasSelectedText:!1}))}function qr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Jt(Pr,this)===Tn.HIGHLIGHT?this.highlightSelection(e):Jt(gr,this)&&Qt(Hr,this,Xr).call(this)}function Kr(){document.addEventListener("selectionchange",Qt(Hr,this,Yr).bind(this),{signal:this._signal})}function Qr(){if(Jt(xr,this))return;Zt(xr,this,new AbortController);const e=this.combinedSignal(Jt(xr,this));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}function $r(){var e;null===(e=Jt(xr,this))||void 0===e||e.abort(),Zt(xr,this,null)}function Jr(){if(Jt(Er,this))return;Zt(Er,this,new AbortController);const e=this.combinedSignal(Jt(Er,this));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}function Zr(){var e;null===(e=Jt(Er,this))||void 0===e||e.abort(),Zt(Er,this,null)}function ea(){if(Jt(cr,this))return;Zt(cr,this,new AbortController);const e=this.combinedSignal(Jt(cr,this));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}function ta(){var e;null===(e=Jt(cr,this))||void 0===e||e.abort(),Zt(cr,this,null)}function na(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}function sa(e){Object.entries(e).some(e=>{let[t,n]=e;return Jt(Rr,this)[t]!==n})&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(Jt(Rr,this),e)}),Jt(Pr,this)===Tn.HIGHLIGHT&&!1===e.hasSelectedEditor&&Qt(Hr,this,ia).call(this,[[Mn.HIGHLIGHT_FREE,!0]]))}function ia(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}async function ra(){if(!Jt(kr,this)){Zt(kr,this,!0);const e=[];for(const t of Jt(ir,this).values())e.push(t.enable());await Promise.all(e);for(const t of Jt(sr,this).values())t.enable()}}function aa(){if(this.unselectAll(),Jt(kr,this)){Zt(kr,this,!1);for(const e of Jt(ir,this).values())e.disable();for(const e of Jt(sr,this).values())e.disable()}}function oa(e){const t=Jt(ir,this).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}function la(e){let t=null;for(t of Jt(Or,e));return t}function ca(){if(0===Jt(sr,this).size)return!0;if(1===Jt(sr,this).size)for(const e of Jt(sr,this).values())return e.isEmpty();return!1}function ha(e){for(const t of Jt(Or,this))t.unselect();Jt(Or,this).clear();for(const t of e)t.isEmpty()||(Jt(Or,this).add(t),t.select());Qt(Hr,this,sa).call(this,{hasSelectedEditor:this.hasSelection})}o(Ur,"TRANSLATE_SMALL",1),o(Ur,"TRANSLATE_BIG",10);var ua=new WeakMap,da=new WeakMap,fa=new WeakMap,pa=new WeakMap,ga=new WeakMap,ma=new WeakMap,va=new WeakMap,ya=new WeakMap,ba=new WeakMap,xa=new WeakMap,wa=new WeakMap,Sa=new WeakMap,_a=new WeakSet;class Ca{constructor(e){qt(this,_a),Kt(this,ua,null),Kt(this,da,!1),Kt(this,fa,null),Kt(this,pa,null),Kt(this,ga,null),Kt(this,ma,null),Kt(this,va,!1),Kt(this,ya,null),Kt(this,ba,null),Kt(this,xa,null),Kt(this,wa,null),Kt(this,Sa,!1),Zt(ba,this,e),Zt(Sa,this,e._uiManager.useNewAltTextFlow),Ea._||(Ea._=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){var t;null!==(t=Ca._l10n)&&void 0!==t||(Ca._l10n=e)}async render(){const e=Zt(fa,this,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=Zt(pa,this,document.createElement("span"));e.append(t),Jt(Sa,this)?(e.classList.add("new"),e.setAttribute("data-l10n-id",Ea._.missing),t.setAttribute("data-l10n-id",Ea._["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=Jt(ba,this)._uiManager._signal;e.addEventListener("contextmenu",ri,{signal:n}),e.addEventListener("pointerdown",e=>e.stopPropagation(),{signal:n});const s=e=>{e.preventDefault(),Jt(ba,this)._uiManager.editAltText(Jt(ba,this)),Jt(Sa,this)&&Jt(ba,this)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:$t(_a,this,ka)}})};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",t=>{t.target===e&&"Enter"===t.key&&(Zt(va,this,!0),s(t))},{signal:n}),await Qt(_a,this,Aa).call(this),e}finish(){Jt(fa,this)&&(Jt(fa,this).focus({focusVisible:Jt(va,this)}),Zt(va,this,!1))}isEmpty(){return Jt(Sa,this)?null===Jt(ua,this):!Jt(ua,this)&&!Jt(da,this)}hasData(){return Jt(Sa,this)?null!==Jt(ua,this)||!!Jt(xa,this):this.isEmpty()}get guessedText(){return Jt(xa,this)}async setGuessedText(e){null===Jt(ua,this)&&(Zt(xa,this,e),Zt(wa,this,await Ca._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),Qt(_a,this,Aa).call(this))}toggleAltTextBadge(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;if(!Jt(Sa,this)||Jt(ua,this))return null===(t=Jt(ya,this))||void 0===t||t.remove(),void Zt(ya,this,null);if(!Jt(ya,this)){const e=Zt(ya,this,document.createElement("div"));e.className="noAltTextBadge",Jt(ba,this).div.append(e)}Jt(ya,this).classList.toggle("hidden",!e)}serialize(e){let t=Jt(ua,this);return e||Jt(xa,this)!==t||(t=Jt(wa,this)),{altText:t,decorative:Jt(da,this),guessedText:Jt(xa,this),textWithDisclaimer:Jt(wa,this)}}get data(){return{altText:Jt(ua,this),decorative:Jt(da,this)}}set data(e){let{altText:t,decorative:n,guessedText:s,textWithDisclaimer:i,cancel:r=!1}=e;s&&(Zt(xa,this,s),Zt(wa,this,i)),Jt(ua,this)===t&&Jt(da,this)===n||(r||(Zt(ua,this,t),Zt(da,this,n)),Qt(_a,this,Aa).call(this))}toggle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Jt(fa,this)&&(!e&&Jt(ma,this)&&(clearTimeout(Jt(ma,this)),Zt(ma,this,null)),Jt(fa,this).disabled=!e)}shown(){Jt(ba,this)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:$t(_a,this,ka)}})}destroy(){var e,t;null===(e=Jt(fa,this))||void 0===e||e.remove(),Zt(fa,this,null),Zt(pa,this,null),Zt(ga,this,null),null===(t=Jt(ya,this))||void 0===t||t.remove(),Zt(ya,this,null)}}function ka(e){return(Jt(ua,e)?"added":null===Jt(ua,e)&&e.guessedText&&"review")||"missing"}async function Aa(){const e=Jt(fa,this);if(!e)return;if(Jt(Sa,this)){var t,n;if(e.classList.toggle("done",!!Jt(ua,this)),e.setAttribute("data-l10n-id",Ea._[$t(_a,this,ka)]),null===(t=Jt(pa,this))||void 0===t||t.setAttribute("data-l10n-id",Ea._["".concat($t(_a,this,ka),"-label")]),!Jt(ua,this))return void(null===(n=Jt(ga,this))||void 0===n||n.remove())}else{var s;if(!Jt(ua,this)&&!Jt(da,this))return e.classList.remove("done"),void(null===(s=Jt(ga,this))||void 0===s||s.remove());e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let i=Jt(ga,this);if(!i){Zt(ga,this,i=document.createElement("span")),i.className="tooltip",i.setAttribute("role","tooltip"),i.id="alt-text-tooltip-".concat(Jt(ba,this).id);const t=100,n=Jt(ba,this)._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(Jt(ma,this)),Zt(ma,this,null)},{once:!0}),e.addEventListener("mouseenter",()=>{Zt(ma,this,setTimeout(()=>{Zt(ma,this,null),Jt(ga,this).classList.add("show"),Jt(ba,this)._reportTelemetry({action:"alt_text_tooltip"})},t))},{signal:n}),e.addEventListener("mouseleave",()=>{var e;Jt(ma,this)&&(clearTimeout(Jt(ma,this)),Zt(ma,this,null)),null===(e=Jt(ga,this))||void 0===e||e.classList.remove("show")},{signal:n})}Jt(da,this)?i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(i.removeAttribute("data-l10n-id"),i.textContent=Jt(ua,this)),i.parentNode||e.append(i);const r=Jt(ba,this).getImageForAltText();null===r||void 0===r||r.setAttribute("aria-describedby",i.id)}var Ea={_:null};o(Ca,"_l10n",null);var Ta=new WeakMap,Ma=new WeakMap,ja=new WeakMap,Pa=new WeakMap,Oa=new WeakMap,Da=new WeakMap,Na=new WeakMap,La=new WeakMap,Ra=new WeakMap,Fa=new WeakMap,Ia=new WeakMap,za=new WeakMap,Wa=new WeakMap,Ba=new WeakMap,Ha=new WeakMap,Ua=new WeakMap,Va=new WeakMap,Ga=new WeakMap,Xa=new WeakMap,Ya=new WeakMap,qa=new WeakSet;class Ka{static get _resizerKeyboardManager(){const e=Ka.prototype._resizeWithKeyboard,t=Ur.TRANSLATE_SMALL,n=Ur.TRANSLATE_BIG;return ys(this,"_resizerKeyboardManager",new Ji([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],Ka.prototype._stopResizingWithKeyboard]]))}constructor(e){qt(this,qa),Kt(this,Ta,null),Kt(this,Ma,null),Kt(this,ja,null),Kt(this,Pa,!1),Kt(this,Oa,!1),Kt(this,Da,null),Kt(this,Na,null),Kt(this,La,null),Kt(this,Ra,""),Kt(this,Fa,!1),Kt(this,Ia,null),Kt(this,za,!1),Kt(this,Wa,!1),Kt(this,Ba,!1),Kt(this,Ha,null),Kt(this,Ua,0),Kt(this,Va,0),Kt(this,Ga,null),o(this,"_editToolbar",null),o(this,"_initialOptions",Object.create(null)),o(this,"_initialData",null),o(this,"_isVisible",!0),o(this,"_uiManager",null),o(this,"_focusEventsAllowed",!0),Kt(this,Xa,!1),Kt(this,Ya,Ka._zIndex++),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:i,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[i,r];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return ys(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new uo({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){var n;if(null!==(n=Ka._l10n)&&void 0!==n||(Ka._l10n=e),Ka._l10nResizer||(Ka._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),-1!==Ka._borderLineWidth)return;const s=getComputedStyle(document.documentElement);Ka._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){gs("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return Jt(Xa,this)}set _isDraggable(e){var t;Zt(Xa,this,e),null===(t=this.div)||void 0===t||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(2*e),this.y+=this.width*e/(2*t);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(2*e),this.y-=this.width*e/(2*t);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=Jt(Ya,this)}setParent(e){null!==e?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):Qt(qa,this,ho).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(Jt(Fa,this)?Zt(Fa,this,!1):this.parent.setSelected(this))}focusout(e){var t;if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const n=e.relatedTarget;null!==n&&void 0!==n&&n.closest("#".concat(this.id))||(e.preventDefault(),null!==(t=this.parent)&&void 0!==t&&t.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){const[i,r]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/i,this.y=(t+s)/r,this.fixAndSetPosition()}translate(e,t){Qt(qa,this,Qa).call(this,this.parentDimensions,e,t)}translateInPage(e,t){Jt(Ia,this)||Zt(Ia,this,[this.x,this.y]),Qt(qa,this,Qa).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){Jt(Ia,this)||Zt(Ia,this,[this.x,this.y]);const[n,s]=this.parentDimensions;if(this.x+=e/n,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:e,y:t}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,t)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:i,y:r}=this;const[a,o]=this.getBaseTranslation();i+=a,r+=o,this.div.style.left="".concat((100*i).toFixed(2),"%"),this.div.style.top="".concat((100*r).toFixed(2),"%"),this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!Jt(Ia,this)&&(Jt(Ia,this)[0]!==this.x||Jt(Ia,this)[1]!==this.y)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=Ka,s=n/e,i=n/t;switch(this.rotation){case 90:return[-s,i];case 180:return[s,i];case 270:return[s,-i];default:return[-s,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation;const[t,n]=this.pageDimensions;let{x:s,y:i,width:r,height:a}=this;if(r*=t,a*=n,s*=t,i*=n,this._mustFixPosition)switch(e){case 0:s=Math.max(0,Math.min(t-r,s)),i=Math.max(0,Math.min(n-a,i));break;case 90:s=Math.max(0,Math.min(t-a,s)),i=Math.min(n,Math.max(r,i));break;case 180:s=Math.min(t,Math.max(r,s)),i=Math.min(n,Math.max(a,i));break;case 270:s=Math.min(t,Math.max(a,s)),i=Math.max(0,Math.min(n-r,i))}this.x=s/=t,this.y=i/=n;const[o,l]=this.getBaseTranslation();s+=o,i+=l;const{style:c}=this.div;c.left="".concat((100*s).toFixed(2),"%"),c.top="".concat((100*i).toFixed(2),"%"),this.moveInDOM()}screenToPageTranslation(e,t){return $a.call(Ka,e,t,this.parentRotation)}pageTranslationToScreen(e,t){return $a.call(Ka,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){const[n,s]=this.parentDimensions;this.div.style.width="".concat((100*e/n).toFixed(2),"%"),Jt(Oa,this)||(this.div.style.height="".concat((100*t/s).toFixed(2),"%"))}fixDims(){const{style:e}=this.div,{height:t,width:n}=e,s=n.endsWith("%"),i=!Jt(Oa,this)&&t.endsWith("%");if(s&&i)return;const[r,a]=this.parentDimensions;s||(e.width="".concat((100*parseFloat(n)/r).toFixed(2),"%")),Jt(Oa,this)||i||(e.height="".concat((100*parseFloat(t)/a).toFixed(2),"%"))}getInitialTranslation(){return[0,0]}altTextFinish(){var e;null===(e=Jt(ja,this))||void 0===e||e.finish()}async addEditToolbar(){return this._editToolbar||Jt(Wa,this)||(this._editToolbar=new wi(this),this.div.append(this._editToolbar.render()),Jt(ja,this)&&await this._editToolbar.addAltText(Jt(ja,this))),this._editToolbar}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,null===(e=Jt(ja,this))||void 0===e||e.destroy())}addContainer(e){var t;const n=null===(t=this._editToolbar)||void 0===t?void 0:t.div;n?n.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){Jt(ja,this)||(Ca.initialize(Ka._l10n),Zt(ja,this,new Ca(this)),Jt(Ta,this)&&(Jt(ja,this).data=Jt(Ta,this),Zt(Ta,this,null)),await this.addEditToolbar())}get altTextData(){var e;return null===(e=Jt(ja,this))||void 0===e?void 0:e.data}set altTextData(e){Jt(ja,this)&&(Jt(ja,this).data=e)}get guessedAltText(){var e;return null===(e=Jt(ja,this))||void 0===e?void 0:e.guessedText}async setGuessedAltText(e){var t;await(null===(t=Jt(ja,this))||void 0===t?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return null===(t=Jt(ja,this))||void 0===t?void 0:t.serialize(e)}hasAltText(){return!!Jt(ja,this)&&!Jt(ja,this).isEmpty()}hasAltTextData(){var e,t;return null!==(e=null===(t=Jt(ja,this))||void 0===t?void 0:t.hasData())&&void 0!==e&&e}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=Jt(Pa,this)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),Qt(qa,this,ro).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth="".concat((100*t/e).toFixed(2),"%"),this.div.style.maxHeight="".concat((100*e/t).toFixed(2),"%"));const[n,s]=this.getInitialTranslation();return this.translate(n,s),Fi(this,this.div,["pointerdown"]),this.div}pointerdown(e){const{isMac:t}=js.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(Zt(Fa,this,!0),this._isDraggable?Qt(qa,this,io).call(this,e):Qt(qa,this,so).call(this,e))}get isSelected(){return this._uiManager.isSelected(this)}moveInDOM(){Jt(Ha,this)&&clearTimeout(Jt(Ha,this)),Zt(Ha,this,setTimeout(()=>{var e;Zt(Ha,this,null),null===(e=this.parent)||void 0===e||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition()}getRect(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation;const s=this.parentScale,[i,r]=this.pageDimensions,[a,o]=this.pageTranslation,l=e/s,c=t/s,h=this.x*i,u=this.y*r,d=this.width*i,f=this.height*r;switch(n){case 0:return[h+l+a,r-u-c-f+o,h+l+d+a,r-u-c+o];case 90:return[h+c+a,r-u+l+o,h+c+f+a,r-u+l+d+o];case 180:return[h-l-d+a,r-u+c+o,h-l+a,r-u+c+f+o];case 270:return[h-c-f+a,r-u-l-d+o,h-c+a,r-u-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,s,i,r]=e,a=i-n,o=r-s;switch(this.rotation){case 0:return[n,t-r,a,o];case 90:return[n,t-s,o,a];case 180:return[i,t-s,a,o];case 270:return[i,t-r,o,a];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Zt(Wa,this,!0)}disableEditMode(){Zt(Wa,this,!1)}isInEditMode(){return Jt(Wa,this)}shouldGetKeyboardEvents(){return Jt(Ba,this)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){Qt(qa,this,ro).call(this)}rotate(e){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:(null===(e=this._initialData)||void 0===e?void 0:e.popupRef)||""}}serialize(){gs("An editor must be serializable")}static async deserialize(e,t,n){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});s.rotation=e.rotation,Zt(Ta,s,e.accessibilityData);const[i,r]=s.pageDimensions,[a,o,l,c]=s.getRectInCurrentCoords(e.rect,r);return s.x=a/i,s.y=o/r,s.width=l/i,s.height=c/r,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){var e;if(null===(e=Jt(La,this))||void 0===e||e.abort(),Zt(La,this,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),Jt(Ha,this)&&(clearTimeout(Jt(Ha,this)),Zt(Ha,this,null)),Qt(qa,this,ho).call(this),this.removeEditToolbar(),Jt(Ga,this)){for(const e of Jt(Ga,this).values())clearTimeout(e);Zt(Ga,this,null)}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(Qt(qa,this,Za).call(this),Jt(Da,this).classList.remove("hidden"),Fi(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||"Enter"!==e.key)return;this._uiManager.setSelected(this),Zt(Na,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=Jt(Da,this).children;if(!Jt(Ma,this)){Zt(Ma,this,Array.from(t));const e=Qt(qa,this,ao).bind(this),n=Qt(qa,this,oo).bind(this),s=this._uiManager._signal;for(const t of Jt(Ma,this)){const i=t.getAttribute("data-resizer-name");t.setAttribute("role","spinbutton"),t.addEventListener("keydown",e,{signal:s}),t.addEventListener("blur",n,{signal:s}),t.addEventListener("focus",Qt(qa,this,lo).bind(this,i),{signal:s}),t.setAttribute("data-l10n-id",Ka._l10nResizer[i])}}const n=Jt(Ma,this)[0];let s=0;for(const r of t){if(r===n)break;s++}const i=(360-this.rotation+this.parentRotation)%360/90*(Jt(Ma,this).length/4);if(i!==s){if(i<s)for(let t=0;t<s-i;t++)Jt(Da,this).append(Jt(Da,this).firstChild);else if(i>s)for(let t=0;t<i-s;t++)Jt(Da,this).firstChild.before(Jt(Da,this).lastChild);let e=0;for(const n of t){const t=Jt(Ma,this)[e++].getAttribute("data-resizer-name");n.setAttribute("data-l10n-id",Ka._l10nResizer[t])}}Qt(qa,this,co).call(this,0),Zt(Ba,this,!0),Jt(Da,this).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){Jt(Ba,this)&&Qt(qa,this,no).call(this,Jt(Ra,this),{movementX:e,movementY:t})}_stopResizingWithKeyboard(){Qt(qa,this,ho).call(this),this.div.focus()}select(){var e,t,n;this.makeResizable(),null===(e=this.div)||void 0===e||e.classList.add("selectedEditor"),this._editToolbar?(null===(t=this._editToolbar)||void 0===t||t.show(),null===(n=Jt(ja,this))||void 0===n||n.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{var e,t;null!==(e=this.div)&&void 0!==e&&e.classList.contains("selectedEditor")&&(null===(t=this._editToolbar)||void 0===t||t.show())})}unselect(){var e,t,n,s,i;null===(e=Jt(Da,this))||void 0===e||e.classList.add("hidden"),null===(t=this.div)||void 0===t||t.classList.remove("selectedEditor"),null!==(n=this.div)&&void 0!==n&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),null===(s=this._editToolbar)||void 0===s||s.hide(),null===(i=Jt(ja,this))||void 0===i||i.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return Jt(za,this)}set isEditing(e){Zt(za,this,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){Zt(Oa,this,!0);const n=e/t,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){Jt(Ga,this)||Zt(Ga,this,new Map);const{action:t}=e;let n=Jt(Ga,this).get(t);return n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(e),Jt(Ga,this).delete(t),0===Jt(Ga,this).size&&Zt(Ga,this,null)},Ka._telemetryTimeout),void Jt(Ga,this).set(t,n)}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),Zt(Pa,this,!1)}disable(){this.div&&(this.div.tabIndex=-1),Zt(Pa,this,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(t){if("CANVAS"===t.nodeName){const e=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.before(t)}}else t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);return t}resetAnnotationElement(e){const{firstChild:t}=e.container;"DIV"===(null===t||void 0===t?void 0:t.nodeName)&&t.classList.contains("annotationContent")&&t.remove()}}function Qa(e,t,n){let[s,i]=e;[t,n]=this.screenToPageTranslation(t,n),this.x+=t/s,this.y+=n/i,this.fixAndSetPosition()}function $a(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}function Ja(e){switch(e){case 90:{const[e,t]=this.pageDimensions;return[0,-e/t,t/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,t]=this.pageDimensions;return[0,e/t,-t/e,0]}default:return[1,0,0,1]}}function Za(){if(Jt(Da,this))return;Zt(Da,this,document.createElement("div")),Jt(Da,this).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const e=document.createElement("div");Jt(Da,this).append(e),e.classList.add("resizer",n),e.setAttribute("data-resizer-name",n),e.addEventListener("pointerdown",Qt(qa,this,eo).bind(this,n),{signal:t}),e.addEventListener("contextmenu",ri,{signal:t}),e.tabIndex=-1}this.div.prepend(Jt(Da,this))}function eo(e,t){var n;t.preventDefault();const{isMac:s}=js.platform;if(0!==t.button||t.ctrlKey&&s)return;null===(n=Jt(ja,this))||void 0===n||n.toggle(!1);const i=this._isDraggable;this._isDraggable=!1;const r=new AbortController,a=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",Qt(qa,this,no).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("contextmenu",ri,{signal:a});const o=this.x,l=this.y,c=this.width,h=this.height,u=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const f=()=>{var e;r.abort(),this.parent.togglePointerEvents(!0),null===(e=Jt(ja,this))||void 0===e||e.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=u,this.div.style.cursor=d,Qt(qa,this,to).call(this,o,l,c,h)};window.addEventListener("pointerup",f,{signal:a}),window.addEventListener("blur",f,{signal:a})}function to(e,t,n,s){const i=this.x,r=this.y,a=this.width,o=this.height;i===e&&r===t&&a===n&&o===s||this.addCommands({cmd:()=>{this.width=a,this.height=o,this.x=i,this.y=r;const[e,t]=this.parentDimensions;this.setDims(e*a,t*o),this.fixAndSetPosition()},undo:()=>{this.width=n,this.height=s,this.x=e,this.y=t;const[i,r]=this.parentDimensions;this.setDims(i*n,r*s),this.fixAndSetPosition()},mustExec:!0})}function no(e,t){const[n,s]=this.parentDimensions,i=this.x,r=this.y,a=this.width,o=this.height,l=sn.MIN_SIZE/n,c=sn.MIN_SIZE/s,h=e=>Math.round(1e4*e)/1e4,u=Qt(qa,this,Ja).call(this,this.rotation),d=(e,t)=>[u[0]*e+u[2]*t,u[1]*e+u[3]*t],f=Qt(qa,this,Ja).call(this,360-this.rotation);let p,g,m=!1,v=!1;switch(e){case"topLeft":m=!0,p=(e,t)=>[0,0],g=(e,t)=>[e,t];break;case"topMiddle":p=(e,t)=>[e/2,0],g=(e,t)=>[e/2,t];break;case"topRight":m=!0,p=(e,t)=>[e,0],g=(e,t)=>[0,t];break;case"middleRight":v=!0,p=(e,t)=>[e,t/2],g=(e,t)=>[0,t/2];break;case"bottomRight":m=!0,p=(e,t)=>[e,t],g=(e,t)=>[0,0];break;case"bottomMiddle":p=(e,t)=>[e/2,t],g=(e,t)=>[e/2,0];break;case"bottomLeft":m=!0,p=(e,t)=>[0,t],g=(e,t)=>[e,0];break;case"middleLeft":v=!0,p=(e,t)=>[0,t/2],g=(e,t)=>[e,t/2]}const y=p(a,o),b=g(a,o);let x=d(...b);const w=h(i+x[0]),S=h(r+x[1]);let _=1,C=1,[k,A]=this.screenToPageTranslation(t.movementX,t.movementY);if([k,A]=((e,t)=>[f[0]*e+f[2]*t,f[1]*e+f[3]*t])(k/n,A/s),m){const e=Math.hypot(a,o);_=C=Math.max(Math.min(Math.hypot(b[0]-y[0]-k,b[1]-y[1]-A)/e,1/a,1/o),l/a,c/o)}else v?_=Math.max(l,Math.min(1,Math.abs(b[0]-y[0]-k)))/a:C=Math.max(c,Math.min(1,Math.abs(b[1]-y[1]-A)))/o;const E=h(a*_),T=h(o*C);x=d(...g(E,T));const M=w-x[0],j=S-x[1];this.width=E,this.height=T,this.x=M,this.y=j,this.setDims(n*E,s*T),this.fixAndSetPosition()}function so(e){const{isMac:t}=js.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}function io(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();const n=new AbortController,s=this._uiManager.combinedSignal(n);if(t){this.div.classList.add("moving"),Zt(Ua,this,e.clientX),Zt(Va,this,e.clientY);const t=e=>{const{clientX:t,clientY:n}=e,[s,i]=this.screenToPageTranslation(t-Jt(Ua,this),n-Jt(Va,this));Zt(Ua,this,t),Zt(Va,this,n),this._uiManager.dragSelectedEditors(s,i)};window.addEventListener("pointermove",t,{passive:!0,capture:!0,signal:s})}const i=()=>{n.abort(),t&&this.div.classList.remove("moving"),Zt(Fa,this,!1),this._uiManager.endDragSession()||Qt(qa,this,so).call(this,e)};window.addEventListener("pointerup",i,{signal:s}),window.addEventListener("blur",i,{signal:s})}function ro(){if(Jt(La,this)||!this.div)return;Zt(La,this,new AbortController);const e=this._uiManager.combinedSignal(Jt(La,this));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}function ao(e){sn._resizerKeyboardManager.exec(this,e)}function oo(e){var t;Jt(Ba,this)&&(null===(t=e.relatedTarget)||void 0===t?void 0:t.parentNode)!==Jt(Da,this)&&Qt(qa,this,ho).call(this)}function lo(e){Zt(Ra,this,Jt(Ba,this)?e:"")}function co(e){if(Jt(Ma,this))for(const t of Jt(Ma,this))t.tabIndex=e}function ho(){if(Zt(Ba,this,!1),Qt(qa,this,co).call(this,-1),Jt(Na,this)){const{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=Jt(Na,this);Qt(qa,this,to).call(this,e,t,n,s),Zt(Na,this,null)}}sn=Ka,o(Ka,"_l10n",null),o(Ka,"_l10nResizer",null),o(Ka,"_borderLineWidth",-1),o(Ka,"_colorManager",new er),o(Ka,"_zIndex",1),o(Ka,"_telemetryTimeout",1e3);class uo extends Ka{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const fo=3285377520,po=4294901760,go=65535;class mo{constructor(e){this.h1=e?4294967295&e:fo,this.h2=e?4294967295&e:fo}update(e){let t,n;if("string"===typeof e){t=new Uint8Array(2*e.length),n=0;for(let s=0,i=e.length;s<i;s++){const i=e.charCodeAt(s);i<=255?t[n++]=i:(t[n++]=i>>>8,t[n++]=255&i)}}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid data format, must be a string or TypedArray.");t=e.slice(),n=t.byteLength}const s=n>>2,i=n-4*s,r=new Uint32Array(t.buffer,0,s);let a=0,o=0,l=this.h1,c=this.h2;const h=3432918353,u=461845907,d=11601,f=13715;for(let p=0;p<s;p++)1&p?(a=r[p],a=a*h&po|a*d&go,a=a<<15|a>>>17,a=a*u&po|a*f&go,l^=a,l=l<<13|l>>>19,l=5*l+3864292196):(o=r[p],o=o*h&po|o*d&go,o=o<<15|o>>>17,o=o*u&po|o*f&go,c^=o,c=c<<13|c>>>19,c=5*c+3864292196);switch(a=0,i){case 3:a^=t[4*s+2]<<16;case 2:a^=t[4*s+1]<<8;case 1:a^=t[4*s],a=a*h&po|a*d&go,a=a<<15|a>>>17,a=a*u&po|a*f&go,1&s?l^=a:c^=a}this.h1=l,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&po|36045*e&go,t=4283543511*t&po|(2950163797*(t<<16|e>>>16)&po)>>>16,e^=t>>>1,e=444984403*e&po|60499*e&go,t=3301882366*t&po|(3120437893*(t<<16|e>>>16)&po)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const vo=Object.freeze({map:null,hash:"",transfer:void 0});var yo=new WeakMap,bo=new WeakMap,xo=new WeakMap,wo=new WeakSet;class So{constructor(){qt(this,wo),Kt(this,yo,!1),Kt(this,bo,null),Kt(this,xo,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=Jt(xo,this).get(e);return void 0===n?t:Object.assign(t,n)}getRawValue(e){return Jt(xo,this).get(e)}remove(e){if(Jt(xo,this).delete(e),0===Jt(xo,this).size&&this.resetModified(),"function"===typeof this.onAnnotationEditor){for(const e of Jt(xo,this).values())if(e instanceof Ka)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=Jt(xo,this).get(e);let s=!1;if(void 0!==n)for(const[i,r]of Object.entries(t))n[i]!==r&&(s=!0,n[i]=r);else s=!0,Jt(xo,this).set(e,t);s&&Qt(wo,this,_o).call(this),t instanceof Ka&&"function"===typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}has(e){return Jt(xo,this).has(e)}getAll(){return Jt(xo,this).size>0?Ms(Jt(xo,this)):null}setAll(e){for(const[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return Jt(xo,this).size}resetModified(){Jt(yo,this)&&(Zt(yo,this,!1),"function"===typeof this.onResetModified&&this.onResetModified())}get print(){return new ko(this)}get serializable(){if(0===Jt(xo,this).size)return vo;const e=new Map,t=new mo,n=[],s=Object.create(null);let i=!1;for(const[r,a]of Jt(xo,this)){const n=a instanceof Ka?a.serialize(!1,s):a;n&&(e.set(r,n),t.update("".concat(r,":").concat(JSON.stringify(n))),i||(i=!!n.bitmap))}if(i)for(const r of e.values())r.bitmap&&n.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:vo}get editorStats(){let e=null;const t=new Map;for(const i of Jt(xo,this).values()){var n;if(!(i instanceof Ka))continue;const r=i.telemetryFinalData;if(!r)continue;const{type:a}=r;t.has(a)||t.set(a,Object.getPrototypeOf(i).constructor),e||(e=Object.create(null));const o=(n=e)[a]||(n[a]=new Map);for(const[e,t]of Object.entries(r)){var s;if("type"===e)continue;let n=o.get(e);n||(n=new Map,o.set(e,n));const i=null!==(s=n.get(t))&&void 0!==s?s:0;n.set(t,i+1)}}for(const[i,r]of t)e[i]=r.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){Zt(bo,this,null)}get modifiedIds(){if(Jt(bo,this))return Jt(bo,this);const e=[];for(const t of Jt(xo,this).values())t instanceof Ka&&t.annotationElementId&&t.serialize()&&e.push(t.annotationElementId);return Zt(bo,this,{ids:new Set(e),hash:e.join(",")})}}function _o(){Jt(yo,this)||(Zt(yo,this,!0),"function"===typeof this.onSetModified&&this.onSetModified())}var Co=new WeakMap;class ko extends So{constructor(e){super(),Kt(this,Co,void 0);const{map:t,hash:n,transfer:s}=e.serializable,i=structuredClone(t,s?{transfer:s}:null);Zt(Co,this,{map:i,hash:n,transfer:s})}get print(){gs("Should not call PrintAnnotationStorage.print")}get serializable(){return Jt(Co,this)}get modifiedIds(){return ys(this,"modifiedIds",{ids:new Set,hash:""})}}var Ao=new WeakMap;class Eo{constructor(e){let{ownerDocument:t=globalThis.document,styleElement:n=null}=e;Kt(this,Ao,new Set),this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),Jt(Ao,this).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(e){let{systemFontInfo:t,_inspectFont:n}=e;if(t&&!Jt(Ao,this).has(t.loadedName)){if(ms(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:e,src:i,style:r}=t,a=new FontFace(e,i,r);this.addNativeFontFace(a);try{await a.load(),Jt(Ao,this).add(e),null===n||void 0===n||n(t)}catch(s){ps("Cannot load system font: ".concat(t.baseFontName,", installing it could help to improve PDF rendering.")),this.removeNativeFontFace(a)}return}gs("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void await this.loadSystemFont(e);if(this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(n){throw ps("Failed to load font '".concat(t.family,"': '").concat(n,"'.")),e.disableFontFace=!0,n}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(t=>{const n=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,n)})}}get isFontLoadingAPISupported(){var e;return ys(this,"isFontLoadingAPISupported",!(null===(e=this._document)||void 0===e||!e.fonts))}get isSyncFontLoadingSupported(){var e;let t=!1;return(gn||"undefined"!==typeof navigator&&"string"===typeof(null===(e=navigator)||void 0===e?void 0:e.userAgent)&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),ys(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(e){const{loadingRequests:t}=this,n={done:!1,complete:function(){for(ms(!n.done,"completeRequest() cannot be called twice."),n.done=!0;t.length>0&&t[0].done;){const e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(n),n}get _loadTestFont(){return ys(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t){function n(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function s(e,t,n,s){return e.substring(0,t)+s+e.substring(t+n)}let i,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const o=a.getContext("2d");let l=0;const c="lt".concat(Date.now()).concat(this.loadTestFontId++);let h=this._loadTestFont;h=s(h,976,c.length,c);const u=1482184792;let d=n(h,16);for(i=0,r=c.length-3;i<r;i+=4)d=d-u+n(c,i)|0;var f;i<c.length&&(d=d-u+n(c+"XXX",i)|0),h=s(h,16,4,(f=d,String.fromCharCode(f>>24&255,f>>16&255,f>>8&255,255&f)));const p="url(data:font/opentype;base64,".concat(btoa(h),");"),g='@font-face {font-family:"'.concat(c,'";src:').concat(p,"}");this.insertRule(g);const m=this._document.createElement("div");m.style.visibility="hidden",m.style.width=m.style.height="10px",m.style.position="absolute",m.style.top=m.style.left="0px";for(const v of[e.loadedName,c]){const e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=v,m.append(e)}this._document.body.append(m),function e(t,n){if(++l>30)return ps("Load test font never loaded."),void n();o.font="30px "+t,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0?n():setTimeout(e.bind(null,t,n))}(c,()=>{m.remove(),t.complete()})}}class To{constructor(e,t){let{disableFontFace:n=!1,inspectFont:s=null}=t;this.compiledGlyphs=Object.create(null);for(const i in e)this[i]=e[i];this.disableFontFace=!0===n,this._inspectFont=s}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(this.cssFontInfo){const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg")),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}else t=new FontFace(this.loadedName,this.data,{});return null===(e=this._inspectFont)||void 0===e||e.call(this,this),t}createFontFaceRule(){var e;if(!this.data||this.disableFontFace)return null;const t="url(data:".concat(this.mimetype,";base64,").concat((n=this.data,Uint8Array.prototype.toBase64?n.toBase64():btoa(Es(n))),");");var n;let s;if(this.cssFontInfo){let e="font-weight: ".concat(this.cssFontInfo.fontWeight,";");this.cssFontInfo.italicAngle&&(e+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;")),s='@font-face {font-family:"'.concat(this.cssFontInfo.fontFamily,'";').concat(e,"src:").concat(t,"}")}else s='@font-face {font-family:"'.concat(this.loadedName,'";src:').concat(t,"}");return null===(e=this._inspectFont)||void 0===e||e.call(this,this,t),s}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let n;try{n=e.get(this.loadedName+"_path_"+t)}catch(i){ps('getPathGenerator - ignoring character: "'.concat(i,'".'))}if(!Array.isArray(n)||0===n.length)return this.compiledGlyphs[t]=function(e,t){};const s=[];for(let r=0,a=n.length;r<a;)switch(n[r++]){case zs:{const[e,t,i,a,o,l]=n.slice(r,r+6);s.push(n=>n.bezierCurveTo(e,t,i,a,o,l)),r+=6}break;case Ws:{const[e,t]=n.slice(r,r+2);s.push(n=>n.moveTo(e,t)),r+=2}break;case Bs:{const[e,t]=n.slice(r,r+2);s.push(n=>n.lineTo(e,t)),r+=2}break;case Hs:{const[e,t,i,a]=n.slice(r,r+4);s.push(n=>n.quadraticCurveTo(e,t,i,a)),r+=4}break;case Us:s.push(e=>e.restore());break;case Vs:s.push(e=>e.save());break;case Gs:ms(2===s.length,"Scale command is only valid at the third position.");break;case Xs:{const[e,t,i,a,o,l]=n.slice(r,r+6);s.push(n=>n.transform(e,t,i,a,o,l)),r+=6}break;case Ys:{const[e,t]=n.slice(r,r+2);s.push(n=>n.translate(e,t)),r+=2}}return this.compiledGlyphs[t]=function(e,t){s[0](e),s[1](e),e.scale(t,-t);for(let n=2,i=s.length;n<i;n++)s[n](e)}}}var Mo=new WeakMap;class jo{constructor(e){let{enableHWA:t=!1}=e;Kt(this,Mo,!1),Zt(Mo,this,t)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!Jt(Mo,this)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){gs("Abstract method `_createCanvas` called.")}}class Po{constructor(e){let{baseUrl:t=null,isCompressed:n=!0}=e;this.baseUrl=t,this.isCompressed=n}async fetch(e){let{name:t}=e;if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const n=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(n).then(e=>({cMapData:e,isCompressed:this.isCompressed})).catch(e=>{throw new Error("Unable to load ".concat(this.isCompressed?"binary ":"","CMap at: ").concat(n))})}async _fetch(e){gs("Abstract method `_fetch` called.")}}class Oo extends Po{async _fetch(e){const t=await Qs(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Ts(t)}}class Do{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,i){return"none"}destroy(){}}var No=new WeakMap,Lo=new WeakMap,Ro=new WeakMap,Fo=new WeakMap,Io=new WeakMap,zo=new WeakMap,Wo=new WeakMap,Bo=new WeakSet;function Ho(e){return Jt(Lo,e)||Zt(Lo,e,new Map)}function Uo(e){return Jt(zo,e)||Zt(zo,e,new Map)}function Vo(e){if(!Jt(Ro,e)){const t=Jt(Io,e).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const s=Jt(Io,e).createElementNS(qs,"svg");s.setAttribute("width",0),s.setAttribute("height",0),Zt(Ro,e,Jt(Io,e).createElementNS(qs,"defs")),t.append(s),s.append(Jt(Ro,e)),Jt(Io,e).body.append(t)}return Jt(Ro,e)}function Go(e){if(1===e.length){const t=e[0],n=new Array(256);for(let e=0;e<256;e++)n[e]=t[e]/255;const s=n.join(",");return[s,s,s]}const[t,n,s]=e,i=new Array(256),r=new Array(256),a=new Array(256);for(let o=0;o<256;o++)i[o]=t[o]/255,r[o]=n[o]/255,a[o]=s[o]/255;return[i.join(","),r.join(","),a.join(",")]}function Xo(e){if(void 0===Jt(No,this)){Zt(No,this,"");const e=Jt(Io,this).URL;e!==Jt(Io,this).baseURI&&(Zs(e)?ps('#createUrl: ignore "data:"-URL for performance reasons.'):Zt(No,this,e.split("#",1)[0]))}return"url(".concat(Jt(No,this),"#").concat(e,")")}function Yo(e){const t=Jt(Io,this).createElementNS(qs,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}function qo(e){const t=Jt(Io,this).createElementNS(qs,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}function Ko(e){const t=Jt(Io,this).createElementNS(qs,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),$t(Bo,this,Vo).append(t),t}function Qo(e,t,n){const s=Jt(Io,this).createElementNS(qs,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",n),e.append(s)}function $o(e,t,n,s){const i=Jt(Io,this).createElementNS(qs,"feComponentTransfer");s.append(i),Qt(Bo,this,Qo).call(this,i,"feFuncR",e),Qt(Bo,this,Qo).call(this,i,"feFuncG",t),Qt(Bo,this,Qo).call(this,i,"feFuncB",n)}function Jo(e,t){const n=Jt(Io,this).createElementNS(qs,"feComponentTransfer");t.append(n),Qt(Bo,this,Qo).call(this,n,"feFuncA",e)}function Zo(e){return $t(Bo,this,Vo).style.color=e,hi(getComputedStyle($t(Bo,this,Vo)).getPropertyValue("color"))}class el{constructor(e){let{baseUrl:t=null}=e;this.baseUrl=t}async fetch(e){let{filename:t}=e;if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const n="".concat(this.baseUrl).concat(t);return this._fetch(n).catch(e=>{throw new Error("Unable to load font data at: ".concat(n))})}async _fetch(e){gs("Abstract method `_fetch` called.")}}class tl extends el{async _fetch(e){const t=await Qs(e,"arraybuffer");return new Uint8Array(t)}}if(gn){var nl=Promise.withResolvers(),sl=null;const e=async()=>{const e=await import("fs"),t=await import("http"),n=await import("https"),s=await import("url");return new Map(Object.entries({fs:e,http:t,https:n,url:s,canvas:undefined,path2d:undefined}))};e().then(e=>{sl=e,nl.resolve()},e=>{ps("loadPackages: ".concat(e)),sl=new Map,nl.resolve()})}class il{static get promise(){return nl.promise}static get(e){var t;return null===(t=sl)||void 0===t?void 0:t.get(e)}}async function rl(e){const t=il.get("fs"),n=await t.promises.readFile(e);return new Uint8Array(n)}const al="Fill",ol="Stroke",ll="Shading";function cl(e,t){if(!t)return;const n=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],n,s),e.clip(i)}class hl{getPattern(){gs("Abstract method `getPattern` called.")}}class ul extends hl{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let i;if(s===ol||s===al){const r=t.current.getClippedPathBoundingBox(s,ui(e))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=t.cachedCanvases.getCanvas("pattern",a,o),c=l.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),n=Os.transform(n,[1,0,0,1,r[0],r[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),cl(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),i=e.createPattern(l.canvas,"no-repeat");const h=new DOMMatrix(n);i.setTransform(h)}else cl(e,this._bbox),i=this._createGradient(e);return i}}function dl(e,t,n,s,i,r,a,o){const l=t.coords,c=t.colors,h=e.data,u=4*e.width;let d;l[n+1]>l[s+1]&&(d=n,n=s,s=d,d=r,r=a,a=d),l[s+1]>l[i+1]&&(d=s,s=i,i=d,d=a,a=o,o=d),l[n+1]>l[s+1]&&(d=n,n=s,s=d,d=r,r=a,a=d);const f=(l[n]+t.offsetX)*t.scaleX,p=(l[n+1]+t.offsetY)*t.scaleY,g=(l[s]+t.offsetX)*t.scaleX,m=(l[s+1]+t.offsetY)*t.scaleY,v=(l[i]+t.offsetX)*t.scaleX,y=(l[i+1]+t.offsetY)*t.scaleY;if(p>=y)return;const b=c[r],x=c[r+1],w=c[r+2],S=c[a],_=c[a+1],C=c[a+2],k=c[o],A=c[o+1],E=c[o+2],T=Math.round(p),M=Math.round(y);let j,P,O,D,N,L,R,F;for(let I=T;I<=M;I++){if(I<m){const e=I<p?0:(p-I)/(p-m);j=f-(f-g)*e,P=b-(b-S)*e,O=x-(x-_)*e,D=w-(w-C)*e}else{let e;e=I>y?1:m===y?0:(m-I)/(m-y),j=g-(g-v)*e,P=S-(S-k)*e,O=_-(_-A)*e,D=C-(C-E)*e}let e;e=I<p?0:I>y?1:(p-I)/(p-y),N=f-(f-v)*e,L=b-(b-k)*e,R=x-(x-A)*e,F=w-(w-E)*e;const t=Math.round(Math.min(j,N)),n=Math.round(Math.max(j,N));let s=u*I+4*t;for(let i=t;i<=n;i++)e=(j-i)/(j-N),e<0?e=0:e>1&&(e=1),h[s++]=P-(P-L)*e|0,h[s++]=O-(O-R)*e|0,h[s++]=D-(D-F)*e|0,h[s++]=255}}function fl(e,t,n){const s=t.coords,i=t.colors;let r,a;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(s.length/o)-1,c=o-1;for(r=0;r<l;r++){let t=r*o;for(let r=0;r<c;r++,t++)dl(e,n,s[t],s[t+1],s[t+o],i[t],i[t+1],i[t+o]),dl(e,n,s[t+o+1],s[t+1],s[t+o],i[t+o+1],i[t+1],i[t+o])}break;case"triangles":for(r=0,a=s.length;r<a;r+=3)dl(e,n,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class pl extends hl{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){const s=Math.floor(this._bounds[0]),i=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-s,a=Math.ceil(this._bounds[3])-i,o=Math.min(Math.ceil(Math.abs(r*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(a*e[1]*1.1)),3e3),c=r/o,h=a/l,u={coords:this._coords,colors:this._colors,offsetX:-s,offsetY:-i,scaleX:1/c,scaleY:1/h},d=o+4,f=l+4,p=n.getCanvas("mesh",d,f),g=p.context,m=g.createImageData(o,l);if(t){const e=m.data;for(let n=0,s=e.length;n<s;n+=4)e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=255}for(const v of this._figures)fl(m,v,u);g.putImageData(m,2,2);return{canvas:p.canvas,offsetX:s-2*c,offsetY:i-2*h,scaleX:c,scaleY:h}}getPattern(e,t,n,s){let i;if(cl(e,this._bbox),s===ll)i=Os.singularValueDecompose2dScale(ui(e));else if(i=Os.singularValueDecompose2dScale(t.baseTransform),this.matrix){const e=Os.singularValueDecompose2dScale(this.matrix);i=[i[0]*e[0],i[1]*e[1]]}const r=this._createMeshCanvas(i,s===ll?null:this._background,t.cachedCanvases);return s!==ll&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}}class gl extends hl{getPattern(){return"hotpink"}}const ml=1,vl=2;class yl{constructor(e,t,n,s,i){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e){const{bbox:t,operatorList:n,paintType:s,tilingType:i,color:r,canvasGraphicsFactory:a}=this;let{xstep:o,ystep:l}=this;o=Math.abs(o),l=Math.abs(l),fs("TilingType: "+i);const c=t[0],h=t[1],u=t[2],d=t[3],f=u-c,p=d-h,g=Os.singularValueDecompose2dScale(this.matrix),m=Os.singularValueDecompose2dScale(this.baseTransform),v=g[0]*m[0],y=g[1]*m[1];let b=f,x=p,w=!1,S=!1;const _=Math.ceil(o*v),C=Math.ceil(l*y);_>=Math.ceil(f*v)?b=o:w=!0,C>=Math.ceil(p*y)?x=l:S=!0;const k=this.getSizeAndScale(b,this.ctx.canvas.width,v),A=this.getSizeAndScale(x,this.ctx.canvas.height,y),E=e.cachedCanvases.getCanvas("pattern",k.size,A.size),T=E.context,M=a.createCanvasGraphics(T);if(M.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(M,s,r),T.translate(-k.scale*c,-A.scale*h),M.transform(k.scale,0,0,A.scale,0,0),T.save(),this.clipBbox(M,c,h,u,d),M.baseTransform=ui(M.ctx),M.executeOperatorList(n),M.endDrawing(),T.restore(),w||S){const t=E.canvas;w&&(b=o),S&&(x=l);const n=this.getSizeAndScale(b,this.ctx.canvas.width,v),s=this.getSizeAndScale(x,this.ctx.canvas.height,y),i=n.size,r=s.size,a=e.cachedCanvases.getCanvas("pattern-workaround",i,r),u=a.context,d=w?Math.floor(f/o):0,g=S?Math.floor(p/l):0;for(let e=0;e<=d;e++)for(let n=0;n<=g;n++)u.drawImage(t,i*e,r*n,i,r,0,0,i,r);return{canvas:a.canvas,scaleX:n.scale,scaleY:s.scale,offsetX:c,offsetY:h}}return{canvas:E.canvas,scaleX:k.scale,scaleY:A.scale,offsetX:c,offsetY:h}}getSizeAndScale(e,t,n){const s=Math.max(yl.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*n);return i>=s?i=s:n=i/e,{scale:n,size:i}}clipBbox(e,t,n,s,i){const r=s-t,a=i-n;e.ctx.rect(t,n,r,a),e.current.updateRectMinMax(ui(e.ctx),[t,n,s,i]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const s=e.ctx,i=e.current;switch(t){case ml:const e=this.ctx;s.fillStyle=e.fillStyle,s.strokeStyle=e.strokeStyle,i.fillColor=e.fillStyle,i.strokeColor=e.strokeStyle;break;case vl:const r=Os.makeHexColor(n[0],n[1],n[2]);s.fillStyle=r,s.strokeStyle=r,i.fillColor=r,i.strokeColor=r;break;default:throw new ks("Unsupported paint type: ".concat(t))}}getPattern(e,t,n,s){let i=n;s!==ll&&(i=Os.transform(i,t.baseTransform),this.matrix&&(i=Os.transform(i,this.matrix)));const r=this.createPatternCanvas(t);let a=new DOMMatrix(i);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);const o=e.createPattern(r.canvas,"repeat");return o.setTransform(a),o}}function bl(e){let{src:t,srcPos:n=0,dest:s,width:i,height:r,nonBlackColor:a=4294967295,inverseDecode:o=!1}=e;const l=js.isLittleEndian?4278190080:255,[c,h]=o?[a,l]:[l,a],u=i>>3,d=7&i,f=t.length;s=new Uint32Array(s.buffer);let p=0;for(let g=0;g<r;g++){for(const i=n+u;n<i;n++){const e=n<f?t[n]:255;s[p++]=128&e?h:c,s[p++]=64&e?h:c,s[p++]=32&e?h:c,s[p++]=16&e?h:c,s[p++]=8&e?h:c,s[p++]=4&e?h:c,s[p++]=2&e?h:c,s[p++]=1&e?h:c}if(0===d)continue;const e=n<f?t[n++]:255;for(let t=0;t<d;t++)s[p++]=e&1<<7-t?h:c}return{srcPos:n,destPos:p}}o(yl,"MAX_PATTERN_SIZE",3e3);const xl=16;class wl{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return void 0!==this.cache[e]?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Sl(e,t,n,s,i,r,a,o,l,c){const[h,u,d,f,p,g]=ui(e);if(0===u&&0===d){const m=a*h+p,v=Math.round(m),y=o*f+g,b=Math.round(y),x=(a+l)*h+p,w=Math.abs(Math.round(x)-v)||1,S=(o+c)*f+g,_=Math.abs(Math.round(S)-b)||1;return e.setTransform(Math.sign(h),0,0,Math.sign(f),v,b),e.drawImage(t,n,s,i,r,0,0,w,_),e.setTransform(h,u,d,f,p,g),[w,_]}if(0===h&&0===f){const m=o*d+p,v=Math.round(m),y=a*u+g,b=Math.round(y),x=(o+c)*d+p,w=Math.abs(Math.round(x)-v)||1,S=(a+l)*u+g,_=Math.abs(Math.round(S)-b)||1;return e.setTransform(0,Math.sign(u),Math.sign(d),0,v,b),e.drawImage(t,n,s,i,r,0,0,_,w),e.setTransform(h,u,d,f,p,g),[_,w]}e.drawImage(t,n,s,i,r,a,o,l,c);return[Math.hypot(h,u)*l,Math.hypot(d,f)*c]}class _l{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=mn,this.textMatrixScale=1,this.fontMatrix=vn,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Pn,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=Os.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){const n=Os.applyTransform(t,e),s=Os.applyTransform(t.slice(2),e),i=Os.applyTransform([t[0],t[3]],e),r=Os.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],s[0],i[0],r[0]),this.minY=Math.min(this.minY,n[1],s[1],i[1],r[1]),this.maxX=Math.max(this.maxX,n[0],s[0],i[0],r[0]),this.maxY=Math.max(this.maxY,n[1],s[1],i[1],r[1])}updateScalingPathMinMax(e,t){Os.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,s,i,r,a,o,l,c){const h=Os.bezierBoundingBox(t,n,s,i,r,a,o,l,c);c||this.updateRectMinMax(e,h)}getPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:al,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[this.minX,this.minY,this.maxX,this.maxY];if(e===ol){t||gs("Stroke bounding box must include transform.");const e=Os.singularValueDecompose2dScale(t),s=e[0]*this.lineWidth/2,i=e[1]*this.lineWidth/2;n[0]-=s,n[1]-=i,n[2]+=s,n[3]+=i}return n}updateClipFromPath(){const e=Os.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:al,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Os.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Cl(e,t){if("undefined"!==typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);const n=t.height,s=t.width,i=n%xl,r=(n-i)/xl,a=0===i?r:r+1,o=e.createImageData(s,xl);let l,c=0;const h=t.data,u=o.data;let d,f,p,g;if(t.kind===Fn.GRAYSCALE_1BPP){const t=h.byteLength,n=new Uint32Array(u.buffer,0,u.byteLength>>2),g=n.length,m=s+7>>3,v=4294967295,y=js.isLittleEndian?4278190080:255;for(d=0;d<a;d++){for(p=d<r?xl:i,l=0,f=0;f<p;f++){const e=t-c;let i=0;const r=e>m?s:8*e-7,a=-8&r;let o=0,u=0;for(;i<a;i+=8)u=h[c++],n[l++]=128&u?v:y,n[l++]=64&u?v:y,n[l++]=32&u?v:y,n[l++]=16&u?v:y,n[l++]=8&u?v:y,n[l++]=4&u?v:y,n[l++]=2&u?v:y,n[l++]=1&u?v:y;for(;i<r;i++)0===o&&(u=h[c++],o=128),n[l++]=u&o?v:y,o>>=1}for(;l<g;)n[l++]=0;e.putImageData(o,0,d*xl)}}else if(t.kind===Fn.RGBA_32BPP){for(f=0,g=s*xl*4,d=0;d<r;d++)u.set(h.subarray(c,c+g)),c+=g,e.putImageData(o,0,f),f+=xl;d<a&&(g=s*i*4,u.set(h.subarray(c,c+g)),e.putImageData(o,0,f))}else{if(t.kind!==Fn.RGB_24BPP)throw new Error("bad image kind: ".concat(t.kind));for(p=xl,g=s*p,d=0;d<a;d++){for(d>=r&&(p=i,g=s*p),l=0,f=g;f--;)u[l++]=h[c++],u[l++]=h[c++],u[l++]=h[c++],u[l++]=255;e.putImageData(o,0,d*xl)}}}function kl(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);const n=t.height,s=t.width,i=n%xl,r=(n-i)/xl,a=0===i?r:r+1,o=e.createImageData(s,xl);let l=0;const c=t.data,h=o.data;for(let u=0;u<a;u++){const t=u<r?xl:i;({srcPos:l}=bl({src:c,srcPos:l,dest:h,width:s,height:t,nonBlackColor:0})),e.putImageData(o,0,u*xl)}}function Al(e,t){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of n)void 0!==e[s]&&(t[s]=e[s]);void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function El(e){if(e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0),!gn){const{filter:t}=e;"none"!==t&&""!==t&&(e.filter="none")}}function Tl(e,t){if(t)return!0;const n=Os.singularValueDecompose2dScale(e);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*Ks.PDF_TO_CSS_UNITS);return n[0]<=s&&n[1]<=s}const Ml=["butt","round","square"],jl=["miter","round","bevel"],Pl={},Ol={};var Dl=new WeakSet;class Nl{constructor(e,t,n,s,i,r,a,o){let{optionalContentConfig:l,markedContentStack:c=null}=r;qt(this,Dl),this.ctx=e,this.current=new _l(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=i,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=l,this.cachedCanvases=new wl(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=o,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"===typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing(e){let{transform:t,viewport:n,transparency:s=!1,background:i=null}=e;const r=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=o,s){const e=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...ui(this.compositeCtx))}this.ctx.save(),El(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=ui(this.ctx)}executeOperatorList(e,t,n,s){const i=e.argsArray,r=e.fnArray;let a=t||0;const o=i.length;if(o===a)return a;const l=o-a>10&&"function"===typeof n,c=l?Date.now()+15:0;let h=0;const u=this.commonObjs,d=this.objs;let f;for(;;){if(void 0!==s&&a===s.nextBreakPoint)return s.breakIt(a,n),a;if(f=r[a],f!==ls.dependency)this[f].apply(this,i[a]);else for(const e of i[a]){const t=e.startsWith("g_")?u:d;if(!t.has(e))return t.get(e,n),a}if(a++,a===o)return a;if(l&&++h>10){if(Date.now()>c)return n(),a;h=0}}}endDrawing(){Qt(Dl,this,Ll).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),Qt(Dl,this,Rl).call(this)}_scaleImage(e,t){var n,s;const i=null!==(n=e.width)&&void 0!==n?n:e.displayWidth,r=null!==(s=e.height)&&void 0!==s?s:e.displayHeight;let a,o,l=Math.max(Math.hypot(t[0],t[1]),1),c=Math.max(Math.hypot(t[2],t[3]),1),h=i,u=r,d="prescale1";for(;l>2&&h>1||c>2&&u>1;){let t=h,n=u;l>2&&h>1&&(t=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2),l/=h/t),c>2&&u>1&&(n=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u)/2,c/=u/n),a=this.cachedCanvases.getCanvas(d,t,n),o=a.context,o.clearRect(0,0,t,n),o.drawImage(e,0,0,h,u,0,0,t,n),e=a.canvas,h=t,u=n,d="prescale1"===d?"prescale2":"prescale1"}return{img:e,paintWidth:h,paintHeight:u}}_createMaskCanvas(e){const t=this.ctx,{width:n,height:s}=e,i=this.current.fillColor,r=this.current.patternFill,a=ui(t);let o,l,c,h;if((e.bitmap||e.data)&&e.count>1){const t=e.bitmap||e.data.buffer;l=JSON.stringify(r?a:[a.slice(0,4),i]),o=this._cachedBitmapsMap.get(t),o||(o=new Map,this._cachedBitmapsMap.set(t,o));const n=o.get(l);if(n&&!r){return{canvas:n,offsetX:Math.round(Math.min(a[0],a[2])+a[4]),offsetY:Math.round(Math.min(a[1],a[3])+a[5])}}c=n}c||(h=this.cachedCanvases.getCanvas("maskCanvas",n,s),kl(h.context,e));let u=Os.transform(a,[1/n,0,0,-1/s,0,0]);u=Os.transform(u,[1,0,0,1,0,-s]);const[d,f,p,g]=Os.getAxialAlignedBoundingBox([0,0,n,s],u),m=Math.round(p-d)||1,v=Math.round(g-f)||1,y=this.cachedCanvases.getCanvas("fillCanvas",m,v),b=y.context,x=d,w=f;b.translate(-x,-w),b.transform(...u),c||(c=this._scaleImage(h.canvas,di(b)),c=c.img,o&&r&&o.set(l,c)),b.imageSmoothingEnabled=Tl(ui(b),e.interpolate),Sl(b,c,0,0,c.width,c.height,0,0,n,s),b.globalCompositeOperation="source-in";const S=Os.transform(di(b),[1,0,0,1,-x,-w]);return b.fillStyle=r?i.getPattern(t,this,S,al):i,b.fillRect(0,0,n,s),o&&!r&&(this.cachedCanvases.delete("fillCanvas"),o.set(l,y.canvas)),{canvas:y.canvas,offsetX:Math.round(x),offsetY:Math.round(w)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=Ml[e]}setLineJoin(e){this.ctx.lineJoin=jl[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;const i=this.ctx;i.setTransform(...ui(this.suspendedCtx)),Al(this.suspendedCtx,i),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},e.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},e.transform=function(e,n,s,i,r,a){t.transform(e,n,s,i,r,a),this.__originalTransform(e,n,s,i,r,a)},e.setTransform=function(e,n,s,i,r,a){t.setTransform(e,n,s,i,r,a),this.__originalSetTransform(e,n,s,i,r,a)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},e.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},e.bezierCurveTo=function(e,n,s,i,r,a){t.bezierCurveTo(e,n,s,i,r,a),this.__originalBezierCurveTo(e,n,s,i,r,a)},e.rect=function(e,n,s,i){t.rect(e,n,s,i),this.__originalRect(e,n,s,i)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(i,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Al(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){const i=s[0],r=s[1],a=s[2]-i,o=s[3]-r;0!==a&&0!==o&&(this.genericComposeSMask(t.context,n,a,o,t.subtype,t.backdrop,t.transferMap,i,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,i,r,a,o,l,c,h){let u=e.canvas,d=o-c,f=l-h;if(r){const t=Os.makeHexColor(...r);if(d<0||f<0||d+n>u.width||f+s>u.height){const e=this.cachedCanvases.getCanvas("maskExtension",n,s),i=e.context;i.drawImage(u,-d,-f),i.globalCompositeOperation="destination-atop",i.fillStyle=t,i.fillRect(0,0,n,s),i.globalCompositeOperation="source-over",u=e.canvas,d=f=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const i=new Path2D;i.rect(d,f,n,s),e.clip(i),e.globalCompositeOperation="destination-atop",e.fillStyle=t,e.fillRect(d,f,n,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),"Alpha"===i&&a?t.filter=this.filterFactory.addAlphaFilter(a):"Luminosity"===i&&(t.filter=this.filterFactory.addLuminosityFilter(a));const p=new Path2D;p.rect(o,l,n,s),t.clip(p),t.globalCompositeOperation="destination-in",t.drawImage(u,d,f,n,s,o,l,n,s),t.restore()}save(){this.inSMaskMode?(Al(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Al(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,s,i,r){this.ctx.transform(e,t,n,s,i,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){const s=this.ctx,i=this.current;let r,a,o=i.x,l=i.y;const c=ui(s),h=0===c[0]&&0===c[3]||0===c[1]&&0===c[2],u=h?n.slice(0):null;for(let d=0,f=0,p=e.length;d<p;d++)switch(0|e[d]){case ls.rectangle:o=t[f++],l=t[f++];const e=t[f++],n=t[f++],d=o+e,p=l+n;s.moveTo(o,l),0===e||0===n?s.lineTo(d,p):(s.lineTo(d,l),s.lineTo(d,p),s.lineTo(o,p)),h||i.updateRectMinMax(c,[o,l,d,p]),s.closePath();break;case ls.moveTo:o=t[f++],l=t[f++],s.moveTo(o,l),h||i.updatePathMinMax(c,o,l);break;case ls.lineTo:o=t[f++],l=t[f++],s.lineTo(o,l),h||i.updatePathMinMax(c,o,l);break;case ls.curveTo:r=o,a=l,o=t[f+4],l=t[f+5],s.bezierCurveTo(t[f],t[f+1],t[f+2],t[f+3],o,l),i.updateCurvePathMinMax(c,r,a,t[f],t[f+1],t[f+2],t[f+3],o,l,u),f+=6;break;case ls.curveTo2:r=o,a=l,s.bezierCurveTo(o,l,t[f],t[f+1],t[f+2],t[f+3]),i.updateCurvePathMinMax(c,r,a,o,l,t[f],t[f+1],t[f+2],t[f+3],u),o=t[f+2],l=t[f+3],f+=4;break;case ls.curveTo3:r=o,a=l,o=t[f+2],l=t[f+3],s.bezierCurveTo(t[f],t[f+1],o,l,o,l),i.updateCurvePathMinMax(c,r,a,t[f],t[f+1],o,l,o,l,u),f+=4;break;case ls.closePath:s.closePath()}h&&i.updateScalingPathMinMax(c,u),i.setCurrentPoint(o,l)}closePath(){this.ctx.closePath()}stroke(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"===typeof n&&null!==n&&void 0!==n&&n.getPattern?(t.save(),t.strokeStyle=n.getPattern(t,this,di(t),ol),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.ctx,n=this.current.fillColor;let s=!1;this.current.patternFill&&(t.save(),t.fillStyle=n.getPattern(t,this,di(t),al),s=!0);const i=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==i&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),s&&t.restore(),e&&this.consumePath(i)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Pl}eoClip(){this.pendingClip=Ol}beginText(){this.current.textMatrix=mn,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(const n of e)t.setTransform(...n.transform),t.translate(n.x,n.y),n.addToPath(t,n.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var n;const s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error("Can't find font for ".concat(e));if(i.fontMatrix=s.fontMatrix||vn,0!==i.fontMatrix[0]&&0!==i.fontMatrix[3]||ps("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const r=s.loadedName||"sans-serif",a=(null===(n=s.systemFontInfo)||void 0===n?void 0:n.css)||'"'.concat(r,'", ').concat(s.fallbackName);let o="normal";s.black?o="900":s.bold&&(o="bold");const l=s.italic?"italic":"normal";let c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font="".concat(l," ").concat(o," ").concat(c,"px ").concat(a)}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,s,i,r){this.current.textMatrix=[e,t,n,s,i,r],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,s){const i=this.ctx,r=this.current,a=r.font,o=r.textRenderingMode,l=r.fontSize/r.fontSizeScale,c=o&Ln,h=!!(o&Rn),u=r.patternFill&&!a.missingFile;let d;if((a.disableFontFace||h||u)&&(d=a.getPathGenerator(this.commonObjs,e)),a.disableFontFace||u?(i.save(),i.translate(t,n),i.beginPath(),d(i,l),s&&i.setTransform(...s),c!==Pn&&c!==Dn||i.fill(),c!==On&&c!==Dn||i.stroke(),i.restore()):(c!==Pn&&c!==Dn||i.fillText(e,t,n),c!==On&&c!==Dn||i.strokeText(e,t,n)),h){(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ui(i),x:t,y:n,fontSize:l,addToPath:d})}}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return ys(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(0===s)return;const i=this.ctx,r=t.fontSizeScale,a=t.charSpacing,o=t.wordSpacing,l=t.fontDirection,c=t.textHScale*l,h=e.length,u=n.vertical,d=u?1:-1,f=n.defaultVMetrics,p=s*t.fontMatrix[0],g=t.textRenderingMode===Pn&&!n.disableFontFace&&!t.patternFill;let m;if(i.save(),i.transform(...t.textMatrix),i.translate(t.x,t.y+t.textRise),l>0?i.scale(c,-1):i.scale(c,1),t.patternFill){i.save();const e=t.fillColor.getPattern(i,this,di(i),al);m=ui(i),i.restore(),i.fillStyle=e}let v=t.lineWidth;const y=t.textMatrixScale;if(0===y||0===v){const e=t.textRenderingMode&Ln;e!==On&&e!==Dn||(v=this.getSinglePixelWidth())}else v/=y;if(1!==r&&(i.scale(r,r),v/=r),i.lineWidth=v,n.isInvalidPDFjsFont){const n=[];let s=0;for(const t of e)n.push(t.unicode),s+=t.width;return i.fillText(n.join(""),0,0),t.x+=s*p*c,i.restore(),void this.compose()}let b,x=0;for(b=0;b<h;++b){const t=e[b];if("number"===typeof t){x+=d*t*s/1e3;continue}let c=!1;const h=(t.isSpace?o:0)+a,v=t.fontChar,y=t.accent;let w,S,_=t.width;if(u){const e=t.vmetric||f,n=-(t.vmetric?e[1]:.5*_)*p,s=e[2]*p;_=e?-e[0]:_,w=n/r,S=(x+s)/r}else w=x/r,S=0;if(n.remeasure&&_>0){const e=1e3*i.measureText(v).width/s*r;if(_<e&&this.isFontSubpixelAAEnabled){const t=_/e;c=!0,i.save(),i.scale(t,1),w/=t}else _!==e&&(w+=(_-e)/2e3*s/r)}if(this.contentVisible&&(t.isInFont||n.missingFile))if(g&&!y)i.fillText(v,w,S);else if(this.paintChar(v,w,S,m),y){const e=w+s*y.offset.x/r,t=S-s*y.offset.y/r;this.paintChar(y.fontChar,e,t,m)}x+=u?_*p-h*l:_*p+h*l,c&&i.restore()}u?t.y-=x:t.x+=x*c,i.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,s=n.font,i=n.fontSize,r=n.fontDirection,a=s.vertical?1:-1,o=n.charSpacing,l=n.wordSpacing,c=n.textHScale*r,h=n.fontMatrix||vn,u=e.length;let d,f,p,g;if(!(n.textRenderingMode===Nn)&&0!==i){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(c,r),d=0;d<u;++d){if(f=e[d],"number"===typeof f){g=a*f*i/1e3,this.ctx.translate(g,0),n.x+=g*c;continue}const r=(f.isSpace?l:0)+o,u=s.charProcOperatorList[f.operatorListId];if(!u){ps('Type3 character "'.concat(f.operatorListId,'" is not available.'));continue}this.contentVisible&&(this.processingType3=f,this.save(),t.scale(i,i),t.transform(...h),this.executeOperatorList(u),this.restore());p=Os.applyTransform([f.width,0],h)[0]*i+r,t.translate(p,0),n.x+=p*c}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,s,i,r){this.ctx.rect(n,s,i-n,r-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){const n=e[1],s=this.baseTransform||ui(this.ctx),i={createCanvasGraphics:e=>new Nl(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new yl(e,n,this.ctx,i,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.ctx.strokeStyle=this.current.strokeColor=Os.makeHexColor(e,t,n)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(e,t,n){this.ctx.fillStyle=this.current.fillColor=Os.makeHexColor(e,t,n),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(e)?t=this.cachedPatterns.get(e):(t=function(e){switch(e[0]){case"RadialAxial":return new ul(e);case"Mesh":return new pl(e);case"Dummy":return new gl}throw new Error("Unknown IR type: ".concat(e[0]))}(this.getObject(e)),this.cachedPatterns.set(e,t)),n&&(t.matrix=n),t}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,di(t),ll);const s=di(t);if(s){const{width:e,height:n}=t.canvas,[i,r,a,o]=Os.getAxialAlignedBoundingBox([0,0,e,n],s);this.ctx.fillRect(i,r,a-i,o-r)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){gs("Should not call beginInlineImage")}beginImageData(){gs("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=ui(this.ctx),t)){const e=t[2]-t[0],n=t[3]-t[1];this.ctx.rect(t[0],t[1],e,n),this.current.updateRectMinMax(ui(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||fs("TODO: Support non-isolated groups."),e.knockout&&ps("Knockout groups not supported.");const n=ui(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=Os.getAxialAlignedBoundingBox(e.bbox,ui(t));const i=[0,0,t.canvas.width,t.canvas.height];s=Os.intersect(s,i)||[0,0,0,0];const r=Math.floor(s[0]),a=Math.floor(s[1]),o=Math.max(Math.ceil(s[2])-r,1),l=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,o,l]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(c,o,l),u=h.context;u.translate(-r,-a),u.transform(...n),e.smask?this.smaskStack.push({canvas:h.canvas,context:u,offsetX:r,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,a),t.save()),Al(t,u),this.ctx=u,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const e=ui(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...e);const n=Os.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,n,s,i){if(Qt(Dl,this,Ll).call(this),El(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const s=t[2]-t[0],r=t[3]-t[1];if(i&&this.annotationCanvasMap){(n=n.slice())[4]-=t[0],n[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=s,t[3]=r;const[i,a]=Os.singularValueDecompose2dScale(ui(this.ctx)),{viewportScale:o}=this,l=Math.ceil(s*this.outputScaleX*o),c=Math.ceil(r*this.outputScaleY*o);this.annotationCanvas=this.canvasFactory.create(l,c);const{canvas:h,context:u}=this.annotationCanvas;this.annotationCanvasMap.set(e,h),this.annotationCanvas.savedCtx=this.ctx,this.ctx=u,this.ctx.save(),this.ctx.setTransform(i,0,0,-a,0,r*a),El(this.ctx)}else El(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],s,r),this.ctx.clip(),this.ctx.beginPath()}this.current=new _l(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Qt(Dl,this,Rl).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;(e=this.getObject(e.data,e)).count=t;const n=this.ctx,s=this.processingType3;if(s&&(void 0===s.compiled&&(s.compiled=function(e){const{width:t,height:n}=e;if(t>1e3||n>1e3)return null;const s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),i=t+1;let r,a,o,l=new Uint8Array(i*(n+1));const c=t+7&-8;let h=new Uint8Array(c*n),u=0;for(const g of e.data){let e=128;for(;e>0;)h[u++]=g&e?0:255,e>>=1}let d=0;for(u=0,0!==h[u]&&(l[0]=1,++d),a=1;a<t;a++)h[u]!==h[u+1]&&(l[a]=h[u]?2:1,++d),u++;for(0!==h[u]&&(l[a]=2,++d),r=1;r<n;r++){u=r*c,o=r*i,h[u-c]!==h[u]&&(l[o]=h[u]?1:8,++d);let e=(h[u]?4:0)+(h[u-c]?8:0);for(a=1;a<t;a++)e=(e>>2)+(h[u+1]?4:0)+(h[u-c+1]?8:0),s[e]&&(l[o+a]=s[e],++d),u++;if(h[u-c]!==h[u]&&(l[o+a]=h[u]?2:4,++d),d>1e3)return null}for(u=c*(n-1),o=r*i,0!==h[u]&&(l[o]=8,++d),a=1;a<t;a++)h[u]!==h[u+1]&&(l[o+a]=h[u]?4:8,++d),u++;if(0!==h[u]&&(l[o+a]=4,++d),d>1e3)return null;const f=new Int32Array([0,i,-1,0,-i,0,0,0,1]),p=new Path2D;for(r=0;d&&r<=n;r++){let e=r*i;const n=e+t;for(;e<n&&!l[e];)e++;if(e===n)continue;p.moveTo(e%i,r);const s=e;let a=l[e];do{const t=f[a];do{e+=t}while(!l[e]);const n=l[e];5!==n&&10!==n?(a=n,l[e]=0):(a=n&51*a>>4,l[e]&=a>>2|a<<2),p.lineTo(e%i,e/i|0),l[e]||--d}while(s!==e);--r}return h=null,l=null,function(e){e.save(),e.scale(1/t,-1/n),e.translate(0,-n),e.fill(p),e.beginPath(),e.restore()}}(e)),s.compiled))return void s.compiled(n);const i=this._createMaskCanvas(e),r=i.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,i.offsetX,i.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const o=ui(a);a.transform(t,n,s,i,0,0);const l=this._createMaskCanvas(e);a.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(let c=0,h=r.length;c<h;c+=2){const e=Os.transform(o,[t,n,s,i,r[c],r[c+1]]),[h,u]=Os.applyTransform([0,0],e);a.drawImage(l.canvas,h,u)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,s=this.current.patternFill;for(const i of e){const{data:e,width:r,height:a,transform:o}=i,l=this.cachedCanvases.getCanvas("maskCanvas",r,a),c=l.context;c.save();kl(c,this.getObject(e,i)),c.globalCompositeOperation="source-in",c.fillStyle=s?n.getPattern(c,this,di(t),al):n,c.fillRect(0,0,r,a),c.restore(),t.save(),t.transform(...o),t.scale(1,-1),Sl(t,l.canvas,0,0,r,a,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);t?this.paintInlineImageXObject(t):ps("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,n,s){if(!this.contentVisible)return;const i=this.getObject(e);if(!i)return void ps("Dependent image isn't ready yet");const r=i.width,a=i.height,o=[];for(let l=0,c=s.length;l<c;l+=2)o.push({transform:[t,0,0,n,s[l],s[l+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(i,o)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;const{bitmap:t,width:n,height:s}=e,i=this.cachedCanvases.getCanvas("inlineImage",n,s),r=i.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,s=this.ctx;if(this.save(),!gn){const{filter:e}=s;"none"!==e&&""!==e&&(s.filter="none")}let i;if(s.scale(1/t,-1/n),e.bitmap)i=this.applyTransferMapsToBitmap(e);else if("function"===typeof HTMLElement&&e instanceof HTMLElement||!e.data)i=e;else{const s=this.cachedCanvases.getCanvas("inlineImage",t,n).context;Cl(s,e),i=this.applyTransferMapsToCanvas(s)}const r=this._scaleImage(i,di(s));s.imageSmoothingEnabled=Tl(ui(s),e.interpolate),Sl(s,r.img,0,0,r.paintWidth,r.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const t=e.width,n=e.height,i=this.cachedCanvases.getCanvas("inlineImage",t,n).context;Cl(i,e),s=this.applyTransferMapsToCanvas(i)}for(const i of t)n.save(),n.transform(...i.transform),n.scale(1,-1),Sl(n,s,i.x,i.y,i.w,i.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const n=this.ctx;this.pendingClip&&(t||(this.pendingClip===Ol?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=ui(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:e}=this.current,{a:t,b:n,c:s,d:i}=this.ctx.getTransform();let r,a;if(0===n&&0===s){const n=Math.abs(t),s=Math.abs(i);if(n===s)if(0===e)r=a=1/n;else{const t=n*e;r=a=t<1?1/t:1}else if(0===e)r=1/n,a=1/s;else{const t=n*e,i=s*e;r=t<1?1/t:1,a=i<1?1/i:1}}else{const o=Math.abs(t*i-n*s),l=Math.hypot(t,n),c=Math.hypot(s,i);if(0===e)r=c/o,a=l/o;else{const t=e*o;r=c>t?c/t:1,a=l>t?l/t:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:n}=this.current,[s,i]=this.getScaleForStroking();if(t.lineWidth=n||1,1===s&&1===i)return void t.stroke();const r=t.getLineDash();if(e&&t.save(),t.scale(s,i),r.length>0){const e=Math.max(s,i);t.setLineDash(r.map(t=>t/e)),t.lineDashOffset/=e}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}function Ll(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}function Rl(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}for(const n in ls)void 0!==Nl.prototype[n]&&(Nl.prototype[ls[n]]=Nl.prototype[n]);class Fl{static get workerPort(){return Qt(Fl,this,Il)._}static set workerPort(e){if(!("undefined"!==typeof Worker&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");Il._=Qt(Fl,this,e)}static get workerSrc(){return Qt(Fl,this,zl)._}static set workerSrc(e){if("string"!==typeof e)throw new Error("Invalid `workerSrc` type.");zl._=Qt(Fl,this,e)}}var Il={_:null},zl={_:""};const Wl=1,Bl=2,Hl=1,Ul=2,Vl=3,Gl=4,Xl=5,Yl=6,ql=7,Kl=8;function Ql(e){switch(e instanceof Error||"object"===typeof e&&null!==e||gs('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new As(e.message);case"MissingPDFException":return new _s(e.message);case"PasswordException":return new xs(e.message,e.code);case"UnexpectedResponseException":return new Cs(e.message,e.status);case"UnknownErrorException":return new ws(e.message,e.details);default:return new ws(e.message,e.toString())}}var $l=new WeakMap,Jl=new WeakSet;class Zl{constructor(e,t,n){qt(this,Jl),Kt(this,$l,new AbortController),this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",Qt(Jl,this,ec).bind(this),{signal:Jt($l,this).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error('There is already an actionName called "'.concat(e,'"'));n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const s=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[s]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(r){i.reject(r)}return i.promise}sendWithStream(e,t,n,s){const i=this.streamId++,r=this.sourceName,a=this.targetName,o=this.comObj;return new ReadableStream({start:n=>{const l=Promise.withResolvers();return this.streamControllers[i]={controller:n,startCall:l,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:r,targetName:a,action:e,streamId:i,data:t,desiredSize:n.desiredSize},s),l.promise},pull:e=>{const t=Promise.withResolvers();return this.streamControllers[i].pullCall=t,o.postMessage({sourceName:r,targetName:a,stream:Yl,streamId:i,desiredSize:e.desiredSize}),t.promise},cancel:e=>{ms(e instanceof Error,"cancel must have a valid reason");const t=Promise.withResolvers();return this.streamControllers[i].cancelCall=t,this.streamControllers[i].isClosed=!0,o.postMessage({sourceName:r,targetName:a,stream:Hl,streamId:i,reason:Ql(e)}),t.promise}},n)}destroy(){var e;null===(e=Jt($l,this))||void 0===e||e.abort(),Zt($l,this,null)}}function ec(e){let{data:t}=e;if(t.targetName!==this.sourceName)return;if(t.stream)return void Qt(Jl,this,nc).call(this,t);if(t.callback){const e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error("Cannot resolve callback ".concat(e));if(delete this.callbackCapabilities[e],t.callback===Wl)n.resolve(t.data);else{if(t.callback!==Bl)throw new Error("Unexpected callback case");n.reject(Ql(t.reason))}return}const n=this.actionHandler[t.action];if(!n)throw new Error("Unknown action from worker: ".concat(t.action));if(t.callbackId){const e=this.sourceName,s=t.sourceName,i=this.comObj;return void new Promise(function(e){e(n(t.data))}).then(function(n){i.postMessage({sourceName:e,targetName:s,callback:Wl,callbackId:t.callbackId,data:n})},function(n){i.postMessage({sourceName:e,targetName:s,callback:Bl,callbackId:t.callbackId,reason:Ql(n)})})}t.streamId?Qt(Jl,this,tc).call(this,t):n(t.data)}function tc(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,i=this.comObj,r=this,a=this.actionHandler[e.action],o={enqueue(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const o=this.desiredSize;this.desiredSize-=r,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:n,targetName:s,stream:Gl,streamId:t,chunk:e},a)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:s,stream:Vl,streamId:t}),delete r.streamSinks[t])},error(e){ms(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:s,stream:Xl,streamId:t,reason:Ql(e)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[t]=o,new Promise(function(t){t(a(e.data,o))}).then(function(){i.postMessage({sourceName:n,targetName:s,stream:Kl,streamId:t,success:!0})},function(e){i.postMessage({sourceName:n,targetName:s,stream:Kl,streamId:t,reason:Ql(e)})})}function nc(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,i=this.comObj,r=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Kl:e.success?r.startCall.resolve():r.startCall.reject(Ql(e.reason));break;case ql:e.success?r.pullCall.resolve():r.pullCall.reject(Ql(e.reason));break;case Yl:if(!a){i.postMessage({sourceName:n,targetName:s,stream:ql,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,new Promise(function(e){var t;e(null===(t=a.onPull)||void 0===t?void 0:t.call(a))}).then(function(){i.postMessage({sourceName:n,targetName:s,stream:ql,streamId:t,success:!0})},function(e){i.postMessage({sourceName:n,targetName:s,stream:ql,streamId:t,reason:Ql(e)})});break;case Gl:if(ms(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case Vl:if(ms(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),Qt(Jl,this,sc).call(this,r,t);break;case Xl:ms(r,"error should have stream controller"),r.controller.error(Ql(e.reason)),Qt(Jl,this,sc).call(this,r,t);break;case Ul:e.success?r.cancelCall.resolve():r.cancelCall.reject(Ql(e.reason)),Qt(Jl,this,sc).call(this,r,t);break;case Hl:if(!a)break;new Promise(function(t){var n;t(null===(n=a.onCancel)||void 0===n?void 0:n.call(a,Ql(e.reason)))}).then(function(){i.postMessage({sourceName:n,targetName:s,stream:Ul,streamId:t,success:!0})},function(e){i.postMessage({sourceName:n,targetName:s,stream:Ul,streamId:t,reason:Ql(e)})}),a.sinkCapability.reject(Ql(e.reason)),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async function sc(e,t){var n,s,i;await Promise.allSettled([null===(n=e.startCall)||void 0===n?void 0:n.promise,null===(s=e.pullCall)||void 0===s?void 0:s.promise,null===(i=e.cancelCall)||void 0===i?void 0:i.promise]),delete this.streamControllers[t]}var ic=new WeakMap,rc=new WeakMap;class ac{constructor(e){let{parsedData:t,rawData:n}=e;Kt(this,ic,void 0),Kt(this,rc,void 0),Zt(ic,this,t),Zt(rc,this,n)}getRaw(){return Jt(rc,this)}get(e){var t;return null!==(t=Jt(ic,this).get(e))&&void 0!==t?t:null}getAll(){return Ms(Jt(ic,this))}has(e){return Jt(ic,this).has(e)}}const oc=Symbol("INTERNAL");var lc=new WeakMap,cc=new WeakMap,hc=new WeakMap,uc=new WeakMap;class dc{constructor(e,t){let{name:n,intent:s,usage:i,rbGroups:r}=t;Kt(this,lc,!1),Kt(this,cc,!1),Kt(this,hc,!1),Kt(this,uc,!0),Zt(lc,this,!!(e&xn)),Zt(cc,this,!!(e&wn)),this.name=n,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(Jt(hc,this))return Jt(uc,this);if(!Jt(uc,this))return!1;const{print:e,view:t}=this.usage;return Jt(lc,this)?"OFF"!==(null===t||void 0===t?void 0:t.viewState):!Jt(cc,this)||"OFF"!==(null===e||void 0===e?void 0:e.printState)}_setVisible(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==oc&&gs("Internal method `_setVisible` called."),Zt(hc,this,n),Zt(uc,this,t)}}var fc=new WeakMap,pc=new WeakMap,gc=new WeakMap,mc=new WeakMap,vc=new WeakSet;class yc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xn;if(qt(this,vc),Kt(this,fc,null),Kt(this,pc,new Map),Kt(this,gc,null),Kt(this,mc,null),this.renderingIntent=t,this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,Zt(mc,this,e.order);for(const n of e.groups)Jt(pc,this).set(n.id,new dc(t,n));if("OFF"===e.baseState)for(const e of Jt(pc,this).values())e._setVisible(oc,!1);for(const t of e.on)Jt(pc,this).get(t)._setVisible(oc,!0);for(const t of e.off)Jt(pc,this).get(t)._setVisible(oc,!1);Zt(gc,this,this.getHash())}}isVisible(e){if(0===Jt(pc,this).size)return!0;if(!e)return fs("Optional content group not defined."),!0;if("OCG"===e.type)return Jt(pc,this).has(e.id)?Jt(pc,this).get(e.id).visible:(ps("Optional content group not found: ".concat(e.id)),!0);if("OCMD"===e.type){if(e.expression)return Qt(vc,this,bc).call(this,e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!Jt(pc,this).has(t))return ps("Optional content group not found: ".concat(t)),!0;if(Jt(pc,this).get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!Jt(pc,this).has(t))return ps("Optional content group not found: ".concat(t)),!0;if(!Jt(pc,this).get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!Jt(pc,this).has(t))return ps("Optional content group not found: ".concat(t)),!0;if(!Jt(pc,this).get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!Jt(pc,this).has(t))return ps("Optional content group not found: ".concat(t)),!0;if(Jt(pc,this).get(t).visible)return!1}return!0}return ps("Unknown optional content policy ".concat(e.policy,".")),!0}return ps("Unknown group type ".concat(e.type,".")),!0}setVisibility(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=Jt(pc,this).get(e);if(s){if(n&&t&&s.rbGroups.length)for(const t of s.rbGroups)for(const n of t){var i;if(n!==e)null===(i=Jt(pc,this).get(n))||void 0===i||i._setVisible(oc,!1,!0)}s._setVisible(oc,!!t,!0),Zt(fc,this,null)}else ps("Optional content group not found: ".concat(e))}setOCGState(e){let t,{state:n,preserveRB:s}=e;for(const i of n){switch(i){case"ON":case"OFF":case"Toggle":t=i;continue}const e=Jt(pc,this).get(i);if(e)switch(t){case"ON":this.setVisibility(i,!0,s);break;case"OFF":this.setVisibility(i,!1,s);break;case"Toggle":this.setVisibility(i,!e.visible,s)}}Zt(fc,this,null)}get hasInitialVisibility(){return null===Jt(gc,this)||this.getHash()===Jt(gc,this)}getOrder(){return Jt(pc,this).size?Jt(mc,this)?Jt(mc,this).slice():[...Jt(pc,this).keys()]:null}getGroups(){return Jt(pc,this).size>0?Ms(Jt(pc,this)):null}getGroup(e){return Jt(pc,this).get(e)||null}getHash(){if(null!==Jt(fc,this))return Jt(fc,this);const e=new mo;for(const[t,n]of Jt(pc,this))e.update("".concat(t,":").concat(n.visible));return Zt(fc,this,e.hexdigest())}}function bc(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let s=1;s<t;s++){const t=e[s];let i;if(Array.isArray(t))i=Qt(vc,this,bc).call(this,t);else{if(!Jt(pc,this).has(t))return ps("Optional content group not found: ".concat(t)),!0;i=Jt(pc,this).get(t).visible}switch(n){case"And":if(!i)return!1;break;case"Or":if(i)return!0;break;case"Not":return!i;default:return!0}}return"And"===n}class xc{constructor(e,t){let{disableRange:n=!1,disableStream:s=!1}=t;ms(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(null===r||void 0===r?void 0:r.length)>0){const e=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!n,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((e,t)=>{this._onReceiveData({begin:e,chunk:t})}),e.addProgressListener((e,t)=>{this._onProgress({loaded:e,total:t})}),e.addProgressiveReadListener(e=>{this._onReceiveData({chunk:e})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData(e){let{begin:t,chunk:n}=e;const s=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;if(void 0===t)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{ms(this._rangeReaders.some(function(e){return e._begin===t&&(e._enqueue(s),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}_onProgress(e){var t,n,s,i;void 0===e.total?null===(t=this._rangeReaders[0])||void 0===t||null===(n=t.onProgress)||void 0===n||n.call(t,{loaded:e.loaded}):null===(s=this._fullRequestReader)||void 0===s||null===(i=s.onProgress)||void 0===i||i.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;null===(e=this._fullRequestReader)||void 0===e||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ms(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new wc(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new Sc(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class wc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._stream=e,this._done=n||!1,this._filename=ei(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length>0){this._requests.shift().resolve({value:e,done:!1})}else this._queuedChunks.push(e);this._loaded+=e.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){return{value:this._queuedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Sc{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function _c(e,t){const n=new Headers;if(!e||!t||"object"!==typeof t)return n;for(const s in t){const e=t[s];void 0!==e&&n.append(s,e)}return n}function Cc(e){let{responseHeaders:t,isHttp:n,rangeChunkSize:s,disableRange:i}=e;const r={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(t.get("Content-Length"),10);if(!Number.isInteger(a))return r;if(r.suggestedLength=a,a<=2*s)return r;if(i||!n)return r;if("bytes"!==t.get("Accept-Ranges"))return r;return"identity"!==(t.get("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r}function kc(e){const t=e.get("Content-Disposition");if(t){let e=function(e){let t=!0,n=s("filename\\*","i").exec(e);if(n){n=n[1];let e=a(n);return e=unescape(e),e=o(e),e=l(e),r(e)}if(n=function(e){const t=[];let n;const i=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=i.exec(e));){let[,e,s,i]=n;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[s,i]}const r=[];for(let s=0;s<t.length&&s in t;++s){let[e,n]=t[s];n=a(n),e&&(n=unescape(n),0===s&&(n=o(n))),r.push(n)}return r.join("")}(e),n)return r(l(n));if(n=s("filename","i").exec(e),n){n=n[1];let e=a(n);return e=l(e),r(e)}function s(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function i(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const s=new TextDecoder(e,{fatal:!0}),i=Ts(n);n=s.decode(i),t=!1}catch(s){}}return n}function r(e){return t&&/[\x80-\xff]/.test(e)&&(e=i("utf-8",e),t&&(e=i("iso-8859-1",e))),e}function a(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replaceAll(/\\(.)/g,"$1")}e=t.join('"')}return e}function o(e){const t=e.indexOf("'");return-1===t?e:i(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function l(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(e,t,n,s){if("q"===n||"Q"===n)return s=(s=s.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}),i(t,s);try{s=atob(s)}catch(r){}return i(t,s)})}return""}(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(n){}if(ei(e))return e}return null}function Ac(e,t){return 404===e||0===e&&t.startsWith("file:")?new _s('Missing PDF "'+t+'".'):new Cs("Unexpected server response (".concat(e,') while retrieving PDF "').concat(t,'".'),e)}function Ec(e){return 200===e||206===e}function Tc(e,t,n){return{method:"GET",headers:e,signal:n.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Mc(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:(ps("getArrayBuffer - unexpected data format: ".concat(e)),new Uint8Array(e).buffer)}class jc{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=_c(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}getFullReader(){return ms(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Pc(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new Oc(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class Pc{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),s=t.url;fetch(s,Tc(n,this._withCredentials,this._abortController)).then(t=>{if(!Ec(t.status))throw Ac(t.status,s);this._reader=t.body.getReader(),this._headersCapability.resolve();const n=t.headers,{allowRangeRequests:i,suggestedLength:r}=Cc({responseHeaders:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=r||this._contentLength,this._filename=kc(n),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new As("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;await this._headersCapability.promise;const{value:t,done:n}=await this._reader.read();return n?{value:t,done:n}:(this._loaded+=t.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Mc(t),done:!1})}cancel(e){var t;null===(t=this._reader)||void 0===t||t.cancel(e),this._abortController.abort()}}class Oc{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const i=new Headers(e.headers);i.append("Range","bytes=".concat(t,"-").concat(n-1));const r=s.url;fetch(r,Tc(i,this._withCredentials,this._abortController)).then(e=>{if(!Ec(e.status))throw Ac(e.status,r);this._readCapability.resolve(),this._reader=e.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;await this._readCapability.promise;const{value:t,done:n}=await this._reader.read();return n?{value:t,done:n}:(this._loaded+=t.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),{value:Mc(t),done:!1})}cancel(e){var t;null===(t=this._reader)||void 0===t||t.cancel(e),this._abortController.abort()}}class Dc{constructor(e){let{url:t,httpHeaders:n,withCredentials:s}=e;this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=_c(this.isHttp,n),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,n){const s={begin:e,end:t};for(const i in n)s[i]=n[i];return this.request(s)}requestFull(e){return this.request(e)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[i,r]of this.headers)t.setRequestHeader(i,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range","bytes=".concat(e.begin,"-").concat(e.end-1)),s.expectedStatus=206):s.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var n;const s=this.pendingRequests[e];s&&(null===(n=s.onProgress)||void 0===n||n.call(s,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4!==s.readyState)return;if(!(e in this.pendingRequests))return;var i;if(delete this.pendingRequests[e],0===s.status&&this.isHttp)return void(null===(i=n.onError)||void 0===i||i.call(n,s.status));const r=s.status||200;var a;if(!(200===r&&206===n.expectedStatus)&&r!==n.expectedStatus)return void(null===(a=n.onError)||void 0===a||a.call(n,s.status));const o=function(e){const t=e.response;return"string"!==typeof t?t:Ts(t).buffer}(s);if(206===r){const e=s.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);n.onDone({begin:parseInt(t[1],10),chunk:o})}else if(o)n.onDone({begin:0,chunk:o});else{var l;null===(l=n.onError)||void 0===l||l.call(n,s.status)}}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Nc{constructor(e){this._source=e,this._manager=new Dc(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ms(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Lc(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new Rc(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class Lc{constructor(e,t){this._manager=e;const n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(n),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),n=new Headers(t.getAllResponseHeaders().trim().split(/[\r\n]+/).map(e=>{const[t,...n]=e.split(": ");return[t,n.join(": ")]})),{allowRangeRequests:s,suggestedLength:i}=Cc({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=i||this._contentLength,this._filename=kc(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e)if(this._requests.length>0){this._requests.shift().resolve({value:e.chunk,done:!1})}else this._cachedChunks.push(e.chunk);if(this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Ac(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0){return{value:this._cachedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Rc{constructor(e,t,n){this._manager=e;const s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,n,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var e;null===(e=this.onClosed)||void 0===e||e.call(this,this)}_onDone(e){const t=e.chunk;if(this._requests.length>0){this._requests.shift().resolve({value:t,done:!1})}else this._queuedChunk=t;this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=Ac(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:e.loaded}))}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Fc=/^[a-z][a-z0-9\-+.]+:/i;function Ic(e,t,n){if("http:"===e.protocol){return il.get("http").request(e,{headers:t},n)}return il.get("https").request(e,{headers:t},n)}class zc{constructor(e){this.source=e,this.url=function(e){if(Fc.test(e))return new URL(e);const t=il.get("url");return new URL(t.pathToFileURL(e))}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.headers=_c(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}getFullReader(){return ms(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new Vc(this):new Hc(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=this.isFsUrl?new Gc(this,e,t):new Uc(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class Wc{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();if(null===t)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=t.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength});return{value:new Uint8Array(t).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new As("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Bc{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();if(null===t)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=t.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded});return{value:new Uint8Array(t).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class Hc extends Wc{constructor(e){super(e);const t=Object.fromEntries(e.headers);this._request=Ic(this._url,t,t=>{if(404===t.statusCode){const e=new _s('Missing PDF "'.concat(this._url,'".'));return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const n=new Headers(this._readableStream.headers),{allowRangeRequests:s,suggestedLength:i}=Cc({responseHeaders:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=i||this._contentLength,this._filename=kc(n)}),this._request.on("error",e=>{this._storedError=e,this._headersCapability.reject(e)}),this._request.end()}}class Uc extends Bc{constructor(e,t,n){super(e);const s=Object.fromEntries(e.headers);s.Range="bytes=".concat(t,"-").concat(n-1);this._request=Ic(this._url,s,e=>{if(404===e.statusCode){const e=new _s('Missing PDF "'.concat(this._url,'".'));return void(this._storedError=e)}this._setReadableStream(e)}),this._request.on("error",e=>{this._storedError=e}),this._request.end()}}class Vc extends Wc{constructor(e){super(e);const t=il.get("fs");t.promises.lstat(this._url).then(e=>{this._contentLength=e.size,this._setReadableStream(t.createReadStream(this._url)),this._headersCapability.resolve()},e=>{"ENOENT"===e.code&&(e=new _s('Missing PDF "'.concat(this._url,'".'))),this._storedError=e,this._headersCapability.reject(e)})}}class Gc extends Bc{constructor(e,t,n){super(e);const s=il.get("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:n-1}))}}const Xc=30;var Yc=new WeakMap,qc=new WeakMap,Kc=new WeakMap,Qc=new WeakMap,$c=new WeakMap,Jc=new WeakMap,Zc=new WeakMap,eh=new WeakMap,th=new WeakMap,nh=new WeakMap,sh=new WeakMap,ih=new WeakMap,rh=new WeakMap,ah=new WeakMap,oh=new WeakMap,lh=new WeakMap,ch=new WeakMap,hh=new WeakMap,uh=new WeakSet;class dh{constructor(e){var t;let{textContentSource:n,container:s,viewport:i}=e;if(qt(this,uh),Kt(this,Yc,Promise.withResolvers()),Kt(this,qc,null),Kt(this,Kc,!1),Kt(this,Qc,!(null===(t=globalThis.FontInspector)||void 0===t||!t.enabled)),Kt(this,$c,null),Kt(this,Jc,null),Kt(this,Zc,0),Kt(this,eh,0),Kt(this,th,null),Kt(this,nh,null),Kt(this,sh,0),Kt(this,ih,0),Kt(this,rh,Object.create(null)),Kt(this,ah,[]),Kt(this,oh,null),Kt(this,lh,[]),Kt(this,ch,new WeakMap),Kt(this,hh,null),n instanceof ReadableStream)Zt(oh,this,n);else{if("object"!==typeof n)throw new Error('No "textContentSource" parameter specified.');Zt(oh,this,new ReadableStream({start(e){e.enqueue(n),e.close()}}))}Zt(qc,this,Zt(nh,this,s)),Zt(ih,this,i.scale*(globalThis.devicePixelRatio||1)),Zt(sh,this,i.rotation),Zt(Jc,this,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:a,pageX:o,pageY:l}=i.rawDims;Zt(hh,this,[1,0,0,-1,-o,l+a]),Zt(eh,this,r),Zt(Zc,this,a),yh.call(dh),fi(s,i),Jt(Yc,this).promise.finally(()=>{Ch._.delete(this),Zt(Jc,this,null),Zt(rh,this,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=js.platform;return ys(this,"fontFamilyMap",new Map([["sans-serif","".concat(e&&t?"Calibri, ":"","sans-serif")],["monospace","".concat(e&&t?"Lucida Console, ":"","monospace")]]))}render(){const e=()=>{Jt(th,this).read().then(t=>{var n;let{value:s,done:i}=t;i?Jt(Yc,this).resolve():(null!==(n=Jt($c,this))&&void 0!==n||Zt($c,this,s.lang),Object.assign(Jt(rh,this),s.styles),Qt(uh,this,fh).call(this,s.items),e())},Jt(Yc,this).reject)};return Zt(th,this,Jt(oh,this).getReader()),Ch._.add(this),e(),Jt(Yc,this).promise}update(e){let{viewport:t,onBefore:n=null}=e;const s=t.scale*(globalThis.devicePixelRatio||1),i=t.rotation;if(i!==Jt(sh,this)&&(null===n||void 0===n||n(),Zt(sh,this,i),fi(Jt(nh,this),{rotation:i})),s!==Jt(ih,this)){null===n||void 0===n||n(),Zt(ih,this,s);const e={div:null,properties:null,ctx:mh.call(dh,Jt($c,this))};for(const t of Jt(lh,this))e.properties=Jt(ch,this).get(t),e.div=t,Qt(uh,this,gh).call(this,e)}}cancel(){var e;const t=new As("TextLayer task cancelled.");null===(e=Jt(th,this))||void 0===e||e.cancel(t).catch(()=>{}),Zt(th,this,null),Jt(Yc,this).reject(t)}get textDivs(){return Jt(lh,this)}get textContentItemsStr(){return Jt(ah,this)}static cleanup(){if(!(Qt(dh,this,Ch)._.size>0)){Qt(dh,this,xh)._.clear();for(const{canvas:e}of Qt(dh,this,wh)._.values())e.remove();Qt(dh,this,wh)._.clear()}}}function fh(e){var t,n;if(Jt(Kc,this))return;null!==(n=(t=Jt(Jc,this)).ctx)&&void 0!==n||(t.ctx=mh.call(rn,Jt($c,this)));const s=Jt(lh,this),i=Jt(ah,this);for(const r of e){if(s.length>1e5)return ps("Ignoring additional textDivs for performance reasons."),void Zt(Kc,this,!0);if(void 0!==r.str)i.push(r.str),Qt(uh,this,ph).call(this,r);else if("beginMarkedContentProps"===r.type||"beginMarkedContent"===r.type){const e=Jt(qc,this);Zt(qc,this,document.createElement("span")),Jt(qc,this).classList.add("markedContent"),null!==r.id&&Jt(qc,this).setAttribute("id","".concat(r.id)),e.append(Jt(qc,this))}else"endMarkedContent"===r.type&&Zt(qc,this,Jt(qc,this).parentNode)}}function ph(e){const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0};Jt(lh,this).push(t);const s=Os.transform(Jt(hh,this),e.transform);let i=Math.atan2(s[1],s[0]);const r=Jt(rh,this)[e.fontName];r.vertical&&(i+=Math.PI/2);let a=Jt(Qc,this)&&r.fontSubstitution||r.fontFamily;a=rn.fontFamilyMap.get(a)||a;const o=Math.hypot(s[2],s[3]),l=o*bh.call(rn,a,Jt($c,this));let c,h;0===i?(c=s[4],h=s[5]-l):(c=s[4]+l*Math.sin(i),h=s[5]-l*Math.cos(i));const u="calc(var(--scale-factor)*",d=t.style;Jt(qc,this)===Jt(nh,this)?(d.left="".concat((100*c/Jt(eh,this)).toFixed(2),"%"),d.top="".concat((100*h/Jt(Zc,this)).toFixed(2),"%")):(d.left="".concat(u).concat(c.toFixed(2),"px)"),d.top="".concat(u).concat(h.toFixed(2),"px)")),d.fontSize="".concat(u).concat((_h._*o).toFixed(2),"px)"),d.fontFamily=a,n.fontSize=o,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,Jt(Qc,this)&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),0!==i&&(n.angle=i*(180/Math.PI));let f=!1;if(e.str.length>1)f=!0;else if(" "!==e.str&&e.transform[0]!==e.transform[3]){const t=Math.abs(e.transform[0]),n=Math.abs(e.transform[3]);t!==n&&Math.max(t,n)/Math.min(t,n)>1.5&&(f=!0)}if(f&&(n.canvasWidth=r.vertical?e.height:e.width),Jt(ch,this).set(t,n),Jt(Jc,this).div=t,Jt(Jc,this).properties=n,Qt(uh,this,gh).call(this,Jt(Jc,this)),n.hasText&&Jt(qc,this).append(t),n.hasEOL){const e=document.createElement("br");e.setAttribute("role","presentation"),Jt(qc,this).append(e)}}function gh(e){const{div:t,properties:n,ctx:s}=e,{style:i}=t;let r="";if(_h._>1&&(r="scale(".concat(1/_h._,")")),0!==n.canvasWidth&&n.hasText){const{fontFamily:e}=i,{canvasWidth:a,fontSize:o}=n;vh.call(rn,s,o*Jt(ih,this),e);const{width:l}=s.measureText(t.textContent);l>0&&(r="scaleX(".concat(a*Jt(ih,this)/l,") ").concat(r))}0!==n.angle&&(r="rotate(".concat(n.angle,"deg) ").concat(r)),r.length>0&&(i.transform=r)}function mh(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Qt(rn,this,wh)._.get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),Qt(rn,this,wh)._.set(e,t),Qt(rn,this,Sh)._.set(t,{size:0,family:""})}return t}function vh(e,t,n){const s=Qt(rn,this,Sh)._.get(e);t===s.size&&n===s.family||(e.font="".concat(t,"px ").concat(n),s.size=t,s.family=n)}function yh(){if(null!==Qt(rn,this,_h)._)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),_h._=Qt(rn,this,e.getBoundingClientRect().height),e.remove()}function bh(e,t){const n=Qt(rn,this,xh)._.get(e);if(n)return n;const s=Qt(rn,this,mh).call(this,t);s.canvas.width=s.canvas.height=Xc,Qt(rn,this,vh).call(this,s,Xc,e);const i=s.measureText("");let r=i.fontBoundingBoxAscent,a=Math.abs(i.fontBoundingBoxDescent);if(r){const t=r/(r+a);return Qt(rn,this,xh)._.set(e,t),s.canvas.width=s.canvas.height=0,t}s.strokeStyle="red",s.clearRect(0,0,Xc,Xc),s.strokeText("g",0,0);let o=s.getImageData(0,0,Xc,Xc).data;a=0;for(let c=o.length-1-3;c>=0;c-=4)if(o[c]>0){a=Math.ceil(c/4/Xc);break}s.clearRect(0,0,Xc,Xc),s.strokeText("A",0,Xc),o=s.getImageData(0,0,Xc,Xc).data,r=0;for(let c=0,h=o.length;c<h;c+=4)if(o[c]>0){r=Xc-Math.floor(c/4/Xc);break}s.canvas.width=s.canvas.height=0;const l=r?r/(r+a):.8;return Qt(rn,this,xh)._.set(e,l),l}rn=dh;var xh={_:new Map},wh={_:new Map},Sh={_:new WeakMap},_h={_:null},Ch={_:new Set};class kh{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};return function e(n){var s;if(!n)return;let i=null;const r=n.name;if("#text"===r)i=n.value;else{if(!kh.shouldBuildText(r))return;null!==n&&void 0!==n&&null!==(s=n.attributes)&&void 0!==s&&s.textContent?i=n.attributes.textContent:n.value&&(i=n.value)}if(null!==i&&t.push({str:i}),n.children)for(const t of n.children)e(t)}(e),n}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}const Ah=65536,Eh=gn?class extends jo{_createCanvas(e,t){return il.get("canvas").createCanvas(e,t)}}:class extends jo{constructor(e){let{ownerDocument:t=globalThis.document,enableHWA:n=!1}=e;super({enableHWA:n}),this._document=t}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}},Th=gn?class extends Po{async _fetch(e){return rl(e)}}:Oo,Mh=gn?class extends Do{}:class extends Do{constructor(e){let{docId:t,ownerDocument:n=globalThis.document}=e;super(),qt(this,Bo),Kt(this,No,void 0),Kt(this,Lo,void 0),Kt(this,Ro,void 0),Kt(this,Fo,void 0),Kt(this,Io,void 0),Kt(this,zo,void 0),Kt(this,Wo,0),Zt(Fo,this,t),Zt(Io,this,n)}addFilter(e){var t,n;if(!e)return"none";let s=$t(Bo,this,Ho).get(e);if(s)return s;const[i,r,a]=Qt(Bo,this,Go).call(this,e),o=1===e.length?i:"".concat(i).concat(r).concat(a);if(s=$t(Bo,this,Ho).get(o),s)return $t(Bo,this,Ho).set(e,s),s;const l="g_".concat(Jt(Fo,this),"_transfer_map_").concat((Zt(Wo,this,(t=Jt(Wo,this),n=t++,t)),n)),c=Qt(Bo,this,Xo).call(this,l);$t(Bo,this,Ho).set(e,c),$t(Bo,this,Ho).set(o,c);const h=Qt(Bo,this,Ko).call(this,l);return Qt(Bo,this,$o).call(this,i,r,a,h),c}addHCMFilter(e,t){var n;const s="".concat(e,"-").concat(t),i="base";let r=$t(Bo,this,Uo).get(i);if((null===(n=r)||void 0===n?void 0:n.key)===s)return r.url;var a;r?(null===(a=r.filter)||void 0===a||a.remove(),r.key=s,r.url="none",r.filter=null):(r={key:s,url:"none",filter:null},$t(Bo,this,Uo).set(i,r));if(!e||!t)return r.url;const o=Qt(Bo,this,Zo).call(this,e);e=Os.makeHexColor(...o);const l=Qt(Bo,this,Zo).call(this,t);if(t=Os.makeHexColor(...l),$t(Bo,this,Vo).style.color="","#000000"===e&&"#ffffff"===t||e===t)return r.url;const c=new Array(256);for(let p=0;p<=255;p++){const e=p/255;c[p]=e<=.03928?e/12.92:((e+.055)/1.055)**2.4}const h=c.join(","),u="g_".concat(Jt(Fo,this),"_hcm_filter"),d=r.filter=Qt(Bo,this,Ko).call(this,u);Qt(Bo,this,$o).call(this,h,h,h,d),Qt(Bo,this,qo).call(this,d);const f=(e,t)=>{const n=o[e]/255,s=l[e]/255,i=new Array(t+1);for(let r=0;r<=t;r++)i[r]=n+r/t*(s-n);return i.join(",")};return Qt(Bo,this,$o).call(this,f(0,5),f(1,5),f(2,5),d),r.url=Qt(Bo,this,Xo).call(this,u),r.url}addAlphaFilter(e){var t,n;let s=$t(Bo,this,Ho).get(e);if(s)return s;const[i]=Qt(Bo,this,Go).call(this,[e]),r="alpha_".concat(i);if(s=$t(Bo,this,Ho).get(r),s)return $t(Bo,this,Ho).set(e,s),s;const a="g_".concat(Jt(Fo,this),"_alpha_map_").concat((Zt(Wo,this,(t=Jt(Wo,this),n=t++,t)),n)),o=Qt(Bo,this,Xo).call(this,a);$t(Bo,this,Ho).set(e,o),$t(Bo,this,Ho).set(r,o);const l=Qt(Bo,this,Ko).call(this,a);return Qt(Bo,this,Jo).call(this,i,l),o}addLuminosityFilter(e){var t,n;let s,i,r=$t(Bo,this,Ho).get(e||"luminosity");if(r)return r;if(e?([s]=Qt(Bo,this,Go).call(this,[e]),i="luminosity_".concat(s)):i="luminosity",r=$t(Bo,this,Ho).get(i),r)return $t(Bo,this,Ho).set(e,r),r;const a="g_".concat(Jt(Fo,this),"_luminosity_map_").concat((Zt(Wo,this,(t=Jt(Wo,this),n=t++,t)),n)),o=Qt(Bo,this,Xo).call(this,a);$t(Bo,this,Ho).set(e,o),$t(Bo,this,Ho).set(i,o);const l=Qt(Bo,this,Ko).call(this,a);return Qt(Bo,this,Yo).call(this,l),e&&Qt(Bo,this,Jo).call(this,s,l),o}addHighlightHCMFilter(e,t,n,s,i){var r;const a="".concat(t,"-").concat(n,"-").concat(s,"-").concat(i);let o=$t(Bo,this,Uo).get(e);if((null===(r=o)||void 0===r?void 0:r.key)===a)return o.url;var l;o?(null===(l=o.filter)||void 0===l||l.remove(),o.key=a,o.url="none",o.filter=null):(o={key:a,url:"none",filter:null},$t(Bo,this,Uo).set(e,o));if(!t||!n)return o.url;const[c,h]=[t,n].map(Qt(Bo,this,Zo).bind(this));let u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),d=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[f,p]=[s,i].map(Qt(Bo,this,Zo).bind(this));d<u&&([u,d,f,p]=[d,u,p,f]),$t(Bo,this,Vo).style.color="";const g=(e,t,n)=>{const s=new Array(256),i=(d-u)/n,r=e/255,a=(t-e)/(255*n);let o=0;for(let l=0;l<=n;l++){const e=Math.round(u+l*i),t=r+l*a;for(let n=o;n<=e;n++)s[n]=t;o=e+1}for(let l=o;l<256;l++)s[l]=s[o-1];return s.join(",")},m="g_".concat(Jt(Fo,this),"_hcm_").concat(e,"_filter"),v=o.filter=Qt(Bo,this,Ko).call(this,m);return Qt(Bo,this,qo).call(this,v),Qt(Bo,this,$o).call(this,g(f[0],p[0],5),g(f[1],p[1],5),g(f[2],p[2],5),v),o.url=Qt(Bo,this,Xo).call(this,m),o.url}destroy(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&0!==$t(Bo,this,Uo).size||(Jt(Ro,this)&&(Jt(Ro,this).parentNode.parentNode.remove(),Zt(Ro,this,null)),Jt(Lo,this)&&(Jt(Lo,this).clear(),Zt(Lo,this,null)),Zt(Wo,this,0))}},jh=gn?class extends el{async _fetch(e){return rl(e)}}:tl;function Ph(){var e,t,n;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"string"===typeof s||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const i=new Dh,{docId:r}=i,a=s.url?function(e){if(e instanceof URL)return e.href;try{return new URL(e,window.location).href}catch(t){if(gn&&"string"===typeof e)return e}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(s.url):null,o=s.data?function(e){if(gn&&"undefined"!==typeof Buffer&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"===typeof e)return Ts(e);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)||"object"===typeof e&&!isNaN(null===e||void 0===e?void 0:e.length))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(s.data):null,l=s.httpHeaders||null,c=!0===s.withCredentials,h=null!==(e=s.password)&&void 0!==e?e:null,u=s.range instanceof Lh?s.range:null,d=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:Ah;let f=s.worker instanceof Yh?s.worker:null;const p=s.verbosity,g="string"!==typeof s.docBaseUrl||Zs(s.docBaseUrl)?null:s.docBaseUrl,m="string"===typeof s.cMapUrl?s.cMapUrl:null,v=!1!==s.cMapPacked,y=s.CMapReaderFactory||Th,b="string"===typeof s.standardFontDataUrl?s.standardFontDataUrl:null,x=s.StandardFontDataFactory||jh,w=!0!==s.stopAtErrors,S=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,_=!1!==s.isEvalSupported,C="boolean"===typeof s.isOffscreenCanvasSupported?s.isOffscreenCanvasSupported:!gn,k="boolean"===typeof s.isChrome?s.isChrome:!js.platform.isFirefox&&"undefined"!==typeof window&&!(null===(t=window)||void 0===t||!t.chrome),A=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,E="boolean"===typeof s.disableFontFace?s.disableFontFace:gn,T=!0===s.fontExtraProperties,M=!0===s.enableXfa,j=s.ownerDocument||globalThis.document,P=!0===s.disableRange,O=!0===s.disableStream,D=!0===s.disableAutoFetch,N=!0===s.pdfBug,L=s.CanvasFactory||Eh,R=s.FilterFactory||Mh,F=!0===s.enableHWA,I=u?u.length:null!==(n=s.length)&&void 0!==n?n:NaN,z="boolean"===typeof s.useSystemFonts?s.useSystemFonts:!gn&&!E,W="boolean"===typeof s.useWorkerFetch?s.useWorkerFetch:y===Oo&&x===tl&&m&&b&&ii(m,document.baseURI)&&ii(b,document.baseURI);s.canvasFactory&&ai("`canvasFactory`-instance option, please use `CanvasFactory` instead."),s.filterFactory&&ai("`filterFactory`-instance option, please use `FilterFactory` instead.");us(p);const B={canvasFactory:new L({ownerDocument:j,enableHWA:F}),filterFactory:new R({docId:r,ownerDocument:j}),cMapReaderFactory:W?null:new y({baseUrl:m,isCompressed:v}),standardFontDataFactory:W?null:new x({baseUrl:b})};if(!f){const e={verbosity:p,port:Fl.workerPort};f=e.port?Yh.fromPort(e):new Yh(e),i._worker=f}const H={docId:r,apiVersion:"4.8.69",data:o,password:h,disableAutoFetch:D,rangeChunkSize:d,length:I,docBaseUrl:g,enableXfa:M,evaluatorOptions:{maxImageSize:S,disableFontFace:E,ignoreErrors:w,isEvalSupported:_,isOffscreenCanvasSupported:C,isChrome:k,canvasMaxAreaInBytes:A,fontExtraProperties:T,useSystemFonts:z,cMapUrl:W?m:null,standardFontDataUrl:W?b:null}},U={disableFontFace:E,fontExtraProperties:T,ownerDocument:j,pdfBug:N,styleElement:null,loadingParams:{disableAutoFetch:D,enableXfa:M}};return f.promise.then(function(){if(i.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");const e=f.messageHandler.sendWithPromise("GetDocRequest",H,o?[o.buffer]:null);let t;if(u)t=new xc(u,{disableRange:P,disableStream:O});else if(!o){if(!a)throw new Error("getDocument - no `url` parameter provided.");let e;if(gn){e="undefined"!==typeof fetch&&"undefined"!==typeof Response&&"body"in Response.prototype&&ii(a)?jc:zc}else e=ii(a)?jc:Nc;t=new e({url:a,length:I,httpHeaders:l,withCredentials:c,rangeChunkSize:d,disableRange:P,disableStream:O})}return e.then(e=>{if(i.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");const n=new Zl(r,e,f.port),s=new ru(n,i,t,U,B);i._transport=s,n.send("Ready",null)})}).catch(i._capability.reject),i}function Oh(e){return"object"===typeof e&&Number.isInteger(null===e||void 0===e?void 0:e.num)&&e.num>=0&&Number.isInteger(null===e||void 0===e?void 0:e.gen)&&e.gen>=0}class Dh{constructor(){var e,t;this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d".concat((Nh._=(e=Nh._,t=e++,e),t)),this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{var e,t;null!==(e=this._worker)&&void 0!==e&&e.port&&(this._worker._pendingDestroy=!0),await(null===(t=this._transport)||void 0===t?void 0:t.destroy())}catch(s){var n;throw null!==(n=this._worker)&&void 0!==n&&n.port&&delete this._worker._pendingDestroy,s}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}var Nh={_:0};class Lh{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){gs("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Rh{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ys(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){let{intent:e="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Fh=new WeakMap,Ih=new WeakMap,zh=new WeakSet;class Wh{constructor(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];qt(this,zh),Kt(this,Fh,null),Kt(this,Ih,!1),this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new si:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new hu,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new $s({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:i})}getAnnotations(){let{intent:e="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ys(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return(null===(e=this._transport._htmlForXfa)||void 0===e?void 0:e.children[this._pageIndex])||null}render(e){var t,n;let{canvasContext:s,viewport:i,intent:r="display",annotationMode:a=En.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:h=null,pageColors:u=null,printAnnotationStorage:d=null,isEditing:f=!1}=e;null===(t=this._stats)||void 0===t||t.time("Overall");const p=this._transport.getRenderingIntent(r,a,d,f),{renderingIntent:g,cacheKey:m}=p;Zt(Ih,this,!1),Qt(zh,this,Hh).call(this),c||(c=this._transport.getOptionalContentConfig(g));let v=this._intentStates.get(m);v||(v=Object.create(null),this._intentStates.set(m,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);const y=!!(g&wn);var b;v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(b=this._stats)||void 0===b||b.time("Page Request"),this._pumpOperatorList(p));const x=e=>{var t;(v.renderTasks.delete(w),(this._maybeCleanupAfterRender||y)&&Zt(Ih,this,!0),Qt(zh,this,Bh).call(this,!y),e?(w.capability.reject(e),this._abortOperatorList({intentState:v,reason:e instanceof Error?e:new Error(e)})):w.capability.resolve(),this._stats)&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),null!==(t=globalThis.Stats)&&void 0!==t&&t.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},w=new gu({callback:x,params:{canvasContext:s,viewport:i,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!y,pdfBug:this._pdfBug,pageColors:u});((n=v).renderTasks||(n.renderTasks=new Set)).add(w);const S=w.task;return Promise.all([v.displayReadyCapability.promise,c]).then(e=>{var t;let[n,s]=e;if(this.destroyed)x();else{if(null===(t=this._stats)||void 0===t||t.time("Rendering"),!(s.renderingIntent&g))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");w.initializeGraphics({transparency:n,optionalContentConfig:s}),w.operatorListChanged()}}).catch(x),S}getOperatorList(){let{intent:e="display",annotationMode:t=En.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=this._transport.getRenderingIntent(e,t,n,s,!0);let r,a=this._intentStates.get(i.cacheKey);var o,l;(a||(a=Object.create(null),this._intentStates.set(i.cacheKey,a)),a.opListReadCapability)||(r=Object.create(null),r.operatorListChanged=function(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(r))},a.opListReadCapability=Promise.withResolvers(),((o=a).renderTasks||(o.renderTasks=new Set)).add(r),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(l=this._stats)||void 0===l||l.time("Page Request"),this._pumpOperatorList(i));return a.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:e=!1,disableNormalization:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(e=>kh.textContent(e));const t=this.streamTextContent(e);return new Promise(function(e,n){const s=t.getReader(),i={items:[],styles:Object.create(null),lang:null};!function t(){s.read().then(function(n){var s;let{value:r,done:a}=n;a?e(i):(null!==(s=i.lang)&&void 0!==s||(i.lang=r.lang),Object.assign(i.styles,r.styles),i.items.push(...r.items),t())},n)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),Zt(Ih,this,!1),Qt(zh,this,Hh).call(this),Promise.all(e)}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Zt(Ih,this,!0);const t=Qt(zh,this,Bh).call(this,!1);return e&&t&&this._stats&&(this._stats=new si),t}_startRenderPage(e,t){var n,s;const i=this._intentStates.get(t);i&&(null===(n=this._stats)||void 0===n||n.timeEnd("Page Request"),null===(s=i.displayReadyCapability)||void 0===s||s.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&Qt(zh,this,Bh).call(this,!0)}_pumpOperatorList(e){let{renderingIntent:t,cacheKey:n,annotationStorageSerializable:s,modifiedIds:i}=e;const{map:r,transfer:a}=s,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:n,annotationStorage:r,modifiedIds:i},a).getReader(),l=this._intentStates.get(n);l.streamReader=o;const c=()=>{o.read().then(e=>{let{value:t,done:n}=e;n?l.streamReader=null:this._transport.destroyed||(this._renderPageChunk(t,l),c())},e=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const e of l.renderTasks)e.operatorListChanged();Qt(zh,this,Bh).call(this,!0)}if(l.displayReadyCapability)l.displayReadyCapability.reject(e);else{if(!l.opListReadCapability)throw e;l.opListReadCapability.reject(e)}}})};c()}_abortOperatorList(e){let{intentState:t,reason:n,force:s=!1}=e;if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(n instanceof Js){let e=100;return n.extraDelay>0&&n.extraDelay<1e3&&(e+=n.extraDelay),void(t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:n,force:!0})},e))}}if(t.streamReader.cancel(new As(n.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[e,n]of this._intentStates)if(n===t){this._intentStates.delete(e);break}this.cleanup()}}}get stats(){return this._stats}}function Bh(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Qt(zh,this,Hh).call(this),!Jt(Ih,this)||this.destroyed)return!1;if(e)return Zt(Fh,this,setTimeout(()=>{Zt(Fh,this,null),Qt(zh,this,Bh).call(this,!1)},5e3)),!1;for(const{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Zt(Ih,this,!1),!0}function Hh(){Jt(Fh,this)&&(clearTimeout(Jt(Fh,this)),Zt(Fh,this,null))}var Uh=new WeakMap,Vh=new WeakMap;class Gh{constructor(){Kt(this,Uh,new Map),Kt(this,Vh,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};Jt(Vh,this).then(()=>{for(const[e]of Jt(Uh,this))e.call(this,n)})}addEventListener(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=null;if((null===n||void 0===n?void 0:n.signal)instanceof AbortSignal){const{signal:i}=n;if(i.aborted)return void ps("LoopbackPort - cannot use an `aborted` signal.");const r=()=>this.removeEventListener(e,t);s=()=>i.removeEventListener("abort",r),i.addEventListener("abort",r)}Jt(Uh,this).set(t,s)}removeEventListener(e,t){const n=Jt(Uh,this).get(t);null===n||void 0===n||n(),Jt(Uh,this).delete(t)}terminate(){for(const[,e]of Jt(Uh,this))null===e||void 0===e||e();Jt(Uh,this).clear()}}var Xh=new WeakSet;class Yh{constructor(){let{name:e=null,port:t=null,verbosity:n=ds()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(qt(this,Xh),this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){var s;if(null!==(s=Jh._)&&void 0!==s&&s.has(t))throw new Error("Cannot use more than one PDFWorker per port.");return(Jh._||(Jh._=new WeakMap)).set(t,this),void this._initializeFromPort(t)}this._initialize()}get promise(){return gn?Promise.all([il.promise,this._readyCapability.promise]):this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new Zl("main","worker",e),this._messageHandler.on("ready",function(){}),Qt(Xh,this,qh).call(this)}_initialize(){if($h._||Kh(Yh))return void this._setupFakeWorker();let{workerSrc:e}=Yh;try{Yh._isSameOrigin(window.location.href,e)||(e=Yh._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new Zl("main","worker",t),s=()=>{i.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:i.signal}),n.on("test",e=>{i.abort(),!this.destroyed&&e?(this._messageHandler=n,this._port=t,this._webWorker=t,Qt(Xh,this,qh).call(this)):s()}),n.on("ready",e=>{if(i.abort(),this.destroyed)s();else try{r()}catch(t){this._setupFakeWorker()}});const r=()=>{const e=new Uint8Array;n.send("test",e,[e.buffer])};return void r()}catch(t){fs("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){$h._||(ps("Setting up fake worker."),$h._=!0),Yh._setupFakeWorkerGlobal.then(e=>{var t,n;if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const s=new Gh;this._port=s;const i="fake".concat((Qh._=(t=Qh._,n=t++,t),n)),r=new Zl(i+"_worker",i,s);e.setup(r,s),this._messageHandler=new Zl(i,i+"_worker",s),Qt(Xh,this,qh).call(this)}).catch(e=>{this._readyCapability.reject(new Error('Setting up fake worker failed: "'.concat(e.message,'".')))})}destroy(){var e;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),null===(e=Jh._)||void 0===e||e.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){var t;if(null===e||void 0===e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const n=null===(t=Qt(Yh,this,Jh)._)||void 0===t?void 0:t.get(e.port);if(n){if(n._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return n}return new Yh(e)}static get workerSrc(){if(Fl.workerSrc)return Fl.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ys(this,"_setupFakeWorkerGlobal",(async()=>{if($t(Yh,this,Kh))return $t(Yh,this,Kh);return(await import(this.workerSrc)).WorkerMessageHandler})())}}function qh(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}function Kh(e){try{var t;return(null===(t=globalThis.pdfjsWorker)||void 0===t?void 0:t.WorkerMessageHandler)||null}catch(n){return null}}an=Yh;var Qh={_:0},$h={_:!1},Jh={_:void 0};gn&&($h._=Qt(an,an,!0),Fl.workerSrc||(Fl.workerSrc="./pdf.worker.mjs")),an._isSameOrigin=(e,t)=>{let n;try{if(n=new URL(e),!n.origin||"null"===n.origin)return!1}catch(i){return!1}const s=new URL(t,n);return n.origin===s.origin},an._createCDNWrapper=e=>{const t='await import("'.concat(e,'");');return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};var Zh=new WeakMap,eu=new WeakMap,tu=new WeakMap,nu=new WeakMap,su=new WeakMap,iu=new WeakSet;class ru{constructor(e,t,n,s,i){qt(this,iu),Kt(this,Zh,new Map),Kt(this,eu,new Map),Kt(this,tu,new Map),Kt(this,nu,new Map),Kt(this,su,null),this.messageHandler=e,this.loadingTask=t,this.commonObjs=new hu,this.fontLoader=new Eo({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return ys(this,"annotationStorage",new So)}getRenderingIntent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:En.ENABLE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=xn,a=vo;switch(e){case"any":r=bn;break;case"display":break;case"print":r=wn;break;default:ps("getRenderingIntent - invalid intent: ".concat(e))}const o=r&wn&&n instanceof ko?n:this.annotationStorage;switch(t){case En.DISABLE:r+=Cn;break;case En.ENABLE:break;case En.ENABLE_FORMS:r+=Sn;break;case En.ENABLE_STORAGE:r+=_n,a=o.serializable;break;default:ps("getRenderingIntent - invalid annotationMode: ".concat(t))}s&&(r+=kn),i&&(r+=An);const{ids:l,hash:c}=o.modifiedIds;return{renderingIntent:r,cacheKey:[r,a.hash,c].join("_"),annotationStorageSerializable:a,modifiedIds:l}}destroy(){var e;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),null===(e=Jt(su,this))||void 0===e||e.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of Jt(eu,this).values())t.push(s._destroy());Jt(eu,this).clear(),Jt(tu,this).clear(),Jt(nu,this).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const n=this.messageHandler.sendWithPromise("Terminate",null);return t.push(n),Promise.all(t).then(()=>{var e;this.commonObjs.clear(),this.fontLoader.clear(),Jt(Zh,this).clear(),this.filterFactory.destroy(),dh.cleanup(),null===(e=this._networkStream)||void 0===e||e.cancelAllRequests(new As("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(e,t)=>{ms(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then(function(e){let{value:n,done:s}=e;s?t.close():(ms(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(n),1,[n]))}).catch(e=>{t.error(e)})},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})}}),e.on("ReaderHeadersReady",async e=>{await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:s,contentLength:i}=this._fullReader;if(!n||!s){var r;if(this._lastProgress)null===(r=t.onProgress)||void 0===r||r.call(t,this._lastProgress);this._fullReader.onProgress=e=>{var n;null===(n=t.onProgress)||void 0===n||n.call(t,{loaded:e.loaded,total:e.total})}}return{isStreamingSupported:n,isRangeSupported:s,contentLength:i}}),e.on("GetRangeReader",(e,t)=>{ms(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(e.begin,e.end);n?(t.onPull=()=>{n.read().then(function(e){let{value:n,done:s}=e;s?t.close():(ms(n instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(n),1,[n]))}).catch(e=>{t.error(e)})},t.onCancel=e=>{n.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})}):t.close()}),e.on("GetDoc",e=>{let{pdfInfo:n}=e;this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new Rh(n,this))}),e.on("DocException",function(e){let n;switch(e.name){case"PasswordException":n=new xs(e.message,e.code);break;case"InvalidPDFException":n=new Ss(e.message);break;case"MissingPDFException":n=new _s(e.message);break;case"UnexpectedResponseException":n=new Cs(e.message,e.status);break;case"UnknownErrorException":n=new ws(e.message,e.details);break;default:gs("DocException - expected a valid Error.")}t._capability.reject(n)}),e.on("PasswordRequest",e=>{if(Zt(su,this,Promise.withResolvers()),t.onPassword){const s=e=>{e instanceof Error?Jt(su,this).reject(e):Jt(su,this).resolve({password:e})};try{t.onPassword(s,e.code)}catch(n){Jt(su,this).reject(n)}}else Jt(su,this).reject(new xs(e.message,e.code));return Jt(su,this).promise}),e.on("DataLoaded",e=>{var n;null===(n=t.onProgress)||void 0===n||n.call(t,{loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)}),e.on("StartRenderPage",e=>{if(this.destroyed)return;Jt(eu,this).get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)}),e.on("commonobj",t=>{var n;let[s,i,r]=t;if(this.destroyed)return null;if(this.commonObjs.has(s))return null;switch(i){case"Font":const{disableFontFace:t,fontExtraProperties:a,pdfBug:o}=this._params;if("error"in r){const e=r.error;ps("Error during font loading: ".concat(e)),this.commonObjs.resolve(s,e);break}const l=o&&null!==(n=globalThis.FontInspector)&&void 0!==n&&n.enabled?(e,t)=>globalThis.FontInspector.fontAdded(e,t):null,c=new To(r,{disableFontFace:t,inspectFont:l});this.fontLoader.bind(c).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!a&&c.data&&(c.data=null),this.commonObjs.resolve(s,c)});break;case"CopyLocalImage":const{imageRef:h}=r;ms(h,"The imageRef must be defined.");for(const e of Jt(eu,this).values())for(const[,t]of e.objs)if((null===t||void 0===t?void 0:t.ref)===h)return t.dataLen?(this.commonObjs.resolve(s,structuredClone(t)),t.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,r);break;default:throw new Error("Got unknown common object type ".concat(i))}return null}),e.on("obj",e=>{let[t,n,s,i]=e;if(this.destroyed)return;const r=Jt(eu,this).get(n);var a;if(!r.objs.has(t))if(0!==r._intentStates.size)switch(s){case"Image":r.objs.resolve(t,i),(null===i||void 0===i?void 0:i.dataLen)>1e7&&(r._maybeCleanupAfterRender=!0);break;case"Pattern":r.objs.resolve(t,i);break;default:throw new Error("Got unknown object type ".concat(s))}else null===i||void 0===i||null===(a=i.bitmap)||void 0===a||a.close()}),e.on("DocProgress",e=>{var n;this.destroyed||null===(n=t.onProgress)||void 0===n||n.call(t,{loaded:e.loaded,total:e.total})}),e.on("FetchBuiltInCMap",async e=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(e)}),e.on("FetchStandardFontData",async e=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(e)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var e,t;this.annotationStorage.size<=0&&ps("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:n,transfer:s}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:n,filename:null!==(e=null===(t=this._fullReader)||void 0===t?void 0:t.filename)&&void 0!==e?e:null},s).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=Jt(tu,this).get(t);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&Jt(nu,this).set(n.refStr,e);const s=new Wh(t,n,this,this._params.pdfBug);return Jt(eu,this).set(t,s),s});return Jt(tu,this).set(t,s),s}getPageIndex(e){return Oh(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return Qt(iu,this,au).call(this,"GetFieldObjects")}hasJSActions(){return Qt(iu,this,au).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!==typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Qt(iu,this,au).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return Qt(iu,this,au).call(this,"GetOptionalContentConfig").then(t=>new yc(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=Jt(Zh,this).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(e=>{var t,n,s,i;return{info:e[0],metadata:e[1]?new ac(e[1]):null,contentDispositionFilename:null!==(t=null===(n=this._fullReader)||void 0===n?void 0:n.filename)&&void 0!==t?t:null,contentLength:null!==(s=null===(i=this._fullReader)||void 0===i?void 0:i.contentLength)&&void 0!==s?s:null}});return Jt(Zh,this).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of Jt(eu,this).values()){if(!e.cleanup())throw new Error("startCleanup: Page ".concat(e.pageNumber," is currently rendering."))}this.commonObjs.clear(),e||this.fontLoader.clear(),Jt(Zh,this).clear(),this.filterFactory.destroy(!0),dh.cleanup()}}cachedPageNumber(e){var t;if(!Oh(e))return null;const n=0===e.gen?"".concat(e.num,"R"):"".concat(e.num,"R").concat(e.gen);return null!==(t=Jt(nu,this).get(n))&&void 0!==t?t:null}}function au(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=Jt(Zh,this).get(e);if(n)return n;const s=this.messageHandler.sendWithPromise(e,t);return Jt(Zh,this).set(e,s),s}const ou=Symbol("INITIAL_DATA");var lu=new WeakMap,cu=new WeakSet;class hu{constructor(){qt(this,cu),Kt(this,lu,Object.create(null))}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){const n=Qt(cu,this,uu).call(this,e);return n.promise.then(()=>t(n.data)),null}const n=Jt(lu,this)[e];if(!n||n.data===ou)throw new Error("Requesting object that isn't resolved yet ".concat(e,"."));return n.data}has(e){const t=Jt(lu,this)[e];return!!t&&t.data!==ou}resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=Qt(cu,this,uu).call(this,e);n.data=t,n.resolve()}clear(){for(const t in Jt(lu,this)){var e;const{data:n}=Jt(lu,this)[t];null===n||void 0===n||null===(e=n.bitmap)||void 0===e||e.close()}Zt(lu,this,Object.create(null))}*[Symbol.iterator](){for(const e in Jt(lu,this)){const{data:t}=Jt(lu,this)[e];t!==ou&&(yield[e,t])}}}function uu(e){var t;return(t=Jt(lu,this))[e]||(t[e]=c(c({},Promise.withResolvers()),{},{data:ou}))}var du=new WeakMap;class fu{constructor(e){Kt(this,du,null),Zt(du,this,e),this.onContinue=null}get promise(){return Jt(du,this).capability.promise}cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Jt(du,this).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=Jt(du,this).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=Jt(du,this);return e.form||e.canvas&&(null===t||void 0===t?void 0:t.size)>0}}var pu=new WeakMap;class gu{constructor(e){let{callback:t,params:n,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:u=!1,pageColors:d=null}=e;Kt(this,pu,null),this.callback=t,this.params=n,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===h&&"undefined"!==typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new fu(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=n.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(e){var t,n;let{transparency:s=!1,optionalContentConfig:i}=e;if(this.cancelled)return;if(this._canvas){if(mu._.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");mu._.add(this._canvas)}this._pdfBug&&null!==(t=globalThis.StepperManager)&&void 0!==t&&t.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:r,viewport:a,transform:o,background:l}=this.params;this.gfx=new Nl(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:i},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:a,transparency:s,background:l}),this.operatorListIdx=0,this.graphicsReady=!0,null===(n=this.graphicsReadyCallback)||void 0===n||n.call(this)}cancel(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,null===(e=this.gfx)||void 0===e||e.endDrawing(),Jt(pu,this)&&(window.cancelAnimationFrame(Jt(pu,this)),Zt(pu,this,null)),mu._.delete(this._canvas),this.callback(t||new Js("Rendering cancelled, page ".concat(this._pageIndex+1),n))}operatorListChanged(){var e;this.graphicsReady?(null===(e=this.stepper)||void 0===e||e.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?Zt(pu,this,window.requestAnimationFrame(()=>{Zt(pu,this,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),mu._.delete(this._canvas),this.callback())))}}var mu={_:new WeakSet};const vu="4.8.69",yu="3634dab10";function bu(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}function xu(e){return Math.max(0,Math.min(255,255*e))}class wu{static CMYK_G(e){let[t,n,s,i]=e;return["G",1-Math.min(1,.3*t+.59*s+.11*n+i)]}static G_CMYK(e){let[t]=e;return["CMYK",0,0,0,1-t]}static G_RGB(e){let[t]=e;return["RGB",t,t,t]}static G_rgb(e){let[t]=e;return t=xu(t),[t,t,t]}static G_HTML(e){let[t]=e;const n=bu(t);return"#".concat(n).concat(n).concat(n)}static RGB_G(e){let[t,n,s]=e;return["G",.3*t+.59*n+.11*s]}static RGB_rgb(e){return e.map(xu)}static RGB_HTML(e){return"#".concat(e.map(bu).join(""))}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(e){let[t,n,s,i]=e;return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,n+i)]}static CMYK_rgb(e){let[t,n,s,i]=e;return[xu(1-Math.min(1,t+i)),xu(1-Math.min(1,s+i)),xu(1-Math.min(1,n+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK(e){let[t,n,s]=e;const i=1-t,r=1-n,a=1-s;return["CMYK",i,r,a,Math.min(i,r,a)]}}class Su{create(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width","".concat(e,"px")),s.setAttribute("height","".concat(t,"px"))),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox","0 0 ".concat(e," ").concat(t)),s}createElement(e){if("string"!==typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){gs("Abstract method `_createSVG` called.")}}class _u extends Su{_createSVG(e){return document.createElementNS(qs,e)}}class Cu{static setupStorage(e,t,n,s,i){const r=s.getValue(t,{value:null});switch(n.name){case"textarea":if(null!==r.value&&(e.textContent=r.value),"print"===i)break;e.addEventListener("input",e=>{s.setValue(t,{value:e.target.value})});break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(r.value===n.attributes.xfaOn?e.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&e.removeAttribute("checked"),"print"===i)break;e.addEventListener("change",e=>{s.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})})}else{if(null!==r.value&&e.setAttribute("value",r.value),"print"===i)break;e.addEventListener("input",e=>{s.setValue(t,{value:e.target.value})})}break;case"select":if(null!==r.value){e.setAttribute("value",r.value);for(const e of n.children)e.attributes.value===r.value?e.attributes.selected=!0:e.attributes.hasOwnProperty("selected")&&delete e.attributes.selected}e.addEventListener("input",e=>{const n=e.target.options,i=-1===n.selectedIndex?"":n[n.selectedIndex].value;s.setValue(t,{value:i})})}}static setAttributes(e){let{html:t,element:n,storage:s=null,intent:i,linkService:r}=e;const{attributes:a}=n,o=t instanceof HTMLAnchorElement;"radio"===a.type&&(a.name="".concat(a.name,"-").concat(i));for(const[l,c]of Object.entries(a))if(null!==c&&void 0!==c)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||"href"!==l&&"newWindow"!==l)&&t.setAttribute(l,c)}o&&r.addLinkAttributes(t,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(t,a.dataId,n,s)}static render(e){const t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,i=e.intent||"display",r=document.createElement(s.name);s.attributes&&this.setAttributes({html:r,element:s,intent:i,linkService:n});const a="richText"!==i,o=e.div;if(o.append(r),e.viewport){const t="matrix(".concat(e.viewport.transform.join(","),")");o.style.transform=t}a&&o.setAttribute("class","xfaLayer xfaFont");const l=[];if(0===s.children.length){if(s.value){const e=document.createTextNode(s.value);r.append(e),a&&kh.shouldBuildText(s.name)&&l.push(e)}return{textDivs:l}}const c=[[s,-1,r]];for(;c.length>0;){var h,u;const[e,s,r]=c.at(-1);if(s+1===e.children.length){c.pop();continue}const o=e.children[++c.at(-1)[1]];if(null===o)continue;const{name:d}=o;if("#text"===d){const e=document.createTextNode(o.value);l.push(e),r.append(e);continue}const f=null!==o&&void 0!==o&&null!==(h=o.attributes)&&void 0!==h&&h.xmlns?document.createElementNS(o.attributes.xmlns,d):document.createElement(d);if(r.append(f),o.attributes&&this.setAttributes({html:f,element:o,storage:t,intent:i,linkService:n}),(null===(u=o.children)||void 0===u?void 0:u.length)>0)c.push([o,-1,f]);else if(o.value){const e=document.createTextNode(o.value);a&&kh.shouldBuildText(d)&&l.push(e),f.append(e)}}for(const d of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:l}}static update(e){const t="matrix(".concat(e.viewport.transform.join(","),")");e.div.style.transform=t,e.div.hidden=!1}}const ku=1e3,Au=new WeakSet;function Eu(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class Tu{static create(e){switch(e.data.annotationType){case zn:return new Ru(e);case In:return new Wu(e);case ts:switch(e.data.fieldType){case"Tx":return new Hu(e);case"Btn":return e.data.radioButton?new Gu(e):e.data.checkBox?new Vu(e):new Xu(e);case"Ch":return new Yu(e);case"Sig":return new Uu(e)}return new Bu(e);case Zn:return new qu(e);case Wn:return new kd(e);case Bn:return new Ed(e);case Hn:return new Md(e);case Un:return new Pd(e);case Gn:return new Dd(e);case $n:return new Ld(e);case Jn:return new Fd(e);case Vn:return new Nd(e);case Xn:return new Id(e);case Yn:return new zd(e);case qn:return new Wd(e);case Kn:return new Bd(e);case Qn:return new Hd(e);case es:return new Gd(e);default:return new Du(e)}}}var Mu=new WeakMap,ju=new WeakMap,Pu=new WeakMap,Ou=new WeakSet;class Du{constructor(e){let{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};qt(this,Ou),Kt(this,Mu,null),Kt(this,ju,!1),Kt(this,Pu,null),this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData(e){let{titleObj:t,contentsObj:n,richText:s}=e;return!!(null!==t&&void 0!==t&&t.str||null!==n&&void 0!==n&&n.str||null!==s&&void 0!==s&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Du._hasPopupData(this.data)}updateEdited(e){var t;if(!this.container)return;Jt(Mu,this)||Zt(Mu,this,{rect:this.data.rect.slice(0)});const{rect:n}=e;n&&Qt(Ou,this,Nu).call(this,n),null===(t=Jt(Pu,this))||void 0===t||t.popup.updateEdited(e)}resetEdited(){var e;Jt(Mu,this)&&(Qt(Ou,this,Nu).call(this,Jt(Mu,this).rect),null===(e=Jt(Pu,this))||void 0===e||e.popup.resetEdited(),Zt(Mu,this,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:s}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),this instanceof Bu||(i.tabIndex=ku);const{style:r}=i;if(r.zIndex=this.parent.zIndex++,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof qu){const{rotation:e}=t;return t.hasOwnCanvas||0===e||this.setRotation(e,i),i}const{width:a,height:o}=Eu(t.rect);if(!e&&t.borderStyle.width>0){r.borderWidth="".concat(t.borderStyle.width,"px");const e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;if(e>0||n>0){const t="calc(".concat(e,"px * var(--scale-factor)) / calc(").concat(n,"px * var(--scale-factor))");r.borderRadius=t}else if(this instanceof Gu){const e="calc(".concat(a,"px * var(--scale-factor)) / calc(").concat(o,"px * var(--scale-factor))");r.borderRadius=e}switch(t.borderStyle.style){case ns:r.borderStyle="solid";break;case ss:r.borderStyle="dashed";break;case is:ps("Unimplemented border style: beveled");break;case rs:ps("Unimplemented border style: inset");break;case as:r.borderBottomStyle="solid"}const s=t.borderColor||null;s?(Zt(ju,this,!0),r.borderColor=Os.makeHexColor(0|s[0],0|s[1],0|s[2])):r.borderWidth=0}const l=Os.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:c,pageHeight:h,pageX:u,pageY:d}=s.rawDims;r.left="".concat(100*(l[0]-u)/c,"%"),r.top="".concat(100*(l[1]-d)/h,"%");const{rotation:f}=t;return t.hasOwnCanvas||0===f?(r.width="".concat(100*a/c,"%"),r.height="".concat(100*o/h,"%")):this.setRotation(f,i),i}setRotation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims,{width:i,height:r}=Eu(this.data.rect);let a,o;e%180===0?(a=100*i/n,o=100*r/s):(a=100*r/n,o=100*i/s),t.style.width="".concat(a,"%"),t.style.height="".concat(o,"%"),t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(e,t,n)=>{const s=n.detail[e],i=s[0],r=s.slice(1);n.target.style[t]=wu["".concat(i,"_HTML")](r),this.annotationStorage.setValue(this.data.id,{[t]:wu["".concat(i,"_rgb")](r)})};return ys(this,"_commonActions",{display:e=>{const{display:t}=e.detail,n=t%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:1===t||2===t})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:t}=e.detail;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{const t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const s of Object.keys(t.detail)){const i=e[s]||n[s];null===i||void 0===i||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[s,i]of Object.entries(t)){const r=n[s];if(r){r({detail:{[s]:i},target:e}),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,s,i]=this.data.rect.map(e=>Math.fround(e));if(8===e.length){const[r,a,o,l]=e.subarray(2,6);if(s===r&&i===a&&t===o&&n===l)return}const{style:r}=this.container;let a;if(Jt(ju,this)){const{borderColor:e,borderWidth:t}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">','<g fill="transparent" stroke="'.concat(e,'" stroke-width="').concat(t,'">')],this.container.classList.add("hasBorder")}const o=s-t,l=i-n,{svgFactory:c}=this,h=c.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);const u=c.createElement("defs");h.append(u);const d=c.createElement("clipPath"),f="clippath_".concat(this.data.id);d.setAttribute("id",f),d.setAttribute("clipPathUnits","objectBoundingBox"),u.append(d);for(let g=2,m=e.length;g<m;g+=8){var p;const n=e[g],s=e[g+1],r=e[g+2],h=e[g+3],u=c.createElement("rect"),f=(r-t)/o,m=(i-s)/l,v=(n-r)/o,y=(s-h)/l;u.setAttribute("x",f),u.setAttribute("y",m),u.setAttribute("width",v),u.setAttribute("height",y),d.append(u),null===(p=a)||void 0===p||p.push('<rect vector-effect="non-scaling-stroke" x="'.concat(f,'" y="').concat(m,'" width="').concat(v,'" height="').concat(y,'"/>'))}Jt(ju,this)&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath="url(#".concat(f,")")}_createPopup(){const{data:e}=this,t=Zt(Pu,this,new qu({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:"popup_".concat(e.id),rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){gs("Abstract method `AnnotationElement.render` called")}_getElementsByName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:e,id:i,exportValues:r}of s){if(-1===e)continue;if(i===t)continue;const s="string"===typeof r?r:null,a=document.querySelector('[data-element-id="'.concat(i,'"]'));!a||Au.has(a)?n.push({id:i,exportValue:s,domElement:a}):ps("_getElementsByName - element not allowed: ".concat(i))}return n}for(const s of document.getElementsByName(e)){const{exportValue:e}=s,i=s.getAttribute("data-element-id");i!==t&&(Au.has(s)&&n.push({id:i,exportValue:e,domElement:s}))}return n}show(){var e;this.container&&(this.container.hidden=!1),null===(e=this.popup)||void 0===e||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),null===(e=this.popup)||void 0===e||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;null===(n=this.linkService.eventBus)||void 0===n||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}}function Nu(e){const{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:r,pageX:a,pageY:o}}}}=this;null===n||void 0===n||n.splice(0,4,...e);const{width:l,height:c}=Eu(e);t.left="".concat(100*(e[0]-a)/i,"%"),t.top="".concat(100*(r-e[3]+o)/r,"%"),0===s?(t.width="".concat(100*l/i,"%"),t.height="".concat(100*c/r,"%")):this.setRotation(s)}var Lu=new WeakSet;class Ru extends Du{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,{isRenderable:!0,ignoreBorder:!(null===t||void 0===t||!t.ignoreBorder),createQuadrilaterals:!0}),qt(this,Lu),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let s=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(n,e.action),s=!0):e.attachment?(Qt(Lu,this,Iu).call(this,n,e.attachment,e.attachmentDest),s=!0):e.setOCGState?(Qt(Lu,this,zu).call(this,n,e.setOCGState),s=!0):e.dest?(this._bindLink(n,e.dest),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),s=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(n,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(n),this.container}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&Qt(Lu,this,Fu).call(this)}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),Qt(Lu,this,Fu).call(this)}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(t.actions)){const i=n.get(s);i&&(e[i]=()=>{var e;return null===(e=this.linkService.eventBus)||void 0===e||e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:s}}),!1})}e.onclick||(e.onclick=()=>!1),Qt(Lu,this,Fu).call(this)}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),Qt(Lu,this,Fu).call(this),!this._fieldObjects)return ps('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(e.onclick=()=>!1));e.onclick=()=>{null===n||void 0===n||n();const{fields:e,refs:s,include:i}=t,r=[];if(0!==e.length||0!==s.length){const t=new Set(s);for(const n of e){const e=this._fieldObjects[n]||[];for(const{id:n}of e)t.add(n)}for(const e of Object.values(this._fieldObjects))for(const n of e)t.has(n.id)===i&&r.push(n)}else for(const t of Object.values(this._fieldObjects))r.push(...t);const a=this.annotationStorage,o=[];for(const t of r){const{id:e}=t;switch(o.push(e),t.type){case"text":{const n=t.defaultValue||"";a.setValue(e,{value:n});break}case"checkbox":case"radiobutton":{const n=t.defaultValue===t.exportValues;a.setValue(e,{value:n});break}case"combobox":case"listbox":{const n=t.defaultValue||"";a.setValue(e,{value:n});break}default:continue}const n=document.querySelector('[data-element-id="'.concat(e,'"]'));n&&(Au.has(n)?n.dispatchEvent(new Event("resetform")):ps("_bindResetFormAction - element not allowed: ".concat(e)))}var l;this.enableScripting&&(null===(l=this.linkService.eventBus)||void 0===l||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:o,name:"ResetForm"}}));return!1}}}function Fu(){this.container.setAttribute("data-internal-link","")}function Iu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>{var e;return null===(e=this.downloadManager)||void 0===e||e.openOrDownloadData(t.content,t.filename,n),!1},Qt(Lu,this,Fu).call(this)}function zu(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),Qt(Lu,this,Fu).call(this)}class Wu extends Du{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Bu extends Du{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&("CANVAS"===(null===(t=e.previousSibling)||void 0===t?void 0:t.nodeName)&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return js.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,i){n.includes("mouse")?e.addEventListener(n,e=>{var t;null===(t=this.linkService.eventBus)||void 0===t||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:i(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})}):e.addEventListener(n,e=>{var r;if("blur"===n){if(!t.focused||!e.relatedTarget)return;t.focused=!1}else if("focus"===n){if(t.focused)return;t.focused=!0}i&&(null===(r=this.linkService.eventBus)||void 0===r||r.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:i(e)}}))})}_setEventListeners(e,t,n,s){for(const[o,l]of n){var i,r,a;if("Action"===l||null!==(i=this.data.actions)&&void 0!==i&&i[l])"Focus"!==l&&"Blur"!==l||t||(t={focused:!1}),this._setEventListener(e,t,o,l,s),"Focus"!==l||null!==(r=this.data.actions)&&void 0!==r&&r.Blur?"Blur"!==l||null!==(a=this.data.actions)&&void 0!==a&&a.Focus||this._setEventListener(e,t,"focus","Focus",null):this._setEventListener(e,t,"blur","Blur",null)}}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":Os.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||9,i=e.style;let r;const a=e=>Math.round(10*e)/10;if(this.data.multiLine){const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),t=e/(Math.round(e/(yn*s))||1);r=Math.min(s,a(t/yn))}else{const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);r=Math.min(s,a(e/yn))}i.fontSize="calc(".concat(r,"px * var(--scale-factor))"),i.color=Os.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Hu extends Bu{constructor(e){super(e,{isRenderable:e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,n,s){const i=this.annotationStorage;for(const r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=n),i.setValue(r.id,{[s]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){var s;const r=e.getValue(t,{value:this.data.fieldValue});let a=r.value||"";const o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&a.length>o&&(a=a.slice(0,o));let l=r.formattedValue||(null===(s=this.data.textContent)||void 0===s?void 0:s.join("\n"))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));const c={userValue:a,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=null!==l&&void 0!==l?l:a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",null!==l&&void 0!==l?l:a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Au.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=ku,this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",s=>{e.setValue(t,{value:s.target.value}),this.setPropertyOnSiblings(n,"value",s.target.value,"value"),c.formattedValue=null}),n.addEventListener("resetform",e=>{var t;const s=null!==(t=this.data.defaultFieldValue)&&void 0!==t?t:"";n.value=c.userValue=s,c.formattedValue=null});let h=e=>{const{formattedValue:t}=c;null!==t&&void 0!==t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var i;n.addEventListener("focus",e=>{var t;if(c.focused)return;const{target:n}=e;c.userValue&&(n.value=c.userValue),c.lastCommittedValue=n.value,c.commitKey=1,null!==(t=this.data.actions)&&void 0!==t&&t.Focus||(c.focused=!0)}),n.addEventListener("updatefromsandbox",n=>{this.showElementAndHideCanvas(n.target);const s={value(n){var s;c.userValue=null!==(s=n.detail.value)&&void 0!==s?s:"",e.setValue(t,{value:c.userValue.toString()}),n.target.value=c.userValue},formattedValue(n){const{formattedValue:s}=n.detail;c.formattedValue=s,null!==s&&void 0!==s&&n.target!==document.activeElement&&(n.target.value=s),e.setValue(t,{formattedValue:s})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:n=>{var s;const{charLimit:i}=n.detail,{target:r}=n;if(0===i)return void r.removeAttribute("maxLength");r.setAttribute("maxLength",i);let a=c.userValue;!a||a.length<=i||(a=a.slice(0,i),r.value=c.userValue=a,e.setValue(t,{value:a}),null===(s=this.linkService.eventBus)||void 0===s||s.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:a,willCommit:!0,commitKey:1,selStart:r.selectionStart,selEnd:r.selectionEnd}}))}};this._dispatchEventFromSandbox(s,n)}),n.addEventListener("keydown",e=>{var n;c.commitKey=1;let s=-1;if("Escape"===e.key?s=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(c.commitKey=3):s=2,-1===s)return;const{value:i}=e.target;c.lastCommittedValue!==i&&(c.lastCommittedValue=i,c.userValue=i,null===(n=this.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,willCommit:!0,commitKey:s,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))});const s=h;h=null,n.addEventListener("blur",e=>{var n;if(!c.focused||!e.relatedTarget)return;null!==(n=this.data.actions)&&void 0!==n&&n.Blur||(c.focused=!1);const{value:i}=e.target;var r;(c.userValue=i,c.lastCommittedValue!==i)&&(null===(r=this.linkService.eventBus)||void 0===r||r.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,willCommit:!0,commitKey:c.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}));s(e)}),null!==(i=this.data.actions)&&void 0!==i&&i.Keystroke&&n.addEventListener("beforeinput",e=>{var n;c.lastCommittedValue=null;const{data:s,target:i}=e,{value:r,selectionStart:a,selectionEnd:o}=i;let l=a,h=o;switch(e.inputType){case"deleteWordBackward":{const e=r.substring(0,a).match(/\w*[^\w]*$/);e&&(l-=e[0].length);break}case"deleteWordForward":{const e=r.substring(a).match(/^[^\w]*\w*/);e&&(h+=e[0].length);break}case"deleteContentBackward":a===o&&(l-=1);break;case"deleteContentForward":a===o&&(h+=1)}e.preventDefault(),null===(n=this.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:r,change:s||"",willCommit:!1,selStart:l,selEnd:h}})}),this._setEventListeners(n,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.value)}if(h&&n.addEventListener("blur",h),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing="calc(".concat(e,"px * var(--scale-factor) - 1ch)")}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Uu extends Bu{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Vu extends Bu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;"string"===typeof s&&(s="Off"!==s,e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return Au.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,s&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=ku,i.addEventListener("change",s=>{const{name:i,checked:r}=s.target;for(const a of this._getElementsByName(i,n)){const n=r&&a.exportValue===t.exportValue;a.domElement&&(a.domElement.checked=n),e.setValue(a.id,{value:n})}e.setValue(n,{value:r})}),i.addEventListener("resetform",e=>{const n=t.defaultFieldValue||"Off";e.target.checked=n===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",t=>{const s={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(n,{value:t.target.checked})}};this._dispatchEventFromSandbox(s,t)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Gu extends Bu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if("string"===typeof s&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(const r of this._getElementsByName(t.fieldName,n))e.setValue(r.id,{value:!1});const i=document.createElement("input");if(Au.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,s&&i.setAttribute("checked",!0),i.tabIndex=ku,i.addEventListener("change",t=>{const{name:s,checked:i}=t.target;for(const r of this._getElementsByName(s,n))e.setValue(r.id,{value:!1});e.setValue(n,{value:i})}),i.addEventListener("resetform",e=>{const n=t.defaultFieldValue;e.target.checked=null!==n&&void 0!==n&&n===t.buttonValue}),this.enableScripting&&this.hasJSActions){const s=t.buttonValue;i.addEventListener("updatefromsandbox",t=>{const i={value:t=>{const i=s===t.detail.value;for(const s of this._getElementsByName(t.target.name)){const t=i&&s.id===n;s.domElement&&(s.domElement.checked=t),e.setValue(s.id,{value:t})}}};this._dispatchEventFromSandbox(i,t)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Xu extends Ru{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",e=>{this._dispatchEventFromSandbox({},e)})),e}}class Yu extends Bu{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Au.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=ku;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",e=>{const t=this.data.defaultFieldValue;for(const n of s.options)n.selected=n.value===t});for(const c of this.data.options){const e=document.createElement("option");e.textContent=c.displayValue,e.value=c.exportValue,n.value.includes(c.exportValue)&&(e.setAttribute("selected",!0),i=!1),s.append(e)}let r=null;if(i){const e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),s.prepend(e),r=()=>{e.remove(),s.removeEventListener("input",r),r=null},s.addEventListener("input",r)}const a=e=>{const t=e?"value":"textContent",{options:n,multiple:i}=s;return i?Array.prototype.filter.call(n,e=>e.selected).map(e=>e[t]):-1===n.selectedIndex?null:n[n.selectedIndex][t]};let o=a(!1);const l=e=>{const t=e.target.options;return Array.prototype.map.call(t,e=>({displayValue:e.textContent,exportValue:e.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",n=>{const i={value(n){var i;null===(i=r)||void 0===i||i();const l=n.detail.value,c=new Set(Array.isArray(l)?l:[l]);for(const e of s.options)e.selected=c.has(e.value);e.setValue(t,{value:a(!0)}),o=a(!1)},multipleSelection(e){s.multiple=!0},remove(n){const i=s.options,r=n.detail.remove;if(i[r].selected=!1,s.remove(r),i.length>0){-1===Array.prototype.findIndex.call(i,e=>e.selected)&&(i[0].selected=!0)}e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},clear(n){for(;0!==s.length;)s.remove(0);e.setValue(t,{value:null,items:[]}),o=a(!1)},insert(n){const{index:i,displayValue:r,exportValue:c}=n.detail.insert,h=s.children[i],u=document.createElement("option");u.textContent=r,u.value=c,h?h.before(u):s.append(u),e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},items(n){const{items:i}=n.detail;for(;0!==s.length;)s.remove(0);for(const e of i){const{displayValue:t,exportValue:n}=e,i=document.createElement("option");i.textContent=t,i.value=n,s.append(i)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:l(n)}),o=a(!1)},indices(n){const s=new Set(n.detail.indices);for(const e of n.target.options)e.selected=s.has(e.index);e.setValue(t,{value:a(!0)}),o=a(!1)},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(i,n)}),s.addEventListener("input",n=>{var s;const i=a(!0),r=a(!1);e.setValue(t,{value:i}),n.preventDefault(),null===(s=this.linkService.eventBus)||void 0===s||s.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:o,change:r,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],e=>e.target.value)):s.addEventListener("input",function(n){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class qu extends Du{constructor(e){const{data:t,elements:n}=e;super(e,{isRenderable:Du._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new gd({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(e=>"".concat(Is).concat(e)).join(",")),this.container}}var Ku=new WeakMap,Qu=new WeakMap,$u=new WeakMap,Ju=new WeakMap,Zu=new WeakMap,ed=new WeakMap,td=new WeakMap,nd=new WeakMap,sd=new WeakMap,id=new WeakMap,rd=new WeakMap,ad=new WeakMap,od=new WeakMap,ld=new WeakMap,cd=new WeakMap,hd=new WeakMap,ud=new WeakMap,dd=new WeakMap,fd=new WeakMap,pd=new WeakSet;class gd{constructor(e){let{container:t,color:n,elements:s,titleObj:i,modificationDate:r,contentsObj:a,richText:o,parent:l,rect:c,parentRect:h,open:u}=e;qt(this,pd),Kt(this,Ku,Qt(pd,this,xd).bind(this)),Kt(this,Qu,Qt(pd,this,Cd).bind(this)),Kt(this,$u,Qt(pd,this,_d).bind(this)),Kt(this,Ju,Qt(pd,this,Sd).bind(this)),Kt(this,Zu,null),Kt(this,ed,null),Kt(this,td,null),Kt(this,nd,null),Kt(this,sd,null),Kt(this,id,null),Kt(this,rd,null),Kt(this,ad,!1),Kt(this,od,null),Kt(this,ld,null),Kt(this,cd,null),Kt(this,hd,null),Kt(this,ud,null),Kt(this,dd,null),Kt(this,fd,!1),Zt(ed,this,t),Zt(ud,this,i),Zt(td,this,a),Zt(hd,this,o),Zt(id,this,l),Zt(Zu,this,n),Zt(cd,this,c),Zt(rd,this,h),Zt(sd,this,s),Zt(nd,this,oi.toDateObject(r)),this.trigger=s.flatMap(e=>e.getElementsToTriggerPopup());for(const f of this.trigger)f.addEventListener("click",Jt(Ju,this)),f.addEventListener("mouseenter",Jt($u,this)),f.addEventListener("mouseleave",Jt(Qu,this)),f.classList.add("popupTriggerArea");for(const f of s){var d;null===(d=f.container)||void 0===d||d.addEventListener("keydown",Jt(Ku,this))}Jt(ed,this).hidden=!0,u&&Qt(pd,this,Sd).call(this)}render(){if(Jt(od,this))return;const e=Zt(od,this,document.createElement("div"));if(e.className="popup",Jt(Zu,this)){const t=e.style.outlineColor=Os.makeHexColor(...Jt(Zu,this));if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))e.style.backgroundColor="color-mix(in srgb, ".concat(t," 30%, white)");else{const t=.7;e.style.backgroundColor=Os.makeHexColor(...Jt(Zu,this).map(e=>Math.floor(t*(255-e)+e)))}}const t=document.createElement("span");t.className="header";const n=document.createElement("h1");if(t.append(n),({dir:n.dir,str:n.textContent}=Jt(ud,this)),e.append(t),Jt(nd,this)){const e=document.createElement("span");e.classList.add("popupDate"),e.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),e.setAttribute("data-l10n-args",JSON.stringify({dateObj:Jt(nd,this).valueOf()})),t.append(e)}const s=$t(pd,this,md);if(s)Cu.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const t=this._formatContents(Jt(td,this));e.append(t)}Jt(ed,this).append(e)}_formatContents(e){let{str:t,dir:n}=e;const s=document.createElement("p");s.classList.add("popupContent"),s.dir=n;const i=t.split(/(?:\r\n?|\n)/);for(let r=0,a=i.length;r<a;++r){const e=i[r];s.append(document.createTextNode(e)),r<a-1&&s.append(document.createElement("br"))}return s}updateEdited(e){var t;let{rect:n,popupContent:s}=e;Jt(dd,this)||Zt(dd,this,{contentsObj:Jt(td,this),richText:Jt(hd,this)}),n&&Zt(ld,this,null),s&&(Zt(hd,this,Qt(pd,this,bd).call(this,s)),Zt(td,this,null)),null===(t=Jt(od,this))||void 0===t||t.remove(),Zt(od,this,null)}resetEdited(){var e;Jt(dd,this)&&(({contentsObj:Xt(Zt,[td,this])._,richText:Xt(Zt,[hd,this])._}=Jt(dd,this)),Zt(dd,this,null),null===(e=Jt(od,this))||void 0===e||e.remove(),Zt(od,this,null),Zt(ld,this,null))}forceHide(){Zt(fd,this,this.isVisible),Jt(fd,this)&&(Jt(ed,this).hidden=!0)}maybeShow(){Jt(fd,this)&&(Jt(od,this)||Qt(pd,this,_d).call(this),Zt(fd,this,!1),Jt(ed,this).hidden=!1)}get isVisible(){return!1===Jt(ed,this).hidden}}function md(e){const t=Jt(hd,e),n=Jt(td,e);return null===t||void 0===t||!t.str||null!==n&&void 0!==n&&n.str&&n.str!==t.str?null:Jt(hd,e).html||null}function vd(e){var t;return(null===(t=$t(pd,e,md))||void 0===t||null===(t=t.attributes)||void 0===t||null===(t=t.style)||void 0===t?void 0:t.fontSize)||0}function yd(e){var t;return(null===(t=$t(pd,e,md))||void 0===t||null===(t=t.attributes)||void 0===t||null===(t=t.style)||void 0===t?void 0:t.color)||null}function bd(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:$t(pd,this,yd),fontSize:$t(pd,this,vd)?"calc(".concat($t(pd,this,vd),"px * var(--scale-factor))"):""}};for(const i of e.split("\n"))t.push({name:"span",value:i,attributes:s});return n}function xd(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||("Enter"===e.key||"Escape"===e.key&&Jt(ad,this))&&Qt(pd,this,Sd).call(this)}function wd(){if(null!==Jt(ld,this))return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:i}}}=Jt(id,this);let r=!!Jt(rd,this),a=Jt(r?rd:cd,this);for(const d of Jt(sd,this))if(!a||null!==Os.intersect(d.data.rect,a)){a=d.data.rect,r=!0;break}const o=Os.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),l=r?a[2]-a[0]+5:0,c=o[0]+l,h=o[1];Zt(ld,this,[100*(c-s)/t,100*(h-i)/n]);const{style:u}=Jt(ed,this);u.left="".concat(Jt(ld,this)[0],"%"),u.top="".concat(Jt(ld,this)[1],"%")}function Sd(){Zt(ad,this,!Jt(ad,this)),Jt(ad,this)?(Qt(pd,this,_d).call(this),Jt(ed,this).addEventListener("click",Jt(Ju,this)),Jt(ed,this).addEventListener("keydown",Jt(Ku,this))):(Qt(pd,this,Cd).call(this),Jt(ed,this).removeEventListener("click",Jt(Ju,this)),Jt(ed,this).removeEventListener("keydown",Jt(Ku,this)))}function _d(){Jt(od,this)||this.render(),this.isVisible?Jt(ad,this)&&Jt(ed,this).classList.add("focused"):(Qt(pd,this,wd).call(this),Jt(ed,this).hidden=!1,Jt(ed,this).style.zIndex=parseInt(Jt(ed,this).style.zIndex)+1e3)}function Cd(){Jt(ed,this).classList.remove("focused"),!Jt(ad,this)&&this.isVisible&&(Jt(ed,this).hidden=!0,Jt(ed,this).style.zIndex=parseInt(Jt(ed,this).style.zIndex)-1e3)}class kd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Tn.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Ad=new WeakMap;class Ed extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),Kt(this,Ad,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:t,height:n}=Eu(e.rect),s=this.svgFactory.create(t,n,!0),i=Zt(Ad,this,this.svgFactory.createElement("svg:line"));return i.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),i.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),i.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),i.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),s.append(i),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Jt(Ad,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}var Td=new WeakMap;class Md extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),Kt(this,Td,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:t,height:n}=Eu(e.rect),s=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,r=Zt(Td,this,this.svgFactory.createElement("svg:rect"));return r.setAttribute("x",i/2),r.setAttribute("y",i/2),r.setAttribute("width",t-i),r.setAttribute("height",n-i),r.setAttribute("stroke-width",i||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Jt(Td,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}var jd=new WeakMap;class Pd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),Kt(this,jd,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:t,height:n}=Eu(e.rect),s=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,r=Zt(jd,this,this.svgFactory.createElement("svg:ellipse"));return r.setAttribute("cx",t/2),r.setAttribute("cy",n/2),r.setAttribute("rx",t/2-i/2),r.setAttribute("ry",n/2-i/2),r.setAttribute("stroke-width",i||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Jt(jd,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}var Od=new WeakMap;class Dd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),Kt(this,Od,null),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:n,popupRef:s}}=this;if(!t)return this.container;const{width:i,height:r}=Eu(e),a=this.svgFactory.create(i,r,!0);let o=[];for(let c=0,h=t.length;c<h;c+=2){const n=t[c]-e[0],s=e[3]-t[c+1];o.push("".concat(n,",").concat(s))}o=o.join(" ");const l=Zt(Od,this,this.svgFactory.createElement(this.svgElementName));return l.setAttribute("points",o),l.setAttribute("stroke-width",n.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Jt(Od,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}class Nd extends Dd{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Ld extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Rd=new WeakMap;class Fd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),Kt(this,Rd,[]),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?Tn.HIGHLIGHT:Tn.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,inkLists:t,borderStyle:n,popupRef:s}}=this,{width:i,height:r}=Eu(e),a=this.svgFactory.create(i,r,!0);for(const o of t){let t=[];for(let n=0,i=o.length;n<i;n+=2){const s=o[n]-e[0],i=e[3]-o[n+1];t.push("".concat(s,",").concat(i))}t=t.join(" ");const s=this.svgFactory.createElement(this.svgElementName);Jt(Rd,this).push(s),s.setAttribute("points",t),s.setAttribute("stroke-width",n.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),a.append(s)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(a),this._editOnDoubleClick(),this.container}getElementsToTriggerPopup(){return Jt(Rd,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}class Id extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Tn.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class zd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Wd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Bd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Hd extends Du{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Tn.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Ud=new WeakMap,Vd=new WeakSet;class Gd extends Du{constructor(e){var t;super(e,{isRenderable:!0}),qt(this,Vd),Kt(this,Ud,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,null===(t=this.linkService.eventBus)||void 0===t||t.dispatch("fileattachmentannotation",c({source:this},n))}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let n;t.hasAppearance||0===t.fillAlpha?n=document.createElement("div"):(n=document.createElement("img"),n.src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(t.name)?"paperclip":"pushpin",".svg"),t.fillAlpha&&t.fillAlpha<1&&(n.style="filter: opacity(".concat(Math.round(100*t.fillAlpha),"%);"))),n.addEventListener("dblclick",Qt(Vd,this,Xd).bind(this)),Zt(Ud,this,n);const{isMac:s}=js.platform;return e.addEventListener("keydown",e=>{"Enter"===e.key&&(s?e.metaKey:e.ctrlKey)&&Qt(Vd,this,Xd).call(this)}),!t.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return Jt(Ud,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}function Xd(){var e;null===(e=this.downloadManager)||void 0===e||e.openOrDownloadData(this.content,this.filename)}var Yd=new WeakMap,qd=new WeakMap,Kd=new WeakMap,Qd=new WeakMap,$d=new WeakSet;class Jd{constructor(e){let{div:t,accessibilityManager:n,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:a,structTreeLayer:o}=e;qt(this,$d),Kt(this,Yd,null),Kt(this,qd,null),Kt(this,Kd,new Map),Kt(this,Qd,null),this.div=t,Zt(Yd,this,n),Zt(qd,this,s),Zt(Qd,this,o||null),this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return Jt(Kd,this).size>0}async render(e){const{annotations:t}=e,n=this.div;fi(n,this.viewport);const s=new Map,i={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new _u,annotationStorage:e.annotationStorage||new So,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const e=a.annotationType===Zn;if(e){const e=s.get(a.id);if(!e)continue;i.elements=e}else{const{width:e,height:t}=Eu(a.rect);if(e<=0||t<=0)continue}i.data=a;const t=Tu.create(i);if(!t.isRenderable)continue;if(!e&&a.popupRef){const e=s.get(a.popupRef);e?e.push(t):s.set(a.popupRef,[t])}const n=t.render();var r;if(a.hidden&&(n.style.visibility="hidden"),await Qt($d,this,Zd).call(this,n,a.id),t._isEditable)Jt(Kd,this).set(t.data.id,t),null===(r=this._annotationEditorUIManager)||void 0===r||r.renderAnnotationElement(t)}Qt($d,this,ef).call(this)}update(e){let{viewport:t}=e;const n=this.div;this.viewport=t,fi(n,{rotation:t.rotation}),Qt($d,this,ef).call(this),n.hidden=!1}getEditableAnnotations(){return Array.from(Jt(Kd,this).values())}getEditableAnnotation(e){return Jt(Kd,this).get(e)}}async function Zd(e,t){var n,s;const i=e.firstChild||e,r=i.id="".concat(Is).concat(t),a=await(null===(n=Jt(Qd,this))||void 0===n?void 0:n.getAriaAttributes(r));if(a)for(const[o,l]of a)i.setAttribute(o,l);this.div.append(e),null===(s=Jt(Yd,this))||void 0===s||s.moveElementInDOM(this.div,e,i,!1)}function ef(){if(!Jt(qd,this))return;const e=this.div;for(const[t,n]of Jt(qd,this)){const s=e.querySelector('[data-annotation-id="'.concat(t,'"]'));if(!s)continue;n.className="annotationContent";const{firstChild:i}=s;i?"CANVAS"===i.nodeName?i.replaceWith(n):i.classList.contains("annotationContent")?i.after(n):i.before(n):s.append(n)}Jt(qd,this).clear()}const tf=/\r\n?|\n/g;var nf=new WeakMap,sf=new WeakMap,rf=new WeakMap,af=new WeakMap,of=new WeakMap,lf=new WeakSet;class cf extends Ka{static get _keyboardManager(){const e=cf.prototype,t=e=>e.isEmpty(),n=Ur.TRANSLATE_SMALL,s=Ur.TRANSLATE_BIG;return ys(this,"_keyboardManager",new Ji([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}]]))}constructor(e){super(c(c({},e),{},{name:"freeTextEditor"})),qt(this,lf),Kt(this,nf,void 0),Kt(this,sf,""),Kt(this,rf,"".concat(this.id,"-editor")),Kt(this,af,null),Kt(this,of,void 0),Zt(nf,this,e.color||cf._defaultColor||Ka._defaultLineColor),Zt(of,this,e.fontSize||cf._defaultFontSize)}static initialize(e,t){Ka.initialize(e,t);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case Mn.FREETEXT_SIZE:cf._defaultFontSize=t;break;case Mn.FREETEXT_COLOR:cf._defaultColor=t}}updateParams(e,t){switch(e){case Mn.FREETEXT_SIZE:Qt(lf,this,hf).call(this,t);break;case Mn.FREETEXT_COLOR:Qt(lf,this,uf).call(this,t)}}static get defaultPropertiesToUpdate(){return[[Mn.FREETEXT_SIZE,cf._defaultFontSize],[Mn.FREETEXT_COLOR,cf._defaultColor||Ka._defaultLineColor]]}get propertiesToUpdate(){return[[Mn.FREETEXT_SIZE,Jt(of,this)],[Mn.FREETEXT_COLOR,Jt(nf,this)]]}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-cf._internalPadding*e,-(cf._internalPadding+Jt(of,this))*e]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Tn.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),Zt(af,this,new AbortController);const e=this._uiManager.combinedSignal(Jt(af,this));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",Jt(rf,this)),this._isDraggable=!0,null===(e=Jt(af,this))||void 0===e||e.abort(),Zt(af,this,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var e;this.width||(this.enableEditMode(),this.editorDiv.focus(),null!==(e=this._initialOptions)&&void 0!==e&&e.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=Jt(sf,this),t=Zt(sf,this,Qt(lf,this,df).call(this).trimEnd());if(e===t)return;const n=e=>{Zt(sf,this,e),e?(Qt(lf,this,gf).call(this),this._uiManager.rebuild(this),Qt(lf,this,ff).call(this)):this.remove()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),Qt(lf,this,ff).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){cf._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",Jt(rf,this)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize="calc(".concat(Jt(of,this),"px * var(--scale-factor))"),n.color=Jt(nf,this),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Fi(this,this.div,["dblclick","keydown"]),this.width){const[n,s]=this.parentDimensions;if(this.annotationElementId){const{position:i}=this._initialData;let[r,a]=this.getInitialTranslation();[r,a]=this.pageTranslationToScreen(r,a);const[o,l]=this.pageDimensions,[c,h]=this.pageTranslation;let u,d;switch(this.rotation){case 0:u=e+(i[0]-c)/o,d=t+this.height-(i[1]-h)/l;break;case 90:u=e+(i[0]-c)/o,d=t-(i[1]-h)/l,[r,a]=[a,-r];break;case 180:u=e-this.width+(i[0]-c)/o,d=t-(i[1]-h)/l,[r,a]=[-r,-a];break;case 270:u=e+(i[0]-c-this.height*l)/o,d=t+(i[1]-h-this.width*o)/l,[r,a]=[-a,r]}this.setAt(u*n,d*s,r,a)}else this.setAt(e*n,t*s,this.width*n,this.height*s);Qt(lf,this,gf).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:n}=t;if(1===n.length&&"text/plain"===n[0])return;e.preventDefault();const s=vf.call(cf,t.getData("text")||"").replaceAll(tf,"\n");if(!s)return;const i=window.getSelection();if(!i.rangeCount)return;this.editorDiv.normalize(),i.deleteFromDocument();const r=i.getRangeAt(0);if(!s.includes("\n"))return r.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),void i.collapseToStart();const{startContainer:a,startOffset:o}=r,l=[],c=[];if(a.nodeType===Node.TEXT_NODE){const e=a.parentElement;if(c.push(a.nodeValue.slice(o).replaceAll(tf,"")),e!==this.editorDiv){let t=l;for(const n of this.editorDiv.childNodes)n!==e?t.push(pf.call(cf,n)):t=c}l.push(a.nodeValue.slice(0,o).replaceAll(tf,""))}else if(a===this.editorDiv){let e=l,t=0;for(const n of this.editorDiv.childNodes)t++===o&&(e=c),e.push(pf.call(cf,n))}Zt(sf,this,"".concat(l.join("\n")).concat(s).concat(c.join("\n"))),Qt(lf,this,gf).call(this);const h=new Range;let u=l.reduce((e,t)=>e+t.length,0);for(const{firstChild:d}of this.editorDiv.childNodes)if(d.nodeType===Node.TEXT_NODE){const e=d.nodeValue.length;if(u<=e){h.setStart(d,u),h.setEnd(d,u);break}u-=e}i.removeAllRanges(),i.addRange(h)}get contentDiv(){return this.editorDiv}static async deserialize(e,t,n){let s=null;if(e instanceof kd){const{data:{defaultAppearanceData:{fontSize:t,fontColor:n},rect:i,rotation:r,id:a,popupRef:o},textContent:l,textPosition:c,parent:{page:{pageNumber:h}}}=e;if(!l||0===l.length)return null;s=e={annotationType:Tn.FREETEXT,color:Array.from(n),fontSize:t,value:l.join("\n"),position:c,pageIndex:h-1,rect:i.slice(0),rotation:r,id:a,deleted:!1,popupRef:o}}const i=await super.deserialize(e,t,n);return Zt(of,i,e.fontSize),Zt(nf,i,Os.makeHexColor(...e.color)),Zt(sf,i,vf.call(cf,e.value)),i.annotationElementId=e.id||null,i._initialData=s,i}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=cf._internalPadding*this.parentScale,n=this.getRect(t,t),s=Ka._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:Jt(nf,this)),i={annotationType:Tn.FREETEXT,color:s,fontSize:Jt(of,this),value:Qt(lf,this,mf).call(this),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?i:this.annotationElementId&&!Qt(lf,this,yf).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(this.deleted)return t;const{style:n}=t;n.fontSize="calc(".concat(Jt(of,this),"px * var(--scale-factor))"),n.color=Jt(nf,this),t.replaceChildren();for(const i of Jt(sf,this).split("\n")){const e=document.createElement("div");e.append(i?document.createTextNode(i):document.createElement("br")),t.append(e)}const s=cf._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(s,s),popupContent:Jt(sf,this)}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}function hf(e){const t=e=>{this.editorDiv.style.fontSize="calc(".concat(e,"px * var(--scale-factor))"),this.translate(0,-(e-Jt(of,this))*this.parentScale),Zt(of,this,e),Qt(lf,this,ff).call(this)},n=Jt(of,this);this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mn.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}function uf(e){const t=e=>{Zt(nf,this,this.editorDiv.style.color=e)},n=Jt(nf,this);this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mn.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function df(){const e=[];this.editorDiv.normalize();let t=null;for(const s of this.editorDiv.childNodes){var n;(null===(n=t)||void 0===n?void 0:n.nodeType)===Node.TEXT_NODE&&"BR"===s.nodeName||(e.push(pf.call(on,s)),t=s)}return e.join("\n")}function ff(){const[e,t]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:e,div:t}=this,s=t.style.display,i=t.classList.contains("hidden");t.classList.remove("hidden"),t.style.display="hidden",e.div.append(this.div),n=t.getBoundingClientRect(),t.remove(),t.style.display=s,t.classList.toggle("hidden",i)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}function pf(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(tf,"")}function gf(){if(this.editorDiv.replaceChildren(),Jt(sf,this))for(const e of Jt(sf,this).split("\n")){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}function mf(){return Jt(sf,this).replaceAll("\xa0"," ")}function vf(e){return e.replaceAll(" ","\xa0")}function yf(e){const{value:t,fontSize:n,color:s,pageIndex:i}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((e,t)=>e!==s[t])||e.pageIndex!==i}on=cf,o(cf,"_freeTextDefaultContent",""),o(cf,"_internalPadding",0),o(cf,"_defaultColor",null),o(cf,"_defaultFontSize",10),o(cf,"_type","freetext"),o(cf,"_editorType",Tn.FREETEXT);class bf{toSVGPath(){gs("Abstract method `toSVGPath` must be implemented.")}get box(){gs("Abstract getter `box` must be implemented.")}serialize(e,t){gs("Abstract method `serialize` must be implemented.")}get classNamesForDrawing(){gs("Abstract getter `classNamesForDrawing` must be implemented.")}get classNamesForOutlining(){gs("Abstract getter `classNamesForOutlining` must be implemented.")}get mustRemoveSelfIntersections(){return!1}}var xf=new WeakMap,wf=new WeakMap,Sf=new WeakMap,_f=new WeakMap,Cf=new WeakMap,kf=new WeakMap,Af=new WeakMap,Ef=new WeakMap,Tf=new WeakMap,Mf=new WeakMap,jf=new WeakMap,Pf=new WeakMap,Of=new WeakMap,Df=new WeakSet;class Nf{constructor(e,t,n,s,i){let{x:r,y:a}=e,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;qt(this,Df),Kt(this,xf,void 0),Kt(this,wf,[]),Kt(this,Sf,void 0),Kt(this,_f,void 0),Kt(this,Cf,[]),Kt(this,kf,new Float64Array(18)),Kt(this,Af,void 0),Kt(this,Ef,void 0),Kt(this,Tf,void 0),Kt(this,Mf,void 0),Kt(this,jf,void 0),Kt(this,Pf,void 0),Kt(this,Of,[]),Zt(xf,this,t),Zt(Pf,this,s*n),Zt(_f,this,i),Jt(kf,this).set([NaN,NaN,NaN,NaN,r,a],6),Zt(Sf,this,o),Zt(Mf,this,Hf._*n),Zt(Tf,this,Uf._*n),Zt(jf,this,n),Jt(Of,this).push(r,a)}isEmpty(){return isNaN(Jt(kf,this)[8])}add(e){var t;let{x:n,y:s}=e;Zt(Af,this,n),Zt(Ef,this,s);const[i,r,a,o]=Jt(xf,this);let[l,c,h,u]=Jt(kf,this).subarray(8,12);const d=n-h,f=s-u,p=Math.hypot(d,f);if(p<Jt(Tf,this))return!1;const g=p-Jt(Mf,this),m=g/p,v=m*d,y=m*f;let b=l,x=c;l=h,c=u,h+=v,u+=y,null===(t=Jt(Of,this))||void 0===t||t.push(n,s);const w=v/g,S=-y/g*Jt(Pf,this),_=w*Jt(Pf,this);if(Jt(kf,this).set(Jt(kf,this).subarray(2,8),0),Jt(kf,this).set([h+S,u+_],4),Jt(kf,this).set(Jt(kf,this).subarray(14,18),12),Jt(kf,this).set([h-S,u-_],16),isNaN(Jt(kf,this)[6]))return 0===Jt(Cf,this).length&&(Jt(kf,this).set([l+S,c+_],2),Jt(Cf,this).push(NaN,NaN,NaN,NaN,(l+S-i)/a,(c+_-r)/o),Jt(kf,this).set([l-S,c-_],14),Jt(wf,this).push(NaN,NaN,NaN,NaN,(l-S-i)/a,(c-_-r)/o)),Jt(kf,this).set([b,x,l,c,h,u],6),!this.isEmpty();Jt(kf,this).set([b,x,l,c,h,u],6);return Math.abs(Math.atan2(x-c,b-l)-Math.atan2(y,v))<Math.PI/2?([l,c,h,u]=Jt(kf,this).subarray(2,6),Jt(Cf,this).push(NaN,NaN,NaN,NaN,((l+h)/2-i)/a,((c+u)/2-r)/o),[l,c,b,x]=Jt(kf,this).subarray(14,18),Jt(wf,this).push(NaN,NaN,NaN,NaN,((b+l)/2-i)/a,((x+c)/2-r)/o),!0):([b,x,l,c,h,u]=Jt(kf,this).subarray(0,6),Jt(Cf,this).push(((b+5*l)/6-i)/a,((x+5*c)/6-r)/o,((5*l+h)/6-i)/a,((5*c+u)/6-r)/o,((l+h)/2-i)/a,((c+u)/2-r)/o),[h,u,l,c,b,x]=Jt(kf,this).subarray(12,18),Jt(wf,this).push(((b+5*l)/6-i)/a,((x+5*c)/6-r)/o,((5*l+h)/6-i)/a,((5*c+u)/6-r)/o,((l+h)/2-i)/a,((c+u)/2-r)/o),!0)}toSVGPath(){if(this.isEmpty())return"";const e=Jt(Cf,this),t=Jt(wf,this);if(isNaN(Jt(kf,this)[6])&&!this.isEmpty())return Qt(Df,this,Rf).call(this);const n=[];n.push("M".concat(e[4]," ").concat(e[5]));for(let s=6;s<e.length;s+=6)isNaN(e[s])?n.push("L".concat(e[s+4]," ").concat(e[s+5])):n.push("C".concat(e[s]," ").concat(e[s+1]," ").concat(e[s+2]," ").concat(e[s+3]," ").concat(e[s+4]," ").concat(e[s+5]));Qt(Df,this,If).call(this,n);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?n.push("L".concat(t[s+4]," ").concat(t[s+5])):n.push("C".concat(t[s]," ").concat(t[s+1]," ").concat(t[s+2]," ").concat(t[s+3]," ").concat(t[s+4]," ").concat(t[s+5]));return Qt(Df,this,Ff).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,s,i,r){return new Jf(e,t,n,s,i,r)}getOutlines(){var e,t;const n=Jt(Cf,this),s=Jt(wf,this),i=Jt(kf,this),[r,a,o,l]=Jt(xf,this),c=new Float64Array((null!==(e=null===(t=Jt(Of,this))||void 0===t?void 0:t.length)&&void 0!==e?e:0)+2);for(let d=0,f=c.length-2;d<f;d+=2)c[d]=(Jt(Of,this)[d]-r)/o,c[d+1]=(Jt(Of,this)[d+1]-a)/l;if(c[c.length-2]=(Jt(Af,this)-r)/o,c[c.length-1]=(Jt(Ef,this)-a)/l,isNaN(i[6])&&!this.isEmpty())return Qt(Df,this,zf).call(this,c);const h=new Float64Array(Jt(Cf,this).length+24+Jt(wf,this).length);let u=n.length;for(let d=0;d<u;d+=2)isNaN(n[d])?h[d]=h[d+1]=NaN:(h[d]=n[d],h[d+1]=n[d+1]);u=Qt(Df,this,Bf).call(this,h,u);for(let d=s.length-6;d>=6;d-=6)for(let e=0;e<6;e+=2)isNaN(s[d+e])?(h[u]=h[u+1]=NaN,u+=2):(h[u]=s[d+e],h[u+1]=s[d+e+1],u+=2);return Qt(Df,this,Wf).call(this,h,u),this.newFreeDrawOutline(h,c,Jt(xf,this),Jt(jf,this),Jt(Sf,this),Jt(_f,this))}}function Lf(){const e=Jt(kf,this).subarray(4,6),t=Jt(kf,this).subarray(16,18),[n,s,i,r]=Jt(xf,this);return[(Jt(Af,this)+(e[0]-t[0])/2-n)/i,(Jt(Ef,this)+(e[1]-t[1])/2-s)/r,(Jt(Af,this)+(t[0]-e[0])/2-n)/i,(Jt(Ef,this)+(t[1]-e[1])/2-s)/r]}function Rf(){const[e,t,n,s]=Jt(xf,this),[i,r,a,o]=Qt(Df,this,Lf).call(this);return"M".concat((Jt(kf,this)[2]-e)/n," ").concat((Jt(kf,this)[3]-t)/s," L").concat((Jt(kf,this)[4]-e)/n," ").concat((Jt(kf,this)[5]-t)/s," L").concat(i," ").concat(r," L").concat(a," ").concat(o," L").concat((Jt(kf,this)[16]-e)/n," ").concat((Jt(kf,this)[17]-t)/s," L").concat((Jt(kf,this)[14]-e)/n," ").concat((Jt(kf,this)[15]-t)/s," Z")}function Ff(e){const t=Jt(wf,this);e.push("L".concat(t[4]," ").concat(t[5]," Z"))}function If(e){const[t,n,s,i]=Jt(xf,this),r=Jt(kf,this).subarray(4,6),a=Jt(kf,this).subarray(16,18),[o,l,c,h]=Qt(Df,this,Lf).call(this);e.push("L".concat((r[0]-t)/s," ").concat((r[1]-n)/i," L").concat(o," ").concat(l," L").concat(c," ").concat(h," L").concat((a[0]-t)/s," ").concat((a[1]-n)/i))}function zf(e){const t=Jt(kf,this),[n,s,i,r]=Jt(xf,this),[a,o,l,c]=Qt(Df,this,Lf).call(this),h=new Float64Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-n)/i,(t[3]-s)/r,NaN,NaN,NaN,NaN,(t[4]-n)/i,(t[5]-s)/r,NaN,NaN,NaN,NaN,a,o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,(t[16]-n)/i,(t[17]-s)/r,NaN,NaN,NaN,NaN,(t[14]-n)/i,(t[15]-s)/r],0),this.newFreeDrawOutline(h,e,Jt(xf,this),Jt(jf,this),Jt(Sf,this),Jt(_f,this))}function Wf(e,t){const n=Jt(wf,this);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+6}function Bf(e,t){const n=Jt(kf,this).subarray(4,6),s=Jt(kf,this).subarray(16,18),[i,r,a,o]=Jt(xf,this),[l,c,h,u]=Qt(Df,this,Lf).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-i)/a,(n[1]-r)/o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(s[0]-i)/a,(s[1]-r)/o],t),t+24}var Hf={_:8},Uf={_:Hf._+2},Vf=new WeakMap,Gf=new WeakMap,Xf=new WeakMap,Yf=new WeakMap,qf=new WeakMap,Kf=new WeakMap,Qf=new WeakMap,$f=new WeakSet;class Jf extends bf{constructor(e,t,n,s,i,r){super(),qt(this,$f),Kt(this,Vf,void 0),Kt(this,Gf,null),Kt(this,Xf,void 0),Kt(this,Yf,void 0),Kt(this,qf,void 0),Kt(this,Kf,void 0),Kt(this,Qf,void 0),Zt(Qf,this,e),Zt(qf,this,t),Zt(Vf,this,n),Zt(Kf,this,s),Zt(Xf,this,i),Zt(Yf,this,r),Qt($f,this,tp).call(this,r);const{x:a,y:o,width:l,height:c}=Jt(Gf,this);for(let h=0,u=e.length;h<u;h+=2)e[h]=(e[h]-a)/l,e[h+1]=(e[h+1]-o)/c;for(let h=0,u=t.length;h<u;h+=2)t[h]=(t[h]-a)/l,t[h+1]=(t[h+1]-o)/c}toSVGPath(){const e=["M".concat(Jt(Qf,this)[4]," ").concat(Jt(Qf,this)[5])];for(let t=6,n=Jt(Qf,this).length;t<n;t+=6)isNaN(Jt(Qf,this)[t])?e.push("L".concat(Jt(Qf,this)[t+4]," ").concat(Jt(Qf,this)[t+5])):e.push("C".concat(Jt(Qf,this)[t]," ").concat(Jt(Qf,this)[t+1]," ").concat(Jt(Qf,this)[t+2]," ").concat(Jt(Qf,this)[t+3]," ").concat(Jt(Qf,this)[t+4]," ").concat(Jt(Qf,this)[t+5]));return e.push("Z"),e.join(" ")}serialize(e,t){let[n,s,i,r]=e;const a=i-n,o=r-s;let l,c;switch(t){case 0:l=Qt($f,this,Zf).call(this,Jt(Qf,this),n,r,a,-o),c=Qt($f,this,Zf).call(this,Jt(qf,this),n,r,a,-o);break;case 90:l=Qt($f,this,ep).call(this,Jt(Qf,this),n,s,a,o),c=Qt($f,this,ep).call(this,Jt(qf,this),n,s,a,o);break;case 180:l=Qt($f,this,Zf).call(this,Jt(Qf,this),i,s,-a,o),c=Qt($f,this,Zf).call(this,Jt(qf,this),i,s,-a,o);break;case 270:l=Qt($f,this,ep).call(this,Jt(Qf,this),i,r,-a,-o),c=Qt($f,this,ep).call(this,Jt(qf,this),i,r,-a,-o)}return{outline:Array.from(l),points:[Array.from(c)]}}get box(){return Jt(Gf,this)}newOutliner(e,t,n,s,i){return new Nf(e,t,n,s,i,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}getNewOutline(e,t){const{x:n,y:s,width:i,height:r}=Jt(Gf,this),[a,o,l,c]=Jt(Vf,this),h=i*l,u=r*c,d=n*l+a,f=s*c+o,p=this.newOutliner({x:Jt(qf,this)[0]*h+d,y:Jt(qf,this)[1]*u+f},Jt(Vf,this),Jt(Kf,this),e,Jt(Yf,this),null!==t&&void 0!==t?t:Jt(Xf,this));for(let g=2;g<Jt(qf,this).length;g+=2)p.add({x:Jt(qf,this)[g]*h+d,y:Jt(qf,this)[g+1]*u+f});return p.getOutlines()}get mustRemoveSelfIntersections(){return!0}}function Zf(e,t,n,s,i){const r=new Float64Array(e.length);for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a]*s,r[a+1]=n+e[a+1]*i;return r}function ep(e,t,n,s,i){const r=new Float64Array(e.length);for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a+1]*s,r[a+1]=n+e[a]*i;return r}function tp(e){const t=Jt(Qf,this);let n=t[4],s=t[5],i=n,r=s,a=n,o=s,l=n,c=s;const h=e?Math.max:Math.min;for(let g=6,m=t.length;g<m;g+=6){if(isNaN(t[g]))i=Math.min(i,t[g+4]),r=Math.min(r,t[g+5]),a=Math.max(a,t[g+4]),o=Math.max(o,t[g+5]),c<t[g+5]?(l=t[g+4],c=t[g+5]):c===t[g+5]&&(l=h(l,t[g+4]));else{const e=Os.bezierBoundingBox(n,s,...t.slice(g,g+6));i=Math.min(i,e[0]),r=Math.min(r,e[1]),a=Math.max(a,e[2]),o=Math.max(o,e[3]),c<e[3]?(l=e[2],c=e[3]):c===e[3]&&(l=h(l,e[2]))}n=t[g+4],s=t[g+5]}const u=i-Jt(Xf,this),d=r-Jt(Xf,this),f=a-i+2*Jt(Xf,this),p=o-r+2*Jt(Xf,this);Zt(Gf,this,{x:u,y:d,width:f,height:p,lastPoint:[l,c]})}var np=new WeakMap,sp=new WeakMap,ip=new WeakMap,rp=new WeakSet;class ap{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];qt(this,rp),Kt(this,np,void 0),Kt(this,sp,[]),Kt(this,ip,[]);let i=1/0,r=-1/0,a=1/0,o=-1/0;const l=10**-4;for(const{x:g,y:m,width:v,height:y}of e){const e=Math.floor((g-t)/l)*l,n=Math.ceil((g+v+t)/l)*l,s=Math.floor((m-t)/l)*l,c=Math.ceil((m+y+t)/l)*l,h=[e,s,c,!0],u=[n,s,c,!1];Jt(sp,this).push(h,u),i=Math.min(i,e),r=Math.max(r,n),a=Math.min(a,s),o=Math.max(o,c)}const c=r-i+2*n,h=o-a+2*n,u=i-n,d=a-n,f=Jt(sp,this).at(s?-1:-2),p=[f[0],f[2]];for(const g of Jt(sp,this)){const[e,t,n]=g;g[0]=(e-u)/c,g[1]=(t-d)/h,g[2]=(n-d)/h}Zt(np,this,{x:u,y:d,width:c,height:h,lastPoint:p})}getOutlines(){Jt(sp,this).sort((e,t)=>e[0]-t[0]||e[1]-t[1]||e[2]-t[2]);const e=[];for(const t of Jt(sp,this))t[3]?(e.push(...Qt(rp,this,up).call(this,t)),Qt(rp,this,cp).call(this,t)):(Qt(rp,this,hp).call(this,t),e.push(...Qt(rp,this,up).call(this,t)));return Qt(rp,this,op).call(this,e)}}function op(e){const t=[],n=new Set;for(const r of e){const[e,n,s]=r;t.push([e,n,r],[e,s,r])}t.sort((e,t)=>e[1]-t[1]||e[0]-t[0]);for(let r=0,a=t.length;r<a;r+=2){const e=t[r][2],s=t[r+1][2];e.push(s),s.push(e),n.add(e),n.add(s)}const s=[];let i;for(;n.size>0;){const e=n.values().next().value;let[t,r,a,o,l]=e;n.delete(e);let c=t,h=r;for(i=[t,a],s.push(i);;){let e;if(n.has(o))e=o;else{if(!n.has(l))break;e=l}n.delete(e),[t,r,a,o,l]=e,c!==t&&(i.push(c,h,t,h===r?r:a),c=t),h=h===r?a:r}i.push(c,h)}return new pp(s,Jt(np,this))}function lp(e){const t=Jt(ip,this);let n=0,s=t.length-1;for(;n<=s;){const i=n+s>>1,r=t[i][0];if(r===e)return i;r<e?n=i+1:s=i-1}return s+1}function cp(e){let[,t,n]=e;const s=Qt(rp,this,lp).call(this,t);Jt(ip,this).splice(s,0,[t,n])}function hp(e){let[,t,n]=e;const s=Qt(rp,this,lp).call(this,t);for(let i=s;i<Jt(ip,this).length;i++){const[e,s]=Jt(ip,this)[i];if(e!==t)break;if(e===t&&s===n)return void Jt(ip,this).splice(i,1)}for(let i=s-1;i>=0;i--){const[e,s]=Jt(ip,this)[i];if(e!==t)break;if(e===t&&s===n)return void Jt(ip,this).splice(i,1)}}function up(e){const[t,n,s]=e,i=[[t,n,s]],r=Qt(rp,this,lp).call(this,s);for(let a=0;a<r;a++){const[e,n]=Jt(ip,this)[a];for(let s=0,r=i.length;s<r;s++){const[,a,o]=i[s];if(!(n<=a||o<=e))if(a>=e)if(o>n)i[s][1]=n;else{if(1===r)return[];i.splice(s,1),s--,r--}else i[s][2]=e,o>n&&i.push([t,n,o])}}return i}var dp=new WeakMap,fp=new WeakMap;class pp extends bf{constructor(e,t){super(),Kt(this,dp,void 0),Kt(this,fp,void 0),Zt(fp,this,e),Zt(dp,this,t)}toSVGPath(){const e=[];for(const t of Jt(fp,this)){let[n,s]=t;e.push("M".concat(n," ").concat(s));for(let i=2;i<t.length;i+=2){const r=t[i],a=t[i+1];r===n?(e.push("V".concat(a)),s=a):a===s&&(e.push("H".concat(r)),n=r)}e.push("Z")}return e.join(" ")}serialize(e,t){let[n,s,i,r]=e;const a=[],o=i-n,l=r-s;for(const c of Jt(fp,this)){const e=new Array(c.length);for(let t=0;t<c.length;t+=2)e[t]=n+c[t]*o,e[t+1]=r-c[t+1]*l;a.push(e)}return a}get box(){return Jt(dp,this)}get classNamesForDrawing(){return["highlight"]}get classNamesForOutlining(){return["highlightOutline"]}}class gp extends Nf{newFreeDrawOutline(e,t,n,s,i,r){return new mp(e,t,n,s,i,r)}get classNamesForDrawing(){return["highlight","free"]}}class mp extends Jf{get classNamesForDrawing(){return["highlight","free"]}get classNamesForOutlining(){return["highlightOutline","free"]}newOutliner(e,t,n,s,i){return new gp(e,t,n,s,i,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}}var vp=new WeakMap,yp=new WeakMap,bp=new WeakMap,xp=new WeakMap,wp=new WeakMap,Sp=new WeakMap,_p=new WeakMap,Cp=new WeakMap,kp=new WeakMap,Ap=new WeakMap,Ep=new WeakMap,Tp=new WeakSet;class Mp{static get _keyboardManager(){return ys(this,"_keyboardManager",new Ji([[["Escape","mac+Escape"],Mp.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Mp.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Mp.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Mp.prototype._moveToPrevious],[["Home","mac+Home"],Mp.prototype._moveToBeginning],[["End","mac+End"],Mp.prototype._moveToEnd]]))}constructor(e){var t;let{editor:n=null,uiManager:s=null}=e;qt(this,Tp),Kt(this,vp,null),Kt(this,yp,null),Kt(this,bp,void 0),Kt(this,xp,null),Kt(this,wp,!1),Kt(this,Sp,!1),Kt(this,_p,null),Kt(this,Cp,void 0),Kt(this,kp,null),Kt(this,Ap,null),Kt(this,Ep,void 0),n?(Zt(Sp,this,!1),Zt(Ep,this,Mn.HIGHLIGHT_COLOR),Zt(_p,this,n)):(Zt(Sp,this,!0),Zt(Ep,this,Mn.HIGHLIGHT_DEFAULT_COLOR)),Zt(Ap,this,(null===n||void 0===n?void 0:n._uiManager)||s),Zt(Cp,this,Jt(Ap,this)._eventBus),Zt(bp,this,(null===n||void 0===n?void 0:n.color)||(null===(t=Jt(Ap,this))||void 0===t?void 0:t.highlightColors.values().next().value)||"#FFFF98"),Rp._||(Rp._=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}renderButton(){const e=Zt(vp,this,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=Jt(Ap,this)._signal;e.addEventListener("click",Qt(Tp,this,Dp).bind(this),{signal:t}),e.addEventListener("keydown",Qt(Tp,this,Op).bind(this),{signal:t});const n=Zt(yp,this,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=Jt(bp,this),e.append(n),e}renderMainDropdown(){const e=Zt(xp,this,Qt(Tp,this,jp).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===Jt(vp,this))return void Qt(Tp,this,Dp).call(this,e);const t=e.target.getAttribute("data-color");t&&Qt(Tp,this,Pp).call(this,t,e)}_moveToNext(e){var t,n;$t(Tp,this,Lp)?e.target!==Jt(vp,this)?null===(t=e.target.nextSibling)||void 0===t||t.focus():null===(n=Jt(xp,this).firstChild)||void 0===n||n.focus():Qt(Tp,this,Dp).call(this,e)}_moveToPrevious(e){var t,n;e.target!==(null===(t=Jt(xp,this))||void 0===t?void 0:t.firstChild)&&e.target!==Jt(vp,this)?($t(Tp,this,Lp)||Qt(Tp,this,Dp).call(this,e),null===(n=e.target.previousSibling)||void 0===n||n.focus()):$t(Tp,this,Lp)&&this._hideDropdownFromKeyboard()}_moveToBeginning(e){var t;$t(Tp,this,Lp)?null===(t=Jt(xp,this).firstChild)||void 0===t||t.focus():Qt(Tp,this,Dp).call(this,e)}_moveToEnd(e){var t;$t(Tp,this,Lp)?null===(t=Jt(xp,this).lastChild)||void 0===t||t.focus():Qt(Tp,this,Dp).call(this,e)}hideDropdown(){var e,t;null===(e=Jt(xp,this))||void 0===e||e.classList.add("hidden"),null===(t=Jt(kp,this))||void 0===t||t.abort(),Zt(kp,this,null)}_hideDropdownFromKeyboard(){var e;Jt(Sp,this)||($t(Tp,this,Lp)?(this.hideDropdown(),Jt(vp,this).focus({preventScroll:!0,focusVisible:Jt(wp,this)})):null===(e=Jt(_p,this))||void 0===e||e.unselect())}updateColor(e){if(Jt(yp,this)&&(Jt(yp,this).style.backgroundColor=e),!Jt(xp,this))return;const t=Jt(Ap,this).highlightColors.values();for(const n of Jt(xp,this).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;null===(e=Jt(vp,this))||void 0===e||e.remove(),Zt(vp,this,null),Zt(yp,this,null),null===(t=Jt(xp,this))||void 0===t||t.remove(),Zt(xp,this,null)}}function jp(){const e=document.createElement("div"),t=Jt(Ap,this)._signal;e.addEventListener("contextmenu",ri,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[n,s]of Jt(Ap,this).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",s),i.title=n,i.setAttribute("data-l10n-id",Rp._[n]);const r=document.createElement("span");i.append(r),r.className="swatch",r.style.backgroundColor=s,i.setAttribute("aria-selected",s===Jt(bp,this)),i.addEventListener("click",Qt(Tp,this,Pp).bind(this,s),{signal:t}),e.append(i)}return e.addEventListener("keydown",Qt(Tp,this,Op).bind(this),{signal:t}),e}function Pp(e,t){t.stopPropagation(),Jt(Cp,this).dispatch("switchannotationeditorparams",{source:this,type:Jt(Ep,this),value:e})}function Op(e){ln._keyboardManager.exec(this,e)}function Dp(e){if($t(Tp,this,Lp))return void this.hideDropdown();if(Zt(wp,this,0===e.detail),Jt(kp,this)||(Zt(kp,this,new AbortController),window.addEventListener("pointerdown",Qt(Tp,this,Np).bind(this),{signal:Jt(Ap,this).combinedSignal(Jt(kp,this))})),Jt(xp,this))return void Jt(xp,this).classList.remove("hidden");const t=Zt(xp,this,Qt(Tp,this,jp).call(this));Jt(vp,this).append(t)}function Np(e){var t;null!==(t=Jt(xp,this))&&void 0!==t&&t.contains(e.target)||this.hideDropdown()}function Lp(e){return Jt(xp,e)&&!Jt(xp,e).classList.contains("hidden")}ln=Mp;var Rp={_:null},Fp=new WeakMap,Ip=new WeakMap,zp=new WeakMap,Wp=new WeakMap,Bp=new WeakMap,Hp=new WeakMap,Up=new WeakMap,Vp=new WeakMap,Gp=new WeakMap,Xp=new WeakMap,Yp=new WeakMap,qp=new WeakMap,Kp=new WeakMap,Qp=new WeakMap,$p=new WeakMap,Jp=new WeakMap,Zp=new WeakMap,eg=new WeakMap,tg=new WeakSet;class ng extends Ka{static get _keyboardManager(){const e=ng.prototype;return ys(this,"_keyboardManager",new Ji([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super(c(c({},e),{},{name:"highlightEditor"})),qt(this,tg),Kt(this,Fp,null),Kt(this,Ip,0),Kt(this,zp,void 0),Kt(this,Wp,null),Kt(this,Bp,null),Kt(this,Hp,null),Kt(this,Up,null),Kt(this,Vp,0),Kt(this,Gp,null),Kt(this,Xp,null),Kt(this,Yp,null),Kt(this,qp,!1),Kt(this,Kp,null),Kt(this,Qp,void 0),Kt(this,$p,null),Kt(this,Jp,""),Kt(this,Zp,void 0),Kt(this,eg,""),this.color=e.color||ng._defaultColor,Zt(Zp,this,e.thickness||ng._defaultThickness),Zt(Qp,this,e.opacity||ng._defaultOpacity),Zt(zp,this,e.boxes||null),Zt(eg,this,e.methodOfCreation||""),Zt(Jp,this,e.text||""),this._isDraggable=!1,e.highlightId>-1?(Zt(qp,this,!0),Qt(tg,this,ig).call(this,e),Qt(tg,this,cg).call(this)):Jt(zp,this)&&(Zt(Fp,this,e.anchorNode),Zt(Ip,this,e.anchorOffset),Zt(Up,this,e.focusNode),Zt(Vp,this,e.focusOffset),Qt(tg,this,sg).call(this),Qt(tg,this,cg).call(this),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:Jt(qp,this)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:Jt(Zp,this),methodOfCreation:Jt(eg,this)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,t){var n;Ka.initialize(e,t),ng._defaultColor||(ng._defaultColor=(null===(n=t.highlightColors)||void 0===n?void 0:n.values().next().value)||"#fff066")}static updateDefaultParams(e,t){switch(e){case Mn.HIGHLIGHT_DEFAULT_COLOR:ng._defaultColor=t;break;case Mn.HIGHLIGHT_THICKNESS:ng._defaultThickness=t}}translateInPage(e,t){}get toolbarPosition(){return Jt(Kp,this)}updateParams(e,t){switch(e){case Mn.HIGHLIGHT_COLOR:Qt(tg,this,rg).call(this,t);break;case Mn.HIGHLIGHT_THICKNESS:Qt(tg,this,ag).call(this,t)}}static get defaultPropertiesToUpdate(){return[[Mn.HIGHLIGHT_DEFAULT_COLOR,ng._defaultColor],[Mn.HIGHLIGHT_THICKNESS,ng._defaultThickness]]}get propertiesToUpdate(){return[[Mn.HIGHLIGHT_COLOR,this.color||ng._defaultColor],[Mn.HIGHLIGHT_THICKNESS,Jt(Zp,this)||ng._defaultThickness],[Mn.HIGHLIGHT_FREE,Jt(qp,this)]]}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(Zt(Bp,this,new Mp({editor:this})),e.addColorPicker(Jt(Bp,this))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(Qt(tg,this,fg).call(this))}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,Qt(tg,this,fg).call(this))}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){Qt(tg,this,lg).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(Qt(tg,this,cg).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;if(this.parent&&!e)Qt(tg,this,lg).call(this);else if(e){var n;Qt(tg,this,cg).call(this,e),t=!this.parent&&(null===(n=this.div)||void 0===n?void 0:n.classList.contains("selectedEditor"))}super.setParent(e),this.show(this._isVisible),t&&this.select()}rotate(e){const{drawLayer:t}=this.parent;let n;Jt(qp,this)?(e=(e-this.rotation+360)%360,n=hg.call(ng,Jt(Xp,this).box,e)):n=hg.call(ng,this,e),t.rotate(Jt(Yp,this),e),t.rotate(Jt($p,this),e),t.updateBox(Jt(Yp,this),n),t.updateBox(Jt($p,this),hg.call(ng,Jt(Hp,this).box,e))}render(){if(this.div)return this.div;const e=super.render();Jt(Jp,this)&&(e.setAttribute("aria-label",Jt(Jp,this)),e.setAttribute("role","mark")),Jt(qp,this)?e.classList.add("free"):this.div.addEventListener("keydown",Qt(tg,this,ug).bind(this),{signal:this._uiManager._signal});const t=Zt(Gp,this,document.createElement("div"));e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=Jt(Wp,this);const[n,s]=this.parentDimensions;return this.setDims(this.width*n,this.height*s),Fi(this,Jt(Gp,this),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent.drawLayer.addClass(Jt($p,this),"hovered")}pointerleave(){this.isSelected||this.parent.drawLayer.removeClass(Jt($p,this),"hovered")}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:Qt(tg,this,dg).call(this,!0);break;case 1:case 3:Qt(tg,this,dg).call(this,!1)}}select(){var e,t;super.select(),Jt($p,this)&&(null===(e=this.parent)||void 0===e||e.drawLayer.removeClass(Jt($p,this),"hovered"),null===(t=this.parent)||void 0===t||t.drawLayer.addClass(Jt($p,this),"selected"))}unselect(){var e;super.unselect(),Jt($p,this)&&(null===(e=this.parent)||void 0===e||e.drawLayer.removeClass(Jt($p,this),"selected"),Jt(qp,this)||Qt(tg,this,dg).call(this,!1))}get _mustFixPosition(){return!Jt(qp,this)}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;super.show(e),this.parent&&(this.parent.drawLayer.show(Jt(Yp,this),e),this.parent.drawLayer.show(Jt($p,this),e))}static startHighlighting(e,t,n){let{target:s,x:i,y:r}=n;const{x:a,y:o,width:l,height:c}=s.getBoundingClientRect(),h=new AbortController,u=e.combinedSignal(h),d=t=>{h.abort(),Qt(ng,this,vg).call(this,e,t)};window.addEventListener("blur",d,{signal:u}),window.addEventListener("pointerup",d,{signal:u}),window.addEventListener("pointerdown",e=>{e.preventDefault(),e.stopPropagation()},{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",ri,{signal:u}),s.addEventListener("pointermove",Qt(ng,this,mg).bind(this,e),{signal:u}),this._freeHighlight=new gp({x:i,y:r},[a,o,l,c],e.scale,this._defaultThickness/2,t,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0))}static async deserialize(e,t,n){let s=null;if(e instanceof Id){const{data:{quadPoints:t,rect:n,rotation:i,id:r,color:a,opacity:o,popupRef:l},parent:{page:{pageNumber:c}}}=e;s=e={annotationType:Tn.HIGHLIGHT,color:Array.from(a),opacity:o,quadPoints:t,boxes:null,pageIndex:c-1,rect:n.slice(0),rotation:i,id:r,deleted:!1,popupRef:l}}else if(e instanceof Fd){const{data:{inkLists:t,rect:n,rotation:i,id:r,color:a,borderStyle:{rawWidth:o},popupRef:l},parent:{page:{pageNumber:c}}}=e;s=e={annotationType:Tn.HIGHLIGHT,color:Array.from(a),thickness:o,inkLists:t,boxes:null,pageIndex:c-1,rect:n.slice(0),rotation:i,id:r,deleted:!1,popupRef:l}}const{color:i,quadPoints:r,inkLists:a,opacity:o}=e,l=await super.deserialize(e,t,n);l.color=Os.makeHexColor(...i),Zt(Qp,l,o||1),a&&Zt(Zp,l,e.thickness),l.annotationElementId=e.id||null,l._initialData=s;const[c,h]=l.pageDimensions,[u,d]=l.pageTranslation;if(r){const e=Zt(zp,l,[]);for(let t=0;t<r.length;t+=8)e.push({x:(r[t]-u)/c,y:1-(r[t+1]-d)/h,width:(r[t+2]-r[t])/c,height:(r[t+1]-r[t+5])/h});Qt(tg,l,sg).call(l),Qt(tg,l,cg).call(l),l.rotate(l.rotation)}else if(a){Zt(qp,l,!0);const e=a[0],n={x:e[0]-u,y:h-(e[1]-d)},s=new gp(n,[0,0,c,h],1,Jt(Zp,l)/2,!0,.001);for(let t=0,a=e.length;t<a;t+=2)n.x=e[t]-u,n.y=h-(e[t+1]-d),s.add(n);const{id:i,clipPathId:r}=t.drawLayer.draw(s,l.color,l._defaultOpacity,!0);Qt(tg,l,ig).call(l,{highlightOutlines:s.getOutlines(),highlightId:i,clipPathId:r}),Qt(tg,l,cg).call(l)}return l}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=this.getRect(0,0),n=Ka._colorManager.convert(this.color),s={annotationType:Tn.HIGHLIGHT,color:n,opacity:Jt(Qp,this),thickness:Jt(Zp,this),quadPoints:Qt(tg,this,pg).call(this),outlines:Qt(tg,this,gg).call(this,t),pageIndex:this.pageIndex,rect:t,rotation:Qt(tg,this,fg).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!Qt(tg,this,yg).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}function sg(){const e=new ap(Jt(zp,this),.001);Zt(Xp,this,e.getOutlines()),({x:this.x,y:this.y,width:this.width,height:this.height}=Jt(Xp,this).box);const t=new ap(Jt(zp,this),.0025,.001,"ltr"===this._uiManager.direction);Zt(Hp,this,t.getOutlines());const{lastPoint:n}=Jt(Hp,this).box;Zt(Kp,this,[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height])}function ig(e){let{highlightOutlines:t,highlightId:n,clipPathId:s}=e;Zt(Xp,this,t);if(Zt(Hp,this,t.getNewOutline(Jt(Zp,this)/2+1.5,.0025)),n>=0)Zt(Yp,this,n),Zt(Wp,this,s),this.parent.drawLayer.finalizeLine(n,t),Zt($p,this,this.parent.drawLayer.drawOutline(Jt(Hp,this)));else if(this.parent){const e=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(Jt(Yp,this),t),this.parent.drawLayer.updateBox(Jt(Yp,this),hg.call(cn,Jt(Xp,this).box,(e-this.rotation+360)%360)),this.parent.drawLayer.updateLine(Jt($p,this),Jt(Hp,this)),this.parent.drawLayer.updateBox(Jt($p,this),hg.call(cn,Jt(Hp,this).box,e))}const{x:i,y:r,width:a,height:o}=t.box;switch(this.rotation){case 0:this.x=i,this.y=r,this.width=a,this.height=o;break;case 90:{const[e,t]=this.parentDimensions;this.x=r,this.y=1-i,this.width=a*t/e,this.height=o*e/t;break}case 180:this.x=1-i,this.y=1-r,this.width=a,this.height=o;break;case 270:{const[e,t]=this.parentDimensions;this.x=1-r,this.y=i,this.width=a*t/e,this.height=o*e/t;break}}const{lastPoint:l}=Jt(Hp,this).box;Zt(Kp,this,[(l[0]-i)/a,(l[1]-r)/o])}function rg(e){const t=(e,t)=>{var n,s,i;this.color=e,null===(n=this.parent)||void 0===n||n.drawLayer.changeColor(Jt(Yp,this),e),null===(s=Jt(Bp,this))||void 0===s||s.updateColor(e),Zt(Qp,this,t),null===(i=this.parent)||void 0===i||i.drawLayer.changeOpacity(Jt(Yp,this),t)},n=this.color,s=Jt(Qp,this);this.addCommands({cmd:t.bind(this,e,cn._defaultOpacity),undo:t.bind(this,n,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mn.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}function ag(e){const t=Jt(Zp,this),n=e=>{Zt(Zp,this,e),Qt(tg,this,og).call(this,e)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mn.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}function og(e){if(!Jt(qp,this))return;Qt(tg,this,ig).call(this,{highlightOutlines:Jt(Xp,this).getNewOutline(e/2)}),this.fixAndSetPosition();const[t,n]=this.parentDimensions;this.setDims(this.width*t,this.height*n)}function lg(){null!==Jt(Yp,this)&&this.parent&&(this.parent.drawLayer.remove(Jt(Yp,this)),Zt(Yp,this,null),this.parent.drawLayer.remove(Jt($p,this)),Zt($p,this,null))}function cg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null===Jt(Yp,this)&&(({id:Xt(Zt,[Yp,this])._,clipPathId:Xt(Zt,[Wp,this])._}=e.drawLayer.draw(Jt(Xp,this),this.color,Jt(Qp,this))),Zt($p,this,e.drawLayer.drawOutline(Jt(Hp,this))),Jt(Gp,this)&&(Jt(Gp,this).style.clipPath=Jt(Wp,this)))}function hg(e,t){let{x:n,y:s,width:i,height:r}=e;switch(t){case 90:return{x:1-s-r,y:n,width:r,height:i};case 180:return{x:1-n-i,y:1-s-r,width:i,height:r};case 270:return{x:s,y:1-n-i,width:r,height:i}}return{x:n,y:s,width:i,height:r}}function ug(e){cn._keyboardManager.exec(this,e)}function dg(e){if(!Jt(Fp,this))return;const t=window.getSelection();e?t.setPosition(Jt(Fp,this),Jt(Ip,this)):t.setPosition(Jt(Up,this),Jt(Vp,this))}function fg(){return Jt(qp,this)?this.rotation:0}function pg(){if(Jt(qp,this))return null;const[e,t]=this.pageDimensions,[n,s]=this.pageTranslation,i=Jt(zp,this),r=new Float32Array(8*i.length);let a=0;for(const{x:o,y:l,width:c,height:h}of i){const i=o*e+n,u=(1-l-h)*t+s;r[a]=r[a+4]=i,r[a+1]=r[a+3]=u,r[a+2]=r[a+6]=i+c*e,r[a+5]=r[a+7]=u+h*t,a+=8}return r}function gg(e){return Jt(Xp,this).serialize(e,Qt(tg,this,fg).call(this))}function mg(e,t){this._freeHighlight.add(t)&&e.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}function vg(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}function yg(e){const{color:t}=this._initialData;return e.color.some((e,n)=>e!==t[n])}cn=ng,o(ng,"_defaultColor",null),o(ng,"_defaultOpacity",1),o(ng,"_defaultThickness",12),o(ng,"_type","highlight"),o(ng,"_editorType",Tn.HIGHLIGHT),o(ng,"_freeHighlightId",-1),o(ng,"_freeHighlight",null),o(ng,"_freeHighlightClipId","");var bg=new WeakMap,xg=new WeakMap,wg=new WeakMap,Sg=new WeakMap,_g=new WeakMap,Cg=new WeakMap,kg=new WeakMap,Ag=new WeakMap,Eg=new WeakMap,Tg=new WeakMap,Mg=new WeakMap,jg=new WeakMap,Pg=new WeakMap,Og=new WeakSet;class Dg extends Ka{constructor(e){super(c(c({},e),{},{name:"inkEditor"})),qt(this,Og),Kt(this,bg,0),Kt(this,xg,0),Kt(this,wg,null),Kt(this,Sg,new Path2D),Kt(this,_g,!1),Kt(this,Cg,null),Kt(this,kg,!1),Kt(this,Ag,!1),Kt(this,Eg,null),Kt(this,Tg,null),Kt(this,Mg,0),Kt(this,jg,0),Kt(this,Pg,null),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(e,t){Ka.initialize(e,t)}static updateDefaultParams(e,t){switch(e){case Mn.INK_THICKNESS:Dg._defaultThickness=t;break;case Mn.INK_COLOR:Dg._defaultColor=t;break;case Mn.INK_OPACITY:Dg._defaultOpacity=t/100}}updateParams(e,t){switch(e){case Mn.INK_THICKNESS:Qt(Og,this,Ng).call(this,t);break;case Mn.INK_COLOR:Qt(Og,this,Lg).call(this,t);break;case Mn.INK_OPACITY:Qt(Og,this,Rg).call(this,t)}}static get defaultPropertiesToUpdate(){return[[Mn.INK_THICKNESS,Dg._defaultThickness],[Mn.INK_COLOR,Dg._defaultColor||Ka._defaultLineColor],[Mn.INK_OPACITY,Math.round(100*Dg._defaultOpacity)]]}get propertiesToUpdate(){var e;return[[Mn.INK_THICKNESS,this.thickness||Dg._defaultThickness],[Mn.INK_COLOR,this.color||Dg._defaultColor||Ka._defaultLineColor],[Mn.INK_OPACITY,Math.round(100*(null!==(e=this.opacity)&&void 0!==e?e:Dg._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.canvas||(Qt(Og,this,Qg).call(this),Qt(Og,this,$g).call(this)),this.isAttachedToDOM||(this.parent.add(this),Qt(Og,this,Jg).call(this)),Qt(Og,this,om).call(this)))}remove(){var e;null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,Jt(wg,this)&&(clearTimeout(Jt(wg,this)),Zt(wg,this,null)),null===(e=Jt(Eg,this))||void 0===e||e.disconnect(),Zt(Eg,this,null),super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&null===e&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){const[e,t]=this.parentDimensions,n=this.width*e,s=this.height*t;this.setDimensions(n,s)}enableEditMode(){Jt(_g,this)||null===this.canvas||(super.enableEditMode(),this._isDraggable=!1,Qt(Og,this,Yg).call(this))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),Qt(Og,this,qg).call(this))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}commit(){Jt(_g,this)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Zt(_g,this,!0),this.div.classList.add("disabled"),Qt(Og,this,om).call(this,!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),this.enableEditMode())}canvasPointerdown(e){0===e.button&&this.isInEditMode()&&!Jt(_g,this)&&(this.setInForeground(),e.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),Qt(Og,this,zg).call(this,e.offsetX,e.offsetY))}canvasPointermove(e){e.preventDefault(),Qt(Og,this,Wg).call(this,e.offsetX,e.offsetY)}canvasPointerup(e){e.preventDefault(),Qt(Og,this,Kg).call(this,e)}canvasPointerleave(e){Qt(Og,this,Kg).call(this,e)}get isResizable(){return!this.isEmpty()&&Jt(_g,this)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[n,s,i,r]=Qt(Og,this,Fg).call(this);if(this.setAt(n,s,0,0),this.setDims(i,r),Qt(Og,this,Qg).call(this),this.width){const[n,s]=this.parentDimensions;this.setAspectRatio(this.width*n,this.height*s),this.setAt(e*n,t*s,this.width*n,this.height*s),Zt(Ag,this,!0),Qt(Og,this,Jg).call(this),this.setDims(this.width*n,this.height*s),Qt(Og,this,Xg).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Qt(Og,this,$g).call(this),this.div}setDimensions(e,t){const n=Math.round(e),s=Math.round(t);if(Jt(Mg,this)===n&&Jt(jg,this)===s)return;Zt(Mg,this,n),Zt(jg,this,s),this.canvas.style.visibility="hidden";const[i,r]=this.parentDimensions;this.width=e/i,this.height=t/r,this.fixAndSetPosition(),Jt(_g,this)&&Qt(Og,this,Zg).call(this,e,t),Qt(Og,this,Jg).call(this),Qt(Og,this,Xg).call(this),this.canvas.style.visibility="visible",this.fixDims()}static async deserialize(e,t,n){if(e instanceof Fd)return null;const s=await super.deserialize(e,t,n);s.thickness=e.thickness,s.color=Os.makeHexColor(...e.color),s.opacity=e.opacity;const[i,r]=s.pageDimensions,a=s.width*i,o=s.height*r,l=s.parentScale,c=e.thickness/2;Zt(_g,s,!0),Zt(Mg,s,Math.round(a)),Zt(jg,s,Math.round(o));const{paths:h,rect:u,rotation:d}=e;for(let{bezier:p}of h){p=sm.call(Dg,p,u,d);const e=[];s.paths.push(e);let t=l*(p[0]-c),n=l*(p[1]-c);for(let s=2,r=p.length;s<r;s+=6){const i=l*(p[s]-c),r=l*(p[s+1]-c),a=l*(p[s+2]-c),o=l*(p[s+3]-c),h=l*(p[s+4]-c),u=l*(p[s+5]-c);e.push([[t,n],[i,r],[a,o],[h,u]]),t=h,n=u}const i=Qt(Dg,this,tm).call(this,e);s.bezierPath2D.push(i)}const f=Qt(Og,s,rm).call(s);return Zt(xg,s,Math.max(Ka.MIN_SIZE,f[2]-f[0])),Zt(bg,s,Math.max(Ka.MIN_SIZE,f[3]-f[1])),Qt(Og,s,Zg).call(s,a,o),s}serialize(){if(this.isEmpty())return null;const e=this.getRect(0,0),t=Ka._colorManager.convert(this.ctx.strokeStyle);return{annotationType:Tn.INK,color:t,thickness:this.thickness,opacity:this.opacity,paths:Qt(Og,this,im).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,e),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}function Ng(e){const t=e=>{this.thickness=e,Qt(Og,this,om).call(this)},n=this.thickness;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mn.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}function Lg(e){const t=e=>{this.color=e,Qt(Og,this,Xg).call(this)},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mn.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function Rg(e){const t=e=>{this.opacity=e,Qt(Og,this,Xg).call(this)};e/=100;const n=this.opacity;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mn.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}function Fg(){const{parentRotation:e,parentDimensions:[t,n]}=this;switch(e){case 90:return[0,n,n,t];case 180:return[t,n,t,n];case 270:return[t,0,n,t];default:return[0,0,t,n]}}function Ig(){const{ctx:e,color:t,opacity:n,thickness:s,parentScale:i,scaleFactor:r}=this;e.lineWidth=s*i/r,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle="".concat(t).concat(function(e){return Math.round(Math.min(255,Math.max(1,255*e))).toString(16).padStart(2,"0")}(n))}function zg(e,t){this.canvas.addEventListener("contextmenu",ri,{signal:this._uiManager._signal}),Qt(Og,this,qg).call(this),Zt(Cg,this,new AbortController);const n=this._uiManager.combinedSignal(Jt(Cg,this));var s;(this.canvas.addEventListener("pointerleave",this.canvasPointerleave.bind(this),{signal:n}),this.canvas.addEventListener("pointermove",this.canvasPointermove.bind(this),{signal:n}),this.canvas.addEventListener("pointerup",this.canvasPointerup.bind(this),{signal:n}),this.isEditing=!0,Jt(Ag,this))||(Zt(Ag,this,!0),Qt(Og,this,Jg).call(this),this.thickness||(this.thickness=hn._defaultThickness),this.color||(this.color=hn._defaultColor||Ka._defaultLineColor),null!==(s=this.opacity)&&void 0!==s||(this.opacity=hn._defaultOpacity));this.currentPath.push([e,t]),Zt(kg,this,!1),Qt(Og,this,Ig).call(this),Zt(Pg,this,()=>{Qt(Og,this,Ug).call(this),Jt(Pg,this)&&window.requestAnimationFrame(Jt(Pg,this))}),window.requestAnimationFrame(Jt(Pg,this))}function Wg(e,t){const[n,s]=this.currentPath.at(-1);if(this.currentPath.length>1&&e===n&&t===s)return;const i=this.currentPath;let r=Jt(Sg,this);if(i.push([e,t]),Zt(kg,this,!0),i.length<=2)return r.moveTo(...i[0]),void r.lineTo(e,t);3===i.length&&(Zt(Sg,this,r=new Path2D),r.moveTo(...i[0])),Qt(Og,this,Vg).call(this,r,...i.at(-3),...i.at(-2),e,t)}function Bg(){if(0===this.currentPath.length)return;const e=this.currentPath.at(-1);Jt(Sg,this).lineTo(...e)}function Hg(e,t){let n;if(Zt(Pg,this,null),e=Math.min(Math.max(e,0),this.canvas.width),t=Math.min(Math.max(t,0),this.canvas.height),Qt(Og,this,Wg).call(this,e,t),Qt(Og,this,Bg).call(this),1!==this.currentPath.length)n=Qt(Og,this,Gg).call(this);else{const s=[e,t];n=[[s,s.slice(),s.slice(),s]]}const s=Jt(Sg,this),i=this.currentPath;this.currentPath=[],Zt(Sg,this,new Path2D);this.addCommands({cmd:()=>{this.allRawPaths.push(i),this.paths.push(n),this.bezierPath2D.push(s),this._uiManager.rebuild(this)},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(Qt(Og,this,Qg).call(this),Qt(Og,this,$g).call(this)),Qt(Og,this,om).call(this))},mustExec:!0})}function Ug(){if(!Jt(kg,this))return;Zt(kg,this,!1);const e=Math.ceil(this.thickness*this.parentScale),t=this.currentPath.slice(-3),n=t.map(e=>e[0]),s=t.map(e=>e[1]),{ctx:i}=(Math.min(...n),Math.max(...n),Math.min(...s),Math.max(...s),this);i.save(),i.clearRect(0,0,this.canvas.width,this.canvas.height);for(const r of this.bezierPath2D)i.stroke(r);i.stroke(Jt(Sg,this)),i.restore()}function Vg(e,t,n,s,i,r,a){const o=(t+s)/2,l=(n+i)/2,c=(s+r)/2,h=(i+a)/2;e.bezierCurveTo(o+2*(s-o)/3,l+2*(i-l)/3,c+2*(s-c)/3,h+2*(i-h)/3,c,h)}function Gg(){const e=this.currentPath;if(e.length<=2)return[[e[0],e[0],e.at(-1),e.at(-1)]];const t=[];let n,[s,i]=e[0];for(n=1;n<e.length-2;n++){const[r,a]=e[n],[o,l]=e[n+1],c=(r+o)/2,h=(a+l)/2,u=[s+2*(r-s)/3,i+2*(a-i)/3],d=[c+2*(r-c)/3,h+2*(a-h)/3];t.push([[s,i],u,d,[c,h]]),[s,i]=[c,h]}const[r,a]=e[n],[o,l]=e[n+1],c=[s+2*(r-s)/3,i+2*(a-i)/3],h=[o+2*(r-o)/3,l+2*(a-l)/3];return t.push([[s,i],c,h,[o,l]]),t}function Xg(){if(this.isEmpty())return void Qt(Og,this,em).call(this);Qt(Og,this,Ig).call(this);const{canvas:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),Qt(Og,this,em).call(this);for(const n of this.bezierPath2D)t.stroke(n)}function Yg(){if(Jt(Tg,this))return;Zt(Tg,this,new AbortController);const e=this._uiManager.combinedSignal(Jt(Tg,this));this.canvas.addEventListener("pointerdown",this.canvasPointerdown.bind(this),{signal:e})}function qg(){var e;null===(e=this.pointerdownAC)||void 0===e||e.abort(),this.pointerdownAC=null}function Kg(e){var t;null===(t=Jt(Cg,this))||void 0===t||t.abort(),Zt(Cg,this,null),Qt(Og,this,Yg).call(this),Jt(wg,this)&&clearTimeout(Jt(wg,this)),Zt(wg,this,setTimeout(()=>{Zt(wg,this,null),this.canvas.removeEventListener("contextmenu",ri)},10)),Qt(Og,this,Hg).call(this,e.offsetX,e.offsetY),this.addToAnnotationStorage(),this.setInBackground()}function Qg(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}function $g(){Zt(Eg,this,new ResizeObserver(e=>{const t=e[0].contentRect;t.width&&t.height&&this.setDimensions(t.width,t.height)})),Jt(Eg,this).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var e;null===(e=Jt(Eg,this))||void 0===e||e.disconnect(),Zt(Eg,this,null)},{once:!0})}function Jg(){if(!Jt(Ag,this))return;const[e,t]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*t),Qt(Og,this,em).call(this)}function Zg(e,t){const n=Qt(Og,this,am).call(this),s=(e-n)/Jt(xg,this),i=(t-n)/Jt(bg,this);this.scaleFactor=Math.min(s,i)}function em(){const e=Qt(Og,this,am).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)}function tm(e){const t=new Path2D;for(let n=0,s=e.length;n<s;n++){const[s,i,r,a]=e[n];0===n&&t.moveTo(...s),t.bezierCurveTo(i[0],i[1],r[0],r[1],a[0],a[1])}return t}function nm(e,t,n){const[s,i,r,a]=t;switch(n){case 0:for(let t=0,n=e.length;t<n;t+=2)e[t]+=s,e[t+1]=a-e[t+1];break;case 90:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=e[t+1]+s,e[t+1]=n+i}break;case 180:for(let t=0,n=e.length;t<n;t+=2)e[t]=r-e[t],e[t+1]+=i;break;case 270:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=r-e[t+1],e[t+1]=a-n}break;default:throw new Error("Invalid rotation")}return e}function sm(e,t,n){const[s,i,r,a]=t;switch(n){case 0:for(let t=0,n=e.length;t<n;t+=2)e[t]-=s,e[t+1]=a-e[t+1];break;case 90:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=e[t+1]-i,e[t+1]=n-s}break;case 180:for(let t=0,n=e.length;t<n;t+=2)e[t]=r-e[t],e[t+1]-=i;break;case 270:for(let t=0,n=e.length;t<n;t+=2){const n=e[t];e[t]=a-e[t+1],e[t+1]=r-n}break;default:throw new Error("Invalid rotation")}return e}function im(e,t,n,s){const i=[],r=this.thickness/2,a=e*t+r,o=e*n+r;for(const l of this.paths){const t=[],n=[];for(let s=0,i=l.length;s<i;s++){const[r,c,h,u]=l[s];if(r[0]===u[0]&&r[1]===u[1]&&1===i){const s=e*r[0]+a,i=e*r[1]+o;t.push(s,i),n.push(s,i);break}const d=e*r[0]+a,f=e*r[1]+o,p=e*c[0]+a,g=e*c[1]+o,m=e*h[0]+a,v=e*h[1]+o,y=e*u[0]+a,b=e*u[1]+o;0===s&&(t.push(d,f),n.push(d,f)),t.push(p,g,m,v,y,b),n.push(p,g),s===i-1&&n.push(y,b)}i.push({bezier:nm.call(hn,t,s,this.rotation),points:nm.call(hn,n,s,this.rotation)})}return i}function rm(){let e=1/0,t=-1/0,n=1/0,s=-1/0;for(const i of this.paths)for(const[r,a,o,l]of i){const i=Os.bezierBoundingBox(...r,...a,...o,...l);e=Math.min(e,i[0]),n=Math.min(n,i[1]),t=Math.max(t,i[2]),s=Math.max(s,i[3])}return[e,n,t,s]}function am(){return Jt(_g,this)?Math.ceil(this.thickness*this.parentScale):0}function om(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return;if(!Jt(_g,this))return void Qt(Og,this,Xg).call(this);const t=Qt(Og,this,rm).call(this),n=Qt(Og,this,am).call(this);Zt(xg,this,Math.max(Ka.MIN_SIZE,t[2]-t[0])),Zt(bg,this,Math.max(Ka.MIN_SIZE,t[3]-t[1]));const s=Math.ceil(n+Jt(xg,this)*this.scaleFactor),i=Math.ceil(n+Jt(bg,this)*this.scaleFactor),[r,a]=this.parentDimensions;this.width=s/r,this.height=i/a,this.setAspectRatio(s,i);const o=this.translationX,l=this.translationY;this.translationX=-t[0],this.translationY=-t[1],Qt(Og,this,Jg).call(this),Qt(Og,this,Xg).call(this),Zt(Mg,this,s),Zt(jg,this,i),this.setDims(s,i);const c=e?n/this.scaleFactor/2:0;this.translate(o-this.translationX-c,l-this.translationY-c)}hn=Dg,o(Dg,"_defaultColor",null),o(Dg,"_defaultOpacity",1),o(Dg,"_defaultThickness",1),o(Dg,"_type","ink"),o(Dg,"_editorType",Tn.INK);var lm=new WeakMap,cm=new WeakMap,hm=new WeakMap,um=new WeakMap,dm=new WeakMap,fm=new WeakMap,pm=new WeakMap,gm=new WeakMap,mm=new WeakMap,vm=new WeakMap,ym=new WeakMap,bm=new WeakSet;class xm extends Ka{constructor(e){super(c(c({},e),{},{name:"stampEditor"})),qt(this,bm),Kt(this,lm,null),Kt(this,cm,null),Kt(this,hm,null),Kt(this,um,null),Kt(this,dm,null),Kt(this,fm,""),Kt(this,pm,null),Kt(this,gm,null),Kt(this,mm,null),Kt(this,vm,!1),Kt(this,ym,!1),Zt(um,this,e.bitmapUrl),Zt(dm,this,e.bitmapFile)}static initialize(e,t){Ka.initialize(e,t)}static get supportedTypes(){return ys(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(e=>"image/".concat(e)))}static get supportedTypesStr(){return ys(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(Tn.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!(null===(e=this.altTextData)||void 0===e||!e.altText)}}static computeTelemetryFinalData(e){var t,n;const s=e.get("hasAltText");return{hasAltText:null!==(t=s.get(!0))&&void 0!==t?t:0,hasNoAltText:null!==(n=s.get(!1))&&void 0!==n?n:0}}async mlGuessAltText(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:i,height:r}=e||this.copyCanvas(null,null,!0).imageData,a=await n.guess({name:"altText",request:{data:s,width:i,height:r,channels:s.length/(i*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const o=a.output;return await this.setGuessedAltText(o),t&&!this.hasAltTextData()&&(this.altTextData={alt:o,decorative:!1}),o}remove(){var e,t;Jt(cm,this)&&(Zt(lm,this,null),this._uiManager.imageManager.deleteId(Jt(cm,this)),null===(e=Jt(pm,this))||void 0===e||e.remove(),Zt(pm,this,null),null===(t=Jt(gm,this))||void 0===t||t.disconnect(),Zt(gm,this,null),Jt(mm,this)&&(clearTimeout(Jt(mm,this)),Zt(mm,this,null)));super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(Jt(cm,this)&&null===Jt(pm,this)&&Qt(bm,this,_m).call(this),this.isAttachedToDOM||this.parent.add(this))):Jt(cm,this)&&Qt(bm,this,_m).call(this)}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(Jt(hm,this)||Jt(lm,this)||Jt(um,this)||Jt(dm,this)||Jt(cm,this))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),Jt(lm,this)?Qt(bm,this,Cm).call(this):Qt(bm,this,_m).call(this),this.width&&!this.annotationElementId){const[n,s]=this.parentDimensions;this.setAt(e*n,t*s,this.width*n,this.height*s)}return this.div}copyCanvas(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e||(e=224);const{width:s,height:i}=Jt(lm,this),r=new pi;let a=Jt(lm,this),o=s,l=i,c=null;if(t){var h,u;if(s>t||i>t){const e=Math.min(t/s,t/i);o=Math.floor(s*e),l=Math.floor(i*e)}c=document.createElement("canvas");const e=c.width=Math.ceil(o*r.sx),n=c.height=Math.ceil(l*r.sy);Jt(vm,this)||(a=Qt(bm,this,Am).call(this,e,n));const d=c.getContext("2d");d.filter=this._uiManager.hcmFilter;let f="white",p="#cfcfd8";"none"!==this._uiManager.hcmFilter?p="black":null!==(h=(u=window).matchMedia)&&void 0!==h&&h.call(u,"(prefers-color-scheme: dark)").matches&&(f="#8f8f9d",p="#42414d");const g=15,m=g*r.sx,v=g*r.sy,y=new OffscreenCanvas(2*m,2*v),b=y.getContext("2d");b.fillStyle=f,b.fillRect(0,0,2*m,2*v),b.fillStyle=p,b.fillRect(0,0,m,v),b.fillRect(m,v,m,v),d.fillStyle=d.createPattern(y,"repeat"),d.fillRect(0,0,e,n),d.drawImage(a,0,0,a.width,a.height,0,0,e,n)}let d=null;if(n){let t,n;if(r.symmetric&&a.width<e&&a.height<e)t=a.width,n=a.height;else if(a=Jt(lm,this),s>e||i>e){const r=Math.min(e/s,e/i);t=Math.floor(s*r),n=Math.floor(i*r),Jt(vm,this)||(a=Qt(bm,this,Am).call(this,t,n))}const o=new OffscreenCanvas(t,n).getContext("2d",{willReadFrequently:!0});o.drawImage(a,0,0,a.width,a.height,0,0,t,n),d={width:t,height:n,data:o.getImageData(0,0,t,n).data}}return{canvas:c,width:o,height:l,imageData:d}}getImageForAltText(){return Jt(pm,this)}static async deserialize(e,t,n){let s=null;if(e instanceof Hd){var i;const{data:{rect:r,rotation:a,id:o,structParent:l,popupRef:c},container:h,parent:{page:{pageNumber:u}}}=e,d=h.querySelector("canvas"),f=n.imageManager.getFromCanvas(h.id,d);d.remove();const p=(null===(i=await t._structTree.getAriaAttributes("".concat(Is).concat(o)))||void 0===i?void 0:i.get("aria-label"))||"";s=e={annotationType:Tn.STAMP,bitmapId:f.id,bitmap:f.bitmap,pageIndex:u-1,rect:r.slice(0),rotation:a,id:o,deleted:!1,accessibilityData:{decorative:!1,altText:p},isSvg:!1,structParent:l,popupRef:c}}const r=await super.deserialize(e,t,n),{rect:a,bitmap:o,bitmapUrl:l,bitmapId:c,isSvg:h,accessibilityData:u}=e;c&&n.imageManager.isValidId(c)?(Zt(cm,r,c),o&&Zt(lm,r,o)):Zt(um,r,l),Zt(vm,r,h);const[d,f]=r.pageDimensions;return r.width=(a[2]-a[0])/d,r.height=(a[3]-a[1])/f,r.annotationElementId=e.id||null,u&&(r.altTextData=u),r._initialData=s,Zt(ym,r,!!s),r}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:Tn.STAMP,bitmapId:Jt(cm,this),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:Jt(vm,this),structTreeParentId:this._structTreeParentId};if(e)return n.bitmapUrl=Qt(bm,this,Tm).call(this,!0),n.accessibilityData=this.serializeAltText(!0),n;const{decorative:s,altText:i}=this.serializeAltText(!1);if(!s&&i&&(n.accessibilityData={type:"Figure",alt:i}),this.annotationElementId){const e=Qt(bm,this,jm).call(this,n);if(e.isSame)return null;var r;if(e.isSameAltText)delete n.accessibilityData;else n.accessibilityData.structParent=null!==(r=this._initialData.structParent)&&void 0!==r?r:-1}if(n.id=this.annotationElementId,null===t)return n;t.stamps||(t.stamps=new Map);const a=Jt(vm,this)?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(t.stamps.has(Jt(cm,this))){if(Jt(vm,this)){const e=t.stamps.get(Jt(cm,this));a>e.area&&(e.area=a,e.serialized.bitmap.close(),e.serialized.bitmap=Qt(bm,this,Tm).call(this,!1))}}else t.stamps.set(Jt(cm,this),{area:a,serialized:n}),n.bitmap=Qt(bm,this,Tm).call(this,!1);return n}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}function wm(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(Zt(lm,this,e.bitmap),t||(Zt(cm,this,e.id),Zt(vm,this,e.isSvg)),e.file&&Zt(fm,this,e.file.name),Qt(bm,this,Cm).call(this)):this.remove()}function Sm(){if(Zt(hm,this,null),this._uiManager.enableWaiting(!1),Jt(pm,this)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&Jt(lm,this))return this._editToolbar.hide(),void this._uiManager.editAltText(this,!0);if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&Jt(lm,this)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(e){}}this.div.focus()}}function _m(){if(Jt(cm,this))return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(Jt(cm,this)).then(e=>Qt(bm,this,wm).call(this,e,!0)).finally(()=>Qt(bm,this,Sm).call(this));if(Jt(um,this)){const e=Jt(um,this);return Zt(um,this,null),this._uiManager.enableWaiting(!0),void Zt(hm,this,this._uiManager.imageManager.getFromUrl(e).then(e=>Qt(bm,this,wm).call(this,e)).finally(()=>Qt(bm,this,Sm).call(this)))}if(Jt(dm,this)){const e=Jt(dm,this);return Zt(dm,this,null),this._uiManager.enableWaiting(!0),void Zt(hm,this,this._uiManager.imageManager.getFromFile(e).then(e=>Qt(bm,this,wm).call(this,e)).finally(()=>Qt(bm,this,Sm).call(this)))}const e=document.createElement("input");e.type="file",e.accept=un.supportedTypesStr;const t=this._uiManager._signal;Zt(hm,this,new Promise(n=>{e.addEventListener("change",async()=>{if(e.files&&0!==e.files.length){this._uiManager.enableWaiting(!0);const t=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),Qt(bm,this,wm).call(this,t)}else this.remove();n()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:t})}).finally(()=>Qt(bm,this,Sm).call(this))),e.click()}function Cm(){const{div:e}=this;let{width:t,height:n}=Jt(lm,this);const[s,i]=this.pageDimensions,r=.75;if(this.width)t=this.width*s,n=this.height*i;else if(t>r*s||n>r*i){const e=Math.min(r*s/t,r*i/n);t*=e,n*=e}const[a,o]=this.parentDimensions;this.setDims(t*a/s,n*o/i),this._uiManager.enableWaiting(!1);const l=Zt(pm,this,document.createElement("canvas"));l.setAttribute("role","img"),this.addContainer(l),this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(e.hidden=!1),Qt(bm,this,Em).call(this,t,n),Qt(bm,this,Mm).call(this),Jt(ym,this)||(this.parent.addUndoableEditor(this),Zt(ym,this,!0)),this._reportTelemetry({action:"inserted_image"}),Jt(fm,this)&&l.setAttribute("aria-label",Jt(fm,this))}function km(e,t){var n;const[s,i]=this.parentDimensions;this.width=e/s,this.height=t/i,null!==(n=this._initialOptions)&&void 0!==n&&n.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==Jt(mm,this)&&clearTimeout(Jt(mm,this));Zt(mm,this,setTimeout(()=>{Zt(mm,this,null),Qt(bm,this,Em).call(this,e,t)},200))}function Am(e,t){const{width:n,height:s}=Jt(lm,this);let i=n,r=s,a=Jt(lm,this);for(;i>2*e||r>2*t;){const n=i,s=r;i>2*e&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2)),r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const o=new OffscreenCanvas(i,r);o.getContext("2d").drawImage(a,0,0,n,s,0,0,i,r),a=o.transferToImageBitmap()}return a}function Em(e,t){const n=new pi,s=Math.ceil(e*n.sx),i=Math.ceil(t*n.sy),r=Jt(pm,this);if(!r||r.width===s&&r.height===i)return;r.width=s,r.height=i;const a=Jt(vm,this)?Jt(lm,this):Qt(bm,this,Am).call(this,s,i),o=r.getContext("2d");o.filter=this._uiManager.hcmFilter,o.drawImage(a,0,0,a.width,a.height,0,0,s,i)}function Tm(e){if(e){if(Jt(vm,this)){const e=this._uiManager.imageManager.getSvgUrl(Jt(cm,this));if(e)return e}const e=document.createElement("canvas");({width:e.width,height:e.height}=Jt(lm,this));return e.getContext("2d").drawImage(Jt(lm,this),0,0),e.toDataURL()}if(Jt(vm,this)){const[e,t]=this.pageDimensions,n=Math.round(this.width*e*Ks.PDF_TO_CSS_UNITS),s=Math.round(this.height*t*Ks.PDF_TO_CSS_UNITS),i=new OffscreenCanvas(n,s);return i.getContext("2d").drawImage(Jt(lm,this),0,0,Jt(lm,this).width,Jt(lm,this).height,0,0,n,s),i.transferToImageBitmap()}return structuredClone(Jt(lm,this))}function Mm(){this._uiManager._signal&&(Zt(gm,this,new ResizeObserver(e=>{const t=e[0].contentRect;t.width&&t.height&&Qt(bm,this,km).call(this,t.width,t.height)})),Jt(gm,this).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var e;null===(e=Jt(gm,this))||void 0===e||e.disconnect(),Zt(gm,this,null)},{once:!0}))}function jm(e){var t;const{rect:n,pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=e.rect.every((e,t)=>Math.abs(e-n[t])<1),a=e.pageIndex===s,o=((null===(t=e.accessibilityData)||void 0===t?void 0:t.alt)||"")===i;return{isSame:r&&a&&o,isSameAltText:o}}un=xm,o(xm,"_type","stamp"),o(xm,"_editorType",Tn.STAMP);var Pm=new WeakMap,Om=new WeakMap,Dm=new WeakMap,Nm=new WeakMap,Lm=new WeakMap,Rm=new WeakMap,Fm=new WeakMap,Im=new WeakMap,zm=new WeakMap,Wm=new WeakMap,Bm=new WeakMap,Hm=new WeakMap,Um=new WeakSet;class Vm{constructor(e){let{uiManager:t,pageIndex:n,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:a,drawLayer:o,textLayer:l,viewport:c,l10n:h}=e;qt(this,Um),Kt(this,Pm,void 0),Kt(this,Om,!1),Kt(this,Dm,null),Kt(this,Nm,null),Kt(this,Lm,null),Kt(this,Rm,new Map),Kt(this,Fm,!1),Kt(this,Im,!1),Kt(this,zm,!1),Kt(this,Wm,null),Kt(this,Bm,null),Kt(this,Hm,void 0);const u=[...Qm._.values()];if(!Vm._initialized){Vm._initialized=!0;for(const e of u)e.initialize(h,t)}t.registerEditorTypes(u),Zt(Hm,this,t),this.pageIndex=n,this.div=s,Zt(Pm,this,r),Zt(Dm,this,a),this.viewport=c,Zt(Wm,this,l),this.drawLayer=o,this._structTree=i,Jt(Hm,this).addLayer(this)}get isEmpty(){return 0===Jt(Rm,this).size}get isInvisible(){return this.isEmpty&&Jt(Hm,this).getMode()===Tn.NONE}updateToolbar(e){Jt(Hm,this).updateToolbar(e)}updateMode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jt(Hm,this).getMode();switch(Qt(Um,this,Km).call(this),e){case Tn.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case Tn.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case Tn.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const n of Qm._.values())t.toggle("".concat(n._type,"Editing"),e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===(null===(t=Jt(Wm,this))||void 0===t?void 0:t.div)}addInkEditorIfNeeded(e){if(Jt(Hm,this).getMode()!==Tn.INK)return;if(!e)for(const t of Jt(Rm,this).values())if(t.isEmpty())return void t.setInBackground();this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(e){Jt(Hm,this).setEditingState(e)}addCommands(e){Jt(Hm,this).addCommands(e)}toggleDrawing(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("drawing",!e)}togglePointerEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(e=Jt(Dm,this))||void 0===e||e.div.classList.toggle("disabled",!t)}async enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const n of Jt(Rm,this).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(Jt(Hm,this).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!Jt(Dm,this))return;const t=Jt(Dm,this).getEditableAnnotations();for(const n of t){if(n.hide(),Jt(Hm,this).isDeletedAnnotationElement(n.data.id))continue;if(e.has(n.data.id))continue;const t=await this.deserialize(n);t&&(this.addOrRebuild(t),t.enableEditing())}}disable(){Zt(zm,this,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const i of Jt(Rm,this).values()){var n;i.disableEditing(),i.annotationElementId&&(null===i.serialize()?(t.set(i.annotationElementId,i),null===(n=this.getEditableAnnotation(i.annotationElementId))||void 0===n||n.show(),i.remove()):e.set(i.annotationElementId,i))}if(Jt(Dm,this)){const n=Jt(Dm,this).getEditableAnnotations();for(const s of n){const{id:n}=s.data;if(Jt(Hm,this).isDeletedAnnotationElement(n))continue;let i=t.get(n);i?(i.resetAnnotationElement(s),i.show(!1),s.show()):(i=e.get(n),i&&(Jt(Hm,this).addChangedExistingAnnotation(i),i.renderAnnotationElement(s)&&i.show(!1)),s.show())}}Qt(Um,this,Km).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of Qm._.values())s.remove("".concat(i._type,"Editing"));this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),Zt(zm,this,!1)}getEditableAnnotation(e){var t;return(null===(t=Jt(Dm,this))||void 0===t?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){Jt(Hm,this).getActive()!==e&&Jt(Hm,this).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,null!==(e=Jt(Wm,this))&&void 0!==e&&e.div&&!Jt(Bm,this)){Zt(Bm,this,new AbortController);const e=Jt(Hm,this).combinedSignal(Jt(Bm,this));Jt(Wm,this).div.addEventListener("pointerdown",Qt(Um,this,Gm).bind(this),{signal:e}),Jt(Wm,this).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,null!==(e=Jt(Wm,this))&&void 0!==e&&e.div&&Jt(Bm,this)&&(Jt(Bm,this).abort(),Zt(Bm,this,null),Jt(Wm,this).div.classList.remove("highlighting"))}enableClick(){if(Jt(Nm,this))return;Zt(Nm,this,new AbortController);const e=Jt(Hm,this).combinedSignal(Jt(Nm,this));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:e})}disableClick(){var e;null===(e=Jt(Nm,this))||void 0===e||e.abort(),Zt(Nm,this,null)}attach(e){Jt(Rm,this).set(e.id,e);const{annotationElementId:t}=e;t&&Jt(Hm,this).isDeletedAnnotationElement(t)&&Jt(Hm,this).removeDeletedAnnotationElement(e)}detach(e){var t;Jt(Rm,this).delete(e.id),null===(t=Jt(Pm,this))||void 0===t||t.removePointerInTextLayer(e.contentDiv),!Jt(zm,this)&&e.annotationElementId&&Jt(Hm,this).addDeletedAnnotationElement(e)}remove(e){this.detach(e),Jt(Hm,this).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1,Jt(Im,this)||this.addInkEditorIfNeeded(!1)}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(Jt(Hm,this).addDeletedAnnotationElement(e.annotationElementId),Ka.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),null===(t=e.parent)||void 0===t||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(e.parent!==this||!e.isAttachedToDOM){if(this.changeParent(e),Jt(Hm,this).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(),Jt(Hm,this).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var t;if(!e.isAttachedToDOM)return;const{activeElement:n}=document;e.div.contains(n)&&!Jt(Lm,this)&&(e._focusEventsAllowed=!1,Zt(Lm,this,setTimeout(()=>{Zt(Lm,this,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:Jt(Hm,this)._signal}),n.focus())},0))),e._structTreeParentId=null===(t=Jt(Pm,this))||void 0===t?void 0:t.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){this.addCommands({cmd:()=>e._uiManager.rebuild(e),undo:()=>{e.remove()},mustExec:!1})}getNextId(){return Jt(Hm,this).getId()}combinedSignal(e){return Jt(Hm,this).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return null===(e=$t(Um,this,Xm))||void 0===e?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){Jt(Hm,this).updateToolbar(e),Jt(Hm,this).updateMode(e);const{offsetX:n,offsetY:s}=Qt(Um,this,qm).call(this),i=this.getNextId(),r=Qt(Um,this,Ym).call(this,c({parent:this,id:i,x:n,y:s,uiManager:Jt(Hm,this),isCentered:!0},t));r&&this.add(r)}async deserialize(e){var t,n;return await(null===(t=Qm._.get(null!==(n=e.annotationType)&&void 0!==n?n:e.annotationEditorType))||void 0===t?void 0:t.deserialize(e,this,Jt(Hm,this)))||null}createAndAddNewEditor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.getNextId(),i=Qt(Um,this,Ym).call(this,c({parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:Jt(Hm,this),isCentered:t},n));return i&&this.add(i),i}addNewEditor(){this.createAndAddNewEditor(Qt(Um,this,qm).call(this),!0)}setSelected(e){Jt(Hm,this).setSelected(e)}toggleSelected(e){Jt(Hm,this).toggleSelected(e)}unselect(e){Jt(Hm,this).unselect(e)}pointerup(e){const{isMac:t}=js.platform;0!==e.button||e.ctrlKey&&t||e.target===this.div&&Jt(Fm,this)&&(Zt(Fm,this,!1),Jt(Om,this)?Jt(Hm,this).getMode()!==Tn.STAMP?this.createAndAddNewEditor(e,!1):Jt(Hm,this).unselectAll():Zt(Om,this,!0))}pointerdown(e){if(Jt(Hm,this).getMode()===Tn.HIGHLIGHT&&this.enableTextSelection(),Jt(Fm,this))return void Zt(Fm,this,!1);const{isMac:t}=js.platform;if(0!==e.button||e.ctrlKey&&t)return;if(e.target!==this.div)return;Zt(Fm,this,!0);const n=Jt(Hm,this).getActive();Zt(Om,this,!n||n.isEmpty())}findNewParent(e,t,n){const s=Jt(Hm,this).findParent(t,n);return null!==s&&s!==this&&(s.changeParent(e),!0)}destroy(){var e;(null===(e=Jt(Hm,this).getActive())||void 0===e?void 0:e.parent)===this&&(Jt(Hm,this).commitOrRemove(),Jt(Hm,this).setActiveEditor(null)),Jt(Lm,this)&&(clearTimeout(Jt(Lm,this)),Zt(Lm,this,null));for(const n of Jt(Rm,this).values()){var t;null===(t=Jt(Pm,this))||void 0===t||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove()}this.div=null,Jt(Rm,this).clear(),Jt(Hm,this).removeLayer(this)}render(e){let{viewport:t}=e;this.viewport=t,fi(this.div,t);for(const n of Jt(Hm,this).getEditors(this.pageIndex))this.add(n),n.rebuild();this.updateMode()}update(e){let{viewport:t}=e;Jt(Hm,this).commitOrRemove(),Qt(Um,this,Km).call(this);const n=this.viewport.rotation,s=t.rotation;if(this.viewport=t,fi(this.div,{rotation:s}),n!==s)for(const i of Jt(Rm,this).values())i.rotate(s);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return Jt(Hm,this).viewParameters.realScale}}function Gm(e){Jt(Hm,this).unselectAll();const{target:t}=e;if(t===Jt(Wm,this).div||("img"===t.getAttribute("role")||t.classList.contains("endOfContent"))&&Jt(Wm,this).div.contains(t)){const{isMac:t}=js.platform;if(0!==e.button||e.ctrlKey&&t)return;Jt(Hm,this).showAllEditors("highlight",!0,!0),Jt(Wm,this).div.classList.add("free"),this.toggleDrawing(),ng.startHighlighting(this,"ltr"===Jt(Hm,this).direction,{target:Jt(Wm,this).div,x:e.x,y:e.y}),Jt(Wm,this).div.addEventListener("pointerup",()=>{Jt(Wm,this).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:Jt(Hm,this)._signal}),e.preventDefault()}}function Xm(e){return Qm._.get(Jt(Hm,e).getMode())}function Ym(e){const t=$t(Um,this,Xm);return t?new t.prototype.constructor(e):null}function qm(){const{x:e,y:t,width:n,height:s}=this.div.getBoundingClientRect(),i=Math.max(0,e),r=Math.max(0,t),a=(i+Math.min(window.innerWidth,e+n))/2-e,o=(r+Math.min(window.innerHeight,t+s))/2-t,[l,c]=this.viewport.rotation%180===0?[a,o]:[o,a];return{offsetX:l,offsetY:c}}function Km(){Zt(Im,this,!0);for(const e of Jt(Rm,this).values())e.isEmpty()&&e.remove();Zt(Im,this,!1)}o(Vm,"_initialized",!1);var Qm={_:new Map([cf,Dg,xm,ng].map(e=>[e._editorType,e]))},$m=new WeakMap,Jm=new WeakMap,Zm=new WeakMap,ev=new WeakMap,tv=new WeakSet;class nv{constructor(e){let{pageIndex:t}=e;qt(this,tv),Kt(this,$m,null),Kt(this,Jm,0),Kt(this,Zm,new Map),Kt(this,ev,new Map),this.pageIndex=t}setParent(e){if(Jt($m,this)){if(Jt($m,this)!==e){if(Jt(Zm,this).size>0)for(const t of Jt(Zm,this).values())t.remove(),e.append(t);Zt($m,this,e)}}else Zt($m,this,e)}static get _svgFactory(){return ys(this,"_svgFactory",new _u)}draw(e,t,n){var s,i;let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=(Zt(Jm,this,(s=Jt(Jm,this),i=s++,s)),i),o=Qt(tv,this,iv).call(this,e.box);o.classList.add(...e.classNamesForDrawing);const l=nv._svgFactory.createElement("defs");o.append(l);const c=nv._svgFactory.createElement("path");l.append(c);const h="path_p".concat(this.pageIndex,"_").concat(a);c.setAttribute("id",h),c.setAttribute("d",e.toSVGPath()),r&&Jt(ev,this).set(a,c);const u=Qt(tv,this,rv).call(this,l,h),d=nv._svgFactory.createElement("use");return o.append(d),o.setAttribute("fill",t),o.setAttribute("fill-opacity",n),d.setAttribute("href","#".concat(h)),Jt(Zm,this).set(a,o),{id:a,clipPathId:"url(#".concat(u,")")}}drawOutline(e){var t,n;const s=(Zt(Jm,this,(t=Jt(Jm,this),n=t++,t)),n),i=Qt(tv,this,iv).call(this,e.box);i.classList.add(...e.classNamesForOutlining);const r=nv._svgFactory.createElement("defs");i.append(r);const a=nv._svgFactory.createElement("path");r.append(a);const o="path_p".concat(this.pageIndex,"_").concat(s);let l;if(a.setAttribute("id",o),a.setAttribute("d",e.toSVGPath()),a.setAttribute("vector-effect","non-scaling-stroke"),e.mustRemoveSelfIntersections){const e=nv._svgFactory.createElement("mask");r.append(e),l="mask_p".concat(this.pageIndex,"_").concat(s),e.setAttribute("id",l),e.setAttribute("maskUnits","objectBoundingBox");const t=nv._svgFactory.createElement("rect");e.append(t),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("fill","white");const n=nv._svgFactory.createElement("use");e.append(n),n.setAttribute("href","#".concat(o)),n.setAttribute("stroke","none"),n.setAttribute("fill","black"),n.setAttribute("fill-rule","nonzero"),n.classList.add("mask")}const c=nv._svgFactory.createElement("use");i.append(c),c.setAttribute("href","#".concat(o)),l&&c.setAttribute("mask","url(#".concat(l,")"));const h=c.cloneNode();return i.append(h),c.classList.add("mainOutline"),h.classList.add("secondaryOutline"),Jt(Zm,this).set(s,i),s}finalizeLine(e,t){const n=Jt(ev,this).get(e);Jt(ev,this).delete(e),this.updateBox(e,t.box),n.setAttribute("d",t.toSVGPath())}updateLine(e,t){Jt(Zm,this).get(e).firstChild.firstChild.setAttribute("d",t.toSVGPath())}updatePath(e,t){Jt(ev,this).get(e).setAttribute("d",t.toSVGPath())}updateBox(e,t){sv.call(nv,Jt(Zm,this).get(e),t)}show(e,t){Jt(Zm,this).get(e).classList.toggle("hidden",!t)}rotate(e,t){Jt(Zm,this).get(e).setAttribute("data-main-rotation",t)}changeColor(e,t){Jt(Zm,this).get(e).setAttribute("fill",t)}changeOpacity(e,t){Jt(Zm,this).get(e).setAttribute("fill-opacity",t)}addClass(e,t){Jt(Zm,this).get(e).classList.add(t)}removeClass(e,t){Jt(Zm,this).get(e).classList.remove(t)}getSVGRoot(e){return Jt(Zm,this).get(e)}remove(e){Jt(ev,this).delete(e),null!==Jt($m,this)&&(Jt(Zm,this).get(e).remove(),Jt(Zm,this).delete(e))}destroy(){Zt($m,this,null);for(const e of Jt(Zm,this).values())e.remove();Jt(Zm,this).clear(),Jt(ev,this).clear()}}function sv(e){let{x:t=0,y:n=0,width:s=1,height:i=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{style:r}=e;r.top="".concat(100*n,"%"),r.left="".concat(100*t,"%"),r.width="".concat(100*s,"%"),r.height="".concat(100*i,"%")}function iv(e){const t=dn._svgFactory.create(1,1,!0);return Jt($m,this).append(t),t.setAttribute("aria-hidden",!0),sv.call(dn,t,e),t}function rv(e,t){const n=dn._svgFactory.createElement("clipPath");e.append(n);const s="clip_".concat(t);n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const i=dn._svgFactory.createElement("use");return n.append(i),i.setAttribute("href","#".concat(t)),i.classList.add("clip"),s}dn=nv;var av=pn.AnnotationLayer,ov=pn.AnnotationMode,lv=pn.GlobalWorkerOptions,cv=pn.PDFDataRangeTransport,hv=pn.TextLayer,uv=pn.getDocument,dv=function(e,t,n){if(n||2===arguments.length)for(var s,i=0,r=t.length;i<r;i++)!s&&i in t||(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))},fv=dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv(dv([],["onCopy","onCut","onPaste"],!0),["onCompositionEnd","onCompositionStart","onCompositionUpdate"],!0),["onFocus","onBlur"],!0),["onInput","onInvalid","onReset","onSubmit"],!0),["onLoad","onError"],!0),["onKeyDown","onKeyPress","onKeyUp"],!0),["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],!0),["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],!0),["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],!0),["onSelect"],!0),["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],!0),["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],!0),["onScroll"],!0),["onWheel"],!0),["onAnimationStart","onAnimationEnd","onAnimationIteration"],!0),["onTransitionEnd"],!0),["onChange"],!0),["onToggle"],!0);function pv(e,t){var n={};return fv.forEach(function(s){var i=e[s];i&&(n[s]=t?function(e){return i(e,t(s))}:i)}),n}function gv(e){var t=!1;return{promise:new Promise(function(n,s){e.then(function(e){return!t&&n(e)}).catch(function(e){return!t&&s(e)})}),cancel:function(){t=!0}}}function mv(e){var t,n,s="";if("string"==typeof e||"number"==typeof e)s+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=mv(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}const vv=function(){for(var e,t,n=0,s="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=mv(e))&&(s&&(s+=" "),s+=t);return s};var yv="Invariant failed";function bv(e,t){if(!e)throw new Error(yv)}var xv=n(440),wv=Object.prototype.hasOwnProperty;function Sv(e,t,n){for(n of e.keys())if(_v(n,t))return n}function _v(e,t){var n,s,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((s=e.length)===t.length)for(;s--&&_v(e[s],t[s]););return-1===s}if(n===Set){if(e.size!==t.size)return!1;for(s of e){if((i=s)&&"object"===typeof i&&!(i=Sv(t,i)))return!1;if(!t.has(i))return!1}return!0}if(n===Map){if(e.size!==t.size)return!1;for(s of e){if((i=s[0])&&"object"===typeof i&&!(i=Sv(t,i)))return!1;if(!_v(s[1],t.get(i)))return!1}return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((s=e.byteLength)===t.byteLength)for(;s--&&e.getInt8(s)===t.getInt8(s););return-1===s}if(ArrayBuffer.isView(e)){if((s=e.byteLength)===t.byteLength)for(;s--&&e[s]===t[s];);return-1===s}if(!n||"object"===typeof e){for(n in s=0,e){if(wv.call(e,n)&&++s&&!wv.call(t,n))return!1;if(!(n in t)||!_v(e[n],t[n]))return!1}return Object.keys(t).length===s}}return e!==e&&t!==t}const Cv=(0,t.createContext)(null);function kv(e){let{children:t,type:n}=e;return(0,_t.jsx)("div",{className:"react-pdf__message react-pdf__message--".concat(n),children:t})}class Av{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return bv(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){bv(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}goToDestination(e){return new Promise(t=>{bv(this.pdfDocument),bv(e),"string"===typeof e?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(e=>{bv(Array.isArray(e),'"'.concat(e,'" is not a valid destination array.'));const t=e[0];new Promise(e=>{bv(this.pdfDocument),t instanceof Object?this.pdfDocument.getPageIndex(t).then(t=>{e(t)}).catch(()=>{bv(!1,'"'.concat(t,'" is not a valid page reference.'))}):"number"===typeof t?e(t):bv(!1,'"'.concat(t,'" is not a valid destination reference.'))}).then(t=>{const n=t+1;bv(this.pdfViewer),bv(n>=1&&n<=this.pagesCount,'"'.concat(n,'" is not a valid page number.')),this.pdfViewer.scrollPageIntoView({dest:e,pageIndex:t,pageNumber:n})})})}navigateTo(e){this.goToDestination(e)}goToPage(e){const t=e-1;bv(this.pdfViewer),bv(e>=1&&e<=this.pagesCount,'"'.concat(e,'" is not a valid page number.')),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}addLinkAttributes(e,t,n){e.href=t,e.rel=this.externalLinkRel||"noopener noreferrer nofollow",e.target=n?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}const Ev={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Tv="undefined"!==typeof window,Mv=Tv&&"file:"===window.location.protocol;function jv(e){return function(e){return"undefined"!==typeof e}(e)&&null!==e}function Pv(e){return function(e){return"string"===typeof e}(e)&&/^data:/.test(e)}function Ov(e){bv(Pv(e));const[t="",n=""]=e.split(",");return-1!==t.split(";").indexOf("base64")?atob(n):unescape(n)}function Dv(){return Tv&&window.devicePixelRatio||1}const Nv="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function Lv(){xv(!Mv,"Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ".concat(Nv))}function Rv(e){(null===e||void 0===e?void 0:e.cancel)&&e.cancel()}function Fv(e,t){return Object.defineProperty(e,"width",{get(){return this.view[2]*t},configurable:!0}),Object.defineProperty(e,"height",{get(){return this.view[3]*t},configurable:!0}),Object.defineProperty(e,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(e,"originalHeight",{get(){return this.view[3]},configurable:!0}),e}function Iv(e,t){switch(t.type){case"RESOLVE":return{value:t.value,error:void 0};case"REJECT":return{value:!1,error:t.error};case"RESET":return{value:void 0,error:void 0};default:return e}}function zv(){return(0,t.useReducer)(Iv,{value:void 0,error:void 0})}var Wv=function(e,t,n,s){return new(n||(n=Promise))(function(i,r){function a(e){try{l(s.next(e))}catch(xy){r(xy)}}function o(e){try{l(s.throw(e))}catch(xy){r(xy)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((s=s.apply(e,t||[])).next())})},Bv=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n};const{Tm:Hv}=e,Uv=(e,t)=>{switch(t){case Ev.NEED_PASSWORD:e(prompt("Enter the password to open this PDF file."));break;case Ev.INCORRECT_PASSWORD:e(prompt("Invalid password. Please try again."));break}};function Vv(e){return"object"===typeof e&&null!==e&&("data"in e||"range"in e||"url"in e)}const Gv=(0,t.forwardRef)(function(e,n){var{children:s,className:i,error:r="Failed to load PDF file.",externalLinkRel:a,externalLinkTarget:o,file:l,inputRef:c,imageResourcesPath:h,loading:u="Loading PDF\u2026",noData:d="No PDF file specified.",onItemClick:f,onLoadError:p,onLoadProgress:g,onLoadSuccess:m,onPassword:v=Uv,onSourceError:y,onSourceSuccess:b,options:x,renderMode:w,rotate:S}=e,_=Bv(e,["children","className","error","externalLinkRel","externalLinkTarget","file","inputRef","imageResourcesPath","loading","noData","onItemClick","onLoadError","onLoadProgress","onLoadSuccess","onPassword","onSourceError","onSourceSuccess","options","renderMode","rotate"]);const[C,k]=zv(),{value:A,error:E}=C,[T,M]=zv(),{value:j,error:P}=T,O=(0,t.useRef)(new Av),D=(0,t.useRef)([]),N=(0,t.useRef)(void 0),L=(0,t.useRef)(void 0);l&&l!==N.current&&Vv(l)&&(xv(!_v(l,N.current),'File prop passed to <Document /> changed, but it\'s equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.'),N.current=l),x&&x!==L.current&&(xv(!_v(x,L.current),'Options prop passed to <Document /> changed, but it\'s equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.'),L.current=x);const R=(0,t.useRef)({scrollPageIntoView:e=>{const{dest:t,pageNumber:n,pageIndex:s=n-1}=e;if(f)return void f({dest:t,pageIndex:s,pageNumber:n});const i=D.current[s];i?i.scrollIntoView():xv(!1,"An internal link leading to page ".concat(n," was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>."))}});(0,t.useImperativeHandle)(n,()=>({linkService:O,pages:D,viewer:R}),[]),(0,t.useEffect)(function(){k({type:"RESET"})},[l,k]);const F=(0,t.useCallback)(()=>Wv(this,void 0,void 0,function*(){if(!l)return null;if("string"===typeof l){if(Pv(l)){return{data:Ov(l)}}return Lv(),{url:l}}if(l instanceof Hv)return{range:l};if(l instanceof ArrayBuffer)return{data:l};if(Tv&&function(e){return bv(Tv),e instanceof Blob}(l)){const e=yield function(e){return new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{if(!s.result)return n(new Error("Error while reading a file."));t(s.result)},s.onerror=e=>{if(!e.target)return n(new Error("Error while reading a file."));const{error:t}=e.target;if(!t)return n(new Error("Error while reading a file."));switch(t.code){case t.NOT_FOUND_ERR:return n(new Error("Error while reading a file: File not found."));case t.SECURITY_ERR:return n(new Error("Error while reading a file: Security error."));case t.ABORT_ERR:return n(new Error("Error while reading a file: Aborted."));default:return n(new Error("Error while reading a file."))}},s.readAsArrayBuffer(e)})}(l);return{data:e}}if(bv("object"===typeof l),bv(Vv(l)),"url"in l&&"string"===typeof l.url){if(Pv(l.url)){const{url:e}=l,t=Bv(l,["url"]),n=Ov(e);return Object.assign({data:n},t)}Lv()}return l}),[l]);(0,t.useEffect)(()=>{const e=gv(F());return e.promise.then(e=>{k({type:"RESOLVE",value:e})}).catch(e=>{k({type:"REJECT",error:e})}),()=>{Rv(e)}},[F,k]),(0,t.useEffect)(()=>{"undefined"!==typeof A&&(!1!==A?b&&b():E&&(xv(!1,E.toString()),y&&y(E)))},[A]),(0,t.useEffect)(function(){M({type:"RESET"})},[M,A]),(0,t.useEffect)(function(){if(!A)return;const e=x?Object.assign(Object.assign({},A),x):A,t=uv(e);g&&(t.onProgress=g),v&&(t.onPassword=v);const n=t,s=n.promise.then(e=>{M({type:"RESOLVE",value:e})}).catch(e=>{n.destroyed||M({type:"REJECT",error:e})});return()=>{s.finally(()=>n.destroy())}},[x,M,A]),(0,t.useEffect)(()=>{"undefined"!==typeof j&&(!1!==j?j&&(m&&m(j),D.current=new Array(j.numPages),O.current.setDocument(j)):P&&(xv(!1,P.toString()),p&&p(P)))},[j]),(0,t.useEffect)(function(){O.current.setViewer(R.current),O.current.setExternalLinkRel(a),O.current.setExternalLinkTarget(o)},[a,o]);const I=(0,t.useCallback)((e,t)=>{D.current[e]=t},[]),z=(0,t.useCallback)(e=>{delete D.current[e]},[]),W=(0,t.useMemo)(()=>({imageResourcesPath:h,linkService:O.current,onItemClick:f,pdf:j,registerPage:I,renderMode:w,rotate:S,unregisterPage:z}),[h,f,j,I,w,S,z]),B=(0,t.useMemo)(()=>pv(_,()=>j),[_,j]);return(0,_t.jsx)("div",Object.assign({className:vv("react-pdf__Document",i),ref:c,style:{"--scale-factor":"1"}},B,{children:l?void 0===j||null===j?(0,_t.jsx)(kv,{type:"loading",children:"function"===typeof u?u():u}):!1===j?(0,_t.jsx)(kv,{type:"error",children:"function"===typeof r?r():r}):(0,_t.jsx)(Cv.Provider,{value:W,children:s}):(0,_t.jsx)(kv,{type:"no-data",children:"function"===typeof d?d():d})}))}),Xv=Gv;function Yv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.filter(Boolean);return n.length<=1?n[0]||null:function(e){n.forEach(function(t){"function"===typeof t?t(e):t&&(t.current=e)})}}const qv=(0,t.createContext)(null),Kv={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},Qv=/^H(\d+)$/;function $v(e){return"children"in e}function Jv(e){return!!$v(e)&&(1===e.children.length&&0 in e.children&&"id"in e.children[0])}function Zv(e){const t={};if($v(e)){const{role:n}=e,s=n.match(Qv);if(s)t.role="heading",t["aria-level"]=Number(s[1]);else if(function(e){return e in Kv}(n)){const e=Kv[n];e&&(t.role=e)}}return t}function ey(e){const t={};if($v(e)){if(void 0!==e.alt&&(t["aria-label"]=e.alt),void 0!==e.lang&&(t.lang=e.lang),Jv(e)){const[n]=e.children;if(n){const e=ey(n);return Object.assign(Object.assign({},t),e)}}}else"id"in e&&(t["aria-owns"]=e.id);return t}function ty(e){return e?Object.assign(Object.assign({},Zv(e)),ey(e)):null}function ny(e){let{className:n,node:s}=e;const i=(0,t.useMemo)(()=>ty(s),[s]),r=(0,t.useMemo)(()=>$v(s)?Jv(s)?null:s.children.map((e,t)=>(0,_t.jsx)(ny,{node:e},t)):null,[s]);return(0,_t.jsx)("span",Object.assign({className:n},i,{children:r}))}function sy(){return(0,t.useContext)(qv)}function iy(){const e=sy();bv(e);const{onGetStructTreeError:n,onGetStructTreeSuccess:s}=e,[i,r]=zv(),{value:a,error:o}=i,{customTextRenderer:l,page:c}=e;return(0,t.useEffect)(function(){r({type:"RESET"})},[r,c]),(0,t.useEffect)(function(){if(l)return;if(!c)return;const e=gv(c.getStructTree()),t=e;return e.promise.then(e=>{r({type:"RESOLVE",value:e})}).catch(e=>{r({type:"REJECT",error:e})}),()=>Rv(t)},[l,c,r]),(0,t.useEffect)(()=>{void 0!==a&&(!1!==a?a&&s&&s(a):o&&(xv(!1,o.toString()),n&&n(o)))},[a]),a?(0,_t.jsx)(ny,{className:"react-pdf__Page__structTree structTree",node:a}):null}const ry=ov;function ay(e){const n=sy();bv(n);const s=Object.assign(Object.assign({},n),e),{_className:i,canvasBackground:r,devicePixelRatio:a=Dv(),onRenderError:o,onRenderSuccess:l,page:c,renderForms:h,renderTextLayer:u,rotate:d,scale:f}=s,{canvasRef:p}=e;bv(c);const g=(0,t.useRef)(null);function m(e){(function(e){return"RenderingCancelledException"===e.name})(e)||(xv(!1,e.toString()),o&&o(e))}const v=(0,t.useMemo)(()=>c.getViewport({scale:f*a,rotation:d}),[a,c,d,f]),y=(0,t.useMemo)(()=>c.getViewport({scale:f,rotation:d}),[c,d,f]);(0,t.useEffect)(function(){if(!c)return;c.cleanup();const{current:e}=g;if(!e)return;e.width=v.width,e.height=v.height,e.style.width="".concat(Math.floor(y.width),"px"),e.style.height="".concat(Math.floor(y.height),"px"),e.style.visibility="hidden";const t={annotationMode:h?ry.ENABLE_FORMS:ry.ENABLE,canvasContext:e.getContext("2d",{alpha:!1}),viewport:v};r&&(t.background=r);const n=c.render(t),s=n;return n.promise.then(()=>{e.style.visibility="",c&&l&&l(Fv(c,f))}).catch(m),()=>Rv(s)},[r,c,h,v,y]);const b=(0,t.useCallback)(()=>{const{current:e}=g;e&&(e.width=0,e.height=0)},[]);return(0,t.useEffect)(()=>b,[b]),(0,_t.jsx)("canvas",{className:"".concat(i,"__canvas"),dir:"ltr",ref:Yv(p,g),style:{display:"block",userSelect:"none"},children:u?(0,_t.jsx)(iy,{}):null})}function oy(){const e=sy();bv(e);const{customTextRenderer:n,onGetTextError:s,onGetTextSuccess:i,onRenderTextLayerError:r,onRenderTextLayerSuccess:a,page:o,pageIndex:l,pageNumber:c,rotate:h,scale:u}=e;bv(o);const[d,f]=zv(),{value:p,error:g}=d,m=(0,t.useRef)(null);xv(1===Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10),"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer"),(0,t.useEffect)(function(){f({type:"RESET"})},[o,f]),(0,t.useEffect)(function(){if(!o)return;const e=gv(o.getTextContent()),t=e;return e.promise.then(e=>{f({type:"RESOLVE",value:e})}).catch(e=>{f({type:"REJECT",error:e})}),()=>Rv(t)},[o,f]),(0,t.useEffect)(()=>{void 0!==p&&(!1!==p?p&&i&&i(p):g&&(xv(!1,g.toString()),s&&s(g)))},[p]);const v=(0,t.useCallback)(()=>{a&&a()},[a]),y=(0,t.useCallback)(e=>{xv(!1,e.toString()),r&&r(e)},[r]);const b=(0,t.useMemo)(()=>o.getViewport({scale:u,rotation:h}),[o,h,u]);return(0,t.useLayoutEffect)(function(){if(!o||!p)return;const{current:e}=m;if(!e)return;e.innerHTML="";const t=o.streamTextContent({includeMarkedContent:!0}),s=new hv({container:e,textContentSource:t,viewport:b}),i=s;return s.render().then(()=>{const t=document.createElement("div");t.className="endOfContent",e.append(t);const s=e.querySelectorAll('[role="presentation"]');if(n){let e=0;p.items.forEach((t,i)=>{if(!function(e){return"str"in e}(t))return;const r=s[e];if(!r)return;const a=n(Object.assign({pageIndex:l,pageNumber:c,itemIndex:i},t));r.innerHTML=a,e+=t.str&&t.hasEOL?2:1})}v()}).catch(y),()=>Rv(i)},[n,y,v,o,l,c,p,b]),(0,_t.jsx)("div",{className:vv("react-pdf__Page__textContent","textLayer"),onMouseUp:function(){const e=m.current;e&&e.classList.remove("selecting")},onMouseDown:function(){const e=m.current;e&&e.classList.add("selecting")},ref:m})}function ly(){return(0,t.useContext)(Cv)}function cy(){const e=ly(),n=sy();bv(n);const s=Object.assign(Object.assign({},e),n),{imageResourcesPath:i,linkService:r,onGetAnnotationsError:a,onGetAnnotationsSuccess:o,onRenderAnnotationLayerError:l,onRenderAnnotationLayerSuccess:c,page:h,pdf:u,renderForms:d,rotate:f,scale:p=1}=s;bv(u),bv(h),bv(r);const[g,m]=zv(),{value:v,error:y}=g,b=(0,t.useRef)(null);xv(1===Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10),"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations"),(0,t.useEffect)(function(){m({type:"RESET"})},[m,h]),(0,t.useEffect)(function(){if(!h)return;const e=gv(h.getAnnotations()),t=e;return e.promise.then(e=>{m({type:"RESOLVE",value:e})}).catch(e=>{m({type:"REJECT",error:e})}),()=>{Rv(t)}},[m,h]),(0,t.useEffect)(()=>{void 0!==v&&(!1!==v?v&&o&&o(v):y&&(xv(!1,y.toString()),a&&a(y)))},[v]);const x=(0,t.useMemo)(()=>h.getViewport({scale:p,rotation:f}),[h,f,p]);return(0,t.useEffect)(function(){if(!u||!h||!r||!v)return;const{current:e}=b;if(!e)return;const t=x.clone({dontFlip:!0}),n={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:e,l10n:null,page:h,structTreeLayer:null,viewport:t},s={annotations:v,annotationStorage:u.annotationStorage,div:e,imageResourcesPath:i,linkService:r,page:h,renderForms:d,viewport:t};e.innerHTML="";try{new av(n).render(s),c&&c()}catch(a){!function(e){xv(!1,"".concat(e)),l&&l(e)}(a)}return()=>{}},[v,i,r,h,u,d,x]),(0,_t.jsx)("div",{className:vv("react-pdf__Page__annotations","annotationLayer"),ref:b})}var hy=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n};const uy=1;function dy(e){const n=ly(),s=Object.assign(Object.assign({},n),e),{_className:i="react-pdf__Page",_enableRegisterUnregisterPage:r=!0,canvasBackground:a,canvasRef:o,children:l,className:c,customRenderer:h,customTextRenderer:u,devicePixelRatio:d,error:f="Failed to load the page.",height:p,inputRef:g,loading:m="Loading page\u2026",noData:v="No page specified.",onGetAnnotationsError:y,onGetAnnotationsSuccess:b,onGetStructTreeError:x,onGetStructTreeSuccess:w,onGetTextError:S,onGetTextSuccess:_,onLoadError:C,onLoadSuccess:k,onRenderAnnotationLayerError:A,onRenderAnnotationLayerSuccess:E,onRenderError:T,onRenderSuccess:M,onRenderTextLayerError:j,onRenderTextLayerSuccess:P,pageIndex:O,pageNumber:D,pdf:N,registerPage:L,renderAnnotationLayer:R=!0,renderForms:F=!1,renderMode:I="canvas",renderTextLayer:z=!0,rotate:W,scale:B=uy,unregisterPage:H,width:U}=s,V=hy(s,["_className","_enableRegisterUnregisterPage","canvasBackground","canvasRef","children","className","customRenderer","customTextRenderer","devicePixelRatio","error","height","inputRef","loading","noData","onGetAnnotationsError","onGetAnnotationsSuccess","onGetStructTreeError","onGetStructTreeSuccess","onGetTextError","onGetTextSuccess","onLoadError","onLoadSuccess","onRenderAnnotationLayerError","onRenderAnnotationLayerSuccess","onRenderError","onRenderSuccess","onRenderTextLayerError","onRenderTextLayerSuccess","pageIndex","pageNumber","pdf","registerPage","renderAnnotationLayer","renderForms","renderMode","renderTextLayer","rotate","scale","unregisterPage","width"]),[G,X]=zv(),{value:Y,error:q}=G,K=(0,t.useRef)(null);bv(N);const Q=jv(D)?D-1:null!==O&&void 0!==O?O:null,$=null!==D&&void 0!==D?D:jv(O)?O+1:null,J=null!==W&&void 0!==W?W:Y?Y.rotate:null,Z=(0,t.useMemo)(()=>{if(!Y)return null;let e=1;const t=null!==B&&void 0!==B?B:uy;if(U||p){const t=Y.getViewport({scale:1,rotation:J});U?e=U/t.width:p&&(e=p/t.height)}return t*e},[p,Y,J,B,U]);(0,t.useEffect)(function(){return()=>{jv(Q)&&r&&H&&H(Q)}},[r,N,Q,H]),(0,t.useEffect)(function(){X({type:"RESET"})},[X,N,Q]),(0,t.useEffect)(function(){if(!N||!$)return;const e=gv(N.getPage($)),t=e;return e.promise.then(e=>{X({type:"RESOLVE",value:e})}).catch(e=>{X({type:"REJECT",error:e})}),()=>Rv(t)},[X,N,$]),(0,t.useEffect)(()=>{void 0!==Y&&(!1!==Y?function(){if(k){if(!Y||!Z)return;k(Fv(Y,Z))}if(r&&L){if(!jv(Q)||!K.current)return;L(Q,K.current)}}():q&&(xv(!1,q.toString()),C&&C(q)))},[Y,Z]);const ee=(0,t.useMemo)(()=>Y&&jv(Q)&&$&&jv(J)&&jv(Z)?{_className:i,canvasBackground:a,customTextRenderer:u,devicePixelRatio:d,onGetAnnotationsError:y,onGetAnnotationsSuccess:b,onGetStructTreeError:x,onGetStructTreeSuccess:w,onGetTextError:S,onGetTextSuccess:_,onRenderAnnotationLayerError:A,onRenderAnnotationLayerSuccess:E,onRenderError:T,onRenderSuccess:M,onRenderTextLayerError:j,onRenderTextLayerSuccess:P,page:Y,pageIndex:Q,pageNumber:$,renderForms:F,renderTextLayer:z,rotate:J,scale:Z}:null,[i,a,u,d,y,b,x,w,S,_,A,E,T,M,j,P,Y,Q,$,F,z,J,Z]),te=(0,t.useMemo)(()=>pv(V,()=>Y?Z?Fv(Y,Z):void 0:Y),[V,Y,Z]),ne="".concat(Q,"@").concat(Z,"/").concat(J);function se(){switch(I){case"custom":return bv(h),(0,_t.jsx)(h,{},"".concat(ne,"_custom"));case"none":return null;default:return(0,_t.jsx)(ay,{canvasRef:o},"".concat(ne,"_canvas"))}}return(0,_t.jsx)("div",Object.assign({className:vv(i,c),"data-page-number":$,ref:Yv(g,K),style:{"--scale-factor":"".concat(Z),backgroundColor:a||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"}},te,{children:$?null===N||void 0===Y||null===Y?(0,_t.jsx)(kv,{type:"loading",children:"function"===typeof m?m():m}):!1===N||!1===Y?(0,_t.jsx)(kv,{type:"error",children:"function"===typeof f?f():f}):(0,_t.jsxs)(qv.Provider,{value:ee,children:[se(),z?(0,_t.jsx)(oy,{},"".concat(ne,"_text")):null,R?(0,_t.jsx)(cy,{},"".concat(ne,"_annotations")):null,l]}):(0,_t.jsx)(kv,{type:"no-data",children:"function"===typeof v?v():v})}))}lv.workerSrc="".concat("/EduSite","/pdf.worker.min.mjs");const fy={viewerContainer:{display:"flex",flexDirection:"column",height:"100%",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"#f8f9fa",overflow:"hidden"},toolbar:{padding:"8px 12px",borderBottom:"1px solid #ddd",backgroundColor:"#efefef",textAlign:"center",fontSize:"14px",color:"#333",flexShrink:0},pdfScrollArea:{flexGrow:1,overflowY:"auto",backgroundColor:"#e9ecef",padding:"10px 0"},pageContainer:{margin:"15px auto",display:"flex",justifyContent:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",width:"100%",maxWidth:"100%"},errorMessage:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"#dc3545",fontSize:"16px"}},py=e=>{let{pdfUrl:n}=e;const[s,i]=(0,t.useState)(null),[r,a]=(0,t.useState)(1),[o,l]=(0,t.useState)(!1),[h,u]=(0,t.useState)(null),d=(0,t.useRef)();if((0,t.useEffect)(()=>{function e(){d.current&&u(d.current.offsetWidth)}return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),o)return(0,_t.jsx)("div",{style:c(c({},fy.viewerContainer),fy.errorMessage),children:"Error loading document."});const f=c(c({},fy.pageContainer),{},{margin:window.innerWidth<=600?"5px 0":"15px auto"});return(0,_t.jsxs)("div",{style:fy.viewerContainer,ref:d,children:[(0,_t.jsx)("div",{style:fy.toolbar,children:s?"Total Pages: ".concat(s):"Loading PDF..."}),(0,_t.jsx)("div",{style:fy.pdfScrollArea,children:(0,_t.jsx)(Xv,{file:n,onLoadSuccess:function(e){let{numPages:t}=e;i(t),l(!1),a(1)},onLoadError:function(e){console.error("Failed to load PDF document:",e),l(!0),i(null)},loading:(0,_t.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:"Loading document..."}),noData:(0,_t.jsx)("div",{style:fy.errorMessage,children:"No PDF file specified."}),children:Array.from(new Array(s||0),(e,t)=>(0,_t.jsx)("div",{style:f,children:(0,_t.jsx)(dy,{pageNumber:t+1,renderAnnotationLayer:!1,renderTextLayer:!1,width:h?Math.min(h-16,800):void 0},"page_".concat(t+1))},"page_container_".concat(t+1)))})})]})};Bt().setAppElement("#root");const gy=()=>{const[e,n]=(0,t.useState)(""),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)([]),[o,l]=(0,t.useState)([]),[h,u]=(0,t.useState)(""),[d,f]=(0,t.useState)(!1),[p,g]=(0,t.useState)(!1),[m,v]=(0,t.useState)(null),[y,b]=(0,t.useState)(""),[x,w]=(0,t.useState)(null),[S,_]=(0,t.useState)({name:"",description:"",files:null,links:[""]}),[C,k]=(0,t.useState)(!1),[A,E]=(0,t.useState)(!1),[T,M]=(0,t.useState)(null),[j,P]=(0,t.useState)(""),O=[12,11,10,9],D=e=>{const t=e.target.value;n(t),i([]),t?(async e=>{f(!0),v(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/group/grades?grade=").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Groups fetched successfully"===s.Message?(a(s.groups),s.groups.length>0&&u(s.groups[0].gradeid)):v("Failed to fetch groups")}catch(t){v("Error loading groups")}finally{f(!1)}})(t):a([])},N=async e=>{w(e),g(!0),v(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/material/group/").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Materials fetched successfully for the group"===s.message?l(s.data||[]):l([])}catch(t){v("Error loading materials")}finally{g(!1)}},L=()=>{k(!1),M(null),P("")};return(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsxs)("div",{className:"materials-page",children:[(0,_t.jsxs)("div",{className:"materials-left",children:[(0,_t.jsx)("h2",{children:"Select Grade"}),(0,_t.jsx)("div",{className:"grades-list",children:O.map(t=>(0,_t.jsx)("div",{className:"grade-card ".concat(e===String(t)?"selected":""),onClick:()=>D({target:{value:t}}),children:(0,_t.jsxs)("h3",{children:["Grade ",t]})},t))}),e&&(0,_t.jsxs)("div",{className:"groups-section",children:[(0,_t.jsxs)("h3",{children:["Groups in Grade ",e]}),d?(0,_t.jsx)("div",{className:"loading",children:"Loading..."}):(0,_t.jsx)("div",{className:"groups-list",children:r.map(e=>(0,_t.jsx)("div",{className:"group-item ".concat(x===e._id?"selected":""),onClick:()=>N(e._id),children:e.groupname},e._id))})]}),x&&(0,_t.jsxs)("div",{className:"materials-section",children:[(0,_t.jsx)("h3",{children:"Materials"}),p?(0,_t.jsx)("div",{className:"loading",children:"Loading..."}):(0,_t.jsx)("ul",{className:"materials-list",children:o.length>0?o.map(e=>(0,_t.jsxs)("li",{className:"material-card",children:[(0,_t.jsxs)("div",{className:"material-info",children:[(0,_t.jsx)("span",{className:"material-name",children:e.name}),(0,_t.jsx)("span",{className:"material-description",children:e.description})]}),(0,_t.jsxs)("div",{className:"material-actions",children:[(0,_t.jsx)("button",{className:"view-button",onClick:()=>(async e=>{k(!0),E(!0);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/material/").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}});if(!n.ok)throw new Error("Failed to fetch material details");const s=await n.json();M(s),s.files&&s.files.length>0?P(s.files[0].url):P("")}catch(m){alert("An error occurred: "+m.message),k(!1)}finally{E(!1)}})(e._id),children:"View"}),(0,_t.jsx)("button",{className:"delete-button",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this material?"))try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("https://backend-edu-site-5cnm.vercel.app/material/".concat(e),{method:"DELETE",headers:{Authorization:"MonaEdu ".concat(t)}});"Material deleted successfully"===(await n.json()).message?x&&N(x):v("Failed to delete material")}catch(t){console.error("Error deleting material:",t),v("Error deleting material")}})(e._id),children:"Delete"})]})]},e._id)):(0,_t.jsx)("p",{children:"No materials found for this group."})})]})]}),(0,_t.jsxs)("div",{className:"upload-material",children:[(0,_t.jsx)("h2",{children:"Upload new Material"}),(0,_t.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),!e||0===s.length)return void v("Please select a grade and at least one group.");v(null),b("Preparing to upload...");const n=localStorage.getItem("token")||sessionStorage.getItem("token");try{let e=[];if(S.files&&S.files.length>0){b("Uploading ".concat(S.files.length," file(s)..."));const t=Array.from(S.files).map(async e=>{const t=await fetch("".concat(Et,"/material/generate-upload-url"),{method:"POST",headers:{Authorization:"MonaEdu ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({fileName:e.name,fileType:e.type,materialName:e.name})});if(!t.ok)throw new Error("Could not get upload URL for ".concat(e.name,"."));const{uploadUrl:s,s3Key:i}=await t.json();if(200!==(await fetch(s,{method:"PUT",headers:{"Content-Type":e.type},body:e})).status)throw new Error("Failed to upload ".concat(e.name,"."));return{key:i,path:new URL(s).origin+new URL(s).pathname,originalName:e.name,fileType:e.type}});e=await Promise.all(t)}b("Finalizing material...");const t={name:S.name,description:S.description,gradeId:h,groupIds:s,linksArray:S.links.filter(e=>""!==e.trim()),files:e},r=await fetch("".concat(Et,"/material/create"),{method:"POST",headers:{Authorization:"MonaEdu ".concat(n),"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)throw new Error(a.message||"Failed to create material.");b("Material created successfully!"),_({name:"",description:"",files:null,links:[""]}),i([]),document.getElementById("material-files-input").value=null,x&&N(x)}catch(r){console.error("Upload process failed:",r),v(r.message),b("")}},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Grade:"}),(0,_t.jsxs)("select",{value:e,onChange:D,required:!0,children:[(0,_t.jsx)("option",{value:"",children:"Choose grade"}),O.map(e=>(0,_t.jsxs)("option",{value:e,children:["Grade ",e]},e))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Groups:"}),(0,_t.jsxs)("div",{className:"groups-select-container",children:[(0,_t.jsx)("div",{className:"select-all-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",checked:s.length===r.length&&r.length>0,onChange:()=>i(s.length===r.length?[]:r.map(e=>e._id))})," Select All Groups"]})}),(0,_t.jsx)("div",{className:"groups-divider"}),(0,_t.jsx)("div",{className:"groups-checkbox-list",children:r.map(e=>(0,_t.jsx)("div",{className:"group-checkbox-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",checked:s.includes(e._id),onChange:()=>i(t=>t.includes(e._id)?t.filter(t=>t!==e._id):[...t,e._id])}),e.groupname]})},e._id))})]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Material Name:"}),(0,_t.jsx)("input",{type:"text",value:S.name,onChange:e=>_(c(c({},S),{},{name:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Description:"}),(0,_t.jsx)("textarea",{value:S.description,onChange:e=>_(c(c({},S),{},{description:e.target.value})),required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Material Files (can select multiple):"}),(0,_t.jsx)("input",{type:"file",id:"material-files-input",multiple:!0,onChange:e=>_(c(c({},S),{},{files:e.target.files}))})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"YouTube Links:"}),S.links.map((e,t)=>(0,_t.jsxs)("div",{className:"link-input-group",children:[(0,_t.jsx)("input",{type:"url",placeholder:"https://www.youtube.com/watch?v=...",value:e,onChange:e=>((e,t)=>{const n=[...S.links];n[e]=t.target.value,_(c(c({},S),{},{links:n}))})(t,e)}),S.links.length>1&&(0,_t.jsx)("button",{type:"button",className:"remove-link-btn",onClick:()=>(e=>_(t=>c(c({},t),{},{links:t.links.filter((t,n)=>n!==e)})))(t),children:"\xd7"})]},t)),(0,_t.jsx)("button",{type:"button",className:"add-link-btn",onClick:()=>_(e=>c(c({},e),{},{links:[...e.links,""]})),children:"+ Add another link"})]}),m&&(0,_t.jsx)("div",{className:"error-message",children:m}),y&&(0,_t.jsx)("div",{className:"submit-status",children:y}),(0,_t.jsx)("button",{type:"submit",disabled:y.includes("..."),children:y.includes("...")?y:"Submit"})]})]})]}),(0,_t.jsx)(Bt(),{isOpen:C,onRequestClose:L,contentLabel:"View Material",className:"material-modal",overlayClassName:"material-modal-overlay",children:A?(0,_t.jsx)("div",{className:"loading",children:"Loading..."}):T&&(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsxs)("div",{className:"material-modal-header",children:[" ",(0,_t.jsx)("h2",{children:T.name})," ",(0,_t.jsx)("button",{onClick:L,className:"close-modal-btn",children:"\xd7"})," "]}),(0,_t.jsxs)("div",{className:"material-modal-body",children:[(0,_t.jsxs)("div",{className:"content-sidebar",children:[(0,_t.jsx)("p",{className:"material-description",children:T.description}),(0,_t.jsxs)("div",{className:"resource-section",children:[(0,_t.jsx)("h3",{children:"Files"}),T.files&&T.files.length>0?(0,_t.jsx)("ul",{className:"resource-list",children:T.files.map((e,t)=>(0,_t.jsxs)("li",{className:"resource-item",children:[" ",(0,_t.jsxs)("button",{className:j===e.url?"active":"",onClick:()=>P(e.url),children:[" ",e.originalName||"File ".concat(t+1)," "]})," "]},t))}):(0,_t.jsx)("p",{className:"no-resources-message",children:"No files provided."})]}),(0,_t.jsxs)("div",{className:"resource-section",children:[(0,_t.jsx)("h3",{children:"Links"}),T.Links&&T.Links.length>0?(0,_t.jsx)("ul",{className:"resource-list",children:T.Links.map((e,t)=>(0,_t.jsxs)("li",{className:"resource-item link-item",children:[" ",(0,_t.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e})," "]},t))}):(0,_t.jsx)("p",{className:"no-resources-message",children:"No links provided."})]})]}),(0,_t.jsxs)("div",{className:"pdf-viewer-main",children:[" ",j?(0,_t.jsx)(py,{pdfUrl:j}):(0,_t.jsx)("div",{className:"loading",children:"No PDF to display."})," "]})]})]})})]})},my=[9,10,11,12],vy=()=>{const[e,n]=(0,t.useState)({}),[s,i]=(0,t.useState)({}),[r,a]=(0,t.useState)(!0),[o,l]=(0,t.useState)(!0),[h,u]=(0,t.useState)(null),[d,f]=(0,t.useState)(null),[p,g]=(0,t.useState)(null),[m,v]=(0,t.useState)(null),[y,b]=(0,t.useState)(!1),[x,w]=(0,t.useState)(!1),[S,_]=(0,t.useState)(null),[C,k]=(0,t.useState)({groupName:""});(0,t.useEffect)(()=>{A(),E()},[]);const A=async()=>{a(!0),u(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=my.map(t=>fetch("".concat(Et,"/group/grades?grade=").concat(t),{headers:{Authorization:"MonaEdu ".concat(e)}}).then(e=>e.json())),s=await Promise.all(t),i={};s.forEach((e,t)=>{const n=my[t];"Groups fetched successfully"===e.Message?i[n]=e.groups:(console.error("Failed to fetch groups for grade ".concat(n,":"),e.Message),i[n]=[])}),n(i)}catch(e){console.error("Error fetching all groups:",e),u("Error loading groups. Please try again.")}finally{a(!1)}},E=async()=>{l(!0),u(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=my.map(t=>fetch("".concat(Et,"/student/grade/").concat(t,"/unassigned"),{headers:{Authorization:"MonaEdu ".concat(e)}}).then(e=>e.json())),n=await Promise.all(t),s={};n.forEach((e,t)=>{const n=my[t];"Unassigned students fetched successfully"===e.Message||"No Student Attached to it"===e.Message?s[n]=e.students||[]:(console.error("Failed to fetch unassigned students for grade ".concat(n,":"),e.Message),s[n]=[])}),i(s)}catch(e){console.error("Error fetching all unassigned students:",e),u(e.message||"Error loading unassigned students. Please try again.")}finally{l(!1)}},T=e=>s[e]||[],M=()=>{b(!1),_(null)};return r||o?(0,_t.jsx)("div",{className:"loading",children:"Loading groups and unassigned students..."}):h?(0,_t.jsx)("div",{className:"error",children:h}):(0,_t.jsxs)("div",{className:"groups-page",children:[(0,_t.jsx)("h2",{children:"Groups & Unassigned Students"}),my.map(t=>(0,_t.jsxs)("div",{className:"grade-section",children:[(0,_t.jsxs)("div",{className:"grade-header",children:[(0,_t.jsxs)("h3",{children:["Grade ",t]}),(0,_t.jsx)("button",{className:"add-group-btn",onClick:()=>(e=>{_(e),k({groupName:""}),u(null),b(!0)})(t),children:"+ Add Group"})]}),(0,_t.jsxs)("div",{className:"grade-content-container",children:[(0,_t.jsxs)("div",{className:"groups-list-container",children:[(0,_t.jsx)("h4",{className:"container-title",children:"Groups"}),e[t]&&e[t].length>0?(0,_t.jsx)("div",{className:"groups-container",children:e[t].map((e,n)=>(0,_t.jsxs)("div",{className:"group-card",children:[(0,_t.jsx)("h4",{children:e.groupname}),(0,_t.jsxs)("p",{children:["Students: ",e.enrolledStudents?e.enrolledStudents.length:0]}),(0,_t.jsxs)("div",{className:"group-card-actions",children:[(()=>{const e="/dashboard/groups/".concat(t,"/group").concat(n+1);return(0,_t.jsx)(mt,{to:e,className:"view-students-btn",children:"View Students"})})(),(0,_t.jsx)("button",{className:"delete-group-btn",onClick:()=>(async(e,t)=>{if(window.confirm('Are you sure you want to delete group "'.concat(t,'"?'))){f(e);try{const n=localStorage.getItem("token")||sessionStorage.getItem("token"),s=await fetch("".concat(Et,"/group/deletegroup"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"MonaEdu ".concat(n)},body:JSON.stringify({groupid:e})}),i=await s.json();if(!s.ok)throw new Error(i.Message||"Failed to delete group");A(),alert(i.Message||'Group "'.concat(t,'" deleted successfully.'))}catch(n){console.error("Error deleting group:",n),u(n.message||"Error deleting group. Please try again.")}finally{f(null)}}})(e._id,e.groupname),disabled:d===e._id,children:d===e._id?"Deleting...":"Delete"})]})]},e._id))}):(0,_t.jsxs)("p",{children:["No groups found for Grade ",t,"."]})]}),(0,_t.jsxs)("div",{className:"unassigned-students-container",children:[(0,_t.jsx)("h4",{children:"Unassigned Students"}),T(t).length>0?(0,_t.jsx)("div",{className:"students-list",children:T(t).map(n=>(0,_t.jsxs)("div",{className:"student-card",children:[(0,_t.jsx)("p",{children:(0,_t.jsxs)("strong",{children:[n.firstName," ",n.lastName]})}),(0,_t.jsxs)("div",{className:"student-actions",children:[(0,_t.jsx)("button",{className:"view-btn",onClick:()=>(e=>{v(e)})(n),children:"View"}),(0,_t.jsx)("div",{className:"add-to-group-dropdown",children:(0,_t.jsxs)("select",{onChange:e=>(async(e,t,n,s)=>{if(window.confirm("Add ".concat(s,' to group "').concat(n,'"?'))){g(e);try{const i=localStorage.getItem("token")||sessionStorage.getItem("token"),r=await fetch("".concat(Et,"/group/addstudent"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"MonaEdu ".concat(i)},body:JSON.stringify({groupid:t,studentid:e})}),a=await r.json();if(!r.ok)throw new Error(a.Message||"Failed to add student to group");A(),E(),alert(a.Message||"Student ".concat(s,' added to group "').concat(n,'" successfully.'))}catch(i){console.error("Error adding student to group:",i),u(i.message||"Error adding student. Please try again.")}finally{g(null)}}})(n._id,e.target.value,e.target.options[e.target.selectedIndex].text,n.userName),disabled:p===n._id||!e[t]||0===e[t].length,value:"",children:[(0,_t.jsx)("option",{value:"",children:"Add to Group"}),e[t]&&e[t].map(e=>(0,_t.jsx)("option",{value:e._id,children:e.groupname},e._id))]})})]})]},n._id))}):(0,_t.jsxs)("p",{children:["No unassigned students found for Grade ",t,"."]})]})]})]},t)),m&&(0,_t.jsx)("div",{className:"modal-overlay",children:(0,_t.jsxs)("div",{className:"modal-content",children:[(0,_t.jsx)("h3",{children:"Student Details"}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Username:"})," ",m.userName]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"First Name:"})," ",m.firstName]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Last Name:"})," ",m.lastName]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Email:"})," ",m.email]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Phone:"})," ",m.phone||"N/A"]}),(0,_t.jsx)("button",{className:"close-modal-btn",onClick:()=>{v(null)},children:"Close"})]})}),(0,_t.jsxs)(Bt(),{isOpen:y,onRequestClose:M,contentLabel:"Add New Group",className:"form-modal",overlayClassName:"form-modal-overlay",children:[(0,_t.jsxs)("h2",{children:["Create New Group for Grade ",S]}),(0,_t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),C.groupName.trim()){w(!0),u(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=await fetch("".concat(Et,"/group/create"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"MonaEdu ".concat(e)},body:JSON.stringify({grade:parseInt(S),groupname:C.groupName.trim()})}),n=await t.json();if(!t.ok){if(500===t.status&&"Invalid Data"===n.message)return void alert("This group name already exists. Please choose another one.");throw new Error(n.Message||"Failed to create group")}A(),alert(n.Message||"Group created successfully"),M()}catch(t){console.error("Error creating group:",t),u(t.message||"Error creating group. Please try again.")}finally{w(!1)}}else u("Please enter a group name.")},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"groupName",children:"Group Name:"}),(0,_t.jsx)("input",{type:"text",id:"groupName",value:C.groupName,onChange:e=>k(c(c({},C),{},{groupName:e.target.value})),placeholder:"Enter new group name",required:!0})]}),h&&(0,_t.jsx)("div",{className:"error-message",children:h}),(0,_t.jsxs)("div",{className:"form-actions",children:[(0,_t.jsx)("button",{type:"button",className:"cancel-btn",onClick:M,disabled:x,children:"Cancel"}),(0,_t.jsx)("button",{type:"submit",disabled:x,children:x?"Creating...":"Create Group"})]})]})]})]})},yy=()=>{const{grade:e,group:n}=pe(),s=parseInt(n.replace("group",""),10),[i,r]=(0,t.useState)([]),[a,o]=(0,t.useState)(!0),[l,c]=(0,t.useState)(null),[h,u]=(0,t.useState)(null),[d,f]=(0,t.useState)(null);(0,t.useEffect)(()=>{console.log("GroupDetails component mounted/updated."),console.log("URL params - Grade:",e,"GroupNumberString:",n),p()},[e,n]);const p=async()=>{o(!0),c(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token");if(console.log("Fetching token:",t),!t)return c("Authentication token not found. Please log in."),void o(!1);console.log("Fetching groups for grade ".concat(e,"..."));const n=await fetch("".concat(Et,"/group/grades?grade=").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}});if(console.log("Group API response status:",n.status),!n.ok){const e=await n.json();throw console.error("Group API error response:",e),new Error(e.Message||"Failed to fetch groups")}const i=await n.json();if(console.log("Group API response data:",i),"Groups fetched successfully"!==i.Message)throw new Error(i.Message||"Failed to fetch groups: Unexpected message");{const e=i.groups[s-1];if(console.log("Target group based on index:",e),e){f(e._id),console.log("group id set : ",e._id);const t=e.enrolledStudents.map(e=>({_id:e._id,userName:e.userName,firstName:e.firstName,lastName:e.lastName,phone:e.phone,parentPhone:e.parentPhone,email:e.email,parentemail:e.email}));r(t)}else c("Group not found at this index. Please check the URL."),r([]),f(null)}}catch(t){console.error("Error fetching group students:",t),c(t.message||"Error loading group students. Please try again.")}finally{o(!1)}};return a?(0,_t.jsx)("div",{className:"loading",children:"Loading students..."}):l?(0,_t.jsx)("div",{className:"error",children:l}):(0,_t.jsxs)("div",{className:"group-details-page",children:[(0,_t.jsxs)("h2",{children:["Students in Grade ",e," - Group ",s]}),i.length>0?(0,_t.jsx)("div",{className:"students-list-container",children:i.map(e=>(0,_t.jsxs)("div",{className:"student-card",children:[(0,_t.jsx)("p",{children:(0,_t.jsxs)("strong",{children:[e.firstName," ",e.lastName]})}),(0,_t.jsxs)("div",{className:"student-actions",children:[(0,_t.jsx)("button",{className:"view-btn",onClick:()=>(e=>{u(e)})(e),children:"View"}),(0,_t.jsx)("button",{className:"delete-btn",onClick:()=>(async(e,t)=>{if(window.confirm("Are you sure you want to remove ".concat(t," from this group?")))try{const n=localStorage.getItem("token")||sessionStorage.getItem("token");if(!n)return void c("Authentication token not found. Please log in.");if(!d)return void c("Error: Group ID not available for removal.");console.log("Attempting to remove student:",{studentid:e,groupid:d});const s=await fetch("".concat(Et,"/group/removestudent"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"MonaEdu ".concat(n)},body:JSON.stringify({studentid:e,groupid:d})}),i=await s.json();if(console.log("Remove student API response:",i),!s.ok)throw console.error("Remove student API error response:",i),new Error(i.Message||"Failed to remove student from group");p(),alert(i.Message||"Student ".concat(t," removed from group successfully."))}catch(n){console.error("Error removing student from group:",n),c(n.message||"Error removing student. Please try again.")}})(e._id,e.userName),children:"Remove"})]})]},e._id))}):(0,_t.jsx)("p",{children:"No students found in this group."}),h&&(0,_t.jsx)("div",{className:"modal-overlay",children:(0,_t.jsxs)("div",{className:"modal-content",children:[(0,_t.jsx)("h3",{children:"Student Details"}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Username:"})," ",h.userName]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"First Name:"})," ",h.firstName]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Last Name:"})," ",h.lastName]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Email:"})," ",h.email]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Phone:"})," ",h.phone||"N/A"]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Parent Phone:"})," ",h.parentPhone||"N/A"]}),(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Parent Email:"})," ",h.parentemail||"N/A"]}),(0,_t.jsx)("button",{className:"close-modal-btn",onClick:()=>{u(null)},children:"Close"})]})})]})};function by(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function wy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xy(Object(n),!0).forEach(function(t){by(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xy(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Sy(e,t){if(null==e)return{};var n,s,i=function(e,t){if(null==e)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function _y(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}class Cy{constructor(){by(this,"browserShadowBlurConstant",1),by(this,"DPI",96),by(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),by(this,"perfLimitSizeTotal",2097152),by(this,"maxCacheSideLimit",4096),by(this,"minCacheSideLimit",256),by(this,"disableStyleCopyPaste",!1),by(this,"enableGLFiltering",!0),by(this,"textureSize",4096),by(this,"forceGLPutImageData",!1),by(this,"cachesBoundsOfCurve",!1),by(this,"fontPaths",{}),by(this,"NUM_FRACTION_DIGITS",4)}}const ky=new class extends Cy{constructor(e){super(),this.configure(e)}configure(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,e)}addFonts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=wy(wy({},this.fontPaths),e)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(e=>{delete this.fontPaths[e]})}clearFonts(){this.fontPaths={}}restoreDefaults(e){const t=new Cy,n=(null==e?void 0:e.reduce((e,n)=>(e[n]=t[n],e),{}))||t;this.configure(n)}},Ay=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return console[e]("fabric",...n)};class Ey extends Error{constructor(e,t){super("fabric: ".concat(e),t)}}class Ty extends Ey{constructor(e){super("".concat(e," 'options.signal' is in 'aborted' state"))}}class My{}class jy extends My{testPrecision(e,t){const n="precision ".concat(t," float;\nvoid main(){}"),s=e.createShader(e.FRAGMENT_SHADER);return!!s&&(e.shaderSource(s,n),e.compileShader(s),!!e.getShaderParameter(s,e.COMPILE_STATUS))}queryWebGL(e){const t=e.getContext("webgl");t&&(this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(e=>this.testPrecision(t,e)),t.getExtension("WEBGL_lose_context").loseContext(),Ay("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(e){return!!this.maxTextureSize&&this.maxTextureSize>=e}}const Py={};let Oy;const Dy=()=>Oy||(Oy={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new jy,dispose(){},copyPasteData:Py}),Ny=()=>Dy().document,Ly=()=>Dy().window,Ry=()=>{var e;return Math.max(null!==(e=ky.devicePixelRatio)&&void 0!==e?e:Ly().devicePixelRatio,1)},Fy=new class{constructor(){by(this,"charWidthsCache",{}),by(this,"boundsOfCurveCache",{})}getFontCache(e){let{fontFamily:t,fontStyle:n,fontWeight:s}=e;t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});const i=this.charWidthsCache[t],r="".concat(n.toLowerCase(),"_").concat((s+"").toLowerCase());return i[r]||(i[r]={}),i[r]}clearFontCache(e){(e=(e||"").toLowerCase())?this.charWidthsCache[e]&&delete this.charWidthsCache[e]:this.charWidthsCache={}}limitDimsByArea(e){const{perfLimitSizeTotal:t}=ky,n=Math.sqrt(t*e);return[Math.floor(n),Math.floor(t/n)]}},Iy="6.7.1";function zy(){}const Wy=Math.PI/2,By=2*Math.PI,Hy=Math.PI/180,Uy=Object.freeze([1,0,0,1,0,0]),Vy=16,Gy=.4477152502,Xy="center",Yy="left",qy="top",Ky="bottom",Qy="right",$y="none",Jy=/\r?\n/,Zy="moving",eb="scaling",tb="rotating",nb="rotate",sb="skewing",ib="resizing",rb="modifyPoly",ab="modifyPath",ob="changed",lb="scale",cb="scaleX",hb="scaleY",ub="skewX",db="skewY",fb="fill",pb="stroke",gb="modified",mb="json",vb="svg",yb=new class{constructor(){this[mb]=new Map,this[vb]=new Map}has(e){return this[mb].has(e)}getClass(e){const t=this[mb].get(e);if(!t)throw new Ey("No class registered for ".concat(e));return t}setClass(e,t){t?this[mb].set(t,e):(this[mb].set(e.type,e),this[mb].set(e.type.toLowerCase(),e))}getSVGClass(e){return this[vb].get(e)}setSVGClass(e,t){this[vb].set(null!=t?t:e.type.toLowerCase(),e)}},bb=new class extends Array{remove(e){const t=this.indexOf(e);t>-1&&this.splice(t,1)}cancelAll(){const e=this.splice(0);return e.forEach(e=>e.abort()),e}cancelByCanvas(e){if(!e)return[];const t=this.filter(t=>{var n;return t.target===e||"object"==typeof t.target&&(null===(n=t.target)||void 0===n?void 0:n.canvas)===e});return t.forEach(e=>e.abort()),t}cancelByTarget(e){if(!e)return[];const t=this.filter(t=>t.target===e);return t.forEach(e=>e.abort()),t}};class xb{constructor(){by(this,"__eventListeners",{})}on(e,t){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof e)return Object.entries(e).forEach(e=>{let[t,n]=e;this.on(t,n)}),()=>this.off(e);if(t){const n=e;return this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t),()=>this.off(n,t)}return()=>!1}once(e,t){if("object"==typeof e){const t=[];return Object.entries(e).forEach(e=>{let[n,s]=e;t.push(this.once(n,s))}),()=>t.forEach(e=>e())}if(t){const n=this.on(e,function(){for(var e=arguments.length,s=new Array(e),i=0;i<e;i++)s[i]=arguments[i];t.call(this,...s),n()});return n}return()=>!1}_removeEventListener(e,t){if(this.__eventListeners[e])if(t){const n=this.__eventListeners[e],s=n.indexOf(t);s>-1&&n.splice(s,1)}else this.__eventListeners[e]=[]}off(e,t){if(this.__eventListeners)if(void 0===e)for(const n in this.__eventListeners)this._removeEventListener(n);else"object"==typeof e?Object.entries(e).forEach(e=>{let[t,n]=e;this._removeEventListener(t,n)}):this._removeEventListener(e,t)}fire(e,t){var n;if(!this.__eventListeners)return;const s=null===(n=this.__eventListeners[e])||void 0===n?void 0:n.concat();if(s)for(let i=0;i<s.length;i++)s[i].call(this,t||{})}}const wb=(e,t)=>{const n=e.indexOf(t);return-1!==n&&e.splice(n,1),e},Sb=e=>{if(0===e)return 1;switch(Math.abs(e)/Wy){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},_b=e=>{if(0===e)return 0;const t=e/Wy,n=Math.sign(e);switch(t){case 1:return n;case 2:return 0;case 3:return-n}return Math.sin(e)};class Cb{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}add(e){return new Cb(this.x+e.x,this.y+e.y)}addEquals(e){return this.x+=e.x,this.y+=e.y,this}scalarAdd(e){return new Cb(this.x+e,this.y+e)}scalarAddEquals(e){return this.x+=e,this.y+=e,this}subtract(e){return new Cb(this.x-e.x,this.y-e.y)}subtractEquals(e){return this.x-=e.x,this.y-=e.y,this}scalarSubtract(e){return new Cb(this.x-e,this.y-e)}scalarSubtractEquals(e){return this.x-=e,this.y-=e,this}multiply(e){return new Cb(this.x*e.x,this.y*e.y)}scalarMultiply(e){return new Cb(this.x*e,this.y*e)}scalarMultiplyEquals(e){return this.x*=e,this.y*=e,this}divide(e){return new Cb(this.x/e.x,this.y/e.y)}scalarDivide(e){return new Cb(this.x/e,this.y/e)}scalarDivideEquals(e){return this.x/=e,this.y/=e,this}eq(e){return this.x===e.x&&this.y===e.y}lt(e){return this.x<e.x&&this.y<e.y}lte(e){return this.x<=e.x&&this.y<=e.y}gt(e){return this.x>e.x&&this.y>e.y}gte(e){return this.x>=e.x&&this.y>=e.y}lerp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t=Math.max(Math.min(1,t),0),new Cb(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)}distanceFrom(e){const t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}midPointFrom(e){return this.lerp(e)}min(e){return new Cb(Math.min(this.x,e.x),Math.min(this.y,e.y))}max(e){return new Cb(Math.max(this.x,e.x),Math.max(this.y,e.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(e,t){return this.x=e,this.y=t,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setFromPoint(e){return this.x=e.x,this.y=e.y,this}swap(e){const t=this.x,n=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=n}clone(){return new Cb(this.x,this.y)}rotate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kb;const n=_b(e),s=Sb(e),i=this.subtract(t);return new Cb(i.x*s-i.y*n,i.x*n+i.y*s).add(t)}transform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Cb(e[0]*this.x+e[2]*this.y+(t?0:e[4]),e[1]*this.x+e[3]*this.y+(t?0:e[5]))}}const kb=new Cb(0,0),Ab=e=>!!e&&Array.isArray(e._objects);function Eb(e){class t extends e{constructor(){super(...arguments),by(this,"_objects",[])}_onObjectAdded(e){}_onObjectRemoved(e){}_onStackOrderChanged(e){}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=this._objects.push(...t);return t.forEach(e=>this._onObjectAdded(e)),s}insertAt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return this._objects.splice(e,0,...n),n.forEach(e=>this._onObjectAdded(e)),this._objects.length}remove(){const e=this._objects,t=[];for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return s.forEach(n=>{const s=e.indexOf(n);-1!==s&&(e.splice(s,1),t.push(n),this._onObjectRemoved(n))}),t}forEachObject(e){this.getObjects().forEach((t,n,s)=>e(t,n,s))}getObjects(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?[...this._objects]:this._objects.filter(e=>e.isType(...t))}item(e){return this._objects[e]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(e,n){return!!this._objects.includes(e)||!!n&&this._objects.some(n=>n instanceof t&&n.contains(e,!0))}complexity(){return this._objects.reduce((e,t)=>e+(t.complexity?t.complexity():0),0)}sendObjectToBack(e){return!(!e||e===this._objects[0])&&(wb(this._objects,e),this._objects.unshift(e),this._onStackOrderChanged(e),!0)}bringObjectToFront(e){return!(!e||e===this._objects[this._objects.length-1])&&(wb(this._objects,e),this._objects.push(e),this._onStackOrderChanged(e),!0)}sendObjectBackwards(e,t){if(!e)return!1;const n=this._objects.indexOf(e);if(0!==n){const s=this.findNewLowerIndex(e,n,t);return wb(this._objects,e),this._objects.splice(s,0,e),this._onStackOrderChanged(e),!0}return!1}bringObjectForward(e,t){if(!e)return!1;const n=this._objects.indexOf(e);if(n!==this._objects.length-1){const s=this.findNewUpperIndex(e,n,t);return wb(this._objects,e),this._objects.splice(s,0,e),this._onStackOrderChanged(e),!0}return!1}moveObjectTo(e,t){return e!==this._objects[t]&&(wb(this._objects,e),this._objects.splice(t,0,e),this._onStackOrderChanged(e),!0)}findNewLowerIndex(e,t,n){let s;if(n){s=t;for(let n=t-1;n>=0;--n)if(e.isOverlapping(this._objects[n])){s=n;break}}else s=t-1;return s}findNewUpperIndex(e,t,n){let s;if(n){s=t;for(let n=t+1;n<this._objects.length;++n)if(e.isOverlapping(this._objects[n])){s=n;break}}else s=t+1;return s}collectObjects(e){let{left:t,top:n,width:s,height:i}=e,{includeIntersecting:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=[],o=new Cb(t,n),l=o.add(new Cb(s,i));for(let c=this._objects.length-1;c>=0;c--){const e=this._objects[c];e.selectable&&e.visible&&(r&&e.intersectsWithRect(o,l)||e.isContainedWithinRect(o,l)||r&&e.containsPoint(o)||r&&e.containsPoint(l))&&a.push(e)}return a}}return t}class Tb extends xb{_setOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const t in e)this.set(t,e[t])}_setObject(e){for(const t in e)this._set(t,e[t])}set(e,t){return"object"==typeof e?this._setObject(e):this._set(e,t),this}_set(e,t){this[e]=t}toggle(e){const t=this.get(e);return"boolean"==typeof t&&this.set(e,!t),this}get(e){return this[e]}}function Mb(e){return Ly().requestAnimationFrame(e)}function jb(e){return Ly().cancelAnimationFrame(e)}let Pb=0;const Ob=()=>Pb++,Db=()=>{const e=Ny().createElement("canvas");if(!e||void 0===e.getContext)throw new Ey("Failed to create `canvas` element");return e},Nb=()=>Ny().createElement("img"),Lb=e=>{const t=Db();return t.width=e.width,t.height=e.height,t},Rb=(e,t,n)=>e.toDataURL("image/".concat(t),n),Fb=(e,t,n)=>new Promise((s,i)=>{e.toBlob(s,"image/".concat(t),n)}),Ib=e=>e*Hy,zb=e=>e/Hy,Wb=e=>e.every((e,t)=>e===Uy[t]),Bb=(e,t,n)=>new Cb(e).transform(t,n),Hb=e=>{const t=1/(e[0]*e[3]-e[1]*e[2]),n=[t*e[3],-t*e[1],-t*e[2],t*e[0],0,0],{x:s,y:i}=new Cb(e[4],e[5]).transform(n,!0);return n[4]=-s,n[5]=-i,n},Ub=(e,t,n)=>[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],n?0:e[0]*t[4]+e[2]*t[5]+e[4],n?0:e[1]*t[4]+e[3]*t[5]+e[5]],Vb=(e,t)=>e.reduceRight((e,n)=>n&&e?Ub(n,e,t):n||e,void 0)||Uy.concat(),Gb=e=>{let[t,n]=e;return Math.atan2(n,t)},Xb=e=>{const t=Gb(e),n=Math.pow(e[0],2)+Math.pow(e[1],2),s=Math.sqrt(n),i=(e[0]*e[3]-e[2]*e[1])/s,r=Math.atan2(e[0]*e[2]+e[1]*e[3],n);return{angle:zb(t),scaleX:s,scaleY:i,skewX:zb(r),skewY:0,translateX:e[4]||0,translateY:e[5]||0}},Yb=function(e){return[1,0,0,1,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function qb(){let{angle:e=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:t=0,y:n=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=Ib(e),i=Sb(s),r=_b(s);return[i,r,-r,i,t?t-(i*t-r*n):0,n?n-(r*t+i*n):0]}const Kb=function(e){return[e,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,0,0]},Qb=e=>Math.tan(Ib(e)),$b=e=>[1,0,Qb(e),1,0,0],Jb=e=>[1,Qb(e),0,1,0,0],Zb=e=>{let{scaleX:t=1,scaleY:n=1,flipX:s=!1,flipY:i=!1,skewX:r=0,skewY:a=0}=e,o=Kb(s?-t:t,i?-n:n);return r&&(o=Ub(o,$b(r),!0)),a&&(o=Ub(o,Jb(a),!0)),o},ex=e=>{const{translateX:t=0,translateY:n=0,angle:s=0}=e;let i=Yb(t,n);s&&(i=Ub(i,qb({angle:s})));const r=Zb(e);return Wb(r)||(i=Ub(i,r)),i},tx=function(e){let{signal:t,crossOrigin:n=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(s,i){if(t&&t.aborted)return i(new Ty("loadImage"));const r=Nb();let a;t&&(a=function(e){r.src="",i(e)},t.addEventListener("abort",a,{once:!0}));const o=function(){r.onload=r.onerror=null,a&&(null==t||t.removeEventListener("abort",a)),s(r)};e?(r.onload=o,r.onerror=function(){a&&(null==t||t.removeEventListener("abort",a)),i(new Ey("Error loading ".concat(r.src)))},n&&(r.crossOrigin=n),r.src=e):o()})},nx=function(e){let{signal:t,reviver:n=zy}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((s,i)=>{const r=[];t&&t.addEventListener("abort",i,{once:!0}),Promise.all(e.map(e=>yb.getClass(e.type).fromObject(e,{signal:t}).then(t=>(n(e,t),r.push(t),t)))).then(s).catch(e=>{r.forEach(e=>{e.dispose&&e.dispose()}),i(e)}).finally(()=>{t&&t.removeEventListener("abort",i)})})},sx=function(e){let{signal:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((n,s)=>{const i=[];t&&t.addEventListener("abort",s,{once:!0});const r=Object.values(e).map(e=>e&&e.type&&yb.has(e.type)?nx([e],{signal:t}).then(e=>{let[t]=e;return i.push(t),t}):e),a=Object.keys(e);Promise.all(r).then(e=>e.reduce((e,t,n)=>(e[a[n]]=t,e),{})).then(n).catch(e=>{i.forEach(e=>{e.dispose&&e.dispose()}),s(e)}).finally(()=>{t&&t.removeEventListener("abort",s)})})},ix=function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((t,n)=>(n in e&&(t[n]=e[n]),t),{})},rx=(e,t)=>Object.keys(e).reduce((n,s)=>(t(e[s],s,e)&&(n[s]=e[s]),n),{}),ax=(e,t)=>parseFloat(Number(e).toFixed(t)),ox=e=>"matrix("+e.map(e=>ax(e,ky.NUM_FRACTION_DIGITS)).join(" ")+")",lx=e=>!!e&&void 0!==e.toLive,cx=e=>!!e&&"function"==typeof e.toObject,hx=e=>!!e&&void 0!==e.offsetX&&"source"in e,ux=e=>!!e&&"multiSelectionStacking"in e;function dx(e){const t=e&&fx(e);let n=0,s=0;if(!e||!t)return{left:n,top:s};let i=e;const r=t.documentElement,a=t.body||{scrollLeft:0,scrollTop:0};for(;i&&(i.parentNode||i.host)&&(i=i.parentNode||i.host,i===t?(n=a.scrollLeft||r.scrollLeft||0,s=a.scrollTop||r.scrollTop||0):(n+=i.scrollLeft||0,s+=i.scrollTop||0),1!==i.nodeType||"fixed"!==i.style.position););return{left:n,top:s}}const fx=e=>e.ownerDocument||null,px=e=>{var t;return(null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)||null},gx=function(e,t,n){let{width:s,height:i}=n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.width=s,e.height=i,r>1&&(e.setAttribute("width",(s*r).toString()),e.setAttribute("height",(i*r).toString()),t.scale(r,r))},mx=(e,t)=>{let{width:n,height:s}=t;n&&(e.style.width="number"==typeof n?"".concat(n,"px"):n),s&&(e.style.height="number"==typeof s?"".concat(s,"px"):s)};function vx(e){return void 0!==e.onselectstart&&(e.onselectstart=()=>!1),e.style.userSelect=$y,e}class yx{constructor(e){by(this,"_originalCanvasStyle",void 0),by(this,"lower",void 0);const t=this.createLowerCanvas(e);this.lower={el:t,ctx:t.getContext("2d")}}createLowerCanvas(e){const t=(n=e)&&void 0!==n.getContext?e:e&&Ny().getElementById(e)||Db();var n;if(t.hasAttribute("data-fabric"))throw new Ey("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=t.style.cssText,t.setAttribute("data-fabric","main"),t.classList.add("lower-canvas"),t}cleanupDOM(e){let{width:t,height:n}=e;const{el:s}=this.lower;s.classList.remove("lower-canvas"),s.removeAttribute("data-fabric"),s.setAttribute("width","".concat(t)),s.setAttribute("height","".concat(n)),s.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(e,t){const{el:n,ctx:s}=this.lower;gx(n,s,e,t)}setCSSDimensions(e){mx(this.lower.el,e)}calcOffset(){return function(e){var t;const n=e&&fx(e),s={left:0,top:0};if(!n)return s;const i=(null===(t=px(e))||void 0===t?void 0:t.getComputedStyle(e,null))||{};s.left+=parseInt(i.borderLeftWidth,10)||0,s.top+=parseInt(i.borderTopWidth,10)||0,s.left+=parseInt(i.paddingLeft,10)||0,s.top+=parseInt(i.paddingTop,10)||0;let r={left:0,top:0};const a=n.documentElement;void 0!==e.getBoundingClientRect&&(r=e.getBoundingClientRect());const o=dx(e);return{left:r.left+o.left-(a.clientLeft||0)+s.left,top:r.top+o.top-(a.clientTop||0)+s.top}}(this.lower.el)}dispose(){Dy().dispose(this.lower.el),delete this.lower}}const bx={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...Uy]};class xx extends(Eb(Tb)){get lowerCanvasEl(){var e;return null===(e=this.elements.lower)||void 0===e?void 0:e.el}get contextContainer(){var e;return null===(e=this.elements.lower)||void 0===e?void 0:e.ctx}static getDefaults(){return xx.ownDefaults}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(t),this.initElements(e),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(e){this.elements=new yx(e)}add(){const e=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}insertAt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const i=super.insertAt(e,...n);return n.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),i}remove(){const e=super.remove(...arguments);return e.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}_onObjectAdded(e){e.canvas&&e.canvas!==this&&(Ay("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),e.canvas.remove(e)),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e){e._set("canvas",void 0),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?Ry():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(e,t){return this.setDimensions({width:e},t)}setHeight(e,t){return this.setDimensions({height:e},t)}_setDimensionsImpl(e){let{cssOnly:t=!1,backstoreOnly:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t){const t=wy({width:this.width,height:this.height},e);this.elements.setDimensions(t,this.getRetinaScaling()),this.hasLostContext=!0,this.width=t.width,this.height=t.height}n||this.elements.setCSSDimensions(e),this.calcOffset()}setDimensions(e,t){this._setDimensionsImpl(e,t),t&&t.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(e){this.viewportTransform=e,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(e,t){const n=e,s=[...this.viewportTransform],i=Bb(e,Hb(s));s[0]=t,s[3]=t;const r=Bb(i,s);s[4]+=n.x-r.x,s[5]+=n.y-r.y,this.setViewportTransform(s)}setZoom(e){this.zoomToPoint(new Cb(0,0),e)}absolutePan(e){const t=[...this.viewportTransform];return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)}relativePan(e){return this.absolutePan(new Cb(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(e){e.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=Mb(()=>this.renderAndReset()))}calcViewportBoundaries(){const e=this.width,t=this.height,n=Hb(this.viewportTransform),s=Bb({x:0,y:0},n),i=Bb({x:e,y:t},n),r=s.min(i),a=s.max(i);return this.vptCoords={tl:r,tr:new Cb(a.x,r.y),bl:new Cb(r.x,a.y),br:a}}cancelRequestedRender(){this.nextRenderHandle&&(jb(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(e){}renderCanvas(e,t){if(this.destroyed)return;const n=this.viewportTransform,s=this.clipPath;this.calcViewportBoundaries(),this.clearContext(e),e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.patternQuality="best",this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(e,t),e.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(e),s&&(s._set("canvas",this),s.shouldCache(),s._transformDone=!0,s.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e,s)),this._renderOverlay(e),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(e),this.fire("after:render",{ctx:e}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(e,t){const n=this.viewportTransform;e.save(),e.transform(...n),e.globalCompositeOperation="destination-in",t.transform(e),e.scale(1/t.zoomX,1/t.zoomY),e.drawImage(t._cacheCanvas,-t.cacheTranslationX,-t.cacheTranslationY),e.restore()}_renderObjects(e,t){for(let n=0,s=t.length;n<s;++n)t[n]&&t[n].render(e)}_renderBackgroundOrOverlay(e,t){const n=this["".concat(t,"Color")],s=this["".concat(t,"Image")],i=this.viewportTransform,r=this["".concat(t,"Vpt")];if(!n&&!s)return;const a=lx(n);if(n){if(e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=a?n.toLive(e):n,r&&e.transform(...i),a){e.transform(1,0,0,1,n.offsetX||0,n.offsetY||0);const t=n.gradientTransform||n.patternTransform;t&&e.transform(...t)}e.fill(),e.restore()}if(s){e.save();const{skipOffscreen:t}=this;this.skipOffscreen=r,r&&e.transform(...i),s.render(e),this.skipOffscreen=t,e.restore()}}_renderBackground(e){this._renderBackgroundOrOverlay(e,"background")}_renderOverlay(e){this._renderBackgroundOrOverlay(e,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new Cb(this.width/2,this.height/2)}centerObjectH(e){return this._centerObject(e,new Cb(this.getCenterPoint().x,e.getCenterPoint().y))}centerObjectV(e){return this._centerObject(e,new Cb(e.getCenterPoint().x,this.getCenterPoint().y))}centerObject(e){return this._centerObject(e,this.getCenterPoint())}viewportCenterObject(e){return this._centerObject(e,this.getVpCenter())}viewportCenterObjectH(e){return this._centerObject(e,new Cb(this.getVpCenter().x,e.getCenterPoint().y))}viewportCenterObjectV(e){return this._centerObject(e,new Cb(e.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Bb(this.getCenterPoint(),Hb(this.viewportTransform))}_centerObject(e,t){e.setXY(t,Xy,Xy),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(e){return this.toDatalessObject(e)}toObject(e){return this._toObjectMethod("toObject",e)}toJSON(){return this.toObject()}toDatalessObject(e){return this._toObjectMethod("toDatalessObject",e)}_toObjectMethod(e,t){const n=this.clipPath,s=n&&!n.excludeFromExport?this._toObject(n,e,t):null;return wy(wy(wy({version:Iy},ix(this,t)),{},{objects:this._objects.filter(e=>!e.excludeFromExport).map(n=>this._toObject(n,e,t))},this.__serializeBgOverlay(e,t)),s?{clipPath:s}:null)}_toObject(e,t,n){let s;this.includeDefaultValues||(s=e.includeDefaultValues,e.includeDefaultValues=!1);const i=e[t](n);return this.includeDefaultValues||(e.includeDefaultValues=!!s),i}__serializeBgOverlay(e,t){const n={},s=this.backgroundImage,i=this.overlayImage,r=this.backgroundColor,a=this.overlayColor;return lx(r)?r.excludeFromExport||(n.background=r.toObject(t)):r&&(n.background=r),lx(a)?a.excludeFromExport||(n.overlay=a.toObject(t)):a&&(n.overlay=a),s&&!s.excludeFromExport&&(n.backgroundImage=this._toObject(s,e,t)),i&&!i.excludeFromExport&&(n.overlayImage=this._toObject(i,e,t)),n}toSVG(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.reviver=t;const n=[];return this._setSVGPreamble(n,e),this._setSVGHeader(n,e),this.clipPath&&n.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(n,"background"),this._setSVGBgOverlayImage(n,"backgroundImage",t),this._setSVGObjects(n,t),this.clipPath&&n.push("</g>\n"),this._setSVGBgOverlayColor(n,"overlay"),this._setSVGBgOverlayImage(n,"overlayImage",t),n.push("</svg>"),n.join("")}_setSVGPreamble(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(e,t){const n=t.width||"".concat(this.width),s=t.height||"".concat(this.height),i=ky.NUM_FRACTION_DIGITS,r=t.viewBox;let a;if(r)a='viewBox="'.concat(r.x," ").concat(r.y," ").concat(r.width," ").concat(r.height,'" ');else if(this.svgViewportTransformation){const e=this.viewportTransform;a='viewBox="'.concat(ax(-e[4]/e[0],i)," ").concat(ax(-e[5]/e[3],i)," ").concat(ax(this.width/e[0],i)," ").concat(ax(this.height/e[3],i),'" ')}else a='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',s,'" ',a,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",Iy,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),"</defs>\n")}createSVGClipPathMarkup(e){const t=this.clipPath;return t?(t.clipPathId="CLIPPATH_".concat(Ob()),'<clipPath id="'.concat(t.clipPathId,'" >\n').concat(t.toClipPathSVG(e.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map(e=>{const t=this["".concat(e,"Color")];if(lx(t)){const n=this["".concat(e,"Vpt")],s=this.viewportTransform,i={isType:()=>!1,width:this.width/(n?s[0]:1),height:this.height/(n?s[3]:1)};return t.toSVG(i,{additionalTransform:n?ox(s):""})}}).join("")}createSVGFontFacesMarkup(){const e=[],t={},n=ky.fontPaths;this._objects.forEach(function t(n){e.push(n),Ab(n)&&n._objects.forEach(t)}),e.forEach(e=>{if(!(s=e)||"function"!=typeof s._renderText)return;var s;const{styles:i,fontFamily:r}=e;!t[r]&&n[r]&&(t[r]=!0,i&&Object.values(i).forEach(e=>{Object.values(e).forEach(e=>{let{fontFamily:s=""}=e;!t[s]&&n[s]&&(t[s]=!0)})}))});const s=Object.keys(t).map(e=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(e,"';\n\t\t\tsrc: url('").concat(n[e],"');\n\t\t}\n")).join("");return s?'\t<style type="text/css"><![CDATA[\n'.concat(s,"]]></style>\n"):""}_setSVGObjects(e,t){this.forEachObject(n=>{n.excludeFromExport||this._setSVGObject(e,n,t)})}_setSVGObject(e,t,n){e.push(t.toSVG(n))}_setSVGBgOverlayImage(e,t,n){const s=this[t];s&&!s.excludeFromExport&&s.toSVG&&e.push(s.toSVG(n))}_setSVGBgOverlayColor(e,t){const n=this["".concat(t,"Color")];if(n)if(lx(n)){const s=n.repeat||"",i=this.width,r=this.height,a=this["".concat(t,"Vpt")]?ox(Hb(this.viewportTransform)):"";e.push('<rect transform="'.concat(a," translate(").concat(i/2,",").concat(r/2,')" x="').concat(n.offsetX-i/2,'" y="').concat(n.offsetY-r/2,'" width="').concat("repeat-y"!==s&&"no-repeat"!==s||!hx(n)?i:n.source.width,'" height="').concat("repeat-x"!==s&&"no-repeat"!==s||!hx(n)?r:n.source.height,'" fill="url(#SVGID_').concat(n.id,')"></rect>\n'))}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',"></rect>\n")}loadFromJSON(e,t){let{signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return Promise.reject(new Ey("`json` is undefined"));const s="string"==typeof e?JSON.parse(e):e,{objects:i=[],backgroundImage:r,background:a,overlayImage:o,overlay:l,clipPath:c}=s,h=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([nx(i,{reviver:t,signal:n}),sx({backgroundImage:r,backgroundColor:a,overlayImage:o,overlayColor:l,clipPath:c},{signal:n})]).then(e=>{let[t,n]=e;return this.clear(),this.add(...t),this.set(s),this.set(n),this.renderOnAddRemove=h,this})}clone(e){const t=this.toObject(e);return this.cloneWithoutData().loadFromJSON(t)}cloneWithoutData(){const e=Lb(this);return new this.constructor(e)}toDataURL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:t="png",quality:n=1,multiplier:s=1,enableRetinaScaling:i=!1}=e,r=s*(i?this.getRetinaScaling():1);return Rb(this.toCanvasElement(r,e),t,n)}toBlob(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:t="png",quality:n=1,multiplier:s=1,enableRetinaScaling:i=!1}=e,r=s*(i?this.getRetinaScaling():1);return Fb(this.toCanvasElement(r,e),t,n)}toCanvasElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:t,height:n,left:s,top:i,filter:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=(t||this.width)*e,o=(n||this.height)*e,l=this.getZoom(),c=this.width,h=this.height,u=this.skipControlsDrawing,d=l*e,f=this.viewportTransform,p=[d,0,0,d,(f[4]-(s||0))*e,(f[5]-(i||0))*e],g=this.enableRetinaScaling,m=Lb({width:a,height:o}),v=r?this._objects.filter(e=>r(e)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=p,this.width=a,this.height=o,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),v),this.viewportTransform=f,this.width=c,this.height=h,this.calcViewportBoundaries(),this.enableRetinaScaling=g,this.skipControlsDrawing=u,m}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),bb.cancelByCanvas(this),this.disposed=!0,new Promise((e,t)=>{const n=()=>{this.destroy(),e(!0)};n.kill=t,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?e(!1):this.nextRenderHandle?this.__cleanupTask=n:n()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(e=>e.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}by(xx,"ownDefaults",bx);const wx=["touchstart","touchmove","touchend"],Sx=e=>{const t=dx(e.target),n=function(e){const t=e.changedTouches;return t&&t[0]?t[0]:e}(e);return new Cb(n.clientX+t.left,n.clientY+t.top)},_x=e=>wx.includes(e.type)||"touch"===e.pointerType,Cx=e=>{e.preventDefault(),e.stopPropagation()},kx=e=>{let t=0,n=0,s=0,i=0;for(let r=0,a=e.length;r<a;r++){const{x:a,y:o}=e[r];(a>s||!r)&&(s=a),(a<t||!r)&&(t=a),(o>i||!r)&&(i=o),(o<n||!r)&&(n=o)}return{left:t,top:n,width:s-t,height:i-n}},Ax=["translateX","translateY","scaleX","scaleY"],Ex=(e,t)=>Tx(e,Ub(t,e.calcOwnMatrix())),Tx=(e,t)=>{const n=Xb(t),{translateX:s,translateY:i,scaleX:r,scaleY:a}=n,o=Sy(n,Ax),l=new Cb(s,i);e.flipX=!1,e.flipY=!1,Object.assign(e,o),e.set({scaleX:r,scaleY:a}),e.setPositionByOrigin(l,Xy,Xy)},Mx=e=>{e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},jx=e=>({scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}),Px=(e,t,n)=>{const s=e/2,i=t/2,r=[new Cb(-s,-i),new Cb(s,-i),new Cb(-s,i),new Cb(s,i)].map(e=>e.transform(n)),a=kx(r);return new Cb(a.width,a.height)},Ox=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Uy;return Ub(Hb(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uy),e)},Dx=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uy,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Uy;return e.transform(Ox(t,n))},Nx=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uy,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Uy;return e.transform(Ox(t,n),!0)},Lx=(e,t,n)=>{const s=Ox(t,n);return Tx(e,Ub(s,e.calcOwnMatrix())),s},Rx=(e,t)=>{var n;const{transform:{target:s}}=t;null===(n=s.canvas)||void 0===n||n.fire("object:".concat(e),wy(wy({},t),{},{target:s})),s.fire(e,t)},Fx={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Ix=e=>"string"==typeof e?Fx[e]:e-.5,zx="not-allowed";function Wx(e){return Ix(e.originX)===Ix(Xy)&&Ix(e.originY)===Ix(Xy)}function Bx(e){return.5-Ix(e)}const Hx=(e,t)=>e[t],Ux=(e,t,n,s)=>({e:e,transform:t,pointer:new Cb(n,s)});function Vx(e,t){const n=e.getTotalAngle()+zb(Math.atan2(t.y,t.x))+360;return Math.round(n%360/45)}function Gx(e,t,n,s,i){var r;let{target:a,corner:o}=e;const l=a.controls[o],c=(null===(r=a.canvas)||void 0===r?void 0:r.getZoom())||1,h=a.padding/c,u=function(e,t,n,s){const i=e.getRelativeCenterPoint(),r=void 0!==n&&void 0!==s?e.translateToGivenOrigin(i,Xy,Xy,n,s):new Cb(e.left,e.top);return(e.angle?t.rotate(-Ib(e.angle),i):t).subtract(r)}(a,new Cb(s,i),t,n);return u.x>=h&&(u.x-=h),u.x<=-h&&(u.x+=h),u.y>=h&&(u.y-=h),u.y<=h&&(u.y+=h),u.x-=l.offsetX,u.y-=l.offsetY,u}const Xx=(e,t,n,s)=>{const{target:i,offsetX:r,offsetY:a}=t,o=n-r,l=s-a,c=!Hx(i,"lockMovementX")&&i.left!==o,h=!Hx(i,"lockMovementY")&&i.top!==l;return c&&i.set(Yy,o),h&&i.set(qy,l),(c||h)&&Rx(Zy,Ux(e,t,n,s)),c||h},Yx={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},qx=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),Kx=(e,t,n,s)=>{e/=255,t/=255,n/=255;const i=Math.max(e,t,n),r=Math.min(e,t,n);let a,o;const l=(i+r)/2;if(i===r)a=o=0;else{const s=i-r;switch(o=l>.5?s/(2-i-r):s/(i+r),i){case e:a=(t-n)/s+(t<n?6:0);break;case t:a=(n-e)/s+2;break;case n:a=(e-t)/s+4}a/=6}return[Math.round(360*a),Math.round(100*o),Math.round(100*l),s]},Qx=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(e)/(e.endsWith("%")?100:1)},$x=e=>Math.min(Math.round(e),255).toString(16).toUpperCase().padStart(2,"0"),Jx=e=>{let[t,n,s,i=1]=e;const r=Math.round(.3*t+.59*n+.11*s);return[r,r,r,i]};class Zx{constructor(e){if(by(this,"isUnrecognised",!1),e)if(e instanceof Zx)this.setSource([...e._source]);else if(Array.isArray(e)){const[t,n,s,i=1]=e;this.setSource([t,n,s,i])}else this.setSource(this._tryParsingColor(e));else this.setSource([0,0,0,1])}_tryParsingColor(e){return(e=e.toLowerCase())in Yx&&(e=Yx[e]),"transparent"===e?[255,255,255,0]:Zx.sourceFromHex(e)||Zx.sourceFromRgb(e)||Zx.sourceFromHsl(e)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(e){this._source=e}toRgb(){const[e,t,n]=this.getSource();return"rgb(".concat(e,",").concat(t,",").concat(n,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[e,t,n]=Kx(...this.getSource());return"hsl(".concat(e,",").concat(t,"%,").concat(n,"%)")}toHsla(){const[e,t,n,s]=Kx(...this.getSource());return"hsla(".concat(e,",").concat(t,"%,").concat(n,"%,").concat(s,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[e,t,n,s]=this.getSource();return"".concat($x(e)).concat($x(t)).concat($x(n)).concat($x(Math.round(255*s)))}getAlpha(){return this.getSource()[3]}setAlpha(e){return this._source[3]=e,this}toGrayscale(){return this.setSource(Jx(this.getSource())),this}toBlackWhite(e){const[t,,,n]=Jx(this.getSource()),s=t<(e||127)?0:255;return this.setSource([s,s,s,n]),this}overlayWith(e){e instanceof Zx||(e=new Zx(e));const t=this.getSource(),n=e.getSource(),[s,i,r]=t.map((e,t)=>Math.round(.5*e+.5*n[t]));return this.setSource([s,i,r,t[3]]),this}static fromRgb(e){return Zx.fromRgba(e)}static fromRgba(e){return new Zx(Zx.sourceFromRgb(e))}static sourceFromRgb(e){const t=e.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(t){const[e,n,s]=t.slice(1,4).map(e=>{const t=parseFloat(e);return e.endsWith("%")?Math.round(2.55*t):t});return[e,n,s,Qx(t[4])]}}static fromHsl(e){return Zx.fromHsla(e)}static fromHsla(e){return new Zx(Zx.sourceFromHsl(e))}static sourceFromHsl(e){const t=e.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!t)return;const n=(Zx.parseAngletoDegrees(t[1])%360+360)%360/360,s=parseFloat(t[2])/100,i=parseFloat(t[3])/100;let r,a,o;if(0===s)r=a=o=i;else{const e=i<=.5?i*(s+1):i+s-i*s,t=2*i-e;r=qx(t,e,n+1/3),a=qx(t,e,n),o=qx(t,e,n-1/3)}return[Math.round(255*r),Math.round(255*a),Math.round(255*o),Qx(t[4])]}static fromHex(e){return new Zx(Zx.sourceFromHex(e))}static sourceFromHex(e){if(e.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const t=e.slice(e.indexOf("#")+1);let n;n=t.length<=4?t.split("").map(e=>e+e):t.match(/.{2}/g);const[s,i,r,a=255]=n.map(e=>parseInt(e,16));return[s,i,r,a/255]}}static parseAngletoDegrees(e){const t=e.toLowerCase(),n=parseFloat(t);return t.includes("rad")?zb(n):t.includes("turn")?360*n:n}}const ew=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vy;const n=/\D{0,2}$/.exec(e),s=parseFloat(e),i=ky.DPI;switch(null==n?void 0:n[0]){case"mm":return s*i/25.4;case"cm":return s*i/2.54;case"in":return s*i;case"pt":return s*i/72;case"pc":return s*i/72*12;case"em":return s*t;default:return s}},tw=e=>{const[t,n]=e.trim().split(" "),[s,i]=(r=t)&&r!==$y?[r.slice(1,4),r.slice(5,8)]:r===$y?[r,r]:["Mid","Mid"];var r;return{meetOrSlice:n||"meet",alignX:s,alignY:i}},nw=function(e,t){let n,s,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t)if(t.toLive)n="url(#SVGID_".concat(t.id,")");else{const e=new Zx(t),i=e.getAlpha();n=e.toRgb(),1!==i&&(s=i.toString())}else n="none";return i?"".concat(e,": ").concat(n,"; ").concat(s?"".concat(e,"-opacity: ").concat(s,"; "):""):"".concat(e,'="').concat(n,'" ').concat(s?"".concat(e,'-opacity="').concat(s,'" '):"")};class sw{getSvgStyles(e){const t=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):$y,i=this.strokeDashOffset?this.strokeDashOffset:"0",r=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",h=e?"":this.getSvgFilter(),u=nw(fb,this.fill);return[nw(pb,this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",r,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",o,"; ",u,"fill-rule: ",t,"; ","opacity: ",l,";",h,c].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e?this.calcTransformMatrix():this.calcOwnMatrix(),s='transform="'.concat(ox(n));return"".concat(s).concat(t,'" ')}_toSVG(e){return[""]}toSVG(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})}toClipPathSVG(e){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})}_createBaseClipPathSVGMarkup(e){let{reviver:t,additionalTransform:n=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),i=e.indexOf("COMMON_PARTS");return e[i]=s,t?t(e.join("")):e.join("")}_createBaseSVGMarkup(e){let{noStyle:t,reviver:n,withShadow:s,additionalTransform:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t?"":'style="'.concat(this.getSvgStyles(),'" '),a=s?'style="'.concat(this.getSvgFilter(),'" '):"",o=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=o&&o.absolutePositioned,h=this.stroke,u=this.fill,d=this.shadow,f=[],p=e.indexOf("COMMON_PARTS");let g;o&&(o.clipPathId="CLIPPATH_".concat(Ob()),g='<clipPath id="'.concat(o.clipPathId,'" >\n').concat(o.toClipPathSVG(n),"</clipPath>\n")),c&&f.push("<g ",a,this.getSvgCommons()," >\n"),f.push("<g ",this.getSvgTransform(!1),c?"":a+this.getSvgCommons()," >\n");const m=[r,l,t?"":this.addPaintOrder()," ",i?'transform="'.concat(i,'" '):""].join("");return e[p]=m,lx(u)&&f.push(u.toSVG(this)),lx(h)&&f.push(h.toSVG(this)),d&&f.push(d.toSVG(this)),o&&f.push(g),f.push(e.join("")),f.push("</g>\n"),c&&f.push("</g>\n"),n?n(f.join("")):f.join("")}addPaintOrder(){return this.paintFirst!==fb?' paint-order="'.concat(this.paintFirst,'" '):""}}function iw(e){return new RegExp("^("+e.join("|")+")\\b","i")}const rw="textDecorationThickness",aw=["fontSize","fontWeight","fontFamily","fontStyle"],ow=["underline","overline","linethrough"],lw=[...aw,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],cw=[...lw,...ow,"textBackgroundColor","direction",rw],hw=[...aw,...ow,pb,"strokeWidth",fb,"deltaY","textBackgroundColor",rw],uw={_reNewline:Jy,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:Yy,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:Yy,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[rw]:66.667},dw="justify",fw="justify-left",pw="justify-right",gw="justify-center";var mw,vw,yw;const bw=String.raw(mw||(mw=_y(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),xw=String.raw(vw||(vw=_y(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),ww=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+bw+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+bw+"))?\\s+(.*)"),Sw={cx:Yy,x:Yy,r:"radius",cy:qy,y:qy,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":rw},_w="font-size",Cw="clip-path",kw=(iw(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),iw(["symbol","image","marker","pattern","view","svg"]),iw(["symbol","g","a","svg","clipPath","defs"])),Aw=(new RegExp(String.raw(yw||(yw=_y(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),bw,xw,bw,xw,bw,xw,bw)),new Cb(1,0)),Ew=new Cb,Tw=(e,t)=>e.rotate(t),Mw=(e,t)=>new Cb(t).subtract(e),jw=e=>e.distanceFrom(Ew),Pw=(e,t)=>Math.atan2(Lw(e,t),Rw(e,t)),Ow=e=>Pw(Aw,e),Dw=e=>e.eq(Ew)?e:e.scalarDivide(jw(e)),Nw=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Dw(new Cb(-e.y,e.x).scalarMultiply(t?1:-1))},Lw=(e,t)=>e.x*t.y-e.y*t.x,Rw=(e,t)=>e.x*t.x+e.y*t.y,Fw=(e,t,n)=>{if(e.eq(t)||e.eq(n))return!0;const s=Lw(t,n),i=Lw(t,e),r=Lw(n,e);return s>=0?i>=0&&r<=0:!(i<=0&&r>=0)},Iw="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",zw=new RegExp("(?:\\s|^)"+Iw+Iw+"("+bw+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Ww{constructor(e){const t="string"==typeof e?Ww.parseShadow(e):e;Object.assign(this,Ww.ownDefaults,t),this.id=Ob()}static parseShadow(e){const t=e.trim(),[,n=0,s=0,i=0]=(zw.exec(t)||[]).map(e=>parseFloat(e)||0);return{color:(t.replace(zw,"")||"rgb(0,0,0)").trim(),offsetX:n,offsetY:s,blur:i}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(e){const t=Tw(new Cb(this.offsetX,this.offsetY),Ib(-e.angle)),n=new Zx(this.color);let s=40,i=40;return e.width&&e.height&&(s=100*ax((Math.abs(t.x)+this.blur)/e.width,ky.NUM_FRACTION_DIGITS)+20,i=100*ax((Math.abs(t.y)+this.blur)/e.height,ky.NUM_FRACTION_DIGITS)+20),e.flipX&&(t.x*=-1),e.flipY&&(t.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(i,'%" height="').concat(100+2*i,'%" x="-').concat(s,'%" width="').concat(100+2*s,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(ax(this.blur?this.blur/2:0,ky.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(ax(t.x,ky.NUM_FRACTION_DIGITS),'" dy="').concat(ax(t.y,ky.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(n.toRgb(),'" flood-opacity="').concat(n.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){const e={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},t=Ww.ownDefaults;return this.includeDefaultValues?e:rx(e,(e,n)=>e!==t[n])}static async fromObject(e){return new this(e)}}by(Ww,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),by(Ww,"type","shadow"),yb.setClass(Ww,"shadow");const Bw=(e,t,n)=>Math.max(e,Math.min(t,n)),Hw=[qy,Yy,cb,hb,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",ub,db],Uw=[fb,pb,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],Vw={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:Yy,originY:qy,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:fb,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},Gw=(e,t,n,s)=>(e<Math.abs(t)?(e=t,s=n/4):s=0===t&&0===e?n/By*Math.asin(1):n/By*Math.asin(t/e),{a:e,c:t,p:n,s:s}),Xw=(e,t,n,s,i)=>e*Math.pow(2,10*(s-=1))*Math.sin((s*i-t)*By/n),Yw=(e,t,n,s)=>-n*Math.cos(e/s*Wy)+n+t,qw=(e,t,n,s)=>(e/=s)<1/2.75?n*(7.5625*e*e)+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t,Kw=(e,t,n,s)=>n-qw(s-e,0,n,s)+t;var Qw=Object.freeze({__proto__:null,defaultEasing:Yw,easeInBack:function(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return n*(e/=s)*e*((i+1)*e-i)+t},easeInBounce:Kw,easeInCirc:(e,t,n,s)=>-n*(Math.sqrt(1-(e/=s)*e)-1)+t,easeInCubic:(e,t,n,s)=>n*(e/s)**3+t,easeInElastic:(e,t,n,s)=>{const i=n;let r=0;if(0===e)return t;if(1===(e/=s))return t+n;r||(r=.3*s);const{a:a,s:o,p:l}=Gw(i,n,r,1.70158);return-Xw(a,o,l,e,s)+t},easeInExpo:(e,t,n,s)=>0===e?t:n*2**(10*(e/s-1))+t,easeInOutBack:function(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(e/=s/2)<1?n/2*(e*e*((1+(i*=1.525))*e-i))+t:n/2*((e-=2)*e*((1+(i*=1.525))*e+i)+2)+t},easeInOutBounce:(e,t,n,s)=>e<s/2?.5*Kw(2*e,0,n,s)+t:.5*qw(2*e-s,0,n,s)+.5*n+t,easeInOutCirc:(e,t,n,s)=>(e/=s/2)<1?-n/2*(Math.sqrt(1-e**2)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t,easeInOutCubic:(e,t,n,s)=>(e/=s/2)<1?n/2*e**3+t:n/2*((e-2)**3+2)+t,easeInOutElastic:(e,t,n,s)=>{const i=n;let r=0;if(0===e)return t;if(2===(e/=s/2))return t+n;r||(r=s*(.3*1.5));const{a:a,s:o,p:l,c:c}=Gw(i,n,r,1.70158);return e<1?-.5*Xw(a,o,l,e,s)+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*s-o)*By/l)*.5+c+t},easeInOutExpo:(e,t,n,s)=>0===e?t:e===s?t+n:(e/=s/2)<1?n/2*2**(10*(e-1))+t:n/2*-(2**(-10*--e)+2)+t,easeInOutQuad:(e,t,n,s)=>(e/=s/2)<1?n/2*e**2+t:-n/2*(--e*(e-2)-1)+t,easeInOutQuart:(e,t,n,s)=>(e/=s/2)<1?n/2*e**4+t:-n/2*((e-=2)*e**3-2)+t,easeInOutQuint:(e,t,n,s)=>(e/=s/2)<1?n/2*e**5+t:n/2*((e-2)**5+2)+t,easeInOutSine:(e,t,n,s)=>-n/2*(Math.cos(Math.PI*e/s)-1)+t,easeInQuad:(e,t,n,s)=>n*(e/=s)*e+t,easeInQuart:(e,t,n,s)=>n*(e/=s)*e**3+t,easeInQuint:(e,t,n,s)=>n*(e/s)**5+t,easeInSine:(e,t,n,s)=>-n*Math.cos(e/s*Wy)+n+t,easeOutBack:function(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return n*((e=e/s-1)*e*((i+1)*e+i)+1)+t},easeOutBounce:qw,easeOutCirc:(e,t,n,s)=>n*Math.sqrt(1-(e=e/s-1)*e)+t,easeOutCubic:(e,t,n,s)=>n*((e/s-1)**3+1)+t,easeOutElastic:(e,t,n,s)=>{const i=n;let r=0;if(0===e)return t;if(1===(e/=s))return t+n;r||(r=.3*s);const{a:a,s:o,p:l,c:c}=Gw(i,n,r,1.70158);return a*2**(-10*e)*Math.sin((e*s-o)*By/l)+c+t},easeOutExpo:(e,t,n,s)=>e===s?t+n:n*-(2**(-10*e/s)+1)+t,easeOutQuad:(e,t,n,s)=>-n*(e/=s)*(e-2)+t,easeOutQuart:(e,t,n,s)=>-n*((e=e/s-1)*e**3-1)+t,easeOutQuint:(e,t,n,s)=>n*((e/s-1)**5+1)+t,easeOutSine:(e,t,n,s)=>n*Math.sin(e/s*Wy)+t});const $w=()=>!1;class Jw{constructor(e){let{startValue:t,byValue:n,duration:s=500,delay:i=0,easing:r=Yw,onStart:a=zy,onChange:o=zy,onComplete:l=zy,abort:c=$w,target:h}=e;by(this,"_state","pending"),by(this,"durationProgress",0),by(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=s,this.delay=i,this.easing=r,this._onStart=a,this._onChange=o,this._onComplete=l,this._abort=c,this.target=h,this.startValue=t,this.byValue=n,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){const e=e=>{"pending"===this._state&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>Mb(e),this.delay):Mb(e)}tick(e){const t=(e||+new Date)-this.startTime,n=Math.min(t,this.duration);this.durationProgress=n/this.duration;const{value:s,valueProgress:i}=this.calculate(n);this.value=Object.freeze(s),this.valueProgress=i,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):t>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),Mb(this.tick)))}register(){bb.push(this)}unregister(){bb.remove(this)}abort(){this._state="aborted",this.unregister()}}const Zw=["startValue","endValue"];class eS extends Jw{constructor(e){let{startValue:t=0,endValue:n=100}=e;super(wy(wy({},Sy(e,Zw)),{},{startValue:t,byValue:n-t}))}calculate(e){const t=this.easing(e,this.startValue,this.byValue,this.duration);return{value:t,valueProgress:Math.abs((t-this.startValue)/this.byValue)}}}const tS=["startValue","endValue"];class nS extends Jw{constructor(e){let{startValue:t=[0],endValue:n=[100]}=e;super(wy(wy({},Sy(e,tS)),{},{startValue:t,byValue:n.map((e,n)=>e-t[n])}))}calculate(e){const t=this.startValue.map((t,n)=>this.easing(e,t,this.byValue[n],this.duration,n));return{value:t,valueProgress:Math.abs((t[0]-this.startValue[0])/this.byValue[0])}}}const sS=["startValue","endValue","easing","onChange","onComplete","abort"],iS=(e,t,n,s)=>t+n*(1-Math.cos(e/s*Wy)),rS=e=>e&&((t,n,s)=>e(new Zx(t).toRgba(),n,s));class aS extends Jw{constructor(e){let{startValue:t,endValue:n,easing:s=iS,onChange:i,onComplete:r,abort:a}=e,o=Sy(e,sS);const l=new Zx(t).getSource(),c=new Zx(n).getSource();super(wy(wy({},o),{},{startValue:l,byValue:c.map((e,t)=>e-l[t]),easing:s,onChange:rS(i),onComplete:rS(r),abort:rS(a)}))}calculate(e){const[t,n,s,i]=this.startValue.map((t,n)=>this.easing(e,t,this.byValue[n],this.duration,n)),r=[...[t,n,s].map(Math.round),Bw(0,i,1)];return{value:r,valueProgress:r.map((e,t)=>0!==this.byValue[t]?Math.abs((e-this.startValue[t])/this.byValue[t]):0).find(e=>0!==e)||0}}}function oS(e){const t=(e=>Array.isArray(e.startValue)||Array.isArray(e.endValue))(e)?new nS(e):new eS(e);return t.start(),t}function lS(e){const t=new aS(e);return t.start(),t}class cS{constructor(e){this.status=e,this.points=[]}includes(e){return this.points.some(t=>t.eq(e))}append(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.points=this.points.concat(t.filter(e=>!this.includes(e))),this}static isPointContained(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t.eq(n))return e.eq(t);if(t.x===n.x)return e.x===t.x&&(s||e.y>=Math.min(t.y,n.y)&&e.y<=Math.max(t.y,n.y));if(t.y===n.y)return e.y===t.y&&(s||e.x>=Math.min(t.x,n.x)&&e.x<=Math.max(t.x,n.x));{const i=Mw(t,n),r=Mw(t,e).divide(i);return s?Math.abs(r.x)===Math.abs(r.y):r.x===r.y&&r.x>=0&&r.x<=1}}static isPointInPolygon(e,t){const n=new Cb(e).setX(Math.min(e.x-1,...t.map(e=>e.x)));let s=0;for(let i=0;i<t.length;i++){const r=this.intersectSegmentSegment(t[i],t[(i+1)%t.length],e,n);if(r.includes(e))return!0;s+=Number("Intersection"===r.status)}return s%2==1}static intersectLineLine(e,t,n,s){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const a=t.x-e.x,o=t.y-e.y,l=s.x-n.x,c=s.y-n.y,h=e.x-n.x,u=e.y-n.y,d=l*u-c*h,f=a*u-o*h,p=c*a-l*o;if(0!==p){const t=d/p,n=f/p;return(i||0<=t&&t<=1)&&(r||0<=n&&n<=1)?new cS("Intersection").append(new Cb(e.x+t*a,e.y+t*o)):new cS}if(0===d||0===f){const a=i||r||cS.isPointContained(e,n,s)||cS.isPointContained(t,n,s)||cS.isPointContained(n,e,t)||cS.isPointContained(s,e,t);return new cS(a?"Coincident":void 0)}return new cS("Parallel")}static intersectSegmentLine(e,t,n,s){return cS.intersectLineLine(e,t,n,s,!1,!0)}static intersectSegmentSegment(e,t,n,s){return cS.intersectLineLine(e,t,n,s,!1,!1)}static intersectLinePolygon(e,t,n){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=new cS,r=n.length;for(let a,o,l,c=0;c<r;c++){if(a=n[c],o=n[(c+1)%r],l=cS.intersectLineLine(e,t,a,o,s,!1),"Coincident"===l.status)return l;i.append(...l.points)}return i.points.length>0&&(i.status="Intersection"),i}static intersectSegmentPolygon(e,t,n){return cS.intersectLinePolygon(e,t,n,!1)}static intersectPolygonPolygon(e,t){const n=new cS,s=e.length,i=[];for(let r=0;r<s;r++){const a=e[r],o=e[(r+1)%s],l=cS.intersectSegmentPolygon(a,o,t);"Coincident"===l.status?(i.push(l),n.append(a,o)):n.append(...l.points)}return i.length>0&&i.length===e.length?new cS("Coincident"):(n.points.length>0&&(n.status="Intersection"),n)}static intersectPolygonRectangle(e,t,n){const s=t.min(n),i=t.max(n),r=new Cb(i.x,s.y),a=new Cb(s.x,i.y);return cS.intersectPolygonPolygon(e,[s,r,i,a])}}class hS extends Tb{getX(){return this.getXY().x}setX(e){this.setXY(this.getXY().setX(e))}getY(){return this.getXY().y}setY(e){this.setXY(this.getXY().setY(e))}getRelativeX(){return this.left}setRelativeX(e){this.left=e}getRelativeY(){return this.top}setRelativeY(e){this.top=e}getXY(){const e=this.getRelativeXY();return this.group?Bb(e,this.group.calcTransformMatrix()):e}setXY(e,t,n){this.group&&(e=Bb(e,Hb(this.group.calcTransformMatrix()))),this.setRelativeXY(e,t,n)}getRelativeXY(){return new Cb(this.left,this.top)}setRelativeXY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(e,t,n)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:e,tr:t,br:n,bl:s}=this.aCoords||(this.aCoords=this.calcACoords()),i=[e,t,n,s];if(this.group){const e=this.group.calcTransformMatrix();return i.map(t=>Bb(t,e))}return i}intersectsWithRect(e,t){return"Intersection"===cS.intersectPolygonRectangle(this.getCoords(),e,t).status}intersectsWithObject(e){const t=cS.intersectPolygonPolygon(this.getCoords(),e.getCoords());return"Intersection"===t.status||"Coincident"===t.status||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)}isContainedWithinObject(e){return this.getCoords().every(t=>e.containsPoint(t))}isContainedWithinRect(e,t){const{left:n,top:s,width:i,height:r}=this.getBoundingRect();return n>=e.x&&n+i<=t.x&&s>=e.y&&s+r<=t.y}isOverlapping(e){return this.intersectsWithObject(e)||this.isContainedWithinObject(e)||e.isContainedWithinObject(this)}containsPoint(e){return cS.isPointInPolygon(e,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return!!this.getCoords().some(n=>n.x<=t.x&&n.x>=e.x&&n.y<=t.y&&n.y>=e.y)||!!this.intersectsWithRect(e,t)||this.containsPoint(e.midPointFrom(t))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return!!this.intersectsWithRect(e,t)||this.getCoords().every(n=>(n.x>=t.x||n.x<=e.x)&&(n.y>=t.y||n.y<=e.y))&&this.containsPoint(e.midPointFrom(t))}getBoundingRect(){return kx(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(e){this._set(cb,e),this._set(hb,e),this.setCoords()}scaleToWidth(e){const t=this.getBoundingRect().width/this.getScaledWidth();return this.scale(e/this.width/t)}scaleToHeight(e){const t=this.getBoundingRect().height/this.getScaledHeight();return this.scale(e/this.height/t)}getCanvasRetinaScaling(){var e;return(null===(e=this.canvas)||void 0===e?void 0:e.getRetinaScaling())||1}getTotalAngle(){return this.group?zb(Gb(this.calcTransformMatrix())):this.angle}getViewportTransform(){var e;return(null===(e=this.canvas)||void 0===e?void 0:e.viewportTransform)||Uy.concat()}calcACoords(){const e=qb({angle:this.angle}),{x:t,y:n}=this.getRelativeCenterPoint(),s=Yb(t,n),i=Ub(s,e),r=this._getTransformedDimensions(),a=r.x/2,o=r.y/2;return{tl:Bb({x:-a,y:-o},i),tr:Bb({x:a,y:-o},i),bl:Bb({x:-a,y:o},i),br:Bb({x:a,y:o},i)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];return!e&&this.group&&(t=this.group.transformMatrixKey(e)),t.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Ix(this.originX),Ix(this.originY)),t}calcTransformMatrix(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.calcOwnMatrix();if(e||!this.group)return t;const n=this.transformMatrixKey(e),s=this.matrixCache;return s&&s.key.every((e,t)=>e===n[t])?s.value:(this.group&&(t=Ub(this.group.calcTransformMatrix(!1),t)),this.matrixCache={key:n,value:t},t)}calcOwnMatrix(){const e=this.transformMatrixKey(!0),t=this.ownMatrixCache;if(t&&t.key===e)return t.value;const n=this.getRelativeCenterPoint(),s={angle:this.angle,translateX:n.x,translateY:n.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},i=ex(s);return this.ownMatrixCache={key:e,value:i},i}_getNonTransformedDimensions(){return new Cb(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(e){return this._getTransformedDimensions(e).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=wy({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},e),n=t.strokeWidth;let s=n,i=0;this.strokeUniform&&(s=0,i=n);const r=t.width+s,a=t.height+s;let o;return o=0===t.skewX&&0===t.skewY?new Cb(r*t.scaleX,a*t.scaleY):Px(r,a,Zb(t)),o.scalarAdd(i)}translateToGivenOrigin(e,t,n,s,i){let r=e.x,a=e.y;const o=Ix(s)-Ix(t),l=Ix(i)-Ix(n);if(o||l){const e=this._getTransformedDimensions();r+=o*e.x,a+=l*e.y}return new Cb(r,a)}translateToCenterPoint(e,t,n){if(t===Xy&&n===Xy)return e;const s=this.translateToGivenOrigin(e,t,n,Xy,Xy);return this.angle?s.rotate(Ib(this.angle),e):s}translateToOriginPoint(e,t,n){const s=this.translateToGivenOrigin(e,Xy,Xy,t,n);return this.angle?s.rotate(Ib(this.angle),e):s}getCenterPoint(){const e=this.getRelativeCenterPoint();return this.group?Bb(e,this.group.calcTransformMatrix()):e}getRelativeCenterPoint(){return this.translateToCenterPoint(new Cb(this.left,this.top),this.originX,this.originY)}getPointByOrigin(e,t){return this.translateToOriginPoint(this.getRelativeCenterPoint(),e,t)}setPositionByOrigin(e,t,n){const s=this.translateToCenterPoint(e,t,n),i=this.translateToOriginPoint(s,this.originX,this.originY);this.set({left:i.x,top:i.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),Yy,qy)}}const uS=["type"],dS=["extraParam"];let fS=class e extends hS{static getDefaults(){return e.ownDefaults}get type(){const e=this.constructor.type;return"FabricObject"===e?"object":e.toLowerCase()}set type(e){Ay("warn","Setting type has no effect",e)}constructor(t){super(),by(this,"_cacheContext",null),Object.assign(this,e.ownDefaults),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=Db(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(e){const t=e.width,n=e.height,s=ky.maxCacheSideLimit,i=ky.minCacheSideLimit;if(t<=s&&n<=s&&t*n<=ky.perfLimitSizeTotal)return t<i&&(e.width=i),n<i&&(e.height=i),e;const r=t/n,[a,o]=Fy.limitDimsByArea(r),l=Bw(i,a,s),c=Bw(i,o,s);return t>l&&(e.zoomX/=t/l,e.width=l,e.capped=!0),n>c&&(e.zoomY/=n/c,e.height=c,e.capped=!0),e}_getCacheCanvasDimensions(){const e=this.getTotalObjectScaling(),t=this._getTransformedDimensions({skewX:0,skewY:0}),n=t.x*e.x/this.scaleX,s=t.y*e.y/this.scaleY;return{width:Math.ceil(n+2),height:Math.ceil(s+2),zoomX:e.x,zoomY:e.y,x:n,y:s}}_updateCacheCanvas(){const e=this._cacheCanvas,t=this._cacheContext,{width:n,height:s,zoomX:i,zoomY:r,x:a,y:o}=this._limitCacheSize(this._getCacheCanvasDimensions()),l=n!==e.width||s!==e.height,c=this.zoomX!==i||this.zoomY!==r;if(!e||!t)return!1;if(l||c){n!==e.width||s!==e.height?(e.width=n,e.height=s):(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height));const l=a/2,c=o/2;return this.cacheTranslationX=Math.round(e.width/2-l)+l,this.cacheTranslationY=Math.round(e.height/2-c)+c,t.translate(this.cacheTranslationX,this.cacheTranslationY),t.scale(i,r),this.zoomX=i,this.zoomY=r,!0}return!1}setOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(e)}transform(e){const t=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,n=this.calcTransformMatrix(!t);e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}getObjectScaling(){if(!this.group)return new Cb(Math.abs(this.scaleX),Math.abs(this.scaleY));const e=Xb(this.calcTransformMatrix());return new Cb(Math.abs(e.scaleX),Math.abs(e.scaleY))}getTotalObjectScaling(){const e=this.getObjectScaling();if(this.canvas){const t=this.canvas.getZoom(),n=this.getCanvasRetinaScaling();return e.scalarMultiply(t*n)}return e}getObjectOpacity(){let e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e}_constrainScale(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:0===e?1e-4:e}_set(e,t){e!==cb&&e!==hb||(t=this._constrainScale(t)),e===cb&&t<0?(this.flipX=!this.flipX,t*=-1):"scaleY"===e&&t<0?(this.flipY=!this.flipY,t*=-1):"shadow"!==e||!t||t instanceof Ww||(t=new Ww(t));const n=this[e]!==t;return this[e]=t,n&&this.constructor.cacheProperties.includes(e)&&(this.dirty=!0),this.parent&&(this.dirty||n&&this.constructor.stateProperties.includes(e))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.drawObject(e,!1,{}),this.dirty=!1),e.restore())}drawSelectionBackground(e){}renderCache(e){if(e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:t,zoomY:n,cacheTranslationX:s,cacheTranslationY:i}=this,{width:r,height:a}=this._cacheCanvas;this.drawObject(this._cacheContext,e.forClipping,{zoomX:t,zoomY:n,cacheTranslationX:s,cacheTranslationY:i,width:r,height:a,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===pb&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(e,t,n){e.save(),t.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",e.setTransform(1,0,0,1,0,0),e.drawImage(n,0,0),e.restore()}drawObject(e,t,n){const s=this.fill,i=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath,n),this.fill=s,this.stroke=i}createClipPathLayer(e,t){const n=Lb(t),s=n.getContext("2d");if(s.translate(t.cacheTranslationX,t.cacheTranslationY),s.scale(t.zoomX,t.zoomY),e._cacheCanvas=n,t.parentClipPaths.forEach(e=>{e.transform(s)}),t.parentClipPaths.push(e),e.absolutePositioned){const e=Hb(this.calcTransformMatrix());s.transform(e[0],e[1],e[2],e[3],e[4],e[5])}return e.transform(s),e.drawObject(s,!0,t),n}_drawClipPath(e,t,n){if(!t)return;t._transformDone=!0;const s=this.createClipPathLayer(t,n);this.drawClipPathOnCache(e,t,s)}drawCacheOnCanvas(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;const t=this._cacheCanvas,n=this._cacheContext;return!(!t||!n||e||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(t&&n&&!e&&(n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.width,t.height),n.restore()),!0)}_renderBackground(e){if(!this.backgroundColor)return;const t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}_setOpacity(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity}_setStrokeStyles(e,t){const n=t.stroke;n&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,lx(n)?"percentage"===n.gradientUnits||n.gradientTransform||n.patternTransform?this._applyPatternForTransformedGradient(e,n):(e.strokeStyle=n.toLive(e),this._applyPatternGradientTransform(e,n)):e.strokeStyle=t.stroke)}_setFillStyles(e,t){let{fill:n}=t;n&&(lx(n)?(e.fillStyle=n.toLive(e),this._applyPatternGradientTransform(e,n)):e.fillStyle=n)}_setClippingProperties(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"}_setLineDash(e,t){t&&0!==t.length&&e.setLineDash(t)}_setShadow(e){if(!this.shadow)return;const t=this.shadow,n=this.canvas,s=this.getCanvasRetinaScaling(),[i,,,r]=(null==n?void 0:n.viewportTransform)||Uy,a=i*s,o=r*s,l=t.nonScaling?new Cb(1,1):this.getObjectScaling();e.shadowColor=t.color,e.shadowBlur=t.blur*ky.browserShadowBlurConstant*(a+o)*(l.x+l.y)/4,e.shadowOffsetX=t.offsetX*a*l.x,e.shadowOffsetY=t.offsetY*o*l.y}_removeShadow(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)}_applyPatternGradientTransform(e,t){if(!lx(t))return{offsetX:0,offsetY:0};const n=t.gradientTransform||t.patternTransform,s=-this.width/2+t.offsetX||0,i=-this.height/2+t.offsetY||0;return"percentage"===t.gradientUnits?e.transform(this.width,0,0,this.height,s,i):e.transform(1,0,0,1,s,i),n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:s,offsetY:i}}_renderPaintInOrder(e){this.paintFirst===pb?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))}_render(e){}_renderFill(e){this.fill&&(e.save(),this._setFillStyles(e,this),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())}_renderStroke(e){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform){const t=this.getObjectScaling();e.scale(1/t.x,1/t.y)}this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}}_applyPatternForTransformedGradient(e,t){var n;const s=this._limitCacheSize(this._getCacheCanvasDimensions()),i=this.getCanvasRetinaScaling(),r=s.x/this.scaleX/i,a=s.y/this.scaleY/i,o=Lb({width:Math.ceil(r),height:Math.ceil(a)}),l=o.getContext("2d");l&&(l.beginPath(),l.moveTo(0,0),l.lineTo(r,0),l.lineTo(r,a),l.lineTo(0,a),l.closePath(),l.translate(r/2,a/2),l.scale(s.zoomX/this.scaleX/i,s.zoomY/this.scaleY/i),this._applyPatternGradientTransform(l,t),l.fillStyle=t.toLive(e),l.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(i*this.scaleX/s.zoomX,i*this.scaleY/s.zoomY),e.strokeStyle=null!==(n=l.createPattern(o,"no-repeat"))&&void 0!==n?n:"")}_findCenterFromElement(){return new Cb(this.left+this.width/2,this.top+this.height/2)}clone(e){const t=this.toObject(e);return this.constructor.fromObject(t)}cloneAsImage(e){const t=this.toCanvasElement(e);return new(yb.getClass("image"))(t)}toCanvasElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=jx(this),n=this.group,s=this.shadow,i=Math.abs,r=e.enableRetinaScaling?Ry():1,a=(e.multiplier||1)*r,o=e.canvasProvider||(e=>new xx(e,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,e.withoutTransform&&Mx(this),e.withoutShadow&&(this.shadow=null),e.viewportTransform&&Lx(this,this.getViewportTransform()),this.setCoords();const l=Db(),c=this.getBoundingRect(),h=this.shadow,u=new Cb;if(h){const e=h.blur,t=h.nonScaling?new Cb(1,1):this.getObjectScaling();u.x=2*Math.round(i(h.offsetX)+e)*i(t.x),u.y=2*Math.round(i(h.offsetY)+e)*i(t.y)}const d=c.width+u.x,f=c.height+u.y;l.width=Math.ceil(d),l.height=Math.ceil(f);const p=o(l);"jpeg"===e.format&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new Cb(p.width/2,p.height/2),Xy,Xy);const g=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();const m=p.toCanvasElement(a||1,e);return this.set("canvas",g),this.shadow=s,n&&(this.group=n),this.set(t),this.setCoords(),p._objects=[],p.destroy(),m}toDataURL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Rb(this.toCanvasElement(e),e.format||"png",e.quality||1)}toBlob(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Fb(this.toCanvasElement(e),e.format||"png",e.quality||1)}isType(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes(this.constructor.type)||t.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(e){const{centeredRotation:t,originX:n,originY:s}=this;if(t){const{x:e,y:t}=this.getRelativeCenterPoint();this.originX=Xy,this.originY=Xy,this.left=e,this.top=t}if(this.set("angle",e),t){const{x:e,y:t}=this.translateToOriginPoint(this.getRelativeCenterPoint(),n,s);this.left=e,this.top=t,this.originX=n,this.originY=s}}setOnGroup(){}_setupCompositeOperation(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}dispose(){bb.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&Dy().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(e,t){return Object.entries(e).reduce((e,n)=>{let[s,i]=n;return e[s]=this._animate(s,i,t),e},{})}_animate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=e.split("."),i=this.constructor.colorProperties.includes(s[s.length-1]),{abort:r,startValue:a,onChange:o,onComplete:l}=n,c=wy(wy({},n),{},{target:this,startValue:null!=a?a:s.reduce((e,t)=>e[t],this),endValue:t,abort:null==r?void 0:r.bind(this),onChange:(e,t,n)=>{s.reduce((t,n,i)=>(i===s.length-1&&(t[n]=e),t[n]),this),o&&o(e,t,n)},onComplete:(e,t,n)=>{this.setCoords(),l&&l(e,t,n)}});return i?lS(c):oS(c)}isDescendantOf(e){const{parent:t,group:n}=this;return t===e||n===e||!!t&&t.isDescendantOf(e)||!!n&&n!==t&&n.isDescendantOf(e)}getAncestors(){const e=[];let t=this;do{t=t.parent,t&&e.push(t)}while(t);return e}findCommonAncestors(e){if(this===e)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const t=this.getAncestors(),n=e.getAncestors();if(0===t.length&&n.length>0&&this===n[n.length-1])return{fork:[],otherFork:[e,...n.slice(0,n.length-1)],common:[this]};for(let s,i=0;i<t.length;i++){if(s=t[i],s===e)return{fork:[this,...t.slice(0,i)],otherFork:[],common:t.slice(i)};for(let r=0;r<n.length;r++){if(this===n[r])return{fork:[],otherFork:[e,...n.slice(0,r)],common:[this,...t]};if(s===n[r])return{fork:[this,...t.slice(0,i)],otherFork:[e,...n.slice(0,r)],common:t.slice(i)}}}return{fork:[this,...t],otherFork:[e,...n],common:[]}}hasCommonAncestors(e){const t=this.findCommonAncestors(e);return t&&!!t.common.length}isInFrontOf(e){if(this===e)return;const t=this.findCommonAncestors(e);if(t.fork.includes(e))return!0;if(t.otherFork.includes(this))return!1;const n=t.common[0]||this.canvas;if(!n)return;const s=t.fork.pop(),i=t.otherFork.pop(),r=n._objects.indexOf(s),a=n._objects.indexOf(i);return r>-1&&r>a}toObject(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(e.customProperties,this.constructor.customProperties||[]);let n;const s=ky.NUM_FRACTION_DIGITS,{clipPath:i,fill:r,stroke:a,shadow:o,strokeDashArray:l,left:c,top:h,originX:u,originY:d,width:f,height:p,strokeWidth:g,strokeLineCap:m,strokeDashOffset:v,strokeLineJoin:y,strokeUniform:b,strokeMiterLimit:x,scaleX:w,scaleY:S,angle:_,flipX:C,flipY:k,opacity:A,visible:E,backgroundColor:T,fillRule:M,paintFirst:j,globalCompositeOperation:P,skewX:O,skewY:D}=this;i&&!i.excludeFromExport&&(n=i.toObject(t.concat("inverted","absolutePositioned")));const N=e=>ax(e,s),L=wy(wy({},ix(this,t)),{},{type:this.constructor.type,version:Iy,originX:u,originY:d,left:N(c),top:N(h),width:N(f),height:N(p),fill:cx(r)?r.toObject():r,stroke:cx(a)?a.toObject():a,strokeWidth:N(g),strokeDashArray:l?l.concat():l,strokeLineCap:m,strokeDashOffset:v,strokeLineJoin:y,strokeUniform:b,strokeMiterLimit:N(x),scaleX:N(w),scaleY:N(S),angle:N(_),flipX:C,flipY:k,opacity:N(A),shadow:o?o.toObject():o,visible:E,backgroundColor:T,fillRule:M,paintFirst:j,globalCompositeOperation:P,skewX:N(O),skewY:N(D)},n?{clipPath:n}:null);return this.includeDefaultValues?L:this._removeDefaultValues(L)}toDatalessObject(e){return this.toObject(e)}_removeDefaultValues(e){const t=this.constructor.getDefaults(),n=Object.keys(t).length>0?t:Object.getPrototypeOf(this);return rx(e,(e,t)=>{if(t===Yy||t===qy||"type"===t)return!0;const s=n[t];return e!==s&&!(Array.isArray(e)&&Array.isArray(s)&&0===e.length&&0===s.length)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(e){let t=Sy(e,uS),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:s}=n,i=Sy(n,dS);return sx(t,i).then(e=>s?(delete e[s],new this(t[s],e)):new this(e))}static fromObject(e,t){return this._fromObject(e,t)}};by(fS,"stateProperties",Hw),by(fS,"cacheProperties",Uw),by(fS,"ownDefaults",Vw),by(fS,"type","FabricObject"),by(fS,"colorProperties",[fb,pb,"backgroundColor"]),by(fS,"customProperties",[]),yb.setClass(fS),yb.setClass(fS,"object");const pS=(e,t,n)=>(s,i,r,a)=>{const o=t(s,i,r,a);return o&&Rx(e,wy(wy({},Ux(s,i,r,a)),n)),o};function gS(e){return(t,n,s,i)=>{const{target:r,originX:a,originY:o}=n,l=r.getRelativeCenterPoint(),c=r.translateToOriginPoint(l,a,o),h=e(t,n,s,i);return r.setPositionByOrigin(c,n.originX,n.originY),h}}const mS=pS(ib,gS((e,t,n,s)=>{const i=Gx(t,t.originX,t.originY,n,s);if(Ix(t.originX)===Ix(Xy)||Ix(t.originX)===Ix(Qy)&&i.x<0||Ix(t.originX)===Ix(Yy)&&i.x>0){const{target:e}=t,n=e.strokeWidth/(e.strokeUniform?e.scaleX:1),s=Wx(t)?2:1,r=e.width,a=Math.abs(i.x*s/e.scaleX)-n;return e.set("width",Math.max(a,1)),r!==e.width}return!1}));function vS(e,t,n,s,i){s=s||{};const r=this.sizeX||s.cornerSize||i.cornerSize,a=this.sizeY||s.cornerSize||i.cornerSize,o=void 0!==s.transparentCorners?s.transparentCorners:i.transparentCorners,l=o?pb:fb,c=!o&&(s.cornerStrokeColor||i.cornerStrokeColor);let h,u=t,d=n;e.save(),e.fillStyle=s.cornerColor||i.cornerColor||"",e.strokeStyle=s.cornerStrokeColor||i.cornerStrokeColor||"",r>a?(h=r,e.scale(1,a/r),d=n*r/a):a>r?(h=a,e.scale(r/a,1),u=t*a/r):h=r,e.beginPath(),e.arc(u,d,h/2,0,By,!1),e[l](),c&&e.stroke(),e.restore()}function yS(e,t,n,s,i){s=s||{};const r=this.sizeX||s.cornerSize||i.cornerSize,a=this.sizeY||s.cornerSize||i.cornerSize,o=void 0!==s.transparentCorners?s.transparentCorners:i.transparentCorners,l=o?pb:fb,c=!o&&(s.cornerStrokeColor||i.cornerStrokeColor),h=r/2,u=a/2;e.save(),e.fillStyle=s.cornerColor||i.cornerColor||"",e.strokeStyle=s.cornerStrokeColor||i.cornerStrokeColor||"",e.translate(t,n);const d=i.getTotalAngle();e.rotate(Ib(d)),e["".concat(l,"Rect")](-h,-u,r,a),c&&e.strokeRect(-h,-u,r,a),e.restore()}class bS{constructor(e){by(this,"visible",!0),by(this,"actionName",lb),by(this,"angle",0),by(this,"x",0),by(this,"y",0),by(this,"offsetX",0),by(this,"offsetY",0),by(this,"sizeX",0),by(this,"sizeY",0),by(this,"touchSizeX",0),by(this,"touchSizeY",0),by(this,"cursorStyle","crosshair"),by(this,"withConnection",!1),Object.assign(this,e)}shouldActivate(e,t,n,s){var i;let{tl:r,tr:a,br:o,bl:l}=s;return(null===(i=t.canvas)||void 0===i?void 0:i.getActiveObject())===t&&t.isControlVisible(e)&&cS.isPointInPolygon(n,[r,a,o,l])}getActionHandler(e,t,n){return this.actionHandler}getMouseDownHandler(e,t,n){return this.mouseDownHandler}getMouseUpHandler(e,t,n){return this.mouseUpHandler}cursorStyleHandler(e,t,n){return t.cursorStyle}getActionName(e,t,n){return t.actionName}getVisibility(e,t){var n,s;return null!==(n=null===(s=e._controlsVisibility)||void 0===s?void 0:s[t])&&void 0!==n?n:this.visible}setVisibility(e,t,n){this.visible=e}positionHandler(e,t,n,s){return new Cb(this.x*e.x+this.offsetX,this.y*e.y+this.offsetY).transform(t)}calcCornerCoords(e,t,n,s,i,r){const a=Vb([Yb(n,s),qb({angle:e}),Kb((i?this.touchSizeX:this.sizeX)||t,(i?this.touchSizeY:this.sizeY)||t)]);return{tl:new Cb(-.5,-.5).transform(a),tr:new Cb(.5,-.5).transform(a),br:new Cb(.5,.5).transform(a),bl:new Cb(-.5,.5).transform(a)}}render(e,t,n,s,i){"circle"===((s=s||{}).cornerStyle||i.cornerStyle)?vS.call(this,e,t,n,s,i):yS.call(this,e,t,n,s,i)}}const xS=(e,t,n)=>n.lockRotation?zx:t.cursorStyle,wS=pS(tb,gS((e,t,n,s)=>{let{target:i,ex:r,ey:a,theta:o,originX:l,originY:c}=t;const h=i.translateToOriginPoint(i.getRelativeCenterPoint(),l,c);if(Hx(i,"lockRotation"))return!1;const u=Math.atan2(a-h.y,r-h.x),d=Math.atan2(s-h.y,n-h.x);let f=zb(d-u+o);if(i.snapAngle&&i.snapAngle>0){const e=i.snapAngle,t=i.snapThreshold||e,n=Math.ceil(f/e)*e,s=Math.floor(f/e)*e;Math.abs(f-s)<t?f=s:Math.abs(f-n)<t&&(f=n)}f<0&&(f=360+f),f%=360;const p=i.angle!==f;return i.angle=f,p}));function SS(e,t){const n=t.canvas,s=e[n.uniScaleKey];return n.uniformScaling&&!s||!n.uniformScaling&&s}function _S(e,t,n){const s=Hx(e,"lockScalingX"),i=Hx(e,"lockScalingY");if(s&&i)return!0;if(!t&&(s||i)&&n)return!0;if(s&&"x"===t)return!0;if(i&&"y"===t)return!0;const{width:r,height:a,strokeWidth:o}=e;return 0===r&&0===o&&"y"!==t||0===a&&0===o&&"x"!==t}const CS=["e","se","s","sw","w","nw","n","ne","e"],kS=(e,t,n)=>{const s=SS(e,n);if(_S(n,0!==t.x&&0===t.y?"x":0===t.x&&0!==t.y?"y":"",s))return zx;const i=Vx(n,t);return"".concat(CS[i],"-resize")};function AS(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=t.target,a=i.by,o=SS(e,r);let l,c,h,u,d,f;if(_S(r,a,o))return!1;if(t.gestureScale)c=t.scaleX*t.gestureScale,h=t.scaleY*t.gestureScale;else{if(l=Gx(t,t.originX,t.originY,n,s),d="y"!==a?Math.sign(l.x||t.signX||1):1,f="x"!==a?Math.sign(l.y||t.signY||1):1,t.signX||(t.signX=d),t.signY||(t.signY=f),Hx(r,"lockScalingFlip")&&(t.signX!==d||t.signY!==f))return!1;if(u=r._getTransformedDimensions(),o&&!a){const e=Math.abs(l.x)+Math.abs(l.y),{original:n}=t,s=e/(Math.abs(u.x*n.scaleX/r.scaleX)+Math.abs(u.y*n.scaleY/r.scaleY));c=n.scaleX*s,h=n.scaleY*s}else c=Math.abs(l.x*r.scaleX/u.x),h=Math.abs(l.y*r.scaleY/u.y);Wx(t)&&(c*=2,h*=2),t.signX!==d&&"y"!==a&&(t.originX=Bx(t.originX),c*=-1,t.signX=d),t.signY!==f&&"x"!==a&&(t.originY=Bx(t.originY),h*=-1,t.signY=f)}const p=r.scaleX,g=r.scaleY;return a?("x"===a&&r.set(cb,c),"y"===a&&r.set(hb,h)):(!Hx(r,"lockScalingX")&&r.set(cb,c),!Hx(r,"lockScalingY")&&r.set(hb,h)),p!==r.scaleX||g!==r.scaleY}const ES=pS(eb,gS((e,t,n,s)=>AS(e,t,n,s))),TS=pS(eb,gS((e,t,n,s)=>AS(e,t,n,s,{by:"x"}))),MS=pS(eb,gS((e,t,n,s)=>AS(e,t,n,s,{by:"y"}))),jS=["target","ex","ey","skewingSide"],PS={x:{counterAxis:"y",scale:cb,skew:ub,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:hb,skew:db,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},OS=["ns","nesw","ew","nwse"],DS=(e,t,n)=>{if(0!==t.x&&Hx(n,"lockSkewingY"))return zx;if(0!==t.y&&Hx(n,"lockSkewingX"))return zx;const s=Vx(n,t)%4;return"".concat(OS[s],"-resize")};function NS(e,t,n,s,i){const{target:r}=n,{counterAxis:a,origin:o,lockSkewing:l,skew:c,flip:h}=PS[e];if(Hx(r,l))return!1;const{origin:u,flip:d}=PS[a],f=Ix(n[u])*(r[d]?-1:1),p=-Math.sign(f)*(r[h]?-1:1),g=-(0===r[c]&&Gx(n,Xy,Xy,s,i)[e]>0||r[c]>0?1:-1)*p*.5+.5,m=pS(sb,gS((t,n,s,i)=>function(e,t,n){let{target:s,ex:i,ey:r,skewingSide:a}=t,o=Sy(t,jS);const{skew:l}=PS[e],c=n.subtract(new Cb(i,r)).divide(new Cb(s.scaleX,s.scaleY))[e],h=s[l],u=o[l],d=Math.tan(Ib(u)),f="y"===e?s._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:s._getTransformedDimensions({scaleX:1,scaleY:1}).y,p=2*c*a/Math.max(f,1)+d,g=zb(Math.atan(p));s.set(l,g);const m=h!==s[l];if(m&&"y"===e){const{skewX:e,scaleX:t}=s,n=s._getTransformedDimensions({skewY:h}),i=s._getTransformedDimensions(),r=0!==e?n.x/i.x:1;1!==r&&s.set(cb,r*t)}return m}(e,n,new Cb(s,i))));return m(t,wy(wy({},n),{},{[o]:g,skewingSide:p}),s,i)}const LS=(e,t,n,s)=>NS("x",e,t,n,s),RS=(e,t,n,s)=>NS("y",e,t,n,s);function FS(e,t){return e[t.canvas.altActionKey]}const IS=(e,t,n)=>{const s=FS(e,n);return 0===t.x?s?ub:hb:0===t.y?s?db:cb:""},zS=(e,t,n)=>FS(e,n)?DS(0,t,n):kS(e,t,n),WS=(e,t,n,s)=>FS(e,t.target)?RS(e,t,n,s):TS(e,t,n,s),BS=(e,t,n,s)=>FS(e,t.target)?LS(e,t,n,s):MS(e,t,n,s),HS=()=>({ml:new bS({x:-.5,y:0,cursorStyleHandler:zS,actionHandler:WS,getActionName:IS}),mr:new bS({x:.5,y:0,cursorStyleHandler:zS,actionHandler:WS,getActionName:IS}),mb:new bS({x:0,y:.5,cursorStyleHandler:zS,actionHandler:BS,getActionName:IS}),mt:new bS({x:0,y:-.5,cursorStyleHandler:zS,actionHandler:BS,getActionName:IS}),tl:new bS({x:-.5,y:-.5,cursorStyleHandler:kS,actionHandler:ES}),tr:new bS({x:.5,y:-.5,cursorStyleHandler:kS,actionHandler:ES}),bl:new bS({x:-.5,y:.5,cursorStyleHandler:kS,actionHandler:ES}),br:new bS({x:.5,y:.5,cursorStyleHandler:kS,actionHandler:ES}),mtr:new bS({x:0,y:-.5,actionHandler:wS,cursorStyleHandler:xS,offsetY:-40,withConnection:!0,actionName:nb})}),US=()=>({mr:new bS({x:.5,y:0,actionHandler:mS,cursorStyleHandler:zS,actionName:ib}),ml:new bS({x:-.5,y:0,actionHandler:mS,cursorStyleHandler:zS,actionName:ib})}),VS=()=>wy(wy({},HS()),US());class GS extends fS{static getDefaults(){return wy(wy({},super.getDefaults()),GS.ownDefaults)}constructor(e){super(),Object.assign(this,this.constructor.createControls(),GS.ownDefaults),this.setOptions(e)}static createControls(){return{controls:HS()}}_updateCacheCanvas(){const e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){const t=e._currentTransform,n=t.target,s=t.action;if(this===n&&s&&s.startsWith(lb))return!1}return super._updateCacheCanvas()}getActiveControl(){const e=this.__corner;return e?{key:e,control:this.controls[e],coord:this.oCoords[e]}:void 0}findControl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const n=Object.entries(this.oCoords);for(let s=n.length-1;s>=0;s--){const[i,r]=n[s],a=this.controls[i];if(a.shouldActivate(i,this,e,t?r.touchCorner:r.corner))return this.__corner=i,{key:i,control:a,coord:this.oCoords[i]}}}calcOCoords(){const e=this.getViewportTransform(),t=this.getCenterPoint(),n=Yb(t.x,t.y),s=qb({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),i=Ub(n,s),r=Ub(e,i),a=Ub(r,[1/e[0],0,0,1/e[3],0,0]),o=this.group?Xb(this.calcTransformMatrix()):void 0;o&&(o.scaleX=Math.abs(o.scaleX),o.scaleY=Math.abs(o.scaleY));const l=this._calculateCurrentDimensions(o),c={};return this.forEachControl((e,t)=>{const n=e.positionHandler(l,a,this,e);c[t]=Object.assign(n,this._calcCornerCoords(e,n))}),c}_calcCornerCoords(e,t){const n=this.getTotalAngle();return{corner:e.calcCornerCoords(n,this.cornerSize,t.x,t.y,!1,this),touchCorner:e.calcCornerCoords(n,this.touchCornerSize,t.x,t.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(e){for(const t in this.controls)e(this.controls[t],t,this)}drawSelectionBackground(e){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;e.save();const t=this.getRelativeCenterPoint(),n=this._calculateCurrentDimensions(),s=this.getViewportTransform();e.translate(t.x,t.y),e.scale(1/s[0],1/s[3]),e.rotate(Ib(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore()}strokeBorders(e,t){e.strokeRect(-t.x/2,-t.y/2,t.x,t.y)}_drawBorders(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=wy({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},n);e.save(),e.strokeStyle=s.borderColor,this._setLineDash(e,s.borderDashArray),this.strokeBorders(e,t),s.hasControls&&this.drawControlsConnectingLines(e,t),e.restore()}_renderControls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{hasBorders:n,hasControls:s}=this,i=wy({hasBorders:n,hasControls:s},t),r=this.getViewportTransform(),a=i.hasBorders,o=i.hasControls,l=Ub(r,this.calcTransformMatrix()),c=Xb(l);e.save(),e.translate(c.translateX,c.translateY),e.lineWidth=this.borderScaleFactor,this.group===this.parent&&(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(c.angle-=180),e.rotate(Ib(this.group?c.angle:this.angle)),a&&this.drawBorders(e,c,t),o&&this.drawControls(e,t),e.restore()}drawBorders(e,t,n){let s;if(n&&n.forActiveSelection||this.group){const e=Px(this.width,this.height,Zb(t)),n=this.isStrokeAccountedForInDimensions()?kb:(this.strokeUniform?(new Cb).scalarAdd(this.canvas?this.canvas.getZoom():1):new Cb(t.scaleX,t.scaleY)).scalarMultiply(this.strokeWidth);s=e.add(n).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else s=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(e,s,n)}drawControlsConnectingLines(e,t){let n=!1;e.beginPath(),this.forEachControl((s,i)=>{s.withConnection&&s.getVisibility(this,i)&&(n=!0,e.moveTo(s.x*t.x,s.y*t.y),e.lineTo(s.x*t.x+s.offsetX,s.y*t.y+s.offsetY))}),n&&e.stroke()}drawControls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.save();const n=this.getCanvasRetinaScaling(),{cornerStrokeColor:s,cornerDashArray:i,cornerColor:r}=this,a=wy({cornerStrokeColor:s,cornerDashArray:i,cornerColor:r},t);e.setTransform(n,0,0,n,0,0),e.strokeStyle=e.fillStyle=a.cornerColor,this.transparentCorners||(e.strokeStyle=a.cornerStrokeColor),this._setLineDash(e,a.cornerDashArray),this.forEachControl((t,n)=>{if(t.getVisibility(this,n)){const s=this.oCoords[n];t.render(e,s.x,s.y,a,this)}}),e.restore()}isControlVisible(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)}setControlVisible(e,t){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=t}setControlsVisibility(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(e).forEach(e=>{let[t,n]=e;return this.setControlVisible(t,n)})}clearContextTop(e){if(!this.canvas)return;const t=this.canvas.contextTop;if(!t)return;const n=this.canvas.viewportTransform;t.save(),t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.transform(t);const s=this.width+4,i=this.height+4;return t.clearRect(-s/2,-i/2,s,i),e||t.restore(),t}onDeselect(e){return!1}onSelect(e){return!1}shouldStartDragging(e){return!1}onDragStart(e){return!1}canDrop(e){return!1}renderDragSourceEffect(e){}renderDropTargetEffect(e){}}function XS(e,t){return t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{"constructor"!==n&&Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))})}),e}by(GS,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class YS extends GS{}XS(YS,[sw]),yb.setClass(YS),yb.setClass(YS,"object");const qS=(e,t,n,s)=>{const i=2*(s=Math.round(s))+1,{data:r}=e.getImageData(t-s,n-s,i,i);for(let a=3;a<r.length;a+=4)if(r[a]>0)return!1;return!0};class KS{constructor(e){this.options=e,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new Cb(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new Cb(1/this.options.scaleX,1/this.options.scaleY):new Cb(1,1)}createSideVector(e,t){const n=Mw(e,t);return this.options.strokeUniform?n.multiply(this.scale):n}projectOrthogonally(e,t,n){return this.applySkew(e.add(this.calcOrthogonalProjection(e,t,n)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(e){const t=new Cb(e);return t.y+=t.x*Math.tan(Ib(this.options.skewY)),t.x+=t.y*Math.tan(Ib(this.options.skewX)),t}scaleUnitVector(e,t){return e.multiply(this.strokeUniformScalar).scalarMultiply(t)}}const QS=new Cb;class $S extends KS{static getOrthogonalRotationFactor(e,t){const n=t?Pw(e,t):Ow(e);return Math.abs(n)<Wy?-1:1}constructor(e,t,n,s){super(s),by(this,"AB",void 0),by(this,"AC",void 0),by(this,"alpha",void 0),by(this,"bisector",void 0),this.A=new Cb(e),this.B=new Cb(t),this.C=new Cb(n),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Pw(this.AB,this.AC),this.bisector=Dw(Tw(this.AB.eq(QS)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const s=this.createSideVector(e,t),i=Nw(s),r=$S.getOrthogonalRotationFactor(i,this.bisector);return this.scaleUnitVector(i,n*r)}projectBevel(){const e=[];return(this.alpha%By==0?[this.B]:[this.B,this.C]).forEach(t=>{e.push(this.projectOrthogonally(this.A,t)),e.push(this.projectOrthogonally(this.A,t,-this.strokeProjectionMagnitude))}),e}projectMiter(){const e=[],t=Math.abs(this.alpha),n=1/Math.sin(t/2),s=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*n),i=this.options.strokeUniform?jw(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return jw(s)/this.strokeProjectionMagnitude<=i&&e.push(this.applySkew(this.A.add(s))),e.push(...this.projectBevel()),e}projectRoundNoSkew(e,t){const n=[],s=new Cb($S.getOrthogonalRotationFactor(this.bisector),$S.getOrthogonalRotationFactor(new Cb(this.bisector.y,this.bisector.x)));return[new Cb(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(s),new Cb(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(s)].forEach(s=>{Fw(s,e,t)&&n.push(this.A.add(s))}),n}projectRoundWithSkew(e,t){const n=[],{skewX:s,skewY:i,scaleX:r,scaleY:a,strokeUniform:o}=this.options,l=new Cb(Math.tan(Ib(s)),Math.tan(Ib(i))),c=this.strokeProjectionMagnitude,h=o?c/a/Math.sqrt(1/a**2+1/r**2*l.y**2):c/Math.sqrt(1+l.y**2),u=new Cb(Math.sqrt(Math.max(c**2-h**2,0)),h),d=o?c/Math.sqrt(1+l.x**2*(1/a)**2/(1/r+1/r*l.x*l.y)**2):c/Math.sqrt(1+l.x**2/(1+l.x*l.y)**2),f=new Cb(d,Math.sqrt(Math.max(c**2-d**2,0)));return[f,f.scalarMultiply(-1),u,u.scalarMultiply(-1)].map(e=>this.applySkew(o?e.multiply(this.strokeUniformScalar):e)).forEach(s=>{Fw(s,e,t)&&n.push(this.applySkew(this.A).add(s))}),n}projectRound(){const e=[];e.push(...this.projectBevel());const t=this.alpha%By==0,n=this.applySkew(this.A),s=e[t?0:2].subtract(n),i=e[t?1:0].subtract(n),r=t?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),a=Lw(s,r)>0,o=a?s:i,l=a?i:s;return this.isSkewed()?e.push(...this.projectRoundWithSkew(o,l)):e.push(...this.projectRoundNoSkew(o,l)),e}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(e=>({originPoint:this.A,projectedPoint:e,angle:this.alpha,bisector:this.bisector}))}}class JS extends KS{constructor(e,t,n){super(n),this.A=new Cb(e),this.T=new Cb(t)}calcOrthogonalProjection(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const s=this.createSideVector(e,t);return this.scaleUnitVector(Nw(s),n)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const e=[];if(!this.isSkewed()&&this.A.eq(this.T)){const t=new Cb(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.applySkew(this.A.add(t)),this.applySkew(this.A.subtract(t)))}else e.push(...new $S(this.A,this.T,this.T,this.options).projectRound());return e}projectSquare(){const e=[];if(this.A.eq(this.T)){const t=new Cb(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.A.add(t),this.A.subtract(t))}else{const t=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),n=this.scaleUnitVector(Dw(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),s=this.A.add(n);e.push(s.add(t),s.subtract(t))}return e.map(e=>this.applySkew(e))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(e=>({originPoint:this.A,projectedPoint:e}))}}const ZS=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=[];if(0===e.length)return s;const i=e.reduce((e,t)=>(e[e.length-1].eq(t)||e.push(new Cb(t)),e),[new Cb(e[0])]);if(1===i.length)n=!0;else if(!n){const e=i[0],t=((e,t)=>{for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1})(i,t=>!t.eq(e));i.splice(t+1)}return i.forEach((e,i,r)=>{let a,o;0===i?(o=r[1],a=n?e:r[r.length-1]):i===r.length-1?(a=r[i-1],o=n?e:r[0]):(a=r[i-1],o=r[i+1]),n&&1===r.length?s.push(...new JS(e,e,t).project()):!n||0!==i&&i!==r.length-1?s.push(...new $S(e,a,o,t).project()):s.push(...new JS(e,0===i?o:a,t).project())}),s},e_=e=>{const t={};return Object.keys(e).forEach(n=>{t[n]={},Object.keys(e[n]).forEach(s=>{t[n][s]=wy({},e[n][s])})}),t},t_=e=>e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let n_;const s_=e=>{if(n_||n_||(n_="Intl"in Ly()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),n_){const t=n_.segment(e);return Array.from(t).map(e=>{let{segment:t}=e;return t})}return i_(e)},i_=e=>{const t=[];for(let n,s=0;s<e.length;s++)!1!==(n=r_(e,s))&&t.push(n);return t},r_=(e,t)=>{const n=e.charCodeAt(t);if(isNaN(n))return"";if(n<55296||n>57343)return e.charAt(t);if(55296<=n&&n<=56319){if(e.length<=t+1)throw"High surrogate without following low surrogate";const n=e.charCodeAt(t+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";const s=e.charCodeAt(t-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1};var a_=Object.freeze({__proto__:null,capitalize:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(e.charAt(0).toUpperCase()).concat(t?e.slice(1):e.slice(1).toLowerCase())},escapeXml:t_,graphemeSplit:s_});const o_=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.fill!==t.fill||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth||e.fontSize!==t.fontSize||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.textDecorationThickness!==t.textDecorationThickness||e.textBackgroundColor!==t.textBackgroundColor||e.deltaY!==t.deltaY||n&&(e.overline!==t.overline||e.underline!==t.underline||e.linethrough!==t.linethrough)},l_=(e,t)=>{const n=t.split("\n"),s=[];let i=-1,r={};e=e_(e);for(let a=0;a<n.length;a++){const t=s_(n[a]);if(e[a])for(let n=0;n<t.length;n++){i++;const t=e[a][n];t&&Object.keys(t).length>0&&(o_(r,t,!0)?s.push({start:i,end:i+1,style:t}):s[s.length-1].end++),r=t||{}}else i+=t.length,r={}}return s},c_=(e,t)=>{if(!Array.isArray(e))return e_(e);const n=t.split(Jy),s={};let i=-1,r=0;for(let a=0;a<n.length;a++){const t=s_(n[a]);for(let n=0;n<t.length;n++)i++,e[r]&&e[r].start<=i&&i<e[r].end&&(s[a]=s[a]||{},s[a][n]=wy({},e[r].style),i===e[r].end-1&&r++)}return s},h_=["display","transform",fb,"fill-opacity","fill-rule","opacity",pb,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function u_(e,t){const n=e.nodeName,s=e.getAttribute("class"),i=e.getAttribute("id"),r="(?![a-zA-Z\\-]+)";let a;if(a=new RegExp("^"+n,"i"),t=t.replace(a,""),i&&t.length&&(a=new RegExp("#"+i+r,"i"),t=t.replace(a,"")),s&&t.length){const e=s.split(" ");for(let n=e.length;n--;)a=new RegExp("\\."+e[n]+r,"i"),t=t.replace(a,"")}return 0===t.length}function d_(e,t){let n=!0;const s=u_(e,t.pop());return s&&t.length&&(n=function(e,t){let n,s=!0;for(;e.parentElement&&1===e.parentElement.nodeType&&t.length;)s&&(n=t.pop()),s=u_(e=e.parentElement,n);return 0===t.length}(e,t)),s&&n&&0===t.length}const f_=e=>{var t;return null!==(t=Sw[e])&&void 0!==t?t:e},p_=new RegExp("(".concat(bw,")"),"gi");var g_,m_,v_,y_,b_,x_,w_;const S_="(".concat(bw,")"),__=String.raw(g_||(g_=_y(["(skewX)(",")"],["(skewX)\\(","\\)"])),S_),C_=String.raw(m_||(m_=_y(["(skewY)(",")"],["(skewY)\\(","\\)"])),S_),k_=String.raw(v_||(v_=_y(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),S_,S_,S_),A_=String.raw(y_||(y_=_y(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),S_,S_),E_=String.raw(b_||(b_=_y(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),S_,S_),T_=String.raw(x_||(x_=_y(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),S_,S_,S_,S_,S_,S_),M_="(?:".concat(T_,"|").concat(E_,"|").concat(k_,"|").concat(A_,"|").concat(__,"|").concat(C_,")"),j_="(?:".concat(M_,"*)"),P_=String.raw(w_||(w_=_y(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),j_),O_=new RegExp(P_),D_=new RegExp(M_),N_=new RegExp(M_,"g");function L_(e){const t=[];if(!(e=(e=>e.replace(p_," $1 ").replace(/,/gi," ").replace(/\s+/gi," "))(e).replace(/\s*([()])\s*/gi,"$1"))||e&&!O_.test(e))return[...Uy];for(const n of e.matchAll(N_)){const e=D_.exec(n[0]);if(!e)continue;let s=Uy;const i=e.filter(e=>!!e),[,r,...a]=i,[o,l,c,h,u,d]=a.map(e=>parseFloat(e));switch(r){case"translate":s=Yb(o,l);break;case nb:s=qb({angle:o},{x:l,y:c});break;case lb:s=Kb(o,l);break;case ub:s=$b(o);break;case db:s=Jb(o);break;case"matrix":s=[o,l,c,h,u,d]}t.push(s)}return Vb(t)}function R_(e,t,n,s){const i=Array.isArray(t);let r,a=t;if(e!==fb&&e!==pb||t!==$y){if("strokeUniform"===e)return"non-scaling-stroke"===t;if("strokeDashArray"===e)a=t===$y?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===e)a=n&&n.transformMatrix?Ub(n.transformMatrix,L_(t)):L_(t);else if("visible"===e)a=t!==$y&&"hidden"!==t,n&&!1===n.visible&&(a=!1);else if("opacity"===e)a=parseFloat(t),n&&void 0!==n.opacity&&(a*=n.opacity);else if("textAnchor"===e)a="start"===t?Yy:"end"===t?Qy:Xy;else if("charSpacing"===e||e===rw)r=ew(t,s)/s*1e3;else if("paintFirst"===e){const e=t.indexOf(fb),n=t.indexOf(pb);a=fb,(e>-1&&n>-1&&n<e||-1===e&&n>-1)&&(a=pb)}else{if("href"===e||"xlink:href"===e||"font"===e||"id"===e)return t;if("imageSmoothing"===e)return"optimizeQuality"===t;r=i?t.map(ew):ew(t,s)}}else a="";return!i&&isNaN(r)?a:r}function F_(e,t){e.replace(/;\s*$/,"").split(";").forEach(e=>{if(!e)return;const[n,s]=e.split(":");t[n.trim().toLowerCase()]=s.trim()})}const I_={stroke:"strokeOpacity",fill:"fillOpacity"};function z_(e,t,n){if(!e)return{};let s,i={},r=Vy;e.parentNode&&kw.test(e.parentNode.nodeName)&&(i=z_(e.parentElement,t,n),i.fontSize&&(s=r=ew(i.fontSize)));const a=wy(wy(wy({},t.reduce((t,n)=>{const s=e.getAttribute(n);return s&&(t[n]=s),t},{})),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};for(const s in t)d_(e,s.split(" "))&&(n=wy(wy({},n),t[s]));return n}(e,n)),function(e){const t={},n=e.getAttribute("style");return n?("string"==typeof n?F_(n,t):function(e,t){Object.entries(e).forEach(e=>{let[n,s]=e;void 0!==s&&(t[n.toLowerCase()]=s)})}(n,t),t):t}(e));a[Cw]&&e.setAttribute(Cw,a[Cw]),a[_w]&&(s=ew(a[_w],r),a[_w]="".concat(s));const o={};for(const c in a){const e=f_(c),t=R_(e,a[c],i,s);o[e]=t}o&&o.font&&function(e,t){const n=e.match(ww);if(!n)return;const s=n[1],i=n[3],r=n[4],a=n[5],o=n[6];s&&(t.fontStyle=s),i&&(t.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),r&&(t.fontSize=ew(r)),o&&(t.fontFamily=o),a&&(t.lineHeight="normal"===a?1:a)}(o.font,o);const l=wy(wy({},i),o);return kw.test(e.nodeName)?l:function(e){const t=YS.getDefaults();return Object.entries(I_).forEach(n=>{let[s,i]=n;if(void 0===e[i]||""===e[s])return;if(void 0===e[s]){if(!t[s])return;e[s]=t[s]}if(0===e[s].indexOf("url("))return;const r=new Zx(e[s]);e[s]=r.setAlpha(ax(r.getAlpha()*e[i],2)).toRgba()}),e}(l)}const W_=["left","top","width","height","visible"],B_=["rx","ry"];class H_ extends YS{static getDefaults(){return wy(wy({},super.getDefaults()),H_.ownDefaults)}constructor(e){super(),Object.assign(this,H_.ownDefaults),this.setOptions(e),this._initRxRy()}_initRxRy(){const{rx:e,ry:t}=this;e&&!t?this.ry=e:t&&!e&&(this.rx=t)}_render(e){const{width:t,height:n}=this,s=-t/2,i=-n/2,r=this.rx?Math.min(this.rx,t/2):0,a=this.ry?Math.min(this.ry,n/2):0,o=0!==r||0!==a;e.beginPath(),e.moveTo(s+r,i),e.lineTo(s+t-r,i),o&&e.bezierCurveTo(s+t-Gy*r,i,s+t,i+Gy*a,s+t,i+a),e.lineTo(s+t,i+n-a),o&&e.bezierCurveTo(s+t,i+n-Gy*a,s+t-Gy*r,i+n,s+t-r,i+n),e.lineTo(s+r,i+n),o&&e.bezierCurveTo(s+Gy*r,i+n,s,i+n-Gy*a,s,i+n-a),e.lineTo(s,i+a),o&&e.bezierCurveTo(s,i+Gy*a,s+Gy*r,i,s+r,i),e.closePath(),this._renderPaintInOrder(e)}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...B_,...e])}_toSVG(){const{width:e,height:t,rx:n,ry:s}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-e/2,'" y="').concat(-t/2,'" rx="').concat(n,'" ry="').concat(s,'" width="').concat(e,'" height="').concat(t,'" />\n')]}static async fromElement(e,t,n){const s=z_(e,this.ATTRIBUTE_NAMES,n),{left:i=0,top:r=0,width:a=0,height:o=0,visible:l=!0}=s,c=Sy(s,W_);return new this(wy(wy(wy({},t),c),{},{left:i,top:r,width:a,height:o,visible:Boolean(l&&a&&o)}))}}by(H_,"type","Rect"),by(H_,"cacheProperties",[...Uw,...B_]),by(H_,"ownDefaults",{rx:0,ry:0}),by(H_,"ATTRIBUTE_NAMES",[...h_,"x","y","rx","ry","width","height"]),yb.setClass(H_),yb.setSVGClass(H_);const U_="initialization",V_="added",G_="removed",X_="imperative",Y_=(e,t)=>{const{strokeUniform:n,strokeWidth:s,width:i,height:r,group:a}=t,o=a&&a!==e?Ox(a.calcTransformMatrix(),e.calcTransformMatrix()):null,l=o?t.getRelativeCenterPoint().transform(o):t.getRelativeCenterPoint(),c=!t.isStrokeAccountedForInDimensions(),h=n&&c?Nx(new Cb(s,s),void 0,e.calcTransformMatrix()):kb,u=!n&&c?s:0,d=Px(i+u,r+u,Vb([o,t.calcOwnMatrix()],!0)).add(h).scalarDivide(2);return[l.subtract(d),l.add(d)]};class q_{calcLayoutResult(e,t){if(this.shouldPerformLayout(e))return this.calcBoundingBox(t,e)}shouldPerformLayout(e){let{type:t,prevStrategy:n,strategy:s}=e;return t===U_||t===X_||!!n&&s!==n}shouldLayoutClipPath(e){let{type:t,target:{clipPath:n}}=e;return t!==U_&&n&&!n.absolutePositioned}getInitialSize(e,t){return t.size}calcBoundingBox(e,t){const{type:n,target:s}=t;if(n===X_&&t.overrides)return t.overrides;if(0===e.length)return;const{left:i,top:r,width:a,height:o}=kx(e.map(e=>Y_(s,e)).reduce((e,t)=>e.concat(t),[])),l=new Cb(a,o),c=new Cb(i,r).add(l.scalarDivide(2));if(n===U_){const e=this.getInitialSize(t,{size:l,center:c});return{center:c,relativeCorrection:new Cb(0,0),size:e}}return{center:c.transform(s.calcOwnMatrix()),size:l}}}by(q_,"type","strategy");class K_ extends q_{shouldPerformLayout(e){return!0}}by(K_,"type","fit-content"),yb.setClass(K_);const Q_=["strategy"],$_=["target","strategy","bubbles","prevStrategy"],J_="layoutManager";class Z_{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new K_;by(this,"strategy",void 0),this.strategy=e,this._subscriptions=new Map}performLayout(e){const t=wy(wy({bubbles:!0,strategy:this.strategy},e),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(t);const n=this.getLayoutResult(t);n&&this.commitLayout(t,n),this.onAfterLayout(t,n),this._prevLayoutStrategy=t.strategy}attachHandlers(e,t){const{target:n}=t;return[gb,Zy,ib,tb,eb,sb,ob,rb,ab].map(t=>e.on(t,e=>this.performLayout(t===gb?{type:"object_modified",trigger:t,e:e,target:n}:{type:"object_modifying",trigger:t,e:e,target:n})))}subscribe(e,t){this.unsubscribe(e,t);const n=this.attachHandlers(e,t);this._subscriptions.set(e,n)}unsubscribe(e,t){(this._subscriptions.get(e)||[]).forEach(e=>e()),this._subscriptions.delete(e)}unsubscribeTargets(e){e.targets.forEach(t=>this.unsubscribe(t,e))}subscribeTargets(e){e.targets.forEach(t=>this.subscribe(t,e))}onBeforeLayout(e){const{target:t,type:n}=e,{canvas:s}=t;if(n===U_||n===V_?this.subscribeTargets(e):n===G_&&this.unsubscribeTargets(e),t.fire("layout:before",{context:e}),s&&s.fire("object:layout:before",{target:t,context:e}),n===X_&&e.deep){const n=Sy(e,Q_);t.forEachObject(e=>e.layoutManager&&e.layoutManager.performLayout(wy(wy({},n),{},{bubbles:!1,target:e})))}}getLayoutResult(e){const{target:t,strategy:n,type:s}=e,i=n.calcLayoutResult(e,t.getObjects());if(!i)return;const r=s===U_?new Cb:t.getRelativeCenterPoint(),{center:a,correction:o=new Cb,relativeCorrection:l=new Cb}=i,c=r.subtract(a).add(o).transform(s===U_?Uy:Hb(t.calcOwnMatrix()),!0).add(l);return{result:i,prevCenter:r,nextCenter:a,offset:c}}commitLayout(e,t){const{target:n}=e,{result:{size:s},nextCenter:i}=t;var r,a;n.set({width:s.x,height:s.y}),this.layoutObjects(e,t),e.type===U_?n.set({left:null!==(r=e.x)&&void 0!==r?r:i.x+s.x*Ix(n.originX),top:null!==(a=e.y)&&void 0!==a?a:i.y+s.y*Ix(n.originY)}):(n.setPositionByOrigin(i,Xy,Xy),n.setCoords(),n.set("dirty",!0))}layoutObjects(e,t){const{target:n}=e;n.forEachObject(s=>{s.group===n&&this.layoutObject(e,t,s)}),e.strategy.shouldLayoutClipPath(e)&&this.layoutObject(e,t,n.clipPath)}layoutObject(e,t,n){let{offset:s}=t;n.set({left:n.left+s.x,top:n.top+s.y})}onAfterLayout(e,t){const{target:n,strategy:s,bubbles:i,prevStrategy:r}=e,a=Sy(e,$_),{canvas:o}=n;n.fire("layout:after",{context:e,result:t}),o&&o.fire("object:layout:after",{context:e,result:t,target:n});const l=n.parent;i&&null!=l&&l.layoutManager&&((a.path||(a.path=[])).push(n),l.layoutManager.performLayout(wy(wy({},a),{},{target:l}))),n.set("dirty",!0)}dispose(){const{_subscriptions:e}=this;e.forEach(e=>e.forEach(e=>e())),e.clear()}toObject(){return{type:J_,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}yb.setClass(Z_,J_);const eC=["type","objects","layoutManager"];class tC extends Z_{performLayout(){}}class nC extends(Eb(YS)){static getDefaults(){return wy(wy({},super.getDefaults()),nC.ownDefaults)}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),by(this,"_activeObjects",[]),by(this,"__objectSelectionTracker",void 0),by(this,"__objectSelectionDisposer",void 0),Object.assign(this,nC.ownDefaults),this.setOptions(t),this.groupInit(e,t)}groupInit(e,t){var n;this._objects=[...e],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(e=>{this.enterGroup(e,!1)}),this.layoutManager=null!==(n=t.layoutManager)&&void 0!==n?n:new Z_,this.layoutManager.performLayout({type:U_,target:this,targets:[...e],x:t.left,y:t.top})}canEnterGroup(e){return e===this||this.isDescendantOf(e)?(Ay("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(e)||(Ay("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(e){return e.filter((e,t,n)=>this.canEnterGroup(e)&&n.indexOf(e)===t)}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=this._filterObjectsBeforeEnteringGroup(t),i=super.add(...s);return this._onAfterObjectsChange(V_,s),i}insertAt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const i=this._filterObjectsBeforeEnteringGroup(n),r=super.insertAt(e,...i);return this._onAfterObjectsChange(V_,i),r}remove(){const e=super.remove(...arguments);return this._onAfterObjectsChange(G_,e),e}_onObjectAdded(e){this.enterGroup(e,!0),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e,t){this.exitGroup(e,t),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onAfterObjectsChange(e,t){this.layoutManager.performLayout({type:e,targets:t,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(e,t){const n=this[e];return super._set(e,t),"canvas"===e&&n!==t&&(this._objects||[]).forEach(n=>{n._set(e,t)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(e,t){let{target:n}=t;const s=this._activeObjects;if(e)s.push(n),this._set("dirty",!0);else if(s.length>0){const e=s.indexOf(n);e>-1&&(s.splice(e,1),this._set("dirty",!0))}}_watchObject(e,t){e&&this._watchObject(!1,t),e?(t.on("selected",this.__objectSelectionTracker),t.on("deselected",this.__objectSelectionDisposer)):(t.off("selected",this.__objectSelectionTracker),t.off("deselected",this.__objectSelectionDisposer))}enterGroup(e,t){e.group&&e.group.remove(e),e._set("parent",this),this._enterGroup(e,t)}_enterGroup(e,t){t&&Tx(e,Ub(Hb(this.calcTransformMatrix()),e.calcTransformMatrix())),this._shouldSetNestedCoords()&&e.setCoords(),e._set("group",this),e._set("canvas",this.canvas),this._watchObject(!0,e);const n=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();n&&(n===e||e.isDescendantOf(n))&&this._activeObjects.push(e)}exitGroup(e,t){this._exitGroup(e,t),e._set("parent",void 0),e._set("canvas",void 0)}_exitGroup(e,t){e._set("group",void 0),t||(Tx(e,Ub(this.calcTransformMatrix(),e.calcTransformMatrix())),e.setCoords()),this._watchObject(!1,e);const n=this._activeObjects.length>0?this._activeObjects.indexOf(e):-1;n>-1&&this._activeObjects.splice(n,1)}shouldCache(){const e=YS.prototype.shouldCache.call(this);if(e)for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1,!1;return e}willDrawShadow(){if(super.willDrawShadow())return!0;for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(e,t,n){this._renderBackground(e);for(let i=0;i<this._objects.length;i++){var s;const t=this._objects[i];null!==(s=this.canvas)&&void 0!==s&&s.preserveObjectStacking&&t.group!==this?(e.save(),e.transform(...Hb(this.calcTransformMatrix())),t.render(e),e.restore()):t.group===this&&t.render(e)}this._drawClipPath(e,this.clipPath,n)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(e=>e.setCoords())}triggerLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(wy({target:this,type:X_},e))}render(e){this._transformDone=!0,super.render(e),this._transformDone=!1}__serializeObjects(e,t){const n=this.includeDefaultValues;return this._objects.filter(function(e){return!e.excludeFromExport}).map(function(s){const i=s.includeDefaultValues;s.includeDefaultValues=n;const r=s[e||"toObject"](t);return s.includeDefaultValues=i,r})}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.layoutManager.toObject();return wy(wy(wy({},super.toObject(["subTargetCheck","interactive",...e])),"fit-content"!==t.strategy||this.includeDefaultValues?{layoutManager:t}:{}),{},{objects:this.__serializeObjects("toObject",e)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(e=>{this._watchObject(!1,e),e.dispose()}),super.dispose()}_createSVGBgRect(e){if(!this.backgroundColor)return"";const t=H_.prototype._toSVG.call(this),n=t.indexOf("COMMON_PARTS");t[n]='for="group" ';const s=t.join("");return e?e(s):s}_toSVG(e){const t=["<g ","COMMON_PARTS"," >\n"],n=this._createSVGBgRect(e);n&&t.push("\t\t",n);for(let s=0;s<this._objects.length;s++)t.push("\t\t",this._objects[s].toSVG(e));return t.push("</g>\n"),t}getSvgStyles(){const e=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")}toClipPathSVG(e){const t=[],n=this._createSVGBgRect(e);n&&t.push("\t",n);for(let s=0;s<this._objects.length;s++)t.push("\t",this._objects[s].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}static fromObject(e,t){let{type:n,objects:s=[],layoutManager:i}=e,r=Sy(e,eC);return Promise.all([nx(s,t),sx(r,t)]).then(e=>{let[t,n]=e;const s=new this(t,wy(wy(wy({},r),n),{},{layoutManager:new tC}));if(i){const e=yb.getClass(i.type),t=yb.getClass(i.strategy);s.layoutManager=new e(new t)}else s.layoutManager=new Z_;return s.layoutManager.subscribeTargets({type:U_,target:s,targets:s.getObjects()}),s.setCoords(),s})}}by(nC,"type","Group"),by(nC,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),yb.setClass(nC);const sC=(e,t)=>Math.min(t.width/e.width,t.height/e.height),iC=(e,t)=>Math.max(t.width/e.width,t.height/e.height),rC="\\s*,?\\s*",aC="".concat(rC,"(").concat(bw,")"),oC="".concat(aC).concat(aC).concat(aC).concat(rC,"([01])").concat(rC,"([01])").concat(aC).concat(aC),lC={m:"l",M:"L"},cC=(e,t,n,s,i,r,a,o,l,c,h)=>{const u=Sb(e),d=_b(e),f=Sb(t),p=_b(t),g=n*i*f-s*r*p+a,m=s*i*f+n*r*p+o;return["C",c+l*(-n*i*d-s*r*u),h+l*(-s*i*d+n*r*u),g+l*(n*i*p+s*r*f),m+l*(s*i*p-n*r*f),g,m]},hC=(e,t,n,s)=>{const i=Math.atan2(t,e),r=Math.atan2(s,n);return r>=i?r-i:2*Math.PI-(i-r)};function uC(e,t,n,s,i,r,a,o){let l;if(ky.cachesBoundsOfCurve&&(l=[...arguments].join(),Fy.boundsOfCurveCache[l]))return Fy.boundsOfCurveCache[l];const c=Math.sqrt,h=Math.abs,u=[],d=[[0,0],[0,0]];let f=6*e-12*n+6*i,p=-3*e+9*n-9*i+3*a,g=3*n-3*e;for(let x=0;x<2;++x){if(x>0&&(f=6*t-12*s+6*r,p=-3*t+9*s-9*r+3*o,g=3*s-3*t),h(p)<1e-12){if(h(f)<1e-12)continue;const e=-g/f;0<e&&e<1&&u.push(e);continue}const e=f*f-4*g*p;if(e<0)continue;const n=c(e),i=(-f+n)/(2*p);0<i&&i<1&&u.push(i);const a=(-f-n)/(2*p);0<a&&a<1&&u.push(a)}let m=u.length;const v=m,y=gC(e,t,n,s,i,r,a,o);for(;m--;){const{x:e,y:t}=y(u[m]);d[0][m]=e,d[1][m]=t}d[0][v]=e,d[1][v]=t,d[0][v+1]=a,d[1][v+1]=o;const b=[new Cb(Math.min(...d[0]),Math.min(...d[1])),new Cb(Math.max(...d[0]),Math.max(...d[1]))];return ky.cachesBoundsOfCurve&&(Fy.boundsOfCurveCache[l]=b),b}const dC=(e,t,n)=>{let[s,i,r,a,o,l,c,h]=n;const u=((e,t,n,s,i,r,a)=>{if(0===n||0===s)return[];let o=0,l=0,c=0;const h=Math.PI,u=a*Hy,d=_b(u),f=Sb(u),p=.5*(-f*e-d*t),g=.5*(-f*t+d*e),m=n**2,v=s**2,y=g**2,b=p**2,x=m*v-m*y-v*b;let w=Math.abs(n),S=Math.abs(s);if(x<0){const e=Math.sqrt(1-x/(m*v));w*=e,S*=e}else c=(i===r?-1:1)*Math.sqrt(x/(m*y+v*b));const _=c*w*g/S,C=-c*S*p/w,k=f*_-d*C+.5*e,A=d*_+f*C+.5*t;let E=hC(1,0,(p-_)/w,(g-C)/S),T=hC((p-_)/w,(g-C)/S,(-p-_)/w,(-g-C)/S);0===r&&T>0?T-=2*h:1===r&&T<0&&(T+=2*h);const M=Math.ceil(Math.abs(T/h*2)),j=[],P=T/M,O=8/3*Math.sin(P/4)*Math.sin(P/4)/Math.sin(P/2);let D=E+P;for(let N=0;N<M;N++)j[N]=cC(E,D,f,d,w,S,k,A,O,o,l),o=j[N][5],l=j[N][6],E=D,D+=P;return j})(c-e,h-t,i,r,o,l,a);for(let d=0,f=u.length;d<f;d++)u[d][1]+=e,u[d][2]+=t,u[d][3]+=e,u[d][4]+=t,u[d][5]+=e,u[d][6]+=t;return u},fC=e=>{let t=0,n=0,s=0,i=0;const r=[];let a,o=0,l=0;for(const c of e){const e=[...c];let h;switch(e[0]){case"l":e[1]+=t,e[2]+=n;case"L":t=e[1],n=e[2],h=["L",t,n];break;case"h":e[1]+=t;case"H":t=e[1],h=["L",t,n];break;case"v":e[1]+=n;case"V":n=e[1],h=["L",t,n];break;case"m":e[1]+=t,e[2]+=n;case"M":t=e[1],n=e[2],s=e[1],i=e[2],h=["M",t,n];break;case"c":e[1]+=t,e[2]+=n,e[3]+=t,e[4]+=n,e[5]+=t,e[6]+=n;case"C":o=e[3],l=e[4],t=e[5],n=e[6],h=["C",e[1],e[2],o,l,t,n];break;case"s":e[1]+=t,e[2]+=n,e[3]+=t,e[4]+=n;case"S":"C"===a?(o=2*t-o,l=2*n-l):(o=t,l=n),t=e[3],n=e[4],h=["C",o,l,e[1],e[2],t,n],o=h[3],l=h[4];break;case"q":e[1]+=t,e[2]+=n,e[3]+=t,e[4]+=n;case"Q":o=e[1],l=e[2],t=e[3],n=e[4],h=["Q",o,l,t,n];break;case"t":e[1]+=t,e[2]+=n;case"T":"Q"===a?(o=2*t-o,l=2*n-l):(o=t,l=n),t=e[1],n=e[2],h=["Q",o,l,t,n];break;case"a":e[6]+=t,e[7]+=n;case"A":dC(t,n,e).forEach(e=>r.push(e)),t=e[6],n=e[7];break;case"z":case"Z":t=s,n=i,h=["Z"]}h?(r.push(h),a=h[0]):a=""}return r},pC=(e,t,n,s)=>Math.sqrt((n-e)**2+(s-t)**2),gC=(e,t,n,s,i,r,a,o)=>l=>{const c=l**3,h=(e=>3*e**2*(1-e))(l),u=(e=>3*e*(1-e)**2)(l),d=(e=>(1-e)**3)(l);return new Cb(a*c+i*h+n*u+e*d,o*c+r*h+s*u+t*d)},mC=e=>e**2,vC=e=>2*e*(1-e),yC=e=>(1-e)**2,bC=(e,t,n,s,i,r,a,o)=>l=>{const c=mC(l),h=vC(l),u=yC(l),d=3*(u*(n-e)+h*(i-n)+c*(a-i)),f=3*(u*(s-t)+h*(r-s)+c*(o-r));return Math.atan2(f,d)},xC=(e,t,n,s,i,r)=>a=>{const o=mC(a),l=vC(a),c=yC(a);return new Cb(i*o+n*l+e*c,r*o+s*l+t*c)},wC=(e,t,n,s,i,r)=>a=>{const o=1-a,l=2*(o*(n-e)+a*(i-n)),c=2*(o*(s-t)+a*(r-s));return Math.atan2(c,l)},SC=(e,t,n)=>{let s=new Cb(t,n),i=0;for(let r=1;r<=100;r+=1){const t=e(r/100);i+=pC(s.x,s.y,t.x,t.y),s=t}return i},_C=e=>{let t,n,s=0,i=0,r=0,a=0,o=0;const l=[];for(const c of e){const e={x:i,y:r,command:c[0],length:0};switch(c[0]){case"M":n=e,n.x=a=i=c[1],n.y=o=r=c[2];break;case"L":n=e,n.length=pC(i,r,c[1],c[2]),i=c[1],r=c[2];break;case"C":t=gC(i,r,c[1],c[2],c[3],c[4],c[5],c[6]),n=e,n.iterator=t,n.angleFinder=bC(i,r,c[1],c[2],c[3],c[4],c[5],c[6]),n.length=SC(t,i,r),i=c[5],r=c[6];break;case"Q":t=xC(i,r,c[1],c[2],c[3],c[4]),n=e,n.iterator=t,n.angleFinder=wC(i,r,c[1],c[2],c[3],c[4]),n.length=SC(t,i,r),i=c[3],r=c[4];break;case"Z":n=e,n.destX=a,n.destY=o,n.length=pC(i,r,a,o),i=a,r=o}s+=n.length,l.push(n)}return l.push({length:s,x:i,y:r}),l},CC=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_C(e),s=0;for(;t-n[s].length>0&&s<n.length-2;)t-=n[s].length,s++;const i=n[s],r=t/i.length,a=e[s];switch(i.command){case"M":return{x:i.x,y:i.y,angle:0};case"Z":return wy(wy({},new Cb(i.x,i.y).lerp(new Cb(i.destX,i.destY),r)),{},{angle:Math.atan2(i.destY-i.y,i.destX-i.x)});case"L":return wy(wy({},new Cb(i.x,i.y).lerp(new Cb(a[1],a[2]),r)),{},{angle:Math.atan2(a[2]-i.y,a[1]-i.x)});case"C":case"Q":return((e,t)=>{let n,s=0,i=0,r={x:e.x,y:e.y},a=wy({},r),o=.01,l=0;const c=e.iterator,h=e.angleFinder;for(;i<t&&o>1e-4;)a=c(s),l=s,n=pC(r.x,r.y,a.x,a.y),n+i>t?(s-=o,o/=2):(r=a,s+=o,i+=n);return wy(wy({},a),{},{angle:h(l)})})(i,t)}},kC=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),AC=new RegExp(oC,"g"),EC=new RegExp(bw,"gi"),TC={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},MC=e=>{var t;const n=[],s=null!==(t=e.match(kC))&&void 0!==t?t:[];for(const i of s){const e=i[0];if("z"===e||"Z"===e){n.push([e]);continue}const t=TC[e.toLowerCase()];let s=[];if("a"===e||"A"===e){AC.lastIndex=0;for(let e=null;e=AC.exec(i);)s.push(...e.slice(1))}else s=i.match(EC)||[];for(let i=0;i<s.length;i+=t){const r=new Array(t),a=lC[e];r[0]=i>0&&a?a:e;for(let e=0;e<t;e++)r[e+1]=parseFloat(s[i+e]);n.push(r)}}return n},jC=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new Cb(e[0]),s=new Cb(e[1]),i=1,r=0;const a=[],o=e.length,l=o>2;let c;for(l&&(i=e[2].x<s.x?-1:e[2].x===s.x?0:1,r=e[2].y<s.y?-1:e[2].y===s.y?0:1),a.push(["M",n.x-i*t,n.y-r*t]),c=1;c<o;c++){if(!n.eq(s)){const e=n.midPointFrom(s);a.push(["Q",n.x,n.y,e.x,e.y])}n=e[c],c+1<e.length&&(s=e[c+1])}return l&&(i=n.x>e[c-2].x?1:n.x===e[c-2].x?0:-1,r=n.y>e[c-2].y?1:n.y===e[c-2].y?0:-1),a.push(["L",n.x+i*t,n.y+r*t]),a},PC=(e,t)=>e.map(e=>e.map((e,n)=>0===n||void 0===t?e:ax(e,t)).join(" ")).join(" ");function OC(e,t){const n=e.style;n&&t&&("string"==typeof t?n.cssText+=";"+t:Object.entries(t).forEach(e=>{let[t,s]=e;return n.setProperty(t,s)}))}const DC=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;function NC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.onComplete||zy,s=new(Ly().XMLHttpRequest),i=t.signal,r=function(){s.abort()},a=function(){i&&i.removeEventListener("abort",r),s.onerror=s.ontimeout=zy};if(i&&i.aborted)throw new Ty("request");return i&&i.addEventListener("abort",r,{once:!0}),s.onreadystatechange=function(){4===s.readyState&&(a(),n(s),s.onreadystatechange=zy)},s.onerror=s.ontimeout=a,s.open("get",e,!0),s.send(),s}const LC=(e,t)=>{let n=e._findCenterFromElement();e.transformMatrix&&((e=>{if(e.transformMatrix){const{scaleX:t,scaleY:n,angle:s,skewX:i}=Xb(e.transformMatrix);e.flipX=!1,e.flipY=!1,e.set(cb,t),e.set(hb,n),e.angle=s,e.skewX=i,e.skewY=0}})(e),n=n.transform(e.transformMatrix)),delete e.transformMatrix,t&&(e.scaleX*=t.scaleX,e.scaleY*=t.scaleY,e.cropX=t.cropX,e.cropY=t.cropY,n.x+=t.offsetLeft,n.y+=t.offsetTop,e.width=t.width,e.height=t.height),e.setPositionByOrigin(n,Xy,Xy)};Object.freeze({__proto__:null,addTransformToObject:Ex,animate:oS,animateColor:lS,applyTransformToObject:Tx,calcAngleBetweenVectors:Pw,calcDimensionsMatrix:Zb,calcPlaneChangeMatrix:Ox,calcVectorRotation:Ow,cancelAnimFrame:jb,capValue:Bw,composeMatrix:ex,copyCanvasElement:e=>{var t;const n=Lb(e);return null===(t=n.getContext("2d"))||void 0===t||t.drawImage(e,0,0),n},cos:Sb,createCanvasElement:Db,createImage:Nb,createRotateMatrix:qb,createScaleMatrix:Kb,createSkewXMatrix:$b,createSkewYMatrix:Jb,createTranslateMatrix:Yb,createVector:Mw,crossProduct:Lw,degreesToRadians:Ib,dotProduct:Rw,ease:Qw,enlivenObjectEnlivables:sx,enlivenObjects:nx,findScaleToCover:iC,findScaleToFit:sC,getBoundsOfCurve:uC,getOrthonormalVector:Nw,getPathSegmentsInfo:_C,getPointOnPath:CC,getPointer:Sx,getRandomInt:DC,getRegularPolygonPath:(e,t)=>{const n=2*Math.PI/e;let s=-Wy;e%2==0&&(s+=n/2);const i=new Array(e+1);for(let r=0;r<e;r++){const e=r*n+s,{x:a,y:o}=new Cb(Sb(e),_b(e)).scalarMultiply(t);i[r]=[0===r?"M":"L",a,o]}return i[e]=["Z"],i},getSmoothPathFromPoints:jC,getSvgAttributes:e=>{const t=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":return t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return t.concat(["offset","stop-color","stop-opacity"])}return t},getUnitVector:Dw,groupSVGElements:(e,t)=>e&&1===e.length?e[0]:new nC(e,t),hasStyleChanged:o_,invertTransform:Hb,isBetweenVectors:Fw,isIdentityMatrix:Wb,isTouchEvent:_x,isTransparent:qS,joinPath:PC,loadImage:tx,magnitude:jw,makeBoundingBoxFromPoints:kx,makePathSimpler:fC,matrixToSVG:ox,mergeClipPaths:(e,t)=>{var n;let s=e,i=t;s.inverted&&!i.inverted&&(s=t,i=e),Lx(i,null===(n=i.group)||void 0===n?void 0:n.calcTransformMatrix(),s.calcTransformMatrix());const r=s.inverted&&i.inverted;return r&&(s.inverted=i.inverted=!1),new nC([s],{clipPath:i,inverted:r})},multiplyTransformMatrices:Ub,multiplyTransformMatrixArray:Vb,parsePath:MC,parsePreserveAspectRatioAttribute:tw,parseUnit:ew,pick:ix,projectStrokeOnPoints:ZS,qrDecompose:Xb,radiansToDegrees:zb,removeFromArray:wb,removeTransformFromObject:(e,t)=>{const n=Hb(t),s=Ub(n,e.calcOwnMatrix());Tx(e,s)},removeTransformMatrixForSvgParsing:LC,request:NC,requestAnimFrame:Mb,resetObjectTransform:Mx,rotatePoint:(e,t,n)=>e.rotate(n,t),rotateVector:Tw,saveObjectTransform:jx,sendObjectToPlane:Lx,sendPointToPlane:Dx,sendVectorToPlane:Nx,setStyle:OC,sin:_b,sizeAfterTransform:Px,string:a_,stylesFromArray:c_,stylesToArray:l_,toBlob:Fb,toDataURL:Rb,toFixed:ax,transformPath:(e,t,n)=>(n&&(t=Ub(t,[1,0,0,1,-n.x,-n.y])),e.map(e=>{const n=[...e];for(let s=1;s<e.length-1;s+=2){const{x:i,y:r}=Bb({x:e[s],y:e[s+1]},t);n[s]=i,n[s+1]=r}return n})),transformPoint:Bb});class RC extends yx{constructor(e){let{allowTouchScrolling:t=!1,containerClass:n=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),by(this,"upper",void 0),by(this,"container",void 0);const{el:s}=this.lower,i=this.createUpperCanvas();this.upper={el:i,ctx:i.getContext("2d")},this.applyCanvasStyle(s,{allowTouchScrolling:t}),this.applyCanvasStyle(i,{allowTouchScrolling:t,styles:{position:"absolute",left:"0",top:"0"}});const r=this.createContainerElement();r.classList.add(n),s.parentNode&&s.parentNode.replaceChild(r,s),r.append(s,i),this.container=r}createUpperCanvas(){const{el:e}=this.lower,t=Db();return t.className=e.className,t.classList.remove("lower-canvas"),t.classList.add("upper-canvas"),t.setAttribute("data-fabric","top"),t.style.cssText=e.style.cssText,t.setAttribute("draggable","true"),t}createContainerElement(){const e=Ny().createElement("div");return e.setAttribute("data-fabric","wrapper"),OC(e,{position:"relative"}),vx(e),e}applyCanvasStyle(e,t){const{styles:n,allowTouchScrolling:s}=t;OC(e,wy(wy({},n),{},{"touch-action":s?"manipulation":$y})),vx(e)}setDimensions(e,t){super.setDimensions(e,t);const{el:n,ctx:s}=this.upper;gx(n,s,e,t)}setCSSDimensions(e){super.setCSSDimensions(e),mx(this.upper.el,e),mx(this.container,e)}cleanupDOM(e){const t=this.container,{el:n}=this.lower,{el:s}=this.upper;super.cleanupDOM(e),t.removeChild(s),t.removeChild(n),t.parentNode&&t.parentNode.replaceChild(n,t)}dispose(){super.dispose(),Dy().dispose(this.upper.el),delete this.upper,delete this.container}}class FC extends xx{constructor(){super(...arguments),by(this,"targets",[]),by(this,"_hoveredTargets",[]),by(this,"_objectsToRender",void 0),by(this,"_currentTransform",null),by(this,"_groupSelector",null),by(this,"contextTopDirty",!1)}static getDefaults(){return wy(wy({},super.getDefaults()),FC.ownDefaults)}get upperCanvasEl(){var e;return null===(e=this.elements.upper)||void 0===e?void 0:e.el}get contextTop(){var e;return null===(e=this.elements.upper)||void 0===e?void 0:e.ctx}get wrapperEl(){return this.elements.container}initElements(e){this.elements=new RC(e,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(e){this._objectsToRender=void 0,super._onObjectAdded(e)}_onObjectRemoved(e){this._objectsToRender=void 0,e===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[e]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[e]}),e.fire("deselected",{target:e})),e===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(e)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const e=this._activeObject;return!this.preserveObjectStacking&&e?this._objects.filter(t=>!t.group&&t!==e).concat(e):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()}renderTop(){const e=this.contextTop;this.clearContext(e),this.renderTopLayer(e),this.fire("after:render",{ctx:e})}setTargetFindTolerance(e){e=Math.round(e),this.targetFindTolerance=e;const t=this.getRetinaScaling(),n=Math.ceil((2*e+1)*t);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=n,this.pixelFindContext.scale(t,t)}isTargetTransparent(e,t,n){const s=this.targetFindTolerance,i=this.pixelFindContext;this.clearContext(i),i.save(),i.translate(-t+s,-n+s),i.transform(...this.viewportTransform);const r=e.selectionBackgroundColor;e.selectionBackgroundColor="",e.render(i),e.selectionBackgroundColor=r,i.restore();const a=Math.round(s*this.getRetinaScaling());return qS(i,a,a,a)}_isSelectionKeyPressed(e){const t=this.selectionKey;return!!t&&(Array.isArray(t)?!!t.find(t=>!!t&&!0===e[t]):e[t])}_shouldClearSelection(e,t){const n=this.getActiveObjects(),s=this._activeObject;return!!(!t||t&&s&&n.length>1&&-1===n.indexOf(t)&&s!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&s&&s!==t)}_shouldCenterTransform(e,t,n){if(!e)return;let s;return t===lb||t===cb||t===hb||t===ib?s=this.centeredScaling||e.centeredScaling:t===nb&&(s=this.centeredRotation||e.centeredRotation),s?!n:n}_getOriginFromCorner(e,t){const n={x:e.originX,y:e.originY};return t?(["ml","tl","bl"].includes(t)?n.x=Qy:["mr","tr","br"].includes(t)&&(n.x=Yy),["tl","mt","tr"].includes(t)?n.y=Ky:["bl","mb","br"].includes(t)&&(n.y=qy),n):n}_setupCurrentTransform(e,t,n){var s;const i=t.group?Dx(this.getScenePoint(e),void 0,t.group.calcTransformMatrix()):this.getScenePoint(e),{key:r="",control:a}=t.getActiveControl()||{},o=n&&a?null===(s=a.getActionHandler(e,t,a))||void 0===s?void 0:s.bind(a):Xx,l=((e,t,n,s)=>{if(!t||!e)return"drag";const i=s.controls[t];return i.getActionName(n,i,s)})(n,r,e,t),c=e[this.centeredKey],h=this._shouldCenterTransform(t,l,c)?{x:Xy,y:Xy}:this._getOriginFromCorner(t,r),u={target:t,action:l,actionHandler:o,actionPerformed:!1,corner:r,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,offsetX:i.x-t.left,offsetY:i.y-t.top,originX:h.x,originY:h.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:Ib(t.angle),width:t.width,height:t.height,shiftKey:e.shiftKey,altKey:c,original:wy(wy({},jx(t)),{},{originX:h.x,originY:h.y})};this._currentTransform=u,this.fire("before:transform",{e:e,transform:u})}setCursor(e){this.upperCanvasEl.style.cursor=e}_drawSelection(e){const{x:t,y:n,deltaX:s,deltaY:i}=this._groupSelector,r=new Cb(t,n).transform(this.viewportTransform),a=new Cb(t+s,n+i).transform(this.viewportTransform),o=this.selectionLineWidth/2;let l=Math.min(r.x,a.x),c=Math.min(r.y,a.y),h=Math.max(r.x,a.x),u=Math.max(r.y,a.y);this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(l,c,h-l,u-c)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,l+=o,c+=o,h-=o,u-=o,YS.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(l,c,h-l,u-c))}findTarget(e){if(this.skipTargetFind)return;const t=this.getViewportPoint(e),n=this._activeObject,s=this.getActiveObjects();if(this.targets=[],n&&s.length>=1){if(n.findControl(t,_x(e)))return n;if(s.length>1&&this.searchPossibleTargets([n],t))return n;if(n===this.searchPossibleTargets([n],t)){if(this.preserveObjectStacking){const s=this.targets;this.targets=[];const i=this.searchPossibleTargets(this._objects,t);return e[this.altSelectionKey]&&i&&i!==n?(this.targets=s,n):i}return n}}return this.searchPossibleTargets(this._objects,t)}_pointIsInObjectSelectionArea(e,t){let n=e.getCoords();const s=this.getZoom(),i=e.padding/s;if(i){const[e,t,s,r]=n,a=Math.atan2(t.y-e.y,t.x-e.x),o=Sb(a)*i,l=_b(a)*i,c=o+l,h=o-l;n=[new Cb(e.x-h,e.y-c),new Cb(t.x+c,t.y-h),new Cb(s.x+h,s.y+c),new Cb(r.x-c,r.y+h)]}return cS.isPointInPolygon(t,n)}_checkTarget(e,t){if(e&&e.visible&&e.evented&&this._pointIsInObjectSelectionArea(e,Dx(t,void 0,this.viewportTransform))){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}return!1}_searchPossibleTargets(e,t){let n=e.length;for(;n--;){const s=e[n];if(this._checkTarget(s,t)){if(Ab(s)&&s.subTargetCheck){const e=this._searchPossibleTargets(s._objects,t);e&&this.targets.push(e)}return s}}}searchPossibleTargets(e,t){const n=this._searchPossibleTargets(e,t);if(n&&Ab(n)&&n.interactive&&this.targets[0]){const e=this.targets;for(let t=e.length-1;t>0;t--){const n=e[t];if(!Ab(n)||!n.interactive)return n}return e[0]}return n}getViewportPoint(e){return this._pointer?this._pointer:this.getPointer(e,!0)}getScenePoint(e){return this._absolutePointer?this._absolutePointer:this.getPointer(e)}getPointer(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.upperCanvasEl,s=n.getBoundingClientRect();let i=Sx(e),r=s.width||0,a=s.height||0;r&&a||(qy in s&&Ky in s&&(a=Math.abs(s.top-s.bottom)),Qy in s&&Yy in s&&(r=Math.abs(s.right-s.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,t||(i=Dx(i,void 0,this.viewportTransform));const o=this.getRetinaScaling();1!==o&&(i.x/=o,i.y/=o);const l=0===r||0===a?new Cb(1,1):new Cb(n.width/r,n.height/a);return i.multiply(l)}_setDimensionsImpl(e,t){this._resetTransformEventData(),super._setDimensionsImpl(e,t),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Db(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const e=this._activeObject;return ux(e)?e.getObjects():e?[e]:[]}_fireSelectionEvents(e,t){let n=!1,s=!1;const i=this.getActiveObjects(),r=[],a=[];e.forEach(e=>{i.includes(e)||(n=!0,e.fire("deselected",{e:t,target:e}),a.push(e))}),i.forEach(s=>{e.includes(s)||(n=!0,s.fire("selected",{e:t,target:s}),r.push(s))}),e.length>0&&i.length>0?(s=!0,n&&this.fire("selection:updated",{e:t,selected:r,deselected:a})):i.length>0?(s=!0,this.fire("selection:created",{e:t,selected:r})):e.length>0&&(s=!0,this.fire("selection:cleared",{e:t,deselected:a})),s&&(this._objectsToRender=void 0)}setActiveObject(e,t){const n=this.getActiveObjects(),s=this._setActiveObject(e,t);return this._fireSelectionEvents(n,t),s}_setActiveObject(e,t){const n=this._activeObject;return n!==e&&!(!this._discardActiveObject(t,e)&&this._activeObject)&&!e.onSelect({e:t})&&(this._activeObject=e,ux(e)&&n!==e&&e.set("canvas",this),e.setCoords(),!0)}_discardActiveObject(e,t){const n=this._activeObject;return!!n&&!n.onDeselect({e:e,object:t})&&(this._currentTransform&&this._currentTransform.target===n&&this.endCurrentTransform(e),ux(n)&&n===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(e){const t=this.getActiveObjects(),n=this.getActiveObject();t.length&&this.fire("before:selection:cleared",{e:e,deselected:[n]});const s=this._discardActiveObject(e);return this._fireSelectionEvents(t,e),s}endCurrentTransform(e){const t=this._currentTransform;this._finalizeCurrentTransform(e),t&&t.target&&(t.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(e){const t=this._currentTransform,n=t.target,s={e:e,target:n,transform:t,action:t.action};n._scaling&&(n._scaling=!1),n.setCoords(),t.actionPerformed&&(this.fire("object:modified",s),n.fire(gb,s))}setViewportTransform(e){super.setViewportTransform(e);const t=this._activeObject;t&&t.setCoords()}destroy(){const e=this._activeObject;ux(e)&&(e.removeAll(),e.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(e){const t=this._activeObject;t&&t._renderControls(e)}_toObject(e,t,n){const s=this._realizeGroupTransformOnObject(e),i=super._toObject(e,t,n);return e.set(s),i}_realizeGroupTransformOnObject(e){const{group:t}=e;if(t&&ux(t)&&this._activeObject===t){const n=ix(e,["angle","flipX","flipY",Yy,cb,hb,ub,db,qy]);return Ex(e,t.calcOwnMatrix()),n}return{}}_setSVGObject(e,t,n){const s=this._realizeGroupTransformOnObject(t);super._setSVGObject(e,t,n),t.set(s)}}by(FC,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class IC{constructor(e){by(this,"targets",[]),by(this,"__disposer",void 0);const t=()=>{const{hiddenTextarea:t}=e.getActiveObject()||{};t&&t.focus()},n=e.upperCanvasEl;n.addEventListener("click",t),this.__disposer=()=>n.removeEventListener("click",t)}exitTextEditing(){this.target=void 0,this.targets.forEach(e=>{e.isEditing&&e.exitEditing()})}add(e){this.targets.push(e)}remove(e){this.unregister(e),wb(this.targets,e)}register(e){this.target=e}unregister(e){e===this.target&&(this.target=void 0)}onMouseMove(e){var t;(null===(t=this.target)||void 0===t?void 0:t.isEditing)&&this.target.updateSelectionOnMouseMove(e)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const zC=["target","oldTarget","fireCanvas","e"],WC={passive:!1},BC=(e,t)=>{const n=e.getViewportPoint(t),s=e.getScenePoint(t);return{viewportPoint:n,scenePoint:s,pointer:n,absolutePointer:s}},HC=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return e.addEventListener(...n)},UC=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return e.removeEventListener(...n)},VC={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class GC extends FC{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),by(this,"_isClick",void 0),by(this,"textEditingManager",new IC(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(e=>{this[e]=this[e].bind(this)}),this.addOrRemove(HC,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(e,t){const n=this.upperCanvasEl,s=this._getEventPrefix();e(px(n),"resize",this._onResize),e(n,s+"down",this._onMouseDown),e(n,"".concat(s,"move"),this._onMouseMove,WC),e(n,"".concat(s,"out"),this._onMouseOut),e(n,"".concat(s,"enter"),this._onMouseEnter),e(n,"wheel",this._onMouseWheel),e(n,"contextmenu",this._onContextMenu),e(n,"click",this._onClick),e(n,"dblclick",this._onClick),e(n,"dragstart",this._onDragStart),e(n,"dragend",this._onDragEnd),e(n,"dragover",this._onDragOver),e(n,"dragenter",this._onDragEnter),e(n,"dragleave",this._onDragLeave),e(n,"drop",this._onDrop),this.enablePointerEvents||e(n,"touchstart",this._onTouchStart,WC)}removeListeners(){this.addOrRemove(UC,"remove");const e=this._getEventPrefix(),t=fx(this.upperCanvasEl);UC(t,"".concat(e,"up"),this._onMouseUp),UC(t,"touchend",this._onTouchEnd,WC),UC(t,"".concat(e,"move"),this._onMouseMove,WC),UC(t,"touchmove",this._onMouseMove,WC),clearTimeout(this._willAddMouseDown)}_onMouseWheel(e){this.__onMouseWheel(e)}_onMouseOut(e){const t=this._hoveredTarget,n=wy({e:e},BC(this,e));this.fire("mouse:out",wy(wy({},n),{},{target:t})),this._hoveredTarget=void 0,t&&t.fire("mouseout",wy({},n)),this._hoveredTargets.forEach(e=>{this.fire("mouse:out",wy(wy({},n),{},{target:e})),e&&e.fire("mouseout",wy({},n))}),this._hoveredTargets=[]}_onMouseEnter(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",wy({e:e},BC(this,e))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(e){this._isClick=!1;const t=this.getActiveObject();if(t&&t.onDragStart(e)){this._dragSource=t;const n={e:e,target:t};return this.fire("dragstart",n),t.fire("dragstart",n),void HC(this.upperCanvasEl,"drag",this._onDragProgress)}Cx(e)}_renderDragEffects(e,t,n){let s=!1;const i=this._dropTarget;i&&i!==t&&i!==n&&(i.clearContextTop(),s=!0),null==t||t.clearContextTop(),n!==t&&(null==n||n.clearContextTop());const r=this.contextTop;r.save(),r.transform(...this.viewportTransform),t&&(r.save(),t.transform(r),t.renderDragSourceEffect(e),r.restore(),s=!0),n&&(r.save(),n.transform(r),n.renderDropTargetEffect(e),r.restore(),s=!0),r.restore(),s&&(this.contextTopDirty=!0)}_onDragEnd(e){const t=!!e.dataTransfer&&e.dataTransfer.dropEffect!==$y,n=t?this._activeObject:void 0,s={e:e,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:t,dropTarget:n};UC(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",s),this._dragSource&&this._dragSource.fire("dragend",s),delete this._dragSource,this._onMouseUp(e)}_onDragProgress(e){const t={e:e,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",t),this._dragSource&&this._dragSource.fire("drag",t)}findDragTargets(e){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(e)),targets:[...this.targets]}}_onDragOver(e){const t="dragover",{target:n,targets:s}=this.findDragTargets(e),i=this._dragSource,r={e:e,target:n,subTargets:s,dragSource:i,canDrop:!1,dropTarget:void 0};let a;this.fire(t,r),this._fireEnterLeaveEvents(n,r),n&&(n.canDrop(e)&&(a=n),n.fire(t,r));for(let o=0;o<s.length;o++){const n=s[o];n.canDrop(e)&&(a=n),n.fire(t,r)}this._renderDragEffects(e,i,a),this._dropTarget=a}_onDragEnter(e){const{target:t,targets:n}=this.findDragTargets(e),s={e:e,target:t,subTargets:n,dragSource:this._dragSource};this.fire("dragenter",s),this._fireEnterLeaveEvents(t,s)}_onDragLeave(e){const t={e:e,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",t),this._fireEnterLeaveEvents(void 0,t),this._renderDragEffects(e,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(e){const{target:t,targets:n}=this.findDragTargets(e),s=this._basicEventHandler("drop:before",wy({e:e,target:t,subTargets:n,dragSource:this._dragSource},BC(this,e)));s.didDrop=!1,s.dropTarget=void 0,this._basicEventHandler("drop",s),this.fire("drop:after",s)}_onContextMenu(e){const t=this.findTarget(e),n=this.targets||[],s=this._basicEventHandler("contextmenu:before",{e:e,target:t,subTargets:n});return this.stopContextMenu&&Cx(e),this._basicEventHandler("contextmenu",s),!1}_onClick(e){const t=e.detail;t>3||t<2||(this._cacheTransformEventData(e),2==t&&"dblclick"===e.type&&this._handleEvent(e,"dblclick"),3==t&&this._handleEvent(e,"tripleclick"),this._resetTransformEventData())}getPointerId(e){const t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1}_isMainEvent(e){return!0===e.isPrimary||!1!==e.isPrimary&&("touchend"===e.type&&0===e.touches.length||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(e){let t=!this.allowTouchScrolling;const n=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),(this.isDrawingMode||n&&this._target===n)&&(t=!0),t&&e.preventDefault(),this._resetTransformEventData();const s=this.upperCanvasEl,i=this._getEventPrefix(),r=fx(s);HC(r,"touchend",this._onTouchEnd,WC),t&&HC(r,"touchmove",this._onMouseMove,WC),UC(s,"".concat(i,"down"),this._onMouseDown)}_onMouseDown(e){this.__onMouseDown(e),this._resetTransformEventData();const t=this.upperCanvasEl,n=this._getEventPrefix();UC(t,"".concat(n,"move"),this._onMouseMove,WC);const s=fx(t);HC(s,"".concat(n,"up"),this._onMouseUp),HC(s,"".concat(n,"move"),this._onMouseMove,WC)}_onTouchEnd(e){if(e.touches.length>0)return;this.__onMouseUp(e),this._resetTransformEventData(),delete this.mainTouchId;const t=this._getEventPrefix(),n=fx(this.upperCanvasEl);UC(n,"touchend",this._onTouchEnd,WC),UC(n,"touchmove",this._onMouseMove,WC),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{HC(this.upperCanvasEl,"".concat(t,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(e){this.__onMouseUp(e),this._resetTransformEventData();const t=this.upperCanvasEl,n=this._getEventPrefix();if(this._isMainEvent(e)){const e=fx(this.upperCanvasEl);UC(e,"".concat(n,"up"),this._onMouseUp),UC(e,"".concat(n,"move"),this._onMouseMove,WC),HC(t,"".concat(n,"move"),this._onMouseMove,WC)}}_onMouseMove(e){const t=this.getActiveObject();!this.allowTouchScrolling&&(!t||!t.shouldStartDragging(e))&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(e){const t=this.getActiveObject();return!!t!=!!e||t&&e&&t!==e}__onMouseUp(e){var t;this._cacheTransformEventData(e),this._handleEvent(e,"up:before");const n=this._currentTransform,s=this._isClick,i=this._target,{button:r}=e;if(r)return(this.fireMiddleClick&&1===r||this.fireRightClick&&2===r)&&this._handleEvent(e,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(e);if(!this._isMainEvent(e))return;let a,o,l=!1;if(n&&(this._finalizeCurrentTransform(e),l=n.actionPerformed),!s){const t=i===this._activeObject;this.handleSelection(e),l||(l=this._shouldRender(i)||!t&&i===this._activeObject)}if(i){const t=i.findControl(this.getViewportPoint(e),_x(e)),{key:s,control:r}=t||{};if(o=s,i.selectable&&i!==this._activeObject&&"up"===i.activeOn)this.setActiveObject(i,e),l=!0;else if(r){const t=r.getMouseUpHandler(e,i,r);t&&(a=this.getScenePoint(e),t.call(r,e,n,a.x,a.y))}i.isMoving=!1}if(n&&(n.target!==i||n.corner!==o)){const t=n.target&&n.target.controls[n.corner],s=t&&t.getMouseUpHandler(e,n.target,t);a=a||this.getScenePoint(e),s&&s.call(t,e,n,a.x,a.y)}this._setCursorFromEvent(e,i),this._handleEvent(e,"up"),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=void 0),l?this.requestRenderAll():s||null!==(t=this._activeObject)&&void 0!==t&&t.isEditing||this.renderTop()}_basicEventHandler(e,t){const{target:n,subTargets:s=[]}=t;this.fire(e,t),n&&n.fire(e,t);for(let i=0;i<s.length;i++)s[i]!==n&&s[i].fire(e,t);return t}_handleEvent(e,t,n){const s=this._target,i=this.targets||[],r=wy(wy(wy({e:e,target:s,subTargets:i},BC(this,e)),{},{transform:this._currentTransform},"up:before"===t||"up"===t?{isClick:this._isClick,currentTarget:this.findTarget(e),currentSubTargets:this.targets}:{}),"down:before"===t||"down"===t?n:{});this.fire("mouse:".concat(t),r),s&&s.fire("mouse".concat(t),r);for(let a=0;a<i.length;a++)i[a]!==s&&i[a].fire("mouse".concat(t),r)}_onMouseDownInDrawingMode(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(e),this.requestRenderAll());const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(t,{e:e,pointer:t}),this._handleEvent(e,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(e){if(this._isCurrentlyDrawing){const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(t,{e:e,pointer:t})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")}_onMouseUpInDrawingMode(e){const t=this.getScenePoint(e);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:e,pointer:t}):this._isCurrentlyDrawing=!1,this._handleEvent(e,"up")}__onMouseDown(e){this._isClick=!0,this._cacheTransformEventData(e),this._handleEvent(e,"down:before");let t=this._target,n=!!t&&t===this._activeObject;const{button:s}=e;if(s)return(this.fireMiddleClick&&1===s||this.fireRightClick&&2===s)&&this._handleEvent(e,"down",{alreadySelected:n}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(e);if(!this._isMainEvent(e))return;if(this._currentTransform)return;let i=this._shouldRender(t),r=!1;if(this.handleMultiSelection(e,t)?(t=this._activeObject,r=!0,i=!0):this._shouldClearSelection(e,t)&&this.discardActiveObject(e),this.selection&&(!t||!t.selectable&&!t.isEditing&&t!==this._activeObject)){const t=this.getScenePoint(e);this._groupSelector={x:t.x,y:t.y,deltaY:0,deltaX:0}}if(n=!!t&&t===this._activeObject,t){t.selectable&&"down"===t.activeOn&&this.setActiveObject(t,e);const s=t.findControl(this.getViewportPoint(e),_x(e));if(t===this._activeObject&&(s||!r)){this._setupCurrentTransform(e,t,n);const i=s?s.control:void 0,r=this.getScenePoint(e),a=i&&i.getMouseDownHandler(e,t,i);a&&a.call(i,e,this._currentTransform,r.x,r.y)}}i&&(this._objectsToRender=void 0),this._handleEvent(e,"down",{alreadySelected:n}),i&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(e){this._resetTransformEventData(),this._pointer=this.getViewportPoint(e),this._absolutePointer=Dx(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)}__onMouseMove(e){if(this._isClick=!1,this._cacheTransformEventData(e),this._handleEvent(e,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);if(!this._isMainEvent(e))return;const t=this._groupSelector;if(t){const n=this.getScenePoint(e);t.deltaX=n.x-t.x,t.deltaY=n.y-t.y,this.renderTop()}else if(this._currentTransform)this._transformObject(e);else{const t=this.findTarget(e);this._setCursorFromEvent(e,t),this._fireOverOutEvents(e,t)}this.textEditingManager.onMouseMove(e),this._handleEvent(e,"move"),this._resetTransformEventData()}_fireOverOutEvents(e,t){const n=this._hoveredTarget,s=this._hoveredTargets,i=this.targets,r=Math.max(s.length,i.length);this.fireSyntheticInOutEvents("mouse",{e:e,target:t,oldTarget:n,fireCanvas:!0});for(let a=0;a<r;a++)this.fireSyntheticInOutEvents("mouse",{e:e,target:i[a],oldTarget:s[a]});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(e,t){const n=this._draggedoverTarget,s=this._hoveredTargets,i=this.targets,r=Math.max(s.length,i.length);this.fireSyntheticInOutEvents("drag",wy(wy({},t),{},{target:e,oldTarget:n,fireCanvas:!0}));for(let a=0;a<r;a++)this.fireSyntheticInOutEvents("drag",wy(wy({},t),{},{target:i[a],oldTarget:s[a]}));this._draggedoverTarget=e}fireSyntheticInOutEvents(e,t){let{target:n,oldTarget:s,fireCanvas:i,e:r}=t,a=Sy(t,zC);const{targetIn:o,targetOut:l,canvasIn:c,canvasOut:h}=VC[e],u=s!==n;if(s&&u){const e=wy(wy({},a),{},{e:r,target:s,nextTarget:n},BC(this,r));i&&this.fire(h,e),s.fire(l,e)}if(n&&u){const e=wy(wy({},a),{},{e:r,target:n,previousTarget:s},BC(this,r));i&&this.fire(c,e),n.fire(o,e)}}__onMouseWheel(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()}_transformObject(e){const t=this.getScenePoint(e),n=this._currentTransform,s=n.target,i=s.group?Dx(t,void 0,s.group.calcTransformMatrix()):t;n.shiftKey=e.shiftKey,n.altKey=!!this.centeredKey&&e[this.centeredKey],this._performTransformAction(e,n,i),n.actionPerformed&&this.requestRenderAll()}_performTransformAction(e,t,n){const{action:s,actionHandler:i,target:r}=t,a=!!i&&i(e,t,n.x,n.y);a&&r.setCoords(),"drag"===s&&a&&(t.target.isMoving=!0,this.setCursor(t.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||a}_setCursorFromEvent(e,t){if(!t)return void this.setCursor(this.defaultCursor);let n=t.hoverCursor||this.hoverCursor;const s=ux(this._activeObject)?this._activeObject:null,i=(!s||t.group!==s)&&t.findControl(this.getViewportPoint(e));if(i){const n=i.control;this.setCursor(n.cursorStyleHandler(e,n,t))}else t.subTargetCheck&&this.targets.concat().reverse().map(e=>{n=e.hoverCursor||n}),this.setCursor(n)}handleMultiSelection(e,t){const n=this._activeObject,s=ux(n);if(n&&this._isSelectionKeyPressed(e)&&this.selection&&t&&t.selectable&&(n!==t||s)&&(s||!t.isDescendantOf(n)&&!n.isDescendantOf(t))&&!t.onSelect({e:e})&&!n.getActiveControl()){if(s){const s=n.getObjects();if(t===n){const n=this.getViewportPoint(e);if(!(t=this.searchPossibleTargets(s,n)||this.searchPossibleTargets(this._objects,n))||!t.selectable)return!1}t.group===n?(n.remove(t),this._hoveredTarget=t,this._hoveredTargets=[...this.targets],1===n.size()&&this._setActiveObject(n.item(0),e)):(n.multiSelectAdd(t),this._hoveredTarget=n,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(s,e)}else{n.isEditing&&n.exitEditing();const s=new(yb.getClass("ActiveSelection"))([],{canvas:this});s.multiSelectAdd(n,t),this._hoveredTarget=s,this._setActiveObject(s,e),this._fireSelectionEvents([n],e)}return!0}return!1}handleSelection(e){if(!this.selection||!this._groupSelector)return!1;const{x:t,y:n,deltaX:s,deltaY:i}=this._groupSelector,r=new Cb(t,n),a=r.add(new Cb(s,i)),o=r.min(a),l=r.max(a).subtract(o),c=this.collectObjects({left:o.x,top:o.y,width:l.x,height:l.y},{includeIntersecting:!this.selectionFullyContained}),h=r.eq(a)?c[0]?[c[0]]:[]:c.length>1?c.filter(t=>!t.onSelect({e:e})).reverse():c;if(1===h.length)this.setActiveObject(h[0],e);else if(h.length>1){const t=yb.getClass("ActiveSelection");this.setActiveObject(new t(h,{canvas:this}),e)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const XC={x1:0,y1:0,x2:0,y2:0},YC=wy(wy({},XC),{},{r1:0,r2:0}),qC=(e,t)=>isNaN(e)&&"number"==typeof t?t:e,KC=/^(\d+\.\d+)%|(\d+)%$/;function QC(e){return e&&KC.test(e)}function $C(e,t){const n="number"==typeof e?e:"string"==typeof e?parseFloat(e)/(QC(e)?100:1):NaN;return Bw(0,qC(n,t),1)}const JC=/\s*;\s*/,ZC=/\s*:\s*/;function ek(e,t){let n,s;const i=e.getAttribute("style");if(i){const e=i.split(JC);""===e[e.length-1]&&e.pop();for(let t=e.length;t--;){const[i,r]=e[t].split(ZC).map(e=>e.trim());"stop-color"===i?n=r:"stop-opacity"===i&&(s=r)}}const r=new Zx(n||e.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:$C(e.getAttribute("offset"),0),color:r.toRgb(),opacity:qC(parseFloat(s||e.getAttribute("stop-opacity")||""),1)*r.getAlpha()*t}}function tk(e,t){const n=[],s=e.getElementsByTagName("stop"),i=$C(t,1);for(let r=s.length;r--;)n.push(ek(s[r],i));return n}function nk(e){return"linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?"linear":"radial"}function sk(e){return"userSpaceOnUse"===e.getAttribute("gradientUnits")?"pixels":"percentage"}function ik(e,t){return e.getAttribute(t)}function rk(e,t){return function(e,t){let n,{width:s,height:i,gradientUnits:r}=t;return Object.keys(e).reduce((t,a)=>{const o=e[a];return"Infinity"===o?n=1:"-Infinity"===o?n=0:(n="string"==typeof o?parseFloat(o):o,"string"==typeof o&&QC(o)&&(n*=.01,"pixels"===r&&("x1"!==a&&"x2"!==a&&"r2"!==a||(n*=s),"y1"!==a&&"y2"!==a||(n*=i)))),t[a]=n,t},{})}("linear"===nk(e)?function(e){return{x1:ik(e,"x1")||0,y1:ik(e,"y1")||0,x2:ik(e,"x2")||"100%",y2:ik(e,"y2")||0}}(e):function(e){return{x1:ik(e,"fx")||ik(e,"cx")||"50%",y1:ik(e,"fy")||ik(e,"cy")||"50%",r1:0,x2:ik(e,"cx")||"50%",y2:ik(e,"cy")||"50%",r2:ik(e,"r")||"50%"}}(e),wy(wy({},t),{},{gradientUnits:sk(e)}))}class ak{constructor(e){const{type:t="linear",gradientUnits:n="pixels",coords:s={},colorStops:i=[],offsetX:r=0,offsetY:a=0,gradientTransform:o,id:l}=e||{};Object.assign(this,{type:t,gradientUnits:n,coords:wy(wy({},"radial"===t?YC:XC),s),colorStops:i,offsetX:r,offsetY:a,gradientTransform:o,id:l?"".concat(l,"_").concat(Ob()):Ob()})}addColorStop(e){for(const t in e){const n=new Zx(e[t]);this.colorStops.push({offset:parseFloat(t),color:n.toRgb(),opacity:n.getAlpha()})}return this}toObject(e){return wy(wy({},ix(this,e)),{},{type:this.type,coords:wy({},this.coords),colorStops:this.colorStops.map(e=>wy({},e)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(e){let{additionalTransform:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[],s=this.gradientTransform?this.gradientTransform.concat():Uy.concat(),i="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",r=this.colorStops.map(e=>wy({},e)).sort((e,t)=>e.offset-t.offset);let a=-this.offsetX,o=-this.offsetY;var l;"objectBoundingBox"===i?(a/=e.width,o/=e.height):(a+=e.width/2,o+=e.height/2),(l=e)&&"function"==typeof l._renderPathCommands&&"percentage"!==this.gradientUnits&&(a-=e.pathOffset.x,o-=e.pathOffset.y),s[4]-=a,s[5]-=o;const c=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(i,'"'),'gradientTransform="'.concat(t?t+" ":"").concat(ox(s),'"'),""].join(" ");if("linear"===this.type){const{x1:e,y1:t,x2:s,y2:i}=this.coords;n.push("<linearGradient ",c,' x1="',e,'" y1="',t,'" x2="',s,'" y2="',i,'">\n')}else if("radial"===this.type){const{x1:e,y1:t,x2:s,y2:i,r1:a,r2:o}=this.coords,l=a>o;n.push("<radialGradient ",c,' cx="',l?e:s,'" cy="',l?t:i,'" r="',l?a:o,'" fx="',l?s:e,'" fy="',l?i:t,'">\n'),l&&(r.reverse(),r.forEach(e=>{e.offset=1-e.offset}));const h=Math.min(a,o);if(h>0){const e=h/Math.max(a,o);r.forEach(t=>{t.offset+=e*(1-t.offset)})}}return r.forEach(e=>{let{color:t,offset:s,opacity:i}=e;n.push("<stop ",'offset="',100*s+"%",'" style="stop-color:',t,void 0!==i?";stop-opacity: "+i:";",'"/>\n')}),n.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),n.join("")}toLive(e){const{x1:t,y1:n,x2:s,y2:i,r1:r,r2:a}=this.coords,o="linear"===this.type?e.createLinearGradient(t,n,s,i):e.createRadialGradient(t,n,r,s,i,a);return this.colorStops.forEach(e=>{let{color:t,opacity:n,offset:s}=e;o.addColorStop(s,void 0!==n?new Zx(t).setAlpha(n).toRgba():t)}),o}static async fromObject(e){const{colorStops:t,gradientTransform:n}=e;return new this(wy(wy({},e),{},{colorStops:t?t.map(e=>wy({},e)):void 0,gradientTransform:n?[...n]:void 0}))}static fromElement(e,t,n){const s=sk(e),i=t._findCenterFromElement();return new this(wy({id:e.getAttribute("id")||void 0,type:nk(e),coords:rk(e,{width:n.viewBoxWidth||n.width,height:n.viewBoxHeight||n.height}),colorStops:tk(e,n.opacity),gradientUnits:s,gradientTransform:L_(e.getAttribute("gradientTransform")||"")},"pixels"===s?{offsetX:t.width/2-i.x,offsetY:t.height/2-i.y}:{offsetX:0,offsetY:0}))}}by(ak,"type","Gradient"),yb.setClass(ak,"gradient"),yb.setClass(ak,"linear"),yb.setClass(ak,"radial");const ok=["type","source","patternTransform"];class lk{get type(){return"pattern"}set type(e){Ay("warn","Setting type has no effect",e)}constructor(e){by(this,"repeat","repeat"),by(this,"offsetX",0),by(this,"offsetY",0),by(this,"crossOrigin",""),this.id=Ob(),Object.assign(this,e)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(e){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?e.createPattern(this.source,this.repeat):null}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{repeat:t,crossOrigin:n}=this;return wy(wy({},ix(this,e)),{},{type:"pattern",source:this.sourceToString(),repeat:t,crossOrigin:n,offsetX:ax(this.offsetX,ky.NUM_FRACTION_DIGITS),offsetY:ax(this.offsetY,ky.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(e){let{width:t,height:n}=e;const{source:s,repeat:i,id:r}=this,a=qC(this.offsetX/t,0),o=qC(this.offsetY/n,0),l="repeat-y"===i||"no-repeat"===i?1+Math.abs(a||0):qC(s.width/t,0),c="repeat-x"===i||"no-repeat"===i?1+Math.abs(o||0):qC(s.height/n,0);return['<pattern id="SVGID_'.concat(r,'" x="').concat(a,'" y="').concat(o,'" width="').concat(l,'" height="').concat(c,'">'),'<image x="0" y="0" width="'.concat(s.width,'" height="').concat(s.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static async fromObject(e,t){let{type:n,source:s,patternTransform:i}=e,r=Sy(e,ok);const a=await tx(s,wy(wy({},t),{},{crossOrigin:r.crossOrigin}));return new this(wy(wy({},r),{},{patternTransform:i&&i.slice(0),source:a}))}}by(lk,"type","Pattern"),yb.setClass(lk),yb.setClass(lk,"pattern");class ck{constructor(e){by(this,"color","rgb(0, 0, 0)"),by(this,"width",1),by(this,"shadow",null),by(this,"strokeLineCap","round"),by(this,"strokeLineJoin","round"),by(this,"strokeMiterLimit",10),by(this,"strokeDashArray",null),by(this,"limitedToCanvasSize",!1),this.canvas=e}_setBrushStyles(e){e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,e.setLineDash(this.strokeDashArray||[])}_saveAndTransform(e){const t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])}needsFullRender(){return new Zx(this.color).getAlpha()<1||!!this.shadow}_setShadow(){if(!this.shadow||!this.canvas)return;const e=this.canvas,t=this.shadow,n=e.contextTop,s=e.getZoom()*e.getRetinaScaling();n.shadowColor=t.color,n.shadowBlur=t.blur*s,n.shadowOffsetX=t.offsetX*s,n.shadowOffsetY=t.offsetY*s}_resetShadow(){const e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}_isOutSideCanvas(e){return e.x<0||e.x>this.canvas.getWidth()||e.y<0||e.y>this.canvas.getHeight()}}const hk=["path","left","top"],uk=["d"];class dk extends YS{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:n,left:s,top:i}=t,r=Sy(t,hk);super(),Object.assign(this,dk.ownDefaults),this.setOptions(r),this._setPath(e||[],!0),"number"==typeof s&&this.set(Yy,s),"number"==typeof i&&this.set(qy,i)}_setPath(e,t){this.path=fC(Array.isArray(e)?e:MC(e)),this.setBoundingBox(t)}_findCenterFromElement(){const e=this._calcBoundsFromPath();return new Cb(e.left+e.width/2,e.top+e.height/2)}_renderPathCommands(e){const t=-this.pathOffset.x,n=-this.pathOffset.y;e.beginPath();for(const s of this.path)switch(s[0]){case"L":e.lineTo(s[1]+t,s[2]+n);break;case"M":e.moveTo(s[1]+t,s[2]+n);break;case"C":e.bezierCurveTo(s[1]+t,s[2]+n,s[3]+t,s[4]+n,s[5]+t,s[6]+n);break;case"Q":e.quadraticCurveTo(s[1]+t,s[2]+n,s[3]+t,s[4]+n);break;case"Z":e.closePath()}}_render(e){this._renderPathCommands(e),this._renderPaintInOrder(e)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return wy(wy({},super.toObject(e)),{},{path:this.path.map(e=>e.slice())})}toDatalessObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.toObject(e);return this.sourcePath&&(delete t.path,t.sourcePath=this.sourcePath),t}_toSVG(){const e=PC(this.path,ky.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(e,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){const e=ky.NUM_FRACTION_DIGITS;return" translate(".concat(ax(-this.pathOffset.x,e),", ").concat(ax(-this.pathOffset.y,e),")")}toClipPathSVG(e){const t=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}toSVG(e){const t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{width:t,height:n,pathOffset:s}=this._calcDimensions();this.set({width:t,height:n,pathOffset:s}),e&&this.setPositionByOrigin(s,Xy,Xy)}_calcBoundsFromPath(){const e=[];let t=0,n=0,s=0,i=0;for(const r of this.path)switch(r[0]){case"L":s=r[1],i=r[2],e.push({x:t,y:n},{x:s,y:i});break;case"M":s=r[1],i=r[2],t=s,n=i;break;case"C":e.push(...uC(s,i,r[1],r[2],r[3],r[4],r[5],r[6])),s=r[5],i=r[6];break;case"Q":e.push(...uC(s,i,r[1],r[2],r[1],r[2],r[3],r[4])),s=r[3],i=r[4];break;case"Z":s=t,i=n}return kx(e)}_calcDimensions(){const e=this._calcBoundsFromPath();return wy(wy({},e),{},{pathOffset:new Cb(e.left+e.width/2,e.top+e.height/2)})}static fromObject(e){return this._fromObject(e,{extraParam:"path"})}static async fromElement(e,t,n){const s=z_(e,this.ATTRIBUTE_NAMES,n),{d:i}=s;return new this(i,wy(wy(wy({},Sy(s,uk)),t),{},{left:void 0,top:void 0}))}}by(dk,"type","Path"),by(dk,"cacheProperties",[...Uw,"path","fillRule"]),by(dk,"ATTRIBUTE_NAMES",[...h_,"d"]),yb.setClass(dk),yb.setSVGClass(dk);class fk extends ck{constructor(e){super(e),by(this,"decimate",.4),by(this,"drawStraightLine",!1),by(this,"straightLineKey","shiftKey"),this._points=[],this._hasStraightLine=!1}needsFullRender(){return super.needsFullRender()||this._hasStraightLine}static drawSegment(e,t,n){const s=t.midPointFrom(n);return e.quadraticCurveTo(t.x,t.y,s.x,s.y),s}onMouseDown(e,t){let{e:n}=t;this.canvas._isMainEvent(n)&&(this.drawStraightLine=!!this.straightLineKey&&n[this.straightLineKey],this._prepareForDrawing(e),this._addPoint(e),this._render())}onMouseMove(e,t){let{e:n}=t;if(this.canvas._isMainEvent(n)&&(this.drawStraightLine=!!this.straightLineKey&&n[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(e))&&this._addPoint(e)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{const e=this._points,t=e.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=fk.drawSegment(n,e[t-2],e[t-1]),n.stroke(),n.restore()}}onMouseUp(e){let{e:t}=e;return!this.canvas._isMainEvent(t)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)}_prepareForDrawing(e){this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)}_addPoint(e){return!(this._points.length>1&&e.eq(this._points[this._points.length-1]))&&(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(e),!0)}_reset(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1}_render(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvas.contextTop,t=this._points[0],n=this._points[1];if(this._saveAndTransform(e),e.beginPath(),2===this._points.length&&t.x===n.x&&t.y===n.y){const e=this.width/1e3;t.x-=e,n.x+=e}e.moveTo(t.x,t.y);for(let s=1;s<this._points.length;s++)fk.drawSegment(e,t,n),t=this._points[s],n=this._points[s+1];e.lineTo(t.x,t.y),e.stroke(),e.restore()}convertPointsToSVGPath(e){const t=this.width/1e3;return jC(e,t)}createPath(e){const t=new dk(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new Ww(this.shadow)),t}decimatePoints(e,t){if(e.length<=2)return e;let n,s=e[0];const i=this.canvas.getZoom(),r=Math.pow(t/i,2),a=e.length-1,o=[s];for(let l=1;l<a-1;l++)n=Math.pow(s.x-e[l].x,2)+Math.pow(s.y-e[l].y,2),n>=r&&(s=e[l],o.push(s));return o.push(e[a]),o}_finalizeAndAddPath(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));const e=this.convertPointsToSVGPath(this._points);if(function(e){return"M 0 0 Q 0 0 0 0 L 0 0"===PC(e)}(e))return void this.canvas.requestRenderAll();const t=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:t}),this.canvas.add(t),this.canvas.requestRenderAll(),t.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:t})}}const pk=["left","top","radius"],gk=["radius","startAngle","endAngle","counterClockwise"];class mk extends YS{static getDefaults(){return wy(wy({},super.getDefaults()),mk.ownDefaults)}constructor(e){super(),Object.assign(this,mk.ownDefaults),this.setOptions(e)}_set(e,t){return super._set(e,t),"radius"===e&&this.setRadius(t),this}_render(e){e.beginPath(),e.arc(0,0,this.radius,Ib(this.startAngle),Ib(this.endAngle),this.counterClockwise),this._renderPaintInOrder(e)}getRadiusX(){return this.get("radius")*this.get(cb)}getRadiusY(){return this.get("radius")*this.get(hb)}setRadius(e){this.radius=e,this.set({width:2*e,height:2*e})}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...gk,...e])}_toSVG(){const e=(this.endAngle-this.startAngle)%360;if(0===e)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{const{radius:t}=this,n=Ib(this.startAngle),s=Ib(this.endAngle),i=Sb(n)*t,r=_b(n)*t,a=Sb(s)*t,o=_b(s)*t,l=e>180?1:0,c=this.counterClockwise?0:1;return['<path d="M '.concat(i," ").concat(r," A ").concat(t," ").concat(t," 0 ").concat(l," ").concat(c," ").concat(a," ").concat(o,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(e,t,n){const s=z_(e,this.ATTRIBUTE_NAMES,n),{left:i=0,top:r=0,radius:a=0}=s;return new this(wy(wy({},Sy(s,pk)),{},{radius:a,left:i-a,top:r-a}))}static fromObject(e){return super._fromObject(e)}}by(mk,"type","Circle"),by(mk,"cacheProperties",[...Uw,...gk]),by(mk,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),by(mk,"ATTRIBUTE_NAMES",["cx","cy","r",...h_]),yb.setClass(mk),yb.setSVGClass(mk);const vk=["x1","y1","x2","y2"],yk=["x1","y1","x2","y2"],bk=["x1","x2","y1","y2"];class xk extends YS{constructor(){let[e,t,n,s]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,xk.ownDefaults),this.setOptions(i),this.x1=e,this.x2=n,this.y1=t,this.y2=s,this._setWidthHeight();const{left:r,top:a}=i;"number"==typeof r&&this.set(Yy,r),"number"==typeof a&&this.set(qy,a)}_setWidthHeight(){const{x1:e,y1:t,x2:n,y2:s}=this;this.width=Math.abs(n-e),this.height=Math.abs(s-t);const{left:i,top:r,width:a,height:o}=kx([{x:e,y:t},{x:n,y:s}]),l=new Cb(i+a/2,r+o/2);this.setPositionByOrigin(l,Xy,Xy)}_set(e,t){return super._set(e,t),bk.includes(e)&&this._setWidthHeight(),this}_render(e){e.beginPath();const t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineWidth=this.strokeWidth;const n=e.strokeStyle;var s;lx(this.stroke)?e.strokeStyle=this.stroke.toLive(e):e.strokeStyle=null!==(s=this.stroke)&&void 0!==s?s:e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=n}_findCenterFromElement(){return new Cb((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return wy(wy({},super.toObject(e)),this.calcLinePoints())}_getNonTransformedDimensions(){const e=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(e.y-=this.strokeWidth),0===this.height&&(e.x-=this.strokeWidth)),e}calcLinePoints(){const{x1:e,x2:t,y1:n,y2:s,width:i,height:r}=this,a=e<=t?-1:1,o=n<=s?-1:1;return{x1:a*i/2,x2:a*-i/2,y1:o*r/2,y2:o*-r/2}}_toSVG(){const{x1:e,x2:t,y1:n,y2:s}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(e,'" y1="').concat(n,'" x2="').concat(t,'" y2="').concat(s,'" />\n')]}static async fromElement(e,t,n){const s=z_(e,this.ATTRIBUTE_NAMES,n),{x1:i=0,y1:r=0,x2:a=0,y2:o=0}=s;return new this([i,r,a,o],Sy(s,vk))}static fromObject(e){let{x1:t,y1:n,x2:s,y2:i}=e,r=Sy(e,yk);return this._fromObject(wy(wy({},r),{},{points:[t,n,s,i]}),{extraParam:"points"})}}by(xk,"type","Line"),by(xk,"cacheProperties",[...Uw,...bk]),by(xk,"ATTRIBUTE_NAMES",h_.concat(bk)),yb.setClass(xk),yb.setSVGClass(xk);class wk extends YS{static getDefaults(){return wy(wy({},super.getDefaults()),wk.ownDefaults)}constructor(e){super(),Object.assign(this,wk.ownDefaults),this.setOptions(e)}_render(e){const t=this.width/2,n=this.height/2;e.beginPath(),e.moveTo(-t,n),e.lineTo(0,-n),e.lineTo(t,n),e.closePath(),this._renderPaintInOrder(e)}_toSVG(){const e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-e," ").concat(t,",0 ").concat(-t,",").concat(e," ").concat(t),'" />']}}by(wk,"type","Triangle"),by(wk,"ownDefaults",{width:100,height:100}),yb.setClass(wk),yb.setSVGClass(wk);const Sk=["rx","ry"];class _k extends YS{static getDefaults(){return wy(wy({},super.getDefaults()),_k.ownDefaults)}constructor(e){super(),Object.assign(this,_k.ownDefaults),this.setOptions(e)}_set(e,t){switch(super._set(e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this}getRx(){return this.get("rx")*this.get(cb)}getRy(){return this.get("ry")*this.get(hb)}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Sk,...e])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,By,!1),e.restore(),this._renderPaintInOrder(e)}static async fromElement(e,t,n){const s=z_(e,this.ATTRIBUTE_NAMES,n);return s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,new this(s)}}by(_k,"type","Ellipse"),by(_k,"cacheProperties",[...Uw,...Sk]),by(_k,"ownDefaults",{rx:0,ry:0}),by(_k,"ATTRIBUTE_NAMES",[...h_,"cx","cy","rx","ry"]),yb.setClass(_k),yb.setSVGClass(_k);const Ck=["left","top"],kk={exactBoundingBox:!1};class Ak extends YS{static getDefaults(){return wy(wy({},super.getDefaults()),Ak.ownDefaults)}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),by(this,"strokeDiff",void 0),Object.assign(this,Ak.ownDefaults),this.setOptions(t),this.points=e;const{left:n,top:s}=t;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof n&&this.set(Yy,n),"number"==typeof s&&this.set(qy,s)}isOpen(){return!0}_projectStrokeOnPoints(e){return ZS(this.points,e,this.isOpen())}_calcDimensions(e){e=wy({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},e||{});const t=this.exactBoundingBox?this._projectStrokeOnPoints(e).map(e=>e.projectedPoint):this.points;if(0===t.length)return{left:0,top:0,width:0,height:0,pathOffset:new Cb,strokeOffset:new Cb,strokeDiff:new Cb};const n=kx(t),s=Zb(wy(wy({},e),{},{scaleX:1,scaleY:1})),i=kx(this.points.map(e=>Bb(e,s,!0))),r=new Cb(this.scaleX,this.scaleY);let a=n.left+n.width/2,o=n.top+n.height/2;return this.exactBoundingBox&&(a-=o*Math.tan(Ib(this.skewX)),o-=a*Math.tan(Ib(this.skewY))),wy(wy({},n),{},{pathOffset:new Cb(a,o),strokeOffset:new Cb(i.left,i.top).subtract(new Cb(n.left,n.top)).multiply(r),strokeDiff:new Cb(n.width,n.height).subtract(new Cb(i.width,i.height)).multiply(r)})}_findCenterFromElement(){const e=kx(this.points);return new Cb(e.left+e.width/2,e.top+e.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{left:t,top:n,width:s,height:i,pathOffset:r,strokeOffset:a,strokeDiff:o}=this._calcDimensions();this.set({width:s,height:i,pathOffset:r,strokeOffset:a,strokeDiff:o}),e&&this.setPositionByOrigin(new Cb(t+s/2,n+i/2),Xy,Xy)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new Cb(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){let r;if(Object.keys(e).some(e=>this.strokeUniform||this.constructor.layoutProperties.includes(e))){var t,n;const{width:s,height:i}=this._calcDimensions(e);r=new Cb(null!==(t=e.width)&&void 0!==t?t:s,null!==(n=e.height)&&void 0!==n?n:i)}else{var s,i;r=new Cb(null!==(s=e.width)&&void 0!==s?s:this.width,null!==(i=e.height)&&void 0!==i?i:this.height)}return r.multiply(new Cb(e.scaleX||this.scaleX,e.scaleY||this.scaleY))}return super._getTransformedDimensions(e)}_set(e,t){const n=this.initialized&&this[e]!==t,s=super._set(e,t);return this.exactBoundingBox&&n&&((e===cb||e===hb)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(e))&&this.setDimensions(),s}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return wy(wy({},super.toObject(e)),{},{points:this.points.map(e=>{let{x:t,y:n}=e;return{x:t,y:n}})})}_toSVG(){const e=[],t=this.pathOffset.x,n=this.pathOffset.y,s=ky.NUM_FRACTION_DIGITS;for(let i=0,r=this.points.length;i<r;i++)e.push(ax(this.points[i].x-t,s),",",ax(this.points[i].y-n,s)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(e.join(""),'" />\n')]}_render(e){const t=this.points.length,n=this.pathOffset.x,s=this.pathOffset.y;if(t&&!isNaN(this.points[t-1].y)){e.beginPath(),e.moveTo(this.points[0].x-n,this.points[0].y-s);for(let i=0;i<t;i++){const t=this.points[i];e.lineTo(t.x-n,t.y-s)}!this.isOpen()&&e.closePath(),this._renderPaintInOrder(e)}}complexity(){return this.points.length}static async fromElement(e,t,n){return new this(function(e){if(!e)return[];const t=e.replace(/,/g," ").trim().split(/\s+/),n=[];for(let s=0;s<t.length;s+=2)n.push({x:parseFloat(t[s]),y:parseFloat(t[s+1])});return n}(e.getAttribute("points")),wy(wy({},Sy(z_(e,this.ATTRIBUTE_NAMES,n),Ck)),t))}static fromObject(e){return this._fromObject(e,{extraParam:"points"})}}by(Ak,"ownDefaults",kk),by(Ak,"type","Polyline"),by(Ak,"layoutProperties",[ub,db,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),by(Ak,"cacheProperties",[...Uw,"points"]),by(Ak,"ATTRIBUTE_NAMES",[...h_]),yb.setClass(Ak),yb.setSVGClass(Ak);class Ek extends Ak{isOpen(){return!1}}by(Ek,"ownDefaults",kk),by(Ek,"type","Polygon"),yb.setClass(Ek),yb.setSVGClass(Ek);class Tk extends YS{isEmptyStyles(e){if(!this.styles)return!0;if(void 0!==e&&!this.styles[e])return!0;const t=void 0===e?this.styles:{line:this.styles[e]};for(const n in t)for(const e in t[n])for(const s in t[n][e])return!1;return!0}styleHas(e,t){if(!this.styles)return!1;if(void 0!==t&&!this.styles[t])return!1;const n=void 0===t?this.styles:{0:this.styles[t]};for(const s in n)for(const t in n[s])if(void 0!==n[s][t][e])return!0;return!1}cleanStyle(e){if(!this.styles)return!1;const t=this.styles;let n,s,i=0,r=!0,a=0;for(const o in t){n=0;for(const a in t[o]){const l=t[o][a]||{};i++,void 0!==l[e]?(s?l[e]!==s&&(r=!1):s=l[e],l[e]===this[e]&&delete l[e]):r=!1,0!==Object.keys(l).length?n++:delete t[o][a]}0===n&&delete t[o]}for(let o=0;o<this._textLines.length;o++)a+=this._textLines[o].length;r&&i===a&&(this[e]=s,this.removeStyle(e))}removeStyle(e){if(!this.styles)return;const t=this.styles;let n,s,i;for(s in t){for(i in n=t[s],n)delete n[i][e],0===Object.keys(n[i]).length&&delete n[i];0===Object.keys(n).length&&delete t[s]}}_extendStyles(e,t){const{lineIndex:n,charIndex:s}=this.get2DCursorLocation(e);this._getLineStyle(n)||this._setLineStyle(n);const i=rx(wy(wy({},this._getStyleDeclaration(n,s)),t),e=>void 0!==e);this._setStyleDeclaration(n,s,i)}getSelectionStyles(e,t,n){const s=[];for(let i=e;i<(t||e);i++)s.push(this.getStyleAtPosition(i,n));return s}getStyleAtPosition(e,t){const{lineIndex:n,charIndex:s}=this.get2DCursorLocation(e);return t?this.getCompleteStyleDeclaration(n,s):this._getStyleDeclaration(n,s)}setSelectionStyles(e,t,n){for(let s=t;s<(n||t);s++)this._extendStyles(s,e);this._forceClearCache=!0}_getStyleDeclaration(e,t){var n;const s=this.styles&&this.styles[e];return s&&null!==(n=s[t])&&void 0!==n?n:{}}getCompleteStyleDeclaration(e,t){return wy(wy({},ix(this,this.constructor._styleProperties)),this._getStyleDeclaration(e,t))}_setStyleDeclaration(e,t,n){this.styles[e][t]=n}_deleteStyleDeclaration(e,t){delete this.styles[e][t]}_getLineStyle(e){return!!this.styles[e]}_setLineStyle(e){this.styles[e]={}}_deleteLineStyle(e){delete this.styles[e]}}by(Tk,"_styleProperties",hw);const Mk=/  +/g,jk=/"/g;function Pk(e,t,n,s,i){return"\t\t".concat(function(e,t){let{left:n,top:s,width:i,height:r}=t,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ky.NUM_FRACTION_DIGITS;const o=nw(fb,e,!1),[l,c,h,u]=[n,s,i,r].map(e=>ax(e,a));return"<rect ".concat(o,' x="').concat(l,'" y="').concat(c,'" width="').concat(h,'" height="').concat(u,'"></rect>')}(e,{left:t,top:n,width:s,height:i}),"\n")}const Ok=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Dk;class Nk extends Tk{static getDefaults(){return wy(wy({},super.getDefaults()),Nk.ownDefaults)}constructor(e,t){super(),by(this,"__charBounds",[]),Object.assign(this,Nk.ownDefaults),this.setOptions(t),this.styles||(this.styles={}),this.text=e,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const e=this.path;e&&(e.segmentsInfo=_C(e.path))}_splitText(){const e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(dw)&&this.enlargeSpaces()}enlargeSpaces(){let e,t,n,s,i,r,a;for(let o=0,l=this._textLines.length;o<l;o++)if((this.textAlign===dw||o!==l-1&&!this.isEndOfWrapping(o))&&(s=0,i=this._textLines[o],t=this.getLineWidth(o),t<this.width&&(a=this.textLines[o].match(this._reSpacesAndTabs)))){n=a.length,e=(this.width-t)/n;for(let t=0;t<=i.length;t++)r=this.__charBounds[o][t],this._reSpaceAndTab.test(i[t])?(r.width+=e,r.kernedWidth+=e,r.left+=s,s+=e):r.left+=s}}isEndOfWrapping(e){return e===this._textLines.length-1}missingNewlineOffset(e){return 1}get2DCursorLocation(e,t){const n=t?this._unwrappedTextLines:this._textLines;let s;for(s=0;s<n.length;s++){if(e<=n[s].length)return{lineIndex:s,charIndex:e};e-=n[s].length+this.missingNewlineOffset(s,t)}return{lineIndex:s-1,charIndex:n[s-1].length<e?n[s-1].length:e}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const e=super._getCacheCanvasDimensions(),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e}_render(e){const t=this.path;t&&!t.isNotVisible()&&t._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")}_renderText(e){this.paintFirst===pb?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))}_setTextStyles(e,t,n){if(e.textBaseline="alphabetic",this.path)switch(this.pathAlign){case Xy:e.textBaseline="middle";break;case"ascender":e.textBaseline=qy;break;case"descender":e.textBaseline=Ky}e.font=this._getFontDeclaration(t,n)}calcTextWidth(){let e=this.getLineWidth(0);for(let t=1,n=this._textLines.length;t<n;t++){const n=this.getLineWidth(t);n>e&&(e=n)}return e}_renderTextLine(e,t,n,s,i,r){this._renderChars(e,t,n,s,i,r)}_renderTextLinesBackground(e){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const t=e.fillStyle,n=this._getLeftOffset();let s=this._getTopOffset();for(let i=0,r=this._textLines.length;i<r;i++){const t=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",i)){s+=t;continue}const r=this._textLines[i].length,a=this._getLineLeftOffset(i);let o,l,c=0,h=0,u=this.getValueOfPropertyAt(i,0,"textBackgroundColor");for(let d=0;d<r;d++){const r=this.__charBounds[i][d];l=this.getValueOfPropertyAt(i,d,"textBackgroundColor"),this.path?(e.save(),e.translate(r.renderLeft,r.renderTop),e.rotate(r.angle),e.fillStyle=l,l&&e.fillRect(-r.width/2,-t/this.lineHeight*(1-this._fontSizeFraction),r.width,t/this.lineHeight),e.restore()):l!==u?(o=n+a+h,"rtl"===this.direction&&(o=this.width-o-c),e.fillStyle=u,u&&e.fillRect(o,s,c,t/this.lineHeight),h=r.left,c=r.width,u=l):c+=r.kernedWidth}l&&!this.path&&(o=n+a+h,"rtl"===this.direction&&(o=this.width-o-c),e.fillStyle=l,e.fillRect(o,s,c,t/this.lineHeight)),s+=t}e.fillStyle=t,this._removeShadow(e)}_measureChar(e,t,n,s){const i=Fy.getFontCache(t),r=this._getFontDeclaration(t),a=n+e,o=n&&r===this._getFontDeclaration(s),l=t.fontSize/this.CACHE_FONT_SIZE;let c,h,u,d;if(n&&void 0!==i[n]&&(u=i[n]),void 0!==i[e]&&(d=c=i[e]),o&&void 0!==i[a]&&(h=i[a],d=h-u),void 0===c||void 0===u||void 0===h){const s=function(){if(!Dk){const e=Lb({width:0,height:0});Dk=e.getContext("2d")}return Dk}();this._setTextStyles(s,t,!0),void 0===c&&(d=c=s.measureText(e).width,i[e]=c),void 0===u&&o&&n&&(u=s.measureText(n).width,i[n]=u),o&&void 0===h&&(h=s.measureText(a).width,i[a]=h,d=h-u)}return{width:c*l,kernedWidth:d*l}}getHeightOfChar(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")}measureLine(e){const t=this._measureLine(e);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t}_measureLine(e){let t,n,s=0;const i=this.pathSide===Qy,r=this.path,a=this._textLines[e],o=a.length,l=new Array(o);this.__charBounds[e]=l;for(let c=0;c<o;c++){const i=a[c];n=this._getGraphemeBox(i,e,c,t),l[c]=n,s+=n.kernedWidth,t=i}if(l[o]={left:n?n.left+n.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},r&&r.segmentsInfo){let e=0;const t=r.segmentsInfo[r.segmentsInfo.length-1].length;switch(this.textAlign){case Yy:e=i?t-s:0;break;case Xy:e=(t-s)/2;break;case Qy:e=i?0:t-s}e+=this.pathStartOffset*(i?-1:1);for(let s=i?o-1:0;i?s>=0:s<o;i?s--:s++)n=l[s],e>t?e%=t:e<0&&(e+=t),this._setGraphemeOnPath(e,n),e+=n.kernedWidth}return{width:s,numOfSpaces:0}}_setGraphemeOnPath(e,t){const n=e+t.kernedWidth/2,s=this.path,i=CC(s.path,n,s.segmentsInfo);t.renderLeft=i.x-s.pathOffset.x,t.renderTop=i.y-s.pathOffset.y,t.angle=i.angle+(this.pathSide===Qy?Math.PI:0)}_getGraphemeBox(e,t,n,s,i){const r=this.getCompleteStyleDeclaration(t,n),a=s?this.getCompleteStyleDeclaration(t,n-1):{},o=this._measureChar(e,r,s,a);let l,c=o.kernedWidth,h=o.width;0!==this.charSpacing&&(l=this._getWidthOfCharSpacing(),h+=l,c+=l);const u={width:h,left:0,height:r.fontSize,kernedWidth:c,deltaY:r.deltaY};if(n>0&&!i){const e=this.__charBounds[t][n-1];u.left=e.left+e.width+o.kernedWidth-o.width}return u}getHeightOfLine(e){if(this.__lineHeights[e])return this.__lineHeights[e];let t=this.getHeightOfChar(e,0);for(let n=1,s=this._textLines[e].length;n<s;n++)t=Math.max(this.getHeightOfChar(e,n),t);return this.__lineHeights[e]=t*this.lineHeight*this._fontSizeMult}calcTextHeight(){let e,t=0;for(let n=0,s=this._textLines.length;n<s;n++)e=this.getHeightOfLine(n),t+=n===s-1?e/this.lineHeight:e;return t}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(e,t){e.save();let n=0;const s=this._getLeftOffset(),i=this._getTopOffset();for(let r=0,a=this._textLines.length;r<a;r++){const a=this.getHeightOfLine(r),o=a/this.lineHeight,l=this._getLineLeftOffset(r);this._renderTextLine(t,e,this._textLines[r],s+l,i+n+o,r),n+=a}e.restore()}_renderTextFill(e){(this.fill||this.styleHas(fb))&&this._renderTextCommon(e,"fillText")}_renderTextStroke(e){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())}_renderChars(e,t,n,s,i,r){const a=this.getHeightOfLine(r),o=this.textAlign.includes(dw),l=this.path,c=!o&&0===this.charSpacing&&this.isEmptyStyles(r)&&!l,h="ltr"===this.direction,u="ltr"===this.direction?1:-1,d=t.direction;let f,p,g,m,v,y="",b=0;if(t.save(),d!==this.direction&&(t.canvas.setAttribute("dir",h?"ltr":"rtl"),t.direction=h?"ltr":"rtl",t.textAlign=h?Yy:Qy),i-=a*this._fontSizeFraction/this.lineHeight,c)return this._renderChar(e,t,r,0,n.join(""),s,i),void t.restore();for(let x=0,w=n.length-1;x<=w;x++)m=x===w||this.charSpacing||l,y+=n[x],g=this.__charBounds[r][x],0===b?(s+=u*(g.kernedWidth-g.width),b+=g.width):b+=g.kernedWidth,o&&!m&&this._reSpaceAndTab.test(n[x])&&(m=!0),m||(f=f||this.getCompleteStyleDeclaration(r,x),p=this.getCompleteStyleDeclaration(r,x+1),m=o_(f,p,!1)),m&&(l?(t.save(),t.translate(g.renderLeft,g.renderTop),t.rotate(g.angle),this._renderChar(e,t,r,x,y,-b/2,0),t.restore()):(v=s,this._renderChar(e,t,r,x,y,v,i)),y="",f=p,s+=u*b,b=0);t.restore()}_applyPatternGradientTransformText(e){const t=this.width+this.strokeWidth,n=this.height+this.strokeWidth,s=Lb({width:t,height:n}),i=s.getContext("2d");return s.width=t,s.height=n,i.beginPath(),i.moveTo(0,0),i.lineTo(t,0),i.lineTo(t,n),i.lineTo(0,n),i.closePath(),i.translate(t/2,n/2),i.fillStyle=e.toLive(i),this._applyPatternGradientTransform(i,e),i.fill(),i.createPattern(s,"no-repeat")}handleFiller(e,t,n){let s,i;return lx(n)?"percentage"===n.gradientUnits||n.gradientTransform||n.patternTransform?(s=-this.width/2,i=-this.height/2,e.translate(s,i),e[t]=this._applyPatternGradientTransformText(n),{offsetX:s,offsetY:i}):(e[t]=n.toLive(e),this._applyPatternGradientTransform(e,n)):(e[t]=n,{offsetX:0,offsetY:0})}_setStrokeStyles(e,t){let{stroke:n,strokeWidth:s}=t;return e.lineWidth=s,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",n)}_setFillStyles(e,t){let{fill:n}=t;return this.handleFiller(e,"fillStyle",n)}_renderChar(e,t,n,s,i,r,a){const o=this._getStyleDeclaration(n,s),l=this.getCompleteStyleDeclaration(n,s),c="fillText"===e&&l.fill,h="strokeText"===e&&l.stroke&&l.strokeWidth;if(h||c){if(t.save(),t.font=this._getFontDeclaration(l),o.textBackgroundColor&&this._removeShadow(t),o.deltaY&&(a+=o.deltaY),c){const e=this._setFillStyles(t,l);t.fillText(i,r-e.offsetX,a-e.offsetY)}if(h){const e=this._setStrokeStyles(t,l);t.strokeText(i,r-e.offsetX,a-e.offsetY)}t.restore()}}setSuperscript(e,t){this._setScript(e,t,this.superscript)}setSubscript(e,t){this._setScript(e,t,this.subscript)}_setScript(e,t,n){const s=this.get2DCursorLocation(e,!0),i=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"fontSize"),r=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"deltaY"),a={fontSize:i*n.size,deltaY:r+i*n.baseline};this.setSelectionStyles(a,e,t)}_getLineLeftOffset(e){const t=this.getLineWidth(e),n=this.width-t,s=this.textAlign,i=this.direction,r=this.isEndOfWrapping(e);let a=0;return s===dw||s===gw&&!r||s===pw&&!r||s===fw&&!r?0:(s===Xy&&(a=n/2),s===Qy&&(a=n),s===gw&&(a=n/2),s===pw&&(a=n),"rtl"===i&&(s===Qy||s===dw||s===pw?a=0:s===Yy||s===fw?a=-n:s!==Xy&&s!==gw||(a=-n/2)),a)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(e){if(void 0!==this.__lineWidths[e])return this.__lineWidths[e];const{width:t}=this.measureLine(e);return this.__lineWidths[e]=t,t}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(e,t,n){var s;return null!==(s=this._getStyleDeclaration(e,t)[n])&&void 0!==s?s:this[n]}_renderTextDecoration(e,t){if(!this[t]&&!this.styleHas(t))return;let n=this._getTopOffset();const s=this._getLeftOffset(),i=this.path,r=this._getWidthOfCharSpacing(),a="linethrough"===t?.5:"overline"===t?1:0,o=this.offsets[t];for(let l=0,c=this._textLines.length;l<c;l++){const c=this.getHeightOfLine(l);if(!this[t]&&!this.styleHas(t,l)){n+=c;continue}const h=this._textLines[l],u=c/this.lineHeight,d=this._getLineLeftOffset(l);let f=0,p=0,g=this.getValueOfPropertyAt(l,0,t),m=this.getValueOfPropertyAt(l,0,fb),v=this.getValueOfPropertyAt(l,0,rw),y=g,b=m,x=v;const w=n+u*(1-this._fontSizeFraction);let S=this.getHeightOfChar(l,0),_=this.getValueOfPropertyAt(l,0,"deltaY");for(let n=0,r=h.length;n<r;n++){const r=this.__charBounds[l][n];y=this.getValueOfPropertyAt(l,n,t),b=this.getValueOfPropertyAt(l,n,fb),x=this.getValueOfPropertyAt(l,n,rw);const c=this.getHeightOfChar(l,n),h=this.getValueOfPropertyAt(l,n,"deltaY");if(i&&y&&b){const t=this.fontSize*x/1e3;e.save(),e.fillStyle=m,e.translate(r.renderLeft,r.renderTop),e.rotate(r.angle),e.fillRect(-r.kernedWidth/2,o*c+h-a*t,r.kernedWidth,t),e.restore()}else if((y!==g||b!==m||c!==S||x!==v||h!==_)&&p>0){const t=this.fontSize*v/1e3;let n=s+d+f;"rtl"===this.direction&&(n=this.width-n-p),g&&m&&v&&(e.fillStyle=m,e.fillRect(n,w+o*S+_-a*t,p,t)),f=r.left,p=r.width,g=y,v=x,m=b,S=c,_=h}else p+=r.kernedWidth}let C=s+d+f;"rtl"===this.direction&&(C=this.width-C-p),e.fillStyle=b;const k=this.fontSize*x/1e3;y&&b&&x&&e.fillRect(C,w+o*S+_-a*k,p-r,k),n+=c}this._removeShadow(e)}_getFontDeclaration(){let{fontFamily:e=this.fontFamily,fontStyle:t=this.fontStyle,fontWeight:n=this.fontWeight,fontSize:s=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;const r=e.includes("'")||e.includes('"')||e.includes(",")||Nk.genericFonts.includes(e.toLowerCase())?e:'"'.concat(e,'"');return[t,n,"".concat(i?this.CACHE_FONT_SIZE:s,"px"),r].join(" ")}render(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(e)))}graphemeSplit(e){return s_(e)}_splitTextIntoLines(e){const t=e.split(this._reNewline),n=new Array(t.length),s=["\n"];let i=[];for(let r=0;r<t.length;r++)n[r]=this.graphemeSplit(t[r]),i=i.concat(n[r],s);return i.pop(),{_unwrappedLines:n,lines:t,graphemeText:i,graphemeLines:n}}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return wy(wy({},super.toObject([...cw,...e])),{},{styles:l_(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(e,t){const{textLayoutProperties:n}=this.constructor;super.set(e,t);let s=!1,i=!1;if("object"==typeof e)for(const r in e)"path"===r&&this.setPathInfo(),s=s||n.includes(r),i=i||"path"===r;else s=n.includes(e),i="path"===e;return i&&this.setPathInfo(),s&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(e,t,n){const s=z_(e,Nk.ATTRIBUTE_NAMES,n),i=wy(wy({},t),s),{textAnchor:r=Yy,textDecoration:a="",dx:o=0,dy:l=0,top:c=0,left:h=0,fontSize:u=Vy,strokeWidth:d=1}=i,f=Sy(i,Ok),p=new this((e.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),wy({left:h+o,top:c+l,underline:a.includes("underline"),overline:a.includes("overline"),linethrough:a.includes("line-through"),strokeWidth:0,fontSize:u},f)),g=p.getScaledHeight()/p.height,m=((p.height+p.strokeWidth)*p.lineHeight-p.height)*g,v=p.getScaledHeight()+m;let y=0;return r===Xy&&(y=p.getScaledWidth()/2),r===Qy&&(y=p.getScaledWidth()),p.set({left:p.left-y,top:p.top-(v-p.fontSize*(.07+p._fontSizeFraction))/p.lineHeight,strokeWidth:d}),p}static fromObject(e){return this._fromObject(wy(wy({},e),{},{styles:c_(e.styles||{},e.text)}),{extraParam:"text"})}}by(Nk,"textLayoutProperties",lw),by(Nk,"cacheProperties",[...Uw,...cw]),by(Nk,"ownDefaults",uw),by(Nk,"type","Text"),by(Nk,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),by(Nk,"ATTRIBUTE_NAMES",h_.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),XS(Nk,[class extends sw{_toSVG(){const e=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(e.textTop,e.textLeft);return this._wrapSVGTextAndBg(t)}toSVG(e){const t=this._createBaseSVGMarkup(this._toSVG(),{reviver:e,noStyle:!0,withShadow:!0}),n=this.path;return n?t+n._createBaseSVGMarkup(n._toSVG(),{reviver:e,withShadow:!0,additionalTransform:ox(this.calcOwnMatrix())}):t}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(e){let{textBgRects:t,textSpans:n}=e;const s=this.getSvgTextDecoration(this);return[t.join(""),'\t\t<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(jk,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",s?'text-decoration="'.concat(s,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",n.join(""),"</text>\n"]}_getSVGTextAndBg(e,t){const n=[],s=[];let i,r=e;this.backgroundColor&&s.push(...Pk(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let a=0,o=this._textLines.length;a<o;a++)i=this._getLineLeftOffset(a),"rtl"===this.direction&&(i+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(s,a,t+i,r),this._setSVGTextLineText(n,a,t+i,r),r+=this.getHeightOfLine(a);return{textSpans:n,textBgRects:s}}_createTextCharSpan(e,t,n,s,i){const r=ky.NUM_FRACTION_DIGITS,a=this.getSvgSpanStyles(t,e!==e.trim()||!!e.match(Mk)),o=a?'style="'.concat(a,'"'):"",l=t.deltaY,c=l?' dy="'.concat(ax(l,r),'" '):"",{angle:h,renderLeft:u,renderTop:d,width:f}=i;let p="";if(void 0!==u){const e=f/2;h&&(p=' rotate="'.concat(ax(zb(h),r),'"'));const t=qb({angle:zb(h)});t[4]=u,t[5]=d;const i=new Cb(-e,0).transform(t);n=i.x,s=i.y}return'<tspan x="'.concat(ax(n,r),'" y="').concat(ax(s,r),'" ').concat(c).concat(p).concat(o,">").concat(t_(e),"</tspan>")}_setSVGTextLineText(e,t,n,s){const i=this.getHeightOfLine(t),r=this.textAlign.includes(dw),a=this._textLines[t];let o,l,c,h,u,d="",f=0;s+=i*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,g=a.length-1;p<=g;p++)u=p===g||this.charSpacing||this.path,d+=a[p],c=this.__charBounds[t][p],0===f?(n+=c.kernedWidth-c.width,f+=c.width):f+=c.kernedWidth,r&&!u&&this._reSpaceAndTab.test(a[p])&&(u=!0),u||(o=o||this.getCompleteStyleDeclaration(t,p),l=this.getCompleteStyleDeclaration(t,p+1),u=o_(o,l,!0)),u&&(h=this._getStyleDeclaration(t,p),e.push(this._createTextCharSpan(d,h,n,s,c)),d="",o=l,"rtl"===this.direction?n-=f:n+=f,f=0)}_setSVGTextLineBg(e,t,n,s){const i=this._textLines[t],r=this.getHeightOfLine(t)/this.lineHeight;let a,o=0,l=0,c=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(let h=0;h<i.length;h++){const{left:i,width:u,kernedWidth:d}=this.__charBounds[t][h];a=this.getValueOfPropertyAt(t,h,"textBackgroundColor"),a!==c?(c&&e.push(...Pk(c,n+l,s,o,r)),l=i,o=u,c=a):o+=d}a&&e.push(...Pk(c,n+l,s,o,r))}_getSVGLineTopOffset(e){let t,n=0;for(t=0;t<e;t++)n+=this.getHeightOfLine(t);const s=this.getHeightOfLine(t);return{lineTop:n,offset:(this._fontSizeMult-this._fontSizeFraction)*s/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(e){return"".concat(super.getSvgStyles(e)," text-decoration-thickness: ").concat(ax(this.textDecorationThickness*this.getObjectScaling().y/10,ky.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(e,t){const{fontFamily:n,strokeWidth:s,stroke:i,fill:r,fontSize:a,fontStyle:o,fontWeight:l,deltaY:c,textDecorationThickness:h,linethrough:u,overline:d,underline:f}=e,p=this.getSvgTextDecoration({underline:null!=f?f:this.underline,overline:null!=d?d:this.overline,linethrough:null!=u?u:this.linethrough}),g=h||this.textDecorationThickness;return[i?nw(pb,i):"",s?"stroke-width: ".concat(s,"; "):"",n?"font-family: ".concat(n.includes("'")||n.includes('"')?n:"'".concat(n,"'"),"; "):"",a?"font-size: ".concat(a,"px; "):"",o?"font-style: ".concat(o,"; "):"",l?"font-weight: ".concat(l,"; "):"",p?"text-decoration: ".concat(p,"; text-decoration-thickness: ").concat(ax(g*this.getObjectScaling().y/10,ky.NUM_FRACTION_DIGITS),"%; "):"",r?nw(fb,r):"",c?"baseline-shift: ".concat(-c,"; "):"",t?"white-space: pre; ":""].join("")}getSvgTextDecoration(e){return["overline","underline","line-through"].filter(t=>e[t.replace("-","")]).join(" ")}}]),yb.setClass(Nk),yb.setSVGClass(Nk);class Lk{constructor(e){by(this,"target",void 0),by(this,"__mouseDownInPlace",!1),by(this,"__dragStartFired",!1),by(this,"__isDraggingOver",!1),by(this,"__dragStartSelection",void 0),by(this,"__dragImageDisposer",void 0),by(this,"_dispose",void 0),this.target=e;const t=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{t.forEach(e=>e()),this._dispose=void 0}}isPointerOverSelection(e){const t=this.target,n=t.getSelectionStartFromPointer(e);return t.isEditing&&n>=t.selectionStart&&n<=t.selectionEnd&&t.selectionStart<t.selectionEnd}start(e){return this.__mouseDownInPlace=this.isPointerOverSelection(e)}isActive(){return this.__mouseDownInPlace}end(e){const t=this.isActive();return t&&!this.__dragStartFired&&(this.target.setCursorByClick(e),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,t}getDragStartSelection(){return this.__dragStartSelection}setDragImage(e,t){var n;let{selectionStart:s,selectionEnd:i}=t;const r=this.target,a=r.canvas,o=new Cb(r.flipX?-1:1,r.flipY?-1:1),l=r._getCursorBoundaries(s),c=new Cb(l.left+l.leftOffset,l.top+l.topOffset).multiply(o).transform(r.calcTransformMatrix()),h=a.getScenePoint(e).subtract(c),u=r.getCanvasRetinaScaling(),d=r.getBoundingRect(),f=c.subtract(new Cb(d.left,d.top)),p=a.viewportTransform,g=f.add(h).transform(p,!0),m=r.backgroundColor,v=e_(r.styles);r.backgroundColor="";const y={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};r.setSelectionStyles(y,0,s),r.setSelectionStyles(y,i,r.text.length),r.dirty=!0;const b=r.toCanvasElement({enableRetinaScaling:a.enableRetinaScaling,viewportTransform:!0});r.backgroundColor=m,r.styles=v,r.dirty=!0,OC(b,{position:"fixed",left:"".concat(-b.width,"px"),border:$y,width:"".concat(b.width/u,"px"),height:"".concat(b.height/u,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{b.remove()},fx(e.target||this.target.hiddenTextarea).body.appendChild(b),null===(n=e.dataTransfer)||void 0===n||n.setDragImage(b,g.x,g.y)}onDragStart(e){this.__dragStartFired=!0;const t=this.target,n=this.isActive();if(n&&e.dataTransfer){const n=this.__dragStartSelection={selectionStart:t.selectionStart,selectionEnd:t.selectionEnd},s=t._text.slice(n.selectionStart,n.selectionEnd).join(""),i=wy({text:t.text,value:s},n);e.dataTransfer.setData("text/plain",s),e.dataTransfer.setData("application/fabric",JSON.stringify({value:s,styles:t.getSelectionStyles(n.selectionStart,n.selectionEnd,!0)})),e.dataTransfer.effectAllowed="copyMove",this.setDragImage(e,i)}return t.abortCursorAnimation(),n}canDrop(e){if(this.target.editable&&!this.target.getActiveControl()&&!e.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const t=this.target.getSelectionStartFromPointer(e),n=this.__dragStartSelection;return t<n.selectionStart||t>n.selectionEnd}return!0}return!1}targetCanDrop(e){return this.target.canDrop(e)}dragEnterHandler(e){let{e:t}=e;const n=this.targetCanDrop(t);!this.__isDraggingOver&&n&&(this.__isDraggingOver=!0)}dragOverHandler(e){const{e:t}=e,n=this.targetCanDrop(t);!this.__isDraggingOver&&n?this.__isDraggingOver=!0:this.__isDraggingOver&&!n&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(t.preventDefault(),e.canDrop=!0,e.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(e){var t;const{e:n}=e,s=n.defaultPrevented;this.__isDraggingOver=!1,n.preventDefault();let i=null===(t=n.dataTransfer)||void 0===t?void 0:t.getData("text/plain");if(i&&!s){const t=this.target,s=t.canvas;let r=t.getSelectionStartFromPointer(n);const{styles:a}=n.dataTransfer.types.includes("application/fabric")?JSON.parse(n.dataTransfer.getData("application/fabric")):{},o=i[Math.max(0,i.length-1)],l=0;if(this.__dragStartSelection){const e=this.__dragStartSelection.selectionStart,n=this.__dragStartSelection.selectionEnd;r>e&&r<=n?r=e:r>n&&(r-=n-e),t.removeChars(e,n),delete this.__dragStartSelection}t._reNewline.test(o)&&(t._reNewline.test(t._text[r])||r===t._text.length)&&(i=i.trimEnd()),e.didDrop=!0,e.dropTarget=t,t.insertChars(i,a,r),s.setActiveObject(t),t.enterEditing(n),t.selectionStart=Math.min(r+l,t._text.length),t.selectionEnd=Math.min(t.selectionStart+i.length,t._text.length),t.hiddenTextarea.value=t.text,t._updateTextarea(),t.hiddenTextarea.focus(),t.fire(ob,{index:r+l,action:"drop"}),s.fire("text:changed",{target:t}),s.contextTopDirty=!0,s.requestRenderAll()}}dragEndHandler(e){let{e:t}=e;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var n;const e=this.target,s=this.target.canvas,{selectionStart:i,selectionEnd:r}=this.__dragStartSelection,a=(null===(n=t.dataTransfer)||void 0===n?void 0:n.dropEffect)||$y;a===$y?(e.selectionStart=i,e.selectionEnd=r,e._updateTextarea(),e.hiddenTextarea.focus()):(e.clearContextTop(),"move"===a&&(e.removeChars(i,r),e.selectionStart=e.selectionEnd=i,e.hiddenTextarea&&(e.hiddenTextarea.value=e.text),e._updateTextarea(),e.fire(ob,{index:i,action:"dragend"}),s.fire("text:changed",{target:e}),s.requestRenderAll()),e.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Rk=/[ \n\.,;!\?\-]/;class Fk extends Nk{constructor(){super(...arguments),by(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(e){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(e)}_animateCursor(e){let{toValue:t,duration:n,delay:s,onComplete:i}=e;return oS({startValue:this._currentCursorOpacity,endValue:t,duration:n,delay:s,onComplete:i,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:e=>{this._currentCursorOpacity=e,this.renderCursorOrSelection()}})}_tick(e){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(e||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var e;null===(e=this._currentTickCompleteState)||void 0===e||e.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(e){this.abortCursorAnimation(),this._tick(e?0:this.cursorDelay)}abortCursorAnimation(){let e=!1;[this._currentTickState,this._currentTickCompleteState].forEach(t=>{t&&!t.isDone()&&(e=!0,t.abort())}),this._currentCursorOpacity=1,e&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(e=>!e||e.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(e){let t=0,n=e-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)t++,n--;for(;/\S/.test(this._text[n])&&n>-1;)t++,n--;return e-t}findWordBoundaryRight(e){let t=0,n=e;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)t++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)t++,n++;return e+t}findLineBoundaryLeft(e){let t=0,n=e-1;for(;!/\n/.test(this._text[n])&&n>-1;)t++,n--;return e-t}findLineBoundaryRight(e){let t=0,n=e;for(;!/\n/.test(this._text[n])&&n<this._text.length;)t++,n++;return e+t}searchWordBoundary(e,t){const n=this._text;let s=e>0&&this._reSpace.test(n[e])&&(-1===t||!Jy.test(n[e-1]))?e-1:e,i=n[s];for(;s>0&&s<n.length&&!Rk.test(i);)s+=t,i=n[s];return-1===t&&Rk.test(i)&&s++,s}selectWord(e){var t;e=null!==(t=e)&&void 0!==t?t:this.selectionStart;const n=this.searchWordBoundary(e,-1),s=Math.max(n,this.searchWordBoundary(e,1));this.selectionStart=n,this.selectionEnd=s,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(e){var t;e=null!==(t=e)&&void 0!==t?t:this.selectionStart;const n=this.findLineBoundaryLeft(e),s=this.findLineBoundaryRight(e);this.selectionStart=n,this.selectionEnd=s,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(e){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",e?{e:e}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:e}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(e){if(this.getActiveControl())return;const t=this.hiddenTextarea;fx(t).activeElement!==t&&t.focus();const n=this.getSelectionStartFromPointer(e),s=this.selectionStart,i=this.selectionEnd;(n===this.__selectionStartOnMouseDown&&s!==i||s!==n&&i!==n)&&(n>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=n):(this.selectionStart=n,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===s&&this.selectionEnd===i||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(e,t,n){const s=n.slice(0,e),i=this.graphemeSplit(s).length;if(e===t)return{selectionStart:i,selectionEnd:i};const r=n.slice(e,t);return{selectionStart:i,selectionEnd:i+this.graphemeSplit(r).length}}fromGraphemeToStringSelection(e,t,n){const s=n.slice(0,e).join("").length;return e===t?{selectionStart:s,selectionEnd:s}:{selectionStart:s,selectionEnd:s+n.slice(e,t).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const e=this.hiddenTextarea;this.text=e.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const t=this.fromStringToGraphemeSelection(e.selectionStart,e.selectionEnd,e.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),n=this.get2DCursorLocation(e),s=n.lineIndex,i=n.charIndex,r=this.getValueOfPropertyAt(s,i,"fontSize")*this.lineHeight,a=t.leftOffset,o=this.getCanvasRetinaScaling(),l=this.canvas.upperCanvasEl,c=l.width/o,h=l.height/o,u=c-r,d=h-r,f=new Cb(t.left+a,t.top+t.topOffset+r).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new Cb(l.clientWidth/c,l.clientHeight/h));return f.x<0&&(f.x=0),f.x>u&&(f.x=u),f.y<0&&(f.y=0),f.y>d&&(f.y=d),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:"".concat(f.x,"px"),top:"".concat(f.y,"px"),fontSize:"".concat(r,"px"),charHeight:r}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const e=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,e&&(e.blur&&e.blur(),e.parentNode&&e.parentNode.removeChild(e)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const e=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),e&&this.fire(gb),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const e in this.styles)this._textLines[e]||delete this.styles[e]}removeStyleFromTo(e,t){const{lineIndex:n,charIndex:s}=this.get2DCursorLocation(e,!0),{lineIndex:i,charIndex:r}=this.get2DCursorLocation(t,!0);if(n!==i){if(this.styles[n])for(let e=s;e<this._unwrappedTextLines[n].length;e++)delete this.styles[n][e];if(this.styles[i])for(let e=r;e<this._unwrappedTextLines[i].length;e++){const t=this.styles[i][e];t&&(this.styles[n]||(this.styles[n]={}),this.styles[n][s+e-r]=t)}for(let e=n+1;e<=i;e++)delete this.styles[e];this.shiftLineStyles(i,n-i)}else if(this.styles[n]){const e=this.styles[n],t=r-s;for(let n=s;n<r;n++)delete e[n];for(const s in this.styles[n]){const n=parseInt(s,10);n>=r&&(e[n-t]=e[s],delete e[s])}}}shiftLineStyles(e,t){const n=Object.assign({},this.styles);for(const s in this.styles){const i=parseInt(s,10);i>e&&(this.styles[i+t]=n[i],n[i-t]||delete this.styles[i])}}insertNewlineStyleObject(e,t,n,s){const i={},r=this._unwrappedTextLines[e].length,a=r===t;let o=!1;n||(n=1),this.shiftLineStyles(e,n);const l=this.styles[e]?this.styles[e][0===t?t:t-1]:void 0;for(const h in this.styles[e]){const n=parseInt(h,10);n>=t&&(o=!0,i[n-t]=this.styles[e][h],a&&0===t||delete this.styles[e][h])}let c=!1;for(o&&!a&&(this.styles[e+n]=i,c=!0),(c||r>t)&&n--;n>0;)s&&s[n-1]?this.styles[e+n]={0:wy({},s[n-1])}:l?this.styles[e+n]={0:wy({},l)}:delete this.styles[e+n],n--;this._forceClearCache=!0}insertCharStyleObject(e,t,n,s){this.styles||(this.styles={});const i=this.styles[e],r=i?wy({},i):{};n||(n=1);for(const o in r){const e=parseInt(o,10);e>=t&&(i[e+n]=r[e],r[e-n]||delete i[e])}if(this._forceClearCache=!0,s){for(;n--;)Object.keys(s[n]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][t+n]=wy({},s[n]));return}if(!i)return;const a=i[t?t-1:1];for(;a&&n--;)this.styles[e][t+n]=wy({},a)}insertNewStyleBlock(e,t,n){const s=this.get2DCursorLocation(t,!0),i=[0];let r,a=0;for(let o=0;o<e.length;o++)"\n"===e[o]?(a++,i[a]=0):i[a]++;for(i[0]>0&&(this.insertCharStyleObject(s.lineIndex,s.charIndex,i[0],n),n=n&&n.slice(i[0]+1)),a&&this.insertNewlineStyleObject(s.lineIndex,s.charIndex+i[0],a),r=1;r<a;r++)i[r]>0?this.insertCharStyleObject(s.lineIndex+r,0,i[r],n):n&&this.styles[s.lineIndex+r]&&n[0]&&(this.styles[s.lineIndex+r][0]=n[0]),n=n&&n.slice(i[r]+1);i[r]>0&&this.insertCharStyleObject(s.lineIndex+r,0,i[r],n)}removeChars(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e+1;this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;s>n&&this.removeStyleFromTo(n,s);const i=this.graphemeSplit(e);this.insertNewStyleBlock(i,n,t),this._text=[...this._text.slice(0,n),...i,...this._text.slice(s)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(e,t,n){n<=e?(t===e?this._selectionDirection=Yy:this._selectionDirection===Qy&&(this._selectionDirection=Yy,this.selectionEnd=e),this.selectionStart=n):n>e&&n<t?this._selectionDirection===Qy?this.selectionEnd=n:this.selectionStart=n:(t===e?this._selectionDirection=Qy:this._selectionDirection===Yy&&(this._selectionDirection=Qy,this.selectionStart=t),this.selectionEnd=n)}}class Ik extends Fk{initHiddenTextarea(){const e=this.canvas&&fx(this.canvas.getElement())||Ny(),t=e.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(e=>{let[n,s]=e;return t.setAttribute(n,s)});const{top:n,left:s,fontSize:i}=this._calcTextareaPosition();t.style.cssText="position: absolute; top: ".concat(n,"; left: ").concat(s,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(i,";"),(this.hiddenTextareaContainer||e.body).appendChild(t),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(e=>{let[n,s]=e;return t.addEventListener(n,this[s].bind(this))}),this.hiddenTextarea=t}blur(){this.abortCursorAnimation()}onKeyDown(e){if(!this.isEditing)return;const t="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(e){const t=this.fromPaste,{value:n,selectionStart:s,selectionEnd:i}=this.hiddenTextarea;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;const r=()=>{this.updateFromTextArea(),this.fire(ob),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void r();const a=this._splitTextIntoLines(n).graphemeText,o=this._text.length,l=a.length,c=this.selectionStart,h=this.selectionEnd,u=c!==h;let d,f,p,g,m=l-o;const v=this.fromStringToGraphemeSelection(s,i,n),y=c>v.selectionStart;u?(f=this._text.slice(c,h),m+=h-c):l<o&&(f=y?this._text.slice(h+m,h):this._text.slice(c,c-m));const b=a.slice(v.selectionEnd-m,v.selectionEnd);if(f&&f.length&&(b.length&&(d=this.getSelectionStyles(c,c+1,!1),d=b.map(()=>d[0])),u?(p=c,g=h):y?(p=h-f.length,g=h):(p=h,g=h+f.length),this.removeStyleFromTo(p,g)),b.length){const{copyPasteData:e}=Dy();t&&b.join("")===e.copiedText&&!ky.disableStyleCopyPaste&&(d=e.copiedTextStyle),this.insertNewStyleBlock(b,c,d)}r()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(e){let{target:t}=e;const{selectionStart:n,selectionEnd:s}=t;this.compositionStart=n,this.compositionEnd=s,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:e}=Dy();e.copiedText=this.getSelectedText(),ky.disableStyleCopyPaste?e.copiedTextStyle=void 0:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(e,t){let n,s=this._getLineLeftOffset(e);return t>0&&(n=this.__charBounds[e][t-1],s+=n.left+n.width),s}getDownCursorOffset(e,t){const n=this._getSelectionForOffset(e,t),s=this.get2DCursorLocation(n),i=s.lineIndex;if(i===this._textLines.length-1||e.metaKey||34===e.keyCode)return this._text.length-n;const r=s.charIndex,a=this._getWidthBeforeCursor(i,r),o=this._getIndexOnLine(i+1,a);return this._textLines[i].slice(r).length+o+1+this.missingNewlineOffset(i)}_getSelectionForOffset(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart}getUpCursorOffset(e,t){const n=this._getSelectionForOffset(e,t),s=this.get2DCursorLocation(n),i=s.lineIndex;if(0===i||e.metaKey||33===e.keyCode)return-n;const r=s.charIndex,a=this._getWidthBeforeCursor(i,r),o=this._getIndexOnLine(i-1,a),l=this._textLines[i].slice(0,r),c=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+o-l.length+(1-c)}_getIndexOnLine(e,t){const n=this._textLines[e];let s,i,r=this._getLineLeftOffset(e),a=0;for(let o=0,l=n.length;o<l;o++)if(s=this.__charBounds[e][o].width,r+=s,r>t){i=!0;const e=r-s,n=r,l=Math.abs(e-t);a=Math.abs(n-t)<l?o:o-1;break}return i||(a=n.length-1),a}moveCursorDown(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)}moveCursorUp(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",e)}_moveCursorUpOrDown(e,t){const n=this["get".concat(e,"CursorOffset")](t,this._selectionDirection===Qy);if(t.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),0!==n){const e=this.text.length;this.selectionStart=Bw(0,this.selectionStart,e),this.selectionEnd=Bw(0,this.selectionEnd,e),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(e){const t=this._selectionDirection===Yy?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),0!==e}moveCursorWithoutShift(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e}moveCursorLeft(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",e)}_move(e,t,n){let s;if(e.altKey)s=this["findWordBoundary".concat(n)](this[t]);else{if(!e.metaKey&&35!==e.keyCode&&36!==e.keyCode)return this[t]+="Left"===n?-1:1,!0;s=this["findLineBoundary".concat(n)](this[t])}return void 0!==s&&this[t]!==s&&(this[t]=s,!0)}_moveLeft(e,t){return this._move(e,t,"Left")}_moveRight(e,t){return this._move(e,t,"Right")}moveCursorLeftWithoutShift(e){let t=!0;return this._selectionDirection=Yy,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t}moveCursorLeftWithShift(e){return this._selectionDirection===Qy&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=Yy,this._moveLeft(e,"selectionStart")):void 0}moveCursorRight(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)}_moveCursorLeftOrRight(e,t){const n="moveCursor".concat(e).concat(t.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[n](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(e){return this._selectionDirection===Yy&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=Qy,this._moveRight(e,"selectionEnd")):void 0}moveCursorRightWithoutShift(e){let t=!0;return this._selectionDirection=Qy,this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t}}const zk=e=>!!e.button;class Wk extends Ik{constructor(){super(...arguments),by(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new Lk(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(e){return this.draggableTextDelegate.onDragStart(e)}canDrop(e){return this.draggableTextDelegate.canDrop(e)}doubleClickHandler(e){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}tripleClickHandler(e){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}_mouseDownHandler(e){let{e:t,alreadySelected:n}=e;this.canvas&&this.editable&&!zk(t)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(t)||(this.canvas.textEditingManager.register(this),n&&(this.inCompositionMode=!1,this.setCursorByClick(t)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=n||this.isEditing)))}mouseUpHandler(e){let{e:t,transform:n}=e;const s=this.draggableTextDelegate.end(t);if(this.canvas){this.canvas.textEditingManager.unregister(this);const e=this.canvas._activeObject;if(e&&e!==this)return}!this.editable||this.group&&!this.group.interactive||n&&n.actionPerformed||zk(t)||s||this.selected&&!this.getActiveControl()&&(this.enterEditing(t),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(e){const t=this.getSelectionStartFromPointer(e),n=this.selectionStart,s=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(n,s,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(e){const t=this.canvas.getScenePoint(e).transform(Hb(this.calcTransformMatrix())).add(new Cb(-this._getLeftOffset(),-this._getTopOffset()));let n=0,s=0,i=0;for(let l=0;l<this._textLines.length&&n<=t.y;l++)n+=this.getHeightOfLine(l),i=l,l>0&&(s+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));let r=Math.abs(this._getLineLeftOffset(i));const a=this._textLines[i].length,o=this.__charBounds[i];for(let l=0;l<a;l++){const e=r+o[l].kernedWidth;if(t.x<=e){Math.abs(t.x-e)<=Math.abs(t.x-r)&&s++;break}r=e,s++}return Math.min(this.flipX?a-s:s,this._text.length)}}const Bk="moveCursorUp",Hk="moveCursorDown",Uk="moveCursorLeft",Vk="moveCursorRight",Gk="exitEditing",Xk=(e,t)=>{const n=t.getRetinaScaling();e.setTransform(n,0,0,n,0,0);const s=t.viewportTransform;e.transform(s[0],s[1],s[2],s[3],s[4],s[5])},Yk=wy({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Gk,27:Gk,33:Bk,34:Hk,35:Vk,36:Uk,37:Uk,38:Bk,39:Vk,40:Hk},keysMapRtl:{9:Gk,27:Gk,33:Bk,34:Hk,35:Uk,36:Vk,37:Vk,38:Bk,39:Uk,40:Hk},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class qk extends Wk{static getDefaults(){return wy(wy({},super.getDefaults()),qk.ownDefaults)}get type(){const e=super.type;return"itext"===e?"i-text":e}constructor(e,t){super(e,wy(wy({},qk.ownDefaults),t)),this.initBehavior()}_set(e,t){return this.isEditing&&this._savedProps&&e in this._savedProps?(this._savedProps[e]=t,this):("canvas"===e&&(this.canvas instanceof GC&&this.canvas.textEditingManager.remove(this),t instanceof GC&&t.textEditingManager.add(this)),super._set(e,t))}setSelectionStart(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)}setSelectionEnd(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)}_updateAndFire(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,n=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(e,t,n)}setSelectionStyles(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(e,t,n)}get2DCursorLocation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(e,t)}render(e){super.render(e),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(e){const t=this.isEditing;this.isEditing=!1;const n=super.toCanvasElement(e);return this.isEditing=t,n}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const e=this.clearContextTop(!0);if(!e)return;const t=this._getCursorBoundaries(),n=this.findAncestorsWithClipPath(),s=n.length>0;let i,r=e;if(s){i=Lb(e.canvas),r=i.getContext("2d"),Xk(r,this.canvas);const t=this.calcTransformMatrix();r.transform(t[0],t[1],t[2],t[3],t[4],t[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(r,t):this.renderCursor(r,t),s)for(const a of n){const t=a.clipPath,n=Lb(e.canvas),s=n.getContext("2d");if(Xk(s,this.canvas),!t.absolutePositioned){const e=a.calcTransformMatrix();s.transform(e[0],e[1],e[2],e[3],e[4],e[5])}t.transform(s),t.drawObject(s,!0,{}),this.drawClipPathOnCache(r,t,n)}s&&(e.setTransform(1,0,0,1,0,0),e.drawImage(i,0,0)),this.canvas.contextTopDirty=!0,e.restore()}findAncestorsWithClipPath(){const e=[];let t=this;for(;t;)t.clipPath&&e.push(t),t=t.parent;return e}_getCursorBoundaries(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;const n=this._getLeftOffset(),s=this._getTopOffset(),i=this._getCursorBoundariesOffsets(e,t);return{left:n,top:s,leftOffset:i.left,topOffset:i.top}}_getCursorBoundariesOffsets(e,t){return t?this.__getCursorBoundariesOffsets(e):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(e)}__getCursorBoundariesOffsets(e){let t=0,n=0;const{charIndex:s,lineIndex:i}=this.get2DCursorLocation(e);for(let l=0;l<i;l++)t+=this.getHeightOfLine(l);const r=this._getLineLeftOffset(i),a=this.__charBounds[i][s];a&&(n=a.left),0!==this.charSpacing&&s===this._textLines[i].length&&(n-=this._getWidthOfCharSpacing());const o={top:t,left:r+(n>0?n:0)};return"rtl"===this.direction&&(this.textAlign===Qy||this.textAlign===dw||this.textAlign===pw?o.left*=-1:this.textAlign===Yy||this.textAlign===fw?o.left=r-(n>0?n:0):this.textAlign!==Xy&&this.textAlign!==gw||(o.left=r-(n>0?n:0))),o}renderCursorAt(e){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(e,!0),e)}renderCursor(e,t){this._renderCursor(e,t,this.selectionStart)}getCursorRenderingData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(e);const n=this.get2DCursorLocation(e),s=n.lineIndex,i=n.charIndex>0?n.charIndex-1:0,r=this.getValueOfPropertyAt(s,i,"fontSize"),a=this.getObjectScaling().x*this.canvas.getZoom(),o=this.cursorWidth/a,l=this.getValueOfPropertyAt(s,i,"deltaY"),c=t.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(s)/this.lineHeight-r*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(s,i,"fill"),opacity:this._currentCursorOpacity,left:t.left+t.leftOffset-o/2,top:c+t.top+l,width:o,height:r}}_renderCursor(e,t,n){const{color:s,opacity:i,left:r,top:a,width:o,height:l}=this.getCursorRenderingData(n,t);e.fillStyle=s,e.globalAlpha=i,e.fillRect(r,a,o,l)}renderSelection(e,t){const n={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(e,n,t)}renderDragSourceEffect(){const e=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,e,this._getCursorBoundaries(e.selectionStart,!0))}renderDropTargetEffect(e){const t=this.getSelectionStartFromPointer(e);this.renderCursorAt(t)}_renderSelection(e,t,n){const s=t.selectionStart,i=t.selectionEnd,r=this.textAlign.includes(dw),a=this.get2DCursorLocation(s),o=this.get2DCursorLocation(i),l=a.lineIndex,c=o.lineIndex,h=a.charIndex<0?0:a.charIndex,u=o.charIndex<0?0:o.charIndex;for(let d=l;d<=c;d++){const t=this._getLineLeftOffset(d)||0;let s=this.getHeightOfLine(d),i=0,a=0,o=0;if(d===l&&(a=this.__charBounds[l][h].left),d>=l&&d<c)o=r&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===c)if(0===u)o=this.__charBounds[c][u].left;else{const e=this._getWidthOfCharSpacing();o=this.__charBounds[c][u-1].left+this.__charBounds[c][u-1].width-e}i=s,(this.lineHeight<1||d===c&&this.lineHeight>1)&&(s/=this.lineHeight);let f=n.left+t+a,p=s,g=0;const m=o-a;this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",p=1,g=s):e.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===Qy||this.textAlign===dw||this.textAlign===pw?f=this.width-f-m:this.textAlign===Yy||this.textAlign===fw?f=n.left+t-o:this.textAlign!==Xy&&this.textAlign!==gw||(f=n.left+t-o)),e.fillRect(f,n.top+n.topOffset+g,m,p),n.topOffset+=i}}getCurrentCharFontSize(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")}getCurrentCharColor(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,fb)}_getCurrentCharIndex(){const e=this.get2DCursorLocation(this.selectionStart,!0),t=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:t}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}by(qk,"ownDefaults",Yk),by(qk,"type","IText"),yb.setClass(qk),yb.setClass(qk,"i-text");class Kk extends qk{static getDefaults(){return wy(wy({},super.getDefaults()),Kk.ownDefaults)}constructor(e,t){super(e,wy(wy({},Kk.ownDefaults),t))}static createControls(){return{controls:VS()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(dw)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(e){let t=0,n=0,s=0;const i={};for(let r=0;r<e.graphemeLines.length;r++)"\n"===e.graphemeText[s]&&r>0?(n=0,s++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[s])&&r>0&&(n++,s++),i[r]={line:t,offset:n},s+=e.graphemeLines[r].length,n+=e.graphemeLines[r].length;return i}styleHas(e,t){if(this._styleMap&&!this.isWrapping){const e=this._styleMap[t];e&&(t=e.line)}return super.styleHas(e,t)}isEmptyStyles(e){if(!this.styles)return!0;let t,n=0,s=e+1,i=!1;const r=this._styleMap[e],a=this._styleMap[e+1];r&&(e=r.line,n=r.offset),a&&(s=a.line,i=s===e,t=a.offset);const o=void 0===e?this.styles:{line:this.styles[e]};for(const l in o)for(const e in o[l]){const s=parseInt(e,10);if(s>=n&&(!i||s<t))for(const t in o[l][e])return!1}return!0}_getStyleDeclaration(e,t){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[e];if(!n)return{};e=n.line,t=n.offset+t}return super._getStyleDeclaration(e,t)}_setStyleDeclaration(e,t,n){const s=this._styleMap[e];super._setStyleDeclaration(s.line,s.offset+t,n)}_deleteStyleDeclaration(e,t){const n=this._styleMap[e];super._deleteStyleDeclaration(n.line,n.offset+t)}_getLineStyle(e){const t=this._styleMap[e];return!!this.styles[t.line]}_setLineStyle(e){const t=this._styleMap[e];super._setLineStyle(t.line)}_wrapText(e,t){this.isWrapping=!0;const n=this.getGraphemeDataForRender(e),s=[];for(let i=0;i<n.wordsData.length;i++)s.push(...this._wrapLine(i,t,n));return this.isWrapping=!1,s}getGraphemeDataForRender(e){const t=this.splitByGrapheme,n=t?"":" ";let s=0;return{wordsData:e.map((e,i)=>{let r=0;const a=t?this.graphemeSplit(e):this.wordSplit(e);return 0===a.length?[{word:[],width:0}]:a.map(e=>{const a=t?[e]:this.graphemeSplit(e),o=this._measureWord(a,i,r);return s=Math.max(o,s),r+=a.length+n.length,{word:a,width:o}})}),largestWordWidth:s}}_measureWord(e,t){let n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0;for(let r=0,a=e.length;r<a;r++)i+=this._getGraphemeBox(e[r],t,r+s,n,!0).kernedWidth,n=e[r];return i}wordSplit(e){return e.split(this._wordJoiners)}_wrapLine(e,t,n){let{largestWordWidth:s,wordsData:i}=n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=this._getWidthOfCharSpacing(),o=this.splitByGrapheme,l=[],c=o?"":" ";let h=0,u=[],d=0,f=0,p=!0;t-=r;const g=Math.max(t,s,this.dynamicMinWidth),m=i[e];let v;for(d=0,v=0;v<m.length;v++){const{word:t,width:n}=m[v];d+=t.length,h+=f+n-a,h>g&&!p?(l.push(u),u=[],h=n,p=!0):h+=a,p||o||u.push(c),u=u.concat(t),f=o?0:this._measureWord([c],e,d),d++,p=!1}return v&&l.push(u),s+r>this.dynamicMinWidth&&(this.dynamicMinWidth=s-a+r),l}isEndOfWrapping(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line}missingNewlineOffset(e,t){return this.splitByGrapheme&&!t?this.isEndOfWrapping(e)?1:0:1}_splitTextIntoLines(e){const t=super._splitTextIntoLines(e),n=this._wrapText(t.lines,this.width),s=new Array(n.length);for(let i=0;i<n.length;i++)s[i]=n[i].join("");return t.lines=s,t.graphemeLines=n,t}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const e=new Map;for(const t in this._styleMap){const n=parseInt(t,10);if(this._textLines[n]){const n=this._styleMap[t].line;e.set("".concat(n),!0)}}for(const t in this.styles)e.has(t)||delete this.styles[t]}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...e])}}by(Kk,"type","Textbox"),by(Kk,"textLayoutProperties",[...qk.textLayoutProperties,"width"]),by(Kk,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),yb.setClass(Kk);class Qk extends q_{shouldPerformLayout(e){return!!e.target.clipPath&&super.shouldPerformLayout(e)}shouldLayoutClipPath(){return!1}calcLayoutResult(e,t){const{target:n}=e,{clipPath:s,group:i}=n;if(!s||!this.shouldPerformLayout(e))return;const{width:r,height:a}=kx(Y_(n,s)),o=new Cb(r,a);if(s.absolutePositioned)return{center:Dx(s.getRelativeCenterPoint(),void 0,i?i.calcTransformMatrix():void 0),size:o};{const i=s.getRelativeCenterPoint().transform(n.calcOwnMatrix(),!0);if(this.shouldPerformLayout(e)){const{center:n=new Cb,correction:s=new Cb}=this.calcBoundingBox(t,e)||{};return{center:n.add(i),correction:s.subtract(i),size:o}}return{center:n.getRelativeCenterPoint().add(i),size:o}}}}by(Qk,"type","clip-path"),yb.setClass(Qk);class $k extends q_{getInitialSize(e,t){let{target:n}=e,{size:s}=t;return new Cb(n.width||s.x,n.height||s.y)}}by($k,"type","fixed"),yb.setClass($k);class Jk extends Z_{subscribeTargets(e){const t=e.target;e.targets.reduce((e,t)=>(t.parent&&e.add(t.parent),e),new Set).forEach(e=>{e.layoutManager.subscribeTargets({target:e,targets:[t]})})}unsubscribeTargets(e){const t=e.target,n=t.getObjects();e.targets.reduce((e,t)=>(t.parent&&e.add(t.parent),e),new Set).forEach(e=>{!n.some(t=>t.parent===e)&&e.layoutManager.unsubscribeTargets({target:e,targets:[t]})})}}class Zk extends nC{static getDefaults(){return wy(wy({},super.getDefaults()),Zk.ownDefaults)}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,Zk.ownDefaults),this.setOptions(t);const{left:n,top:s,layoutManager:i}=t;this.groupInit(e,{left:n,top:s,layoutManager:null!=i?i:new Jk})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];"selection-order"===this.multiSelectionStacking?this.add(...t):t.forEach(e=>{const t=this._objects.findIndex(t=>t.isInFrontOf(e)),n=-1===t?this.size():t;this.insertAt(n,e)})}canEnterGroup(e){return this.getObjects().some(t=>t.isDescendantOf(e)||e.isDescendantOf(t))?(Ay("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(e)}enterGroup(e,t){e.parent&&e.parent===e.group?e.parent._exitGroup(e):e.group&&e.parent!==e.group&&e.group.remove(e),this._enterGroup(e,t)}exitGroup(e,t){this._exitGroup(e,t),e.parent&&e.parent._enterGroup(e,!0)}_onAfterObjectsChange(e,t){super._onAfterObjectsChange(e,t);const n=new Set;t.forEach(e=>{const{parent:t}=e;t&&n.add(t)}),e===G_?n.forEach(e=>{e._onAfterObjectsChange(V_,t)}):n.forEach(e=>{e._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(e,t,n){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const s=wy(wy({hasControls:!1},n),{},{forActiveSelection:!0});for(let i=0;i<this._objects.length;i++)this._objects[i]._renderControls(e,s);super._renderControls(e,t),e.restore()}}by(Zk,"type","ActiveSelection"),by(Zk,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),yb.setClass(Zk),yb.setClass(Zk,"activeSelection");class eA{constructor(){by(this,"resources",{})}applyFilters(e,t,n,s,i){const r=i.getContext("2d");if(!r)return;r.drawImage(t,0,0,n,s);const a={sourceWidth:n,sourceHeight:s,imageData:r.getImageData(0,0,n,s),originalEl:t,originalImageData:r.getImageData(0,0,n,s),canvasEl:i,ctx:r,filterBackend:this};e.forEach(e=>{e.applyTo(a)});const{imageData:o}=a;return o.width===n&&o.height===s||(i.width=o.width,i.height=o.height),r.putImageData(o,0,0),a}}class tA{constructor(){let{tileSize:e=ky.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};by(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),by(this,"resources",{}),this.tileSize=e,this.setupGLContext(e,e),this.captureGPUInfo()}setupGLContext(e,t){this.dispose(),this.createWebGLCanvas(e,t)}createWebGLCanvas(e,t){const n=Lb({width:e,height:t}),s=n.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});s&&(s.clearColor(0,0,0,0),this.canvas=n,this.gl=s)}applyFilters(e,t,n,s,i,r){const a=this.gl,o=i.getContext("2d");if(!a||!o)return;let l;r&&(l=this.getCachedTexture(r,t));const c={originalWidth:t.width||t.naturalWidth||0,originalHeight:t.height||t.naturalHeight||0,sourceWidth:n,sourceHeight:s,destinationWidth:n,destinationHeight:s,context:a,sourceTexture:this.createTexture(a,n,s,l?void 0:t),targetTexture:this.createTexture(a,n,s),originalTexture:l||this.createTexture(a,n,s,l?void 0:t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},h=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,h),e.forEach(e=>{e&&e.applyTo(c)}),function(e){const t=e.targetCanvas,n=t.width,s=t.height,i=e.destinationWidth,r=e.destinationHeight;n===i&&s===r||(t.width=i,t.height=r)}(c),this.copyGLTo2D(a,c),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(c.sourceTexture),a.deleteTexture(c.targetTexture),a.deleteFramebuffer(h),o.setTransform(1,0,0,1,0,0),c}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(e,t,n,s,i){const{NEAREST:r,TEXTURE_2D:a,RGBA:o,UNSIGNED_BYTE:l,CLAMP_TO_EDGE:c,TEXTURE_MAG_FILTER:h,TEXTURE_MIN_FILTER:u,TEXTURE_WRAP_S:d,TEXTURE_WRAP_T:f}=e,p=e.createTexture();return e.bindTexture(a,p),e.texParameteri(a,h,i||r),e.texParameteri(a,u,i||r),e.texParameteri(a,d,c),e.texParameteri(a,f,c),s?e.texImage2D(a,0,o,o,l,s):e.texImage2D(a,0,o,t,n,0,o,l,null),p}getCachedTexture(e,t,n){const{textureCache:s}=this;if(s[e])return s[e];{const i=this.createTexture(this.gl,t.width,t.height,t,n);return i&&(s[e]=i),i}}evictCachesForKey(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])}copyGLTo2D(e,t){const n=e.canvas,s=t.targetCanvas,i=s.getContext("2d");if(!i)return;i.translate(0,s.height),i.scale(1,-1);const r=n.height-s.height;i.drawImage(n,0,r,s.width,s.height,0,0,s.width,s.height)}copyGLTo2DPutImageData(e,t){const n=t.targetCanvas.getContext("2d"),s=t.destinationWidth,i=t.destinationHeight,r=s*i*4;if(!n)return;const a=new Uint8Array(this.imageBuffer,0,r),o=new Uint8ClampedArray(this.imageBuffer,0,r);e.readPixels(0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,a);const l=new ImageData(o,s,i);n.putImageData(l,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const e=this.gl,t={renderer:"",vendor:""};if(!e)return t;const n=e.getExtension("WEBGL_debug_renderer_info");if(n){const s=e.getParameter(n.UNMASKED_RENDERER_WEBGL),i=e.getParameter(n.UNMASKED_VENDOR_WEBGL);s&&(t.renderer=s.toLowerCase()),i&&(t.vendor=i.toLowerCase())}return this.gpuInfo=t,t}}let nA;function sA(){return!nA&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(nA=function(){const{WebGLProbe:e}=Dy();return e.queryWebGL(Db()),ky.enableGLFiltering&&e.isSupported(ky.textureSize)?new tA({tileSize:ky.textureSize}):new eA}()),nA}const iA=["filters","resizeFilter","src","crossOrigin","type"],rA=["cropX","cropY"];class aA extends YS{static getDefaults(){return wy(wy({},super.getDefaults()),aA.ownDefaults)}constructor(e,t){super(),by(this,"_lastScaleX",1),by(this,"_lastScaleY",1),by(this,"_filterScalingX",1),by(this,"_filterScalingY",1),this.filters=[],Object.assign(this,aA.ownDefaults),this.setOptions(t),this.cacheKey="texture".concat(Ob()),this.setElement("string"==typeof e?(this.canvas&&fx(this.canvas.getElement())||Ny()).getElementById(e):e,t)}getElement(){return this._element}setElement(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=e,this._originalElement=e,this._setWidthHeight(n),null===(t=e.classList)||void 0===t||t.add(aA.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(e){const t=sA(!1);t instanceof tA&&t.evictCachesForKey(e)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(e=>{const t=this[e];t&&Dy().dispose(t),this[e]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const e=this.getElement();return e?{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}:{width:0,height:0}}_stroke(e){if(!this.stroke||0===this.strokeWidth)return;const t=this.width/2,n=this.height/2;e.beginPath(),e.moveTo(-t,-n),e.lineTo(t,-n),e.lineTo(t,n),e.lineTo(-t,n),e.lineTo(-t,-n),e.closePath()}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=[];return this.filters.forEach(e=>{e&&t.push(e.toObject())}),wy(wy({},super.toObject([...rA,...e])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:t},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const e=[],t=this._element,n=-this.width/2,s=-this.height/2;let i=[],r=[],a="",o="";if(!t)return[];if(this.hasCrop()){const e=Ob();i.push('<clipPath id="imageCrop_'+e+'">\n','\t<rect x="'+n+'" y="'+s+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),a=' clip-path="url(#imageCrop_'+e+')" '}if(this.imageSmoothing||(o=' image-rendering="optimizeSpeed"'),e.push("\t<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(n-this.cropX,'" y="').concat(s-this.cropY,'" width="').concat(t.width||t.naturalWidth,'" height="').concat(t.height||t.naturalHeight,'"').concat(o).concat(a,"></image>\n")),this.stroke||this.strokeDashArray){const e=this.fill;this.fill=null,r=['\t<rect x="'.concat(n,'" y="').concat(s,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=e}return i=this.paintFirst!==fb?i.concat(r,e):i.concat(e,r),i}getSrc(e){const t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src")||"":t.src:this.src||""}getSvgSrc(e){return this.getSrc(e)}setSrc(e){let{crossOrigin:t,signal:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return tx(e,{crossOrigin:t,signal:n}).then(e=>{void 0!==t&&this.set({crossOrigin:t}),this.setElement(e)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const e=this.resizeFilter,t=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),s=n.x,i=n.y,r=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||s>t&&i>t)return this._element=r,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=i);const a=Lb(r),{width:o,height:l}=r;this._element=a,this._lastScaleX=e.scaleX=s,this._lastScaleY=e.scaleY=i,sA().applyFilters([e],r,o,l,this._element),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height}applyFilters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(e=e.filter(e=>e&&!e.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===e.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const t=this._originalElement,n=t.naturalWidth||t.width,s=t.naturalHeight||t.height;if(this._element===this._originalElement){const e=Lb({width:n,height:s});this._element=e,this._filteredEl=e}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,s),this._lastScaleX=1,this._lastScaleY=1);sA().applyFilters(e,this._originalElement,n,s,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(e){e.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)}drawCacheOnCanvas(e){e.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(e)}shouldCache(){return this.needsItsOwnCache()}_renderFill(e){const t=this._element;if(!t)return;const n=this._filterScalingX,s=this._filterScalingY,i=this.width,r=this.height,a=Math.max(this.cropX,0),o=Math.max(this.cropY,0),l=t.naturalWidth||t.width,c=t.naturalHeight||t.height,h=a*n,u=o*s,d=Math.min(i*n,l-h),f=Math.min(r*s,c-u),p=-i/2,g=-r/2,m=Math.min(i,l/n-a),v=Math.min(r,c/s-o);t&&e.drawImage(t,h,u,d,f,p,g,m,v)}_needsResize(){const e=this.getTotalObjectScaling();return e.x!==this._lastScaleX||e.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:e,height:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=this.getOriginalSize();this.width=e||n.width,this.height=t||n.height}parsePreserveAspectRatioAttribute(){const e=tw(this.preserveAspectRatio||""),t=this.width,n=this.height,s={width:t,height:n};let i,r=this._element.width,a=this._element.height,o=1,l=1,c=0,h=0,u=0,d=0;return!e||e.alignX===$y&&e.alignY===$y?(o=t/r,l=n/a):("meet"===e.meetOrSlice&&(o=l=sC(this._element,s),i=(t-r*o)/2,"Min"===e.alignX&&(c=-i),"Max"===e.alignX&&(c=i),i=(n-a*l)/2,"Min"===e.alignY&&(h=-i),"Max"===e.alignY&&(h=i)),"slice"===e.meetOrSlice&&(o=l=iC(this._element,s),i=r-t/o,"Mid"===e.alignX&&(u=i/2),"Max"===e.alignX&&(u=i),i=a-n/l,"Mid"===e.alignY&&(d=i/2),"Max"===e.alignY&&(d=i),r=t/o,a=n/l)),{width:r,height:a,scaleX:o,scaleY:l,offsetLeft:c,offsetTop:h,cropX:u,cropY:d}}static fromObject(e,t){let{filters:n,resizeFilter:s,src:i,crossOrigin:r,type:a}=e,o=Sy(e,iA);return Promise.all([tx(i,wy(wy({},t),{},{crossOrigin:r})),n&&nx(n,t),s&&nx([s],t),sx(o,t)]).then(e=>{let[t,n=[],[s]=[],r={}]=e;return new this(t,wy(wy({},o),{},{src:i,filters:n,resizeFilter:s},r))})}static fromURL(e){let{crossOrigin:t=null,signal:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return tx(e,{crossOrigin:t,signal:n}).then(e=>new this(e,s))}static async fromElement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=z_(e,this.ATTRIBUTE_NAMES,n);return this.fromURL(s["xlink:href"]||s.href,t,s).catch(e=>(Ay("log","Unable to parse Image",e),null))}}by(aA,"type","Image"),by(aA,"cacheProperties",[...Uw,...rA]),by(aA,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),by(aA,"CSS_CANVAS","canvas-img"),by(aA,"ATTRIBUTE_NAMES",[...h_,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),yb.setClass(aA),yb.setSVGClass(aA);iw(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const oA=rb,lA=e=>function(t,n,s){const{points:i,pathOffset:r}=s;return new Cb(i[e]).subtract(r).transform(Ub(s.getViewportTransform(),s.calcTransformMatrix()))},cA=(e,t,n,s)=>{const{target:i,pointIndex:r}=t,a=i,o=Dx(new Cb(n,s),void 0,a.calcOwnMatrix());return a.points[r]=o.add(a.pathOffset),a.setDimensions(),a.set("dirty",!0),!0},hA=(e,t)=>function(n,s,i,r){const a=s.target,o=new Cb(a.points[(e>0?e:a.points.length)-1]),l=o.subtract(a.pathOffset).transform(a.calcOwnMatrix()),c=t(n,wy(wy({},s),{},{pointIndex:e}),i,r),h=o.subtract(a.pathOffset).transform(a.calcOwnMatrix()).subtract(l);return a.left-=h.x,a.top-=h.y,c},uA=e=>pS(oA,hA(e,cA)),dA=(e,t,n)=>{const{path:s,pathOffset:i}=e,r=s[t];return new Cb(r[n]-i.x,r[n+1]-i.y).transform(Ub(e.getViewportTransform(),e.calcTransformMatrix()))};function fA(e,t,n){const{commandIndex:s,pointIndex:i}=this;return dA(n,s,i)}function pA(e,t,n,s){const{target:i}=t,{commandIndex:r,pointIndex:a}=this,o=((e,t,n,s,i)=>{const{path:r,pathOffset:a}=e,o=r[(s>0?s:r.length)-1],l=new Cb(o[i],o[i+1]),c=l.subtract(a).transform(e.calcOwnMatrix()),h=Dx(new Cb(t,n),void 0,e.calcOwnMatrix());r[s][i]=h.x+a.x,r[s][i+1]=h.y+a.y,e.setDimensions();const u=l.subtract(e.pathOffset).transform(e.calcOwnMatrix()).subtract(c);return e.left-=u.x,e.top-=u.y,e.set("dirty",!0),!0})(i,n,s,r,a);return Rx(this.actionName,wy(wy({},Ux(e,t,n,s)),{},{commandIndex:r,pointIndex:a})),o}class gA extends bS{constructor(e){super(e)}render(e,t,n,s,i){const r=wy(wy({},s),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(e,t,n,r,i)}}class mA extends gA{constructor(e){super(e)}render(e,t,n,s,i){const{path:r}=i,{commandIndex:a,pointIndex:o,connectToCommandIndex:l,connectToPointIndex:c}=this;e.save(),e.strokeStyle=this.controlStroke,this.connectionDashArray&&e.setLineDash(this.connectionDashArray);const[h]=r[a],u=dA(i,l,c);if("Q"===h){const s=dA(i,a,o+2);e.moveTo(s.x,s.y),e.lineTo(t,n)}else e.moveTo(t,n);e.lineTo(u.x,u.y),e.stroke(),e.restore(),super.render(e,t,n,s,i)}}const vA=(e,t,n,s,i,r)=>new(n?mA:gA)(wy(wy({commandIndex:e,pointIndex:t,actionName:"modifyPath",positionHandler:fA,actionHandler:pA,connectToCommandIndex:i,connectToPointIndex:r},s),n?s.controlPointStyle:s.pointStyle));Object.freeze({__proto__:null,changeWidth:mS,createObjectDefaultControls:HS,createPathControls:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};let s="M";return e.path.forEach((e,i)=>{const r=e[0];switch("Z"!==r&&(n["c_".concat(i,"_").concat(r)]=vA(i,e.length-2,!1,t)),r){case"C":n["c_".concat(i,"_C_CP_1")]=vA(i,1,!0,t,i-1,(e=>"C"===e?5:"Q"===e?3:1)(s)),n["c_".concat(i,"_C_CP_2")]=vA(i,3,!0,t,i,5);break;case"Q":n["c_".concat(i,"_Q_CP_1")]=vA(i,1,!0,t,i,3)}s=r}),n},createPolyActionHandler:uA,createPolyControls:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};for(let s=0;s<("number"==typeof e?e:e.points.length);s++)n["p".concat(s)]=new bS(wy({actionName:oA,positionHandler:lA(s),actionHandler:uA(s)},t));return n},createPolyPositionHandler:lA,createResizeControls:US,createTextboxDefaultControls:VS,dragHandler:Xx,factoryPolyActionHandler:hA,getLocalPoint:Gx,polyActionHandler:cA,renderCircleControl:vS,renderSquareControl:yS,rotationStyleHandler:xS,rotationWithSnapping:wS,scaleCursorStyleHandler:kS,scaleOrSkewActionName:IS,scaleSkewCursorStyleHandler:zS,scalingEqually:ES,scalingX:TS,scalingXOrSkewingY:WS,scalingY:MS,scalingYOrSkewingX:BS,skewCursorStyleHandler:DS,skewHandlerX:LS,skewHandlerY:RS,wrapWithFireEvent:pS,wrapWithFixedAnchor:gS});const yA=e=>void 0!==e.webgl,bA="precision highp float",xA="\n    ".concat(bA,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),wA=["type"],SA=["type"],_A=new RegExp(bA,"g");class CA{get type(){return this.constructor.type}constructor(){let e=Sy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},wA);Object.assign(this,this.constructor.defaults,e)}getFragmentSource(){return xA}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:s="highp"}}=Dy();"highp"!==s&&(t=t.replace(_A,bA.replace("highp",s)));const i=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER),a=e.createProgram();if(!i||!r||!a)throw new Ey("Vertex, fragment shader or program creation error");if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Ey("Vertex shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(i)));if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Ey("Fragment shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(r)));if(e.attachShader(a,i),e.attachShader(a,r),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Ey('Shader link error for "'.concat(this.type,'" ').concat(e.getProgramInfoLog(a)));const o=this.getUniformLocations(e,a)||{};return o.uStepW=e.getUniformLocation(a,"uStepW"),o.uStepH=e.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(e,a),uniformLocations:o}}getAttributeLocations(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}}getUniformLocations(e,t){const n=this.constructor.uniformLocations,s={};for(let i=0;i<n.length;i++)s[n[i]]=e.getUniformLocation(t,n[i]);return s}sendAttributeData(e,t,n){const s=t.aPosition,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}_setupFrameBuffer(e){const t=e.context;if(e.passes>1){const n=e.destinationWidth,s=e.destinationHeight;e.sourceWidth===n&&e.sourceHeight===s||(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,n,s)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)}else t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish()}_swapTextures(e){e.passes--,e.pass++;const t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t}isNeutralState(e){return!1}applyTo(e){yA(e)?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){}getCacheKey(){return this.type}retrieveShader(e){const t=this.getCacheKey();return e.programCache[t]||(e.programCache[t]=this.createProgram(e.context)),e.programCache[t]}applyToWebGL(e){const t=e.context,n=this.retrieveShader(e);0===e.pass&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(n.program),this.sendAttributeData(t,n.attributeLocations,e.aPosition),t.uniform1f(n.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(n.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,n.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(e,t,n){e.activeTexture(n),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)}unbindAdditionalTexture(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)}sendUniformData(e,t){}createHelpLayer(e){if(!e.helpLayer){const{sourceWidth:t,sourceHeight:n}=e,s=Lb({width:t,height:n});e.helpLayer=s}}toObject(){const e=Object.keys(this.constructor.defaults||{});return wy({type:this.type},e.reduce((e,t)=>(e[t]=this[t],e),{}))}toJSON(){return this.toObject()}static async fromObject(e,t){return new this(Sy(e,SA))}}by(CA,"type","BaseFilter"),by(CA,"uniformLocations",[]);const kA={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class AA extends CA{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(kA[this.mode],"\n        }\n      }\n      ")}applyTo2d(e){let{imageData:{data:t}}=e;const n=new Zx(this.color).getSource(),s=this.alpha,i=n[0]*s,r=n[1]*s,a=n[2]*s,o=1-s;for(let l=0;l<t.length;l+=4){const e=t[l],n=t[l+1],s=t[l+2];let c,h,u;switch(this.mode){case"multiply":c=e*i/255,h=n*r/255,u=s*a/255;break;case"screen":c=255-(255-e)*(255-i)/255,h=255-(255-n)*(255-r)/255,u=255-(255-s)*(255-a)/255;break;case"add":c=e+i,h=n+r,u=s+a;break;case"difference":c=Math.abs(e-i),h=Math.abs(n-r),u=Math.abs(s-a);break;case"subtract":c=e-i,h=n-r,u=s-a;break;case"darken":c=Math.min(e,i),h=Math.min(n,r),u=Math.min(s,a);break;case"lighten":c=Math.max(e,i),h=Math.max(n,r),u=Math.max(s,a);break;case"overlay":c=i<128?2*e*i/255:255-2*(255-e)*(255-i)/255,h=r<128?2*n*r/255:255-2*(255-n)*(255-r)/255,u=a<128?2*s*a/255:255-2*(255-s)*(255-a)/255;break;case"exclusion":c=i+e-2*i*e/255,h=r+n-2*r*n/255,u=a+s-2*a*s/255;break;case"tint":c=i+e*o,h=r+n*o,u=a+s*o}t[l]=c,t[l+1]=h,t[l+2]=u}}sendUniformData(e,t){const n=new Zx(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,e.uniform4fv(t.uColor,n)}}by(AA,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),by(AA,"type","BlendColor"),by(AA,"uniformLocations",["uColor"]),yb.setClass(AA);const EA={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},TA=["type","image"];class MA extends CA{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return EA[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(e){const t=e.context,n=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,n,t.TEXTURE1),super.applyToWebGL(e),this.unbindAdditionalTexture(t,t.TEXTURE1)}createTexture(e,t){return e.getCachedTexture(t.cacheKey,t.getElement())}calculateMatrix(){const e=this.image,{width:t,height:n}=e.getElement();return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/n,1]}applyTo2d(e){let{imageData:{data:t,width:n,height:s},filterBackend:{resources:i}}=e;const r=this.image;i.blendImage||(i.blendImage=Db());const a=i.blendImage,o=a.getContext("2d");a.width!==n||a.height!==s?(a.width=n,a.height=s):o.clearRect(0,0,n,s),o.setTransform(r.scaleX,0,0,r.scaleY,r.left,r.top),o.drawImage(r.getElement(),0,0,n,s);const l=o.getImageData(0,0,n,s).data;for(let c=0;c<t.length;c+=4){const e=t[c],n=t[c+1],s=t[c+2],i=t[c+3],r=l[c],a=l[c+1],o=l[c+2],h=l[c+3];switch(this.mode){case"multiply":t[c]=e*r/255,t[c+1]=n*a/255,t[c+2]=s*o/255,t[c+3]=i*h/255;break;case"mask":t[c+3]=h}}}sendUniformData(e,t){const n=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,n)}toObject(){return wy(wy({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(e,t){let{type:n,image:s}=e,i=Sy(e,TA);return aA.fromObject(s,t).then(e=>new this(wy(wy({},i),{},{image:e})))}}by(MA,"type","BlendImage"),by(MA,"defaults",{mode:"multiply",alpha:1}),by(MA,"uniformLocations",["uTransformMatrix","uImage"]),yb.setClass(MA);class jA extends CA{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float totalC = 0.0;\n      float totalA = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);\n        float weight = 1.0 - abs(percent);\n        float alpha = weight * sample.a;\n        color.rgb += sample.rgb * alpha;\n        color.a += alpha;\n        totalA += weight;\n        totalC += alpha;\n      }\n      gl_FragColor.rgb = color.rgb / totalC;\n      gl_FragColor.a = color.a / totalA;\n    }\n  "}applyTo(e){yA(e)?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){let{imageData:{data:t,width:n,height:s}}=e;this.aspectRatio=n/s,this.horizontal=!0;let i=this.getBlurValue()*n;const r=new Uint8ClampedArray(t),a=4*n;for(let o=0;o<t.length;o+=4){let e=0,n=0,s=0,l=0,c=0;const h=o-o%a,u=h+a;for(let r=-14;r<15;r++){const a=r/15,d=4*Math.floor(i*a),f=1-Math.abs(a);let p=o+d;p<h?p=h:p>u&&(p=u);const g=t[p+3]*f;e+=t[p]*g,n+=t[p+1]*g,s+=t[p+2]*g,l+=g,c+=f}r[o]=e/l,r[o+1]=n/l,r[o+2]=s/l,r[o+3]=l/c}this.horizontal=!1,i=this.getBlurValue()*s;for(let o=0;o<r.length;o+=4){let e=0,n=0,s=0,l=0,c=0;const h=o%a,u=r.length-a+h;for(let t=-14;t<15;t++){const d=t/15,f=Math.floor(i*d)*a,p=1-Math.abs(d);let g=o+f;g<h?g=h:g>u&&(g=u);const m=r[g+3]*p;e+=r[g]*m,n+=r[g+1]*m,s+=r[g+2]*m,l+=m,c+=p}t[o]=e/l,t[o+1]=n/l,t[o+2]=s/l,t[o+3]=l/c}}sendUniformData(e,t){const n=this.chooseRightDelta();e.uniform2fv(t.uDelta,n)}isNeutralState(){return 0===this.blur}getBlurValue(){let e=1;const{horizontal:t,aspectRatio:n}=this;return t?n>1&&(e=1/n):n<1&&(e=n),e*this.blur*.12}chooseRightDelta(){const e=this.getBlurValue();return this.horizontal?[e,0]:[0,e]}}by(jA,"type","Blur"),by(jA,"defaults",{blur:0}),by(jA,"uniformLocations",["uDelta"]),yb.setClass(jA);class PA extends CA{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(e){let{imageData:{data:t}}=e;const n=Math.round(255*this.brightness);for(let s=0;s<t.length;s+=4)t[s]+=n,t[s+1]+=n,t[s+2]+=n}isNeutralState(){return 0===this.brightness}sendUniformData(e,t){e.uniform1f(t.uBrightness,this.brightness)}}by(PA,"type","Brightness"),by(PA,"defaults",{brightness:0}),by(PA,"uniformLocations",["uBrightness"]),yb.setClass(PA);const OA={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class DA extends CA{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(e){const t=e.imageData.data,n=this.matrix,s=this.colorsOnly;for(let i=0;i<t.length;i+=4){const e=t[i],r=t[i+1],a=t[i+2];if(t[i]=e*n[0]+r*n[1]+a*n[2]+255*n[4],t[i+1]=e*n[5]+r*n[6]+a*n[7]+255*n[9],t[i+2]=e*n[10]+r*n[11]+a*n[12]+255*n[14],!s){const s=t[i+3];t[i]+=s*n[3],t[i+1]+=s*n[8],t[i+2]+=s*n[13],t[i+3]=e*n[15]+r*n[16]+a*n[17]+s*n[18]+255*n[19]}}}sendUniformData(e,t){const n=this.matrix,s=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],i=[n[4],n[9],n[14],n[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,s),e.uniform4fv(t.uConstants,i)}toObject(){return wy(wy({},super.toObject()),{},{matrix:[...this.matrix]})}}function NA(e,t){var n;const s=(by(n=class extends DA{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",e),by(n,"defaults",{colorsOnly:!1,matrix:t}),n);return yb.setClass(s,e),s}by(DA,"type","ColorMatrix"),by(DA,"defaults",OA),by(DA,"uniformLocations",["uColorMatrix","uConstants"]),yb.setClass(DA);const LA=NA("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),RA=NA("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),FA=NA("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),IA=NA("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),zA=NA("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),WA=NA("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),BA=NA("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class HA extends CA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.subFilters=e.subFilters||[]}applyTo(e){yA(e)&&(e.passes+=this.subFilters.length-1),this.subFilters.forEach(t=>{t.applyTo(e)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(e=>e.toObject())}}isNeutralState(){return!this.subFilters.some(e=>!e.isNeutralState())}static fromObject(e,t){return Promise.all((e.subFilters||[]).map(e=>yb.getClass(e.type).fromObject(e,t))).then(e=>new this({subFilters:e}))}}by(HA,"type","Composed"),yb.setClass(HA);class UA extends CA{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(e){let{imageData:{data:t}}=e;const n=Math.floor(255*this.contrast),s=259*(n+255)/(255*(259-n));for(let i=0;i<t.length;i+=4)t[i]=s*(t[i]-128)+128,t[i+1]=s*(t[i+1]-128)+128,t[i+2]=s*(t[i+2]-128)+128}sendUniformData(e,t){e.uniform1f(t.uContrast,this.contrast)}}by(UA,"type","Contrast"),by(UA,"defaults",{contrast:0}),by(UA,"uniformLocations",["uContrast"]),yb.setClass(UA);const VA={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class GA extends CA{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return VA[this.getCacheKey()]}applyTo2d(e){const t=e.imageData,n=t.data,s=this.matrix,i=Math.round(Math.sqrt(s.length)),r=Math.floor(i/2),a=t.width,o=t.height,l=e.ctx.createImageData(a,o),c=l.data,h=this.opaque?1:0;let u,d,f,p,g,m,v,y,b,x,w,S,_;for(w=0;w<o;w++)for(x=0;x<a;x++){for(g=4*(w*a+x),u=0,d=0,f=0,p=0,_=0;_<i;_++)for(S=0;S<i;S++)v=w+_-r,m=x+S-r,v<0||v>=o||m<0||m>=a||(y=4*(v*a+m),b=s[_*i+S],u+=n[y]*b,d+=n[y+1]*b,f+=n[y+2]*b,h||(p+=n[y+3]*b));c[g]=u,c[g+1]=d,c[g+2]=f,c[g+3]=h?n[g+3]:p}e.imageData=l}sendUniformData(e,t){e.uniform1fv(t.uMatrix,this.matrix)}toObject(){return wy(wy({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}by(GA,"type","Convolute"),by(GA,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),by(GA,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),yb.setClass(GA);const XA="Gamma";class YA extends CA{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.gamma=e.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(e){let{imageData:{data:t}}=e;const n=this.gamma,s=1/n[0],i=1/n[1],r=1/n[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const a=this.rgbValues;for(let o=0;o<256;o++)a.r[o]=255*Math.pow(o/255,s),a.g[o]=255*Math.pow(o/255,i),a.b[o]=255*Math.pow(o/255,r);for(let o=0;o<t.length;o+=4)t[o]=a.r[t[o]],t[o+1]=a.g[t[o+1]],t[o+2]=a.b[t[o+2]]}sendUniformData(e,t){e.uniform3fv(t.uGamma,this.gamma)}isNeutralState(){const{gamma:e}=this;return 1===e[0]&&1===e[1]&&1===e[2]}toObject(){return{type:XA,gamma:this.gamma.concat()}}}by(YA,"type",XA),by(YA,"defaults",{gamma:[1,1,1]}),by(YA,"uniformLocations",["uGamma"]),yb.setClass(YA);const qA={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class KA extends CA{applyTo2d(e){let{imageData:{data:t}}=e;for(let n,s=0;s<t.length;s+=4){const e=t[s],i=t[s+1],r=t[s+2];switch(this.mode){case"average":n=(e+i+r)/3;break;case"lightness":n=(Math.min(e,i,r)+Math.max(e,i,r))/2;break;case"luminosity":n=.21*e+.72*i+.07*r}t[s+2]=t[s+1]=t[s]=n}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return qA[this.mode]}sendUniformData(e,t){e.uniform1i(t.uMode,1)}isNeutralState(){return!1}}by(KA,"type","Grayscale"),by(KA,"defaults",{mode:"average"}),by(KA,"uniformLocations",["uMode"]),yb.setClass(KA);const QA=wy(wy({},OA),{},{rotation:0});class $A extends DA{calculateMatrix(){const e=this.rotation*Math.PI,t=Sb(e),n=_b(e),s=1/3,i=Math.sqrt(s)*n,r=1-t;this.matrix=[t+r/3,s*r-i,s*r+i,0,0,s*r+i,t+s*r,s*r-i,0,0,s*r-i,s*r+i,t+s*r,0,0,0,0,0,1,0]}isNeutralState(){return 0===this.rotation}applyTo(e){this.calculateMatrix(),super.applyTo(e)}toObject(){return{type:this.type,rotation:this.rotation}}}by($A,"type","HueRotation"),by($A,"defaults",QA),yb.setClass($A);class JA extends CA{applyTo2d(e){let{imageData:{data:t}}=e;for(let n=0;n<t.length;n+=4)t[n]=255-t[n],t[n+1]=255-t[n+1],t[n+2]=255-t[n+2],this.alpha&&(t[n+3]=255-t[n+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(e,t){e.uniform1i(t.uInvert,Number(this.invert)),e.uniform1i(t.uAlpha,Number(this.alpha))}}by(JA,"type","Invert"),by(JA,"defaults",{alpha:!1,invert:!0}),by(JA,"uniformLocations",["uInvert","uAlpha"]),yb.setClass(JA);class ZA extends CA{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(e){let{imageData:{data:t}}=e;const n=this.noise;for(let s=0;s<t.length;s+=4){const e=(.5-Math.random())*n;t[s]+=e,t[s+1]+=e,t[s+2]+=e}}sendUniformData(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}by(ZA,"type","Noise"),by(ZA,"defaults",{noise:0}),by(ZA,"uniformLocations",["uNoise","uSeed"]),yb.setClass(ZA);class eE extends CA{applyTo2d(e){let{imageData:{data:t,width:n,height:s}}=e;for(let i=0;i<s;i+=this.blocksize)for(let e=0;e<n;e+=this.blocksize){const r=4*i*n+4*e,a=t[r],o=t[r+1],l=t[r+2],c=t[r+3];for(let h=i;h<Math.min(i+this.blocksize,s);h++)for(let s=e;s<Math.min(e+this.blocksize,n);s++){const e=4*h*n+4*s;t[e]=a,t[e+1]=o,t[e+2]=l,t[e+3]=c}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}by(eE,"type","Pixelate"),by(eE,"defaults",{blocksize:4}),by(eE,"uniformLocations",["uBlocksize"]),yb.setClass(eE);class tE extends CA{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(e){let{imageData:{data:t}}=e;const n=255*this.distance,s=new Zx(this.color).getSource(),i=[s[0]-n,s[1]-n,s[2]-n],r=[s[0]+n,s[1]+n,s[2]+n];for(let a=0;a<t.length;a+=4){const e=t[a],n=t[a+1],s=t[a+2];e>i[0]&&n>i[1]&&s>i[2]&&e<r[0]&&n<r[1]&&s<r[2]&&(t[a+3]=0)}}sendUniformData(e,t){const n=new Zx(this.color).getSource(),s=this.distance,i=[0+n[0]/255-s,0+n[1]/255-s,0+n[2]/255-s,1],r=[n[0]/255+s,n[1]/255+s,n[2]/255+s,1];e.uniform4fv(t.uLow,i),e.uniform4fv(t.uHigh,r)}}by(tE,"type","RemoveColor"),by(tE,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),by(tE,"uniformLocations",["uLow","uHigh"]),yb.setClass(tE);class nE extends CA{sendUniformData(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)}getFilterWindow(){const e=this.tempScale;return Math.ceil(this.lanczosLobes/e)}getCacheKey(){const e=this.getFilterWindow();return"".concat(this.type,"_").concat(e)}getFragmentSource(){const e=this.getFilterWindow();return this.generateShader(e)}getTaps(){const e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,n=this.getFilterWindow(),s=new Array(n);for(let i=1;i<=n;i++)s[i-1]=e(i*t);return s}generateShader(e){const t=new Array(e);for(let n=1;n<=e;n++)t[n-1]="".concat(n,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(e,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(t.map((e,t)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(e,") * uTaps[").concat(t,"] + texture2D(uTexture, vTexCoord - ").concat(e,") * uTaps[").concat(t,"];\n              sum += 2.0 * uTaps[").concat(t,"];\n            ")).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(e){e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,super.applyTo(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,super.applyTo(e),e.sourceHeight=e.destinationHeight}applyTo(e){yA(e)?this.applyToForWebgl(e):this.applyTo2d(e)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(e){return t=>{if(t>=e||t<=-e)return 0;if(t<1.1920929e-7&&t>-1.1920929e-7)return 1;const n=(t*=Math.PI)/e;return Math.sin(t)/t*Math.sin(n)/n}}applyTo2d(e){const t=e.imageData,n=this.scaleX,s=this.scaleY;this.rcpScaleX=1/n,this.rcpScaleY=1/s;const i=t.width,r=t.height,a=Math.round(i*n),o=Math.round(r*s);let l;l="sliceHack"===this.resizeType?this.sliceByTwo(e,i,r,a,o):"hermite"===this.resizeType?this.hermiteFastResize(e,i,r,a,o):"bilinear"===this.resizeType?this.bilinearFiltering(e,i,r,a,o):"lanczos"===this.resizeType?this.lanczosResize(e,i,r,a,o):new ImageData(a,o),e.imageData=l}sliceByTwo(e,t,n,s,i){const r=e.imageData,a=.5;let o=!1,l=!1,c=t*a,h=n*a;const u=e.filterBackend.resources;let d=0,f=0;const p=t;let g=0;u.sliceByTwo||(u.sliceByTwo=Db());const m=u.sliceByTwo;(m.width<1.5*t||m.height<n)&&(m.width=1.5*t,m.height=n);const v=m.getContext("2d");for(v.clearRect(0,0,1.5*t,n),v.putImageData(r,0,0),s=Math.floor(s),i=Math.floor(i);!o||!l;)t=c,n=h,s<Math.floor(c*a)?c=Math.floor(c*a):(c=s,o=!0),i<Math.floor(h*a)?h=Math.floor(h*a):(h=i,l=!0),v.drawImage(m,d,f,t,n,p,g,c,h),d=p,f=g,g+=h;return v.getImageData(d,f,s,i)}lanczosResize(e,t,n,s,i){const r=e.imageData.data,a=e.ctx.createImageData(s,i),o=a.data,l=this.lanczosCreate(this.lanczosLobes),c=this.rcpScaleX,h=this.rcpScaleY,u=2/this.rcpScaleX,d=2/this.rcpScaleY,f=Math.ceil(c*this.lanczosLobes/2),p=Math.ceil(h*this.lanczosLobes/2),g={},m={x:0,y:0},v={x:0,y:0};return function e(y){let b,x,w,S,_,C,k,A,E,T,M;for(m.x=(y+.5)*c,v.x=Math.floor(m.x),b=0;b<i;b++){for(m.y=(b+.5)*h,v.y=Math.floor(m.y),_=0,C=0,k=0,A=0,E=0,x=v.x-f;x<=v.x+f;x++)if(!(x<0||x>=t)){T=Math.floor(1e3*Math.abs(x-m.x)),g[T]||(g[T]={});for(let e=v.y-p;e<=v.y+p;e++)e<0||e>=n||(M=Math.floor(1e3*Math.abs(e-m.y)),g[T][M]||(g[T][M]=l(Math.sqrt(Math.pow(T*u,2)+Math.pow(M*d,2))/1e3)),w=g[T][M],w>0&&(S=4*(e*t+x),_+=w,C+=w*r[S],k+=w*r[S+1],A+=w*r[S+2],E+=w*r[S+3]))}S=4*(b*s+y),o[S]=C/_,o[S+1]=k/_,o[S+2]=A/_,o[S+3]=E/_}return++y<s?e(y):a}(0)}bilinearFiltering(e,t,n,s,i){let r,a,o,l,c,h,u,d,f,p,g,m,v,y=0;const b=this.rcpScaleX,x=this.rcpScaleY,w=4*(t-1),S=e.imageData.data,_=e.ctx.createImageData(s,i),C=_.data;for(u=0;u<i;u++)for(d=0;d<s;d++)for(c=Math.floor(b*d),h=Math.floor(x*u),f=b*d-c,p=x*u-h,v=4*(h*t+c),g=0;g<4;g++)r=S[v+g],a=S[v+4+g],o=S[v+w+g],l=S[v+w+4+g],m=r*(1-f)*(1-p)+a*f*(1-p)+o*p*(1-f)+l*f*p,C[y++]=m;return _}hermiteFastResize(e,t,n,s,i){const r=this.rcpScaleX,a=this.rcpScaleY,o=Math.ceil(r/2),l=Math.ceil(a/2),c=e.imageData.data,h=e.ctx.createImageData(s,i),u=h.data;for(let d=0;d<i;d++)for(let e=0;e<s;e++){const n=4*(e+d*s);let i=0,h=0,f=0,p=0,g=0,m=0,v=0;const y=(d+.5)*a;for(let s=Math.floor(d*a);s<(d+1)*a;s++){const n=Math.abs(y-(s+.5))/l,a=(e+.5)*r,u=n*n;for(let l=Math.floor(e*r);l<(e+1)*r;l++){let e=Math.abs(a-(l+.5))/o;const n=Math.sqrt(u+e*e);n>1&&n<-1||(i=2*n*n*n-3*n*n+1,i>0&&(e=4*(l+s*t),v+=i*c[e+3],f+=i,c[e+3]<255&&(i=i*c[e+3]/250),p+=i*c[e],g+=i*c[e+1],m+=i*c[e+2],h+=i))}}u[n]=p/h,u[n+1]=g/h,u[n+2]=m/h,u[n+3]=v/f}return h}}by(nE,"type","Resize"),by(nE,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),by(nE,"uniformLocations",["uDelta","uTaps"]),yb.setClass(nE);class sE extends CA{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(e){let{imageData:{data:t}}=e;const n=-this.saturation;for(let s=0;s<t.length;s+=4){const e=t[s],i=t[s+1],r=t[s+2],a=Math.max(e,i,r);t[s]+=a!==e?(a-e)*n:0,t[s+1]+=a!==i?(a-i)*n:0,t[s+2]+=a!==r?(a-r)*n:0}}sendUniformData(e,t){e.uniform1f(t.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}by(sE,"type","Saturation"),by(sE,"defaults",{saturation:0}),by(sE,"uniformLocations",["uSaturation"]),yb.setClass(sE);class iE extends CA{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(e){let{imageData:{data:t}}=e;const n=-this.vibrance;for(let s=0;s<t.length;s+=4){const e=t[s],i=t[s+1],r=t[s+2],a=Math.max(e,i,r),o=(e+i+r)/3,l=2*Math.abs(a-o)/255*n;t[s]+=a!==e?(a-e)*l:0,t[s+1]+=a!==i?(a-i)*l:0,t[s+2]+=a!==r?(a-r)*l:0}}sendUniformData(e,t){e.uniform1f(t.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}by(iE,"type","Vibrance"),by(iE,"defaults",{vibrance:0}),by(iE,"uniformLocations",["uVibrance"]),yb.setClass(iE);Object.freeze({__proto__:null,BaseFilter:CA,BlackWhite:BA,BlendColor:AA,BlendImage:MA,Blur:jA,Brightness:PA,Brownie:LA,ColorMatrix:DA,Composed:HA,Contrast:UA,Convolute:GA,Gamma:YA,Grayscale:KA,HueRotation:$A,Invert:JA,Kodachrome:FA,Noise:ZA,Pixelate:eE,Polaroid:zA,RemoveColor:tE,Resize:nE,Saturation:sE,Sepia:WA,Technicolor:IA,Vibrance:iE,Vintage:RA});lv.workerSrc="".concat("/EduSite","/pdf.worker.min.mjs");const rE={editorContainer:{display:"flex",flexDirection:"column",height:"100%",border:"1px solid #ccc",borderRadius:"4px",overflow:"hidden"},toolbar:{padding:"8px 12px",borderBottom:"1px solid #ddd",backgroundColor:"#f8f9fa",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"10px"},toolButton:{padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",cursor:"pointer",backgroundColor:"#fff",transition:"background-color 0.2s ease"},activeToolButton:{backgroundColor:"#007bff",color:"white",borderColor:"#007bff"},inputGroup:{display:"flex",alignItems:"center",gap:"5px"},inputField:{padding:"6px",border:"1px solid #ccc",borderRadius:"4px"},scoreInput:{width:"70px"},notesTextarea:{minWidth:"200px",flexGrow:1,resize:"vertical"},pdfDisplayArea:{flexGrow:1,overflowY:"scroll",backgroundColor:"#e9ecef",padding:"10px 0"},pageContainer:{position:"relative",margin:"20px auto",display:"flex",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},fabricCanvasOverlay:{position:"absolute",left:"50%",top:0,transform:"translateX(-50%)",zIndex:10},loadingOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,fontSize:"1.2em",color:"#333"}},aE=e=>{let{pdfUrl:n,submissionId:s,initialAnnotationData:i,initialScore:r,initialFeedback:a,onSaveSuccess:o,markType:l}=e;const[h,u]=(0,t.useState)(null),[d,f]=(0,t.useState)({}),[p,g]=(0,t.useState)("pen"),[m,v]=(0,t.useState)("#000000"),[y,b]=(0,t.useState)(5),x=(0,t.useRef)({}),[w,S]=(0,t.useState)(""),[_,C]=(0,t.useState)(""),[k,A]=(0,t.useState)(!1),[E,T]=(0,t.useState)({});(0,t.useEffect)(()=>{void 0!==r&&null!==r&&S(String(r))},[r]),(0,t.useEffect)(()=>{a&&C(a)},[a]);(0,t.useEffect)(()=>{if(h&&Object.keys(E).length===h){const t={};for(let e=1;e<=h;e++){const n=document.getElementById("fabric-canvas-".concat(e));if(n&&!d[e]){const{width:s,height:i}=E[e];t[e]=new GC(n,{width:s,height:i})}else d[e]&&(t[e]=d[e])}if(f(t),i)try{const e=JSON.parse(i);Object.entries(e).forEach(e=>{let[n,s]=e;const i=t[n];i&&i.loadFromJSON(s,()=>{requestAnimationFrame(()=>{i.renderAll(),i.getObjects().forEach(e=>{0!==e.opacity&&!1!==e.visible||(e.opacity=1,e.visible=!0)})})})})}catch(e){console.error("Failed to load annotation data:",e)}}},[E,h,i]);const M=(0,t.useCallback)((e,t)=>{if(!e||"string"!==typeof e||!e.startsWith("#")||7!==e.length&&4!==e.length)return"rgba(255, 255, 0, 0.3)";let n,s,i;return 4===e.length?(n=parseInt(e[1]+e[1],16),s=parseInt(e[2]+e[2],16),i=parseInt(e[3]+e[3],16)):(n=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16)),isNaN(n)||isNaN(s)||isNaN(i)?"rgba(255, 255, 0, 0.3)":"rgba(".concat(n,", ").concat(s,", ").concat(i,", ").concat(t,")")},[]),j=(0,t.useCallback)((e,t)=>{if(t)if("textbox"===p){if(e.target&&e.target instanceof qk)return t.setActiveObject(e.target),void e.target.enterEditing();const n=t.getPointer(e.e),s=new qk("",{left:n.x,top:n.y,fontFamily:"arial",fill:m,fontSize:20});t.add(s),t.setActiveObject(s),s.enterEditing()}else"eraser"===p&&e.target&&t.remove(e.target)},[p,m]);(0,t.useEffect)(()=>{Object.values(d).forEach(e=>{e&&(e.isDrawingMode=["pen","highlighter"].includes(p),e.selection=!e.isDrawingMode,"pen"!==p&&"highlighter"!==p||(e.freeDrawingBrush=new fk(e),e.freeDrawingBrush.width="highlighter"===p?3*parseInt(y,10):parseInt(y,10),e.freeDrawingBrush.color="highlighter"===p?M(m,.3):m),e.off("mouse:down"),["textbox","eraser"].includes(p)&&e.on("mouse:down",t=>j(t,e)))})},[p,m,y,d,j,M]);const P=e=>c(c({},rE.toolButton),p===e?rE.activeToolButton:{});return(0,_t.jsxs)("div",{style:rE.editorContainer,children:[k&&(0,_t.jsx)("div",{style:rE.loadingOverlay,children:"Saving... Please wait."}),(0,_t.jsxs)("div",{style:rE.toolbar,children:[(0,_t.jsx)("button",{style:P("pen"),onClick:()=>g("pen"),children:"Pen"}),(0,_t.jsx)("button",{style:P("highlighter"),onClick:()=>g("highlighter"),children:"Highlight"}),(0,_t.jsx)("button",{style:P("eraser"),onClick:()=>{"eraser"===p?Object.values(d).forEach(e=>{if(e instanceof GC){const t=e.getActiveObject();t&&("activeSelection"===t.type?t.forEachObject(t=>{e.remove(t)}):e.remove(t),e.discardActiveObject(),e.renderAll())}}):g("eraser")},children:"Eraser"}),(0,_t.jsx)("button",{style:P("textbox"),onClick:()=>g("textbox"),children:"Textbox"}),(0,_t.jsx)("div",{style:rE.inputGroup,children:(0,_t.jsx)("input",{type:"color",value:m,onChange:e=>v(e.target.value),style:c(c({},rE.inputField),{},{padding:"2px",height:"34px"})})}),(0,_t.jsxs)("div",{style:rE.inputGroup,children:[(0,_t.jsx)("label",{htmlFor:"brushSizeInput",children:"Size:"}),(0,_t.jsx)("input",{type:"range",id:"brushSizeInput",min:"1",max:"50",value:y,onChange:e=>b(e.target.value),style:{margin:"0 5px"}})," ",y]})]}),(0,_t.jsxs)("div",{style:c(c({},rE.toolbar),{},{borderTop:"1px solid #ddd",justifyContent:"space-between"}),children:[(0,_t.jsxs)("div",{style:rE.inputGroup,children:[(0,_t.jsx)("label",{htmlFor:"scoreInput",children:"Score:"}),(0,_t.jsx)("input",{type:"number",id:"scoreInput",value:w,onChange:e=>S(e.target.value),style:c(c({},rE.inputField),rE.scoreInput)})]}),(0,_t.jsxs)("div",{style:c(c({},rE.inputGroup),{},{flexGrow:1,margin:"0 1rem"}),children:[(0,_t.jsx)("label",{htmlFor:"feedbackInput",children:"Feedback:"}),(0,_t.jsx)("textarea",{id:"feedbackInput",value:_,onChange:e=>C(e.target.value),placeholder:"Provide overall feedback...",style:c(c({},rE.inputField),{},{width:"100%",resize:"none"}),rows:"1"})]}),(0,_t.jsx)("button",{onClick:async()=>{if(!s)return void alert("Submission ID is missing. Cannot save.");A(!0);const e={};Object.entries(d).forEach(t=>{let[n,s]=t;s&&(e[n]=s.toJSON())});const t=JSON.stringify(e),n={submissionId:s,score:w,annotationData:t,feedback:_};console.log({submissionId:s,score:w,annotationData:t,feedback:_});const i=localStorage.getItem("token")||sessionStorage.getItem("token");if(!i)return alert("Authentication token not found."),void A(!1);try{const e="".concat(Et,"exam"===l?"/exams/mark":"/assignments/mark"),t=await fetch(e,{method:"PUT",headers:{Authorization:"MonaEdu ".concat(i),"Content-Type":"application/json"},body:JSON.stringify(n)}),s=await t.json();if(!t.ok)throw new Error(s.message||"Server error: ".concat(t.status));if(!["Marked PDF uploaded successfully","Submission marked and replaced successfully"].includes(s.message))throw new Error(s.message||"An unexpected response was received from the server.");alert("Marks and annotations saved successfully!"),o&&o()}catch(r){console.error("Error saving annotations:",r),alert("Error: ".concat(r.message))}finally{A(!1)}},disabled:k||!h,style:rE.toolButton,children:k?"Saving...":"Save Changes"})]}),(0,_t.jsx)("div",{style:rE.pdfDisplayArea,children:(0,_t.jsx)(Xv,{file:n,onLoadSuccess:e=>{let{numPages:t}=e;u(t),T({}),Object.values(d).forEach(e=>{e&&"function"===typeof e.dispose&&e.dispose()}),f({}),x.current={}},onLoadError:e=>console.error("Error loading PDF:",e.message),children:Array.from(new Array(h||0),(e,t)=>(0,_t.jsxs)("div",{style:rE.pageContainer,children:[(0,_t.jsx)(dy,{pageNumber:t+1,renderAnnotationLayer:!1,renderTextLayer:!1,onRenderSuccess:e=>{T(n=>c(c({},n),{},{[t+1]:{width:e.width,height:e.height}}))}},"page_".concat(t+1)),(0,_t.jsx)("div",{style:rE.fabricCanvasOverlay,children:E[t+1]&&(0,_t.jsx)("canvas",{id:"fabric-canvas-".concat(t+1),width:E[t+1].width,height:E[t+1].height})})]},"page_container_".concat(t+1)))})})]})},oE=()=>{var e;const{groupId:n,assignmentId:s}=pe(),[i,r]=(0,t.useState)([]),[a,o]=(0,t.useState)(!0),[l,c]=(0,t.useState)(null),[h,u]=(0,t.useState)(""),[d,f]=(0,t.useState)(""),[p,g]=(0,t.useState)("all"),[m,v]=(0,t.useState)("name"),[y,b]=(0,t.useState)("asc"),[x,w]=(0,t.useState)(!1),[S,_]=(0,t.useState)(null),C=(0,t.useCallback)(async()=>{o(!0),c(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=await fetch("".concat(Et,"/assignments/submissions?assignmentId=").concat(s,"&groupId=").concat(n),{headers:{Authorization:"MonaEdu ".concat(e)}}),i=await t.json();if("Submission status for group fetched successfully."!==i.message)throw new Error(i.message||"Failed to fetch submissions");r(i.data),u(i.assignmentName||"")}catch(e){c(e.message)}finally{o(!1)}},[s,n]);(0,t.useEffect)(()=>{C()},[C]);const k=()=>{w(!1),_(null)};if(a)return(0,_t.jsx)("div",{className:"loading",children:"Loading submissions..."});if(l)return(0,_t.jsx)("div",{className:"error",children:l});const A=(()=>{let e=[...i];return"all"!==p&&(e=e.filter(e=>e.status===p)),e.sort((e,t)=>{if("name"===m){const n="".concat(e.firstName," ").concat(e.lastName).toLowerCase(),s="".concat(t.firstName," ").concat(t.lastName).toLowerCase();return"asc"===y?n.localeCompare(s):s.localeCompare(n)}if("date"===m){var n,s;const i=(null===(n=e.submissionDetails)||void 0===n?void 0:n.SubmitDate)||"",r=(null===(s=t.submissionDetails)||void 0===s?void 0:s.SubmitDate)||"";return"asc"===y?i.localeCompare(r):r.localeCompare(i)}return 0}),e})(),E=(()=>{const e=i.length,t=i.filter(e=>"submitted"===e.status).length;return{total:e,submitted:t,percentage:e>0?Math.round(t/e*100):0}})();return(0,_t.jsxs)("div",{className:"assignment-submissions-page",children:[h&&(0,_t.jsx)("div",{className:"assignment-header",children:(0,_t.jsx)("h2",{children:h})}),(0,_t.jsx)("div",{className:"submissions-stats",children:(0,_t.jsxs)("div",{className:"stat-card",children:[(0,_t.jsx)("h3",{children:"Submission Statistics"}),(0,_t.jsxs)("p",{children:[E.submitted," submitted out of ",E.total," total students"]}),(0,_t.jsxs)("p",{className:"percentage",children:[E.percentage,"% submission rate"]})]})}),(0,_t.jsxs)("div",{className:"filters-section",children:[(0,_t.jsxs)("div",{className:"filter-group",children:[(0,_t.jsx)("label",{children:"Status:"}),(0,_t.jsxs)("select",{value:p,onChange:e=>g(e.target.value),children:[(0,_t.jsx)("option",{value:"all",children:"All"}),(0,_t.jsx)("option",{value:"submitted",children:"Submitted"}),(0,_t.jsx)("option",{value:"not submitted",children:"Not Submitted"})]})]}),(0,_t.jsxs)("div",{className:"filter-group",children:[(0,_t.jsx)("label",{children:"Sort by:"}),(0,_t.jsxs)("select",{value:m,onChange:e=>v(e.target.value),children:[(0,_t.jsx)("option",{value:"name",children:"Name"}),(0,_t.jsx)("option",{value:"date",children:"Submission Date"})]}),(0,_t.jsx)("button",{className:"sort-order-btn",onClick:()=>b("asc"===y?"desc":"asc"),children:"asc"===y?"\u2191":"\u2193"})]})]}),(0,_t.jsx)("div",{className:"submissions-table-container",children:(0,_t.jsxs)("table",{className:"submissions-table",children:[(0,_t.jsx)("thead",{children:(0,_t.jsxs)("tr",{children:[(0,_t.jsx)("th",{children:"Student Name"}),(0,_t.jsx)("th",{children:"Username"}),(0,_t.jsx)("th",{children:"Status"}),(0,_t.jsx)("th",{children:"Submission Date"}),(0,_t.jsx)("th",{children:"Student Notes"}),(0,_t.jsx)("th",{children:"Feedback"}),(0,_t.jsx)("th",{children:"Grade"}),(0,_t.jsx)("th",{children:"Actions"})]})}),(0,_t.jsx)("tbody",{children:A.map(e=>{var t,r,a,o;return(0,_t.jsxs)("tr",{children:[(0,_t.jsxs)("td",{children:[e.firstName," ",e.lastName]}),(0,_t.jsxs)("td",{children:[e.userName," ",(0,_t.jsx)("br",{})," ",(0,_t.jsxs)("p",{children:["id: ",e._id]})]}),(0,_t.jsx)("td",{children:(0,_t.jsx)("span",{className:"status-badge ".concat("submitted"===e.status?"submitted":"not-submitted"),children:e.status})}),(0,_t.jsx)("td",{children:null!==(t=e.submissionDetails)&&void 0!==t&&t.SubmitDate?new Date(e.submissionDetails.SubmitDate).toLocaleDateString():"-"}),(0,_t.jsx)("td",{children:(null===(r=e.submissionDetails)||void 0===r?void 0:r.notes)||"-"}),(0,_t.jsx)("td",{children:(null===(a=e.submissionDetails)||void 0===a?void 0:a.teacherFeedback)||"-"}),(0,_t.jsx)("td",{children:(null===(o=e.submissionDetails)||void 0===o?void 0:o.score)||"-"}),(0,_t.jsx)("td",{children:(0,_t.jsx)("div",{className:"action-buttons",children:(0,_t.jsx)("button",{className:"mark-btn",onClick:()=>(async e=>{try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),r=await fetch("".concat(Et,"/assignments/submissions?assignmentId=").concat(s,"&groupId=").concat(n,"&studentId=").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}}),a=await r.json();if(console.log(a),"Submissions fetched successfully."===a.message&&a.data.length>0){const e=a.data[0];e.path?(f(i.notes),_(e),w(!0)):alert("No PDF file found for this submission.")}else alert("No submission found for this student.")}catch(l){console.error("Error in handleOpenMarkEditor: ",l),alert("Error fetching submission. Please try again.")}})(e._id),disabled:"submitted"!==e.status,children:"Mark / View"})})})]},e._id)})})]})}),S&&(0,_t.jsxs)(Bt(),{isOpen:x,onRequestClose:k,contentLabel:"Mark Submission PDF",className:"pdf-editor-modal",overlayClassName:"pdf-editor-modal-overlay",children:[(0,_t.jsxs)("div",{className:"modal-header",children:[(0,_t.jsxs)("h2",{children:["Marking: ",S.studentId.firstName," ",S.studentId.lastName,"'s Submission"]}),(0,_t.jsx)("button",{onClick:k,className:"close-modal-btn",children:"\xd7"})]}),(0,_t.jsx)("div",{className:"modal-body",children:(0,_t.jsx)(aE,{pdfUrl:S.path,submissionId:S._id,initialAnnotationData:S.annotationData,initialScore:null===(e=S.submissionDetails)||void 0===e?void 0:e.score,onSaveSuccess:()=>{k(),C()},markType:"assignment"})})]})]})},lE=()=>{const{groupId:e,examId:n}=pe(),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,l]=(0,t.useState)(null),[c,h]=(0,t.useState)("all"),[u,d]=(0,t.useState)("name"),[f,p]=(0,t.useState)("asc"),[g,m]=(0,t.useState)(!1),[v,y]=(0,t.useState)(null),b=(0,t.useCallback)(async()=>{a(!0),l(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),s=await fetch("".concat(Et,"/exams/student/submissions?groupId=").concat(e,"&examId=").concat(n),{headers:{Authorization:"MonaEdu ".concat(t)}}),r=await s.json();if("Student submission statuses fetched successfully"!==r.message)throw new Error(r.message||"Failed to fetch submissions");i(r.students)}catch(t){l(t.message)}finally{a(!1)}},[n,e]);(0,t.useEffect)(()=>{b()},[b]);const x=()=>{m(!1),y(null)};if(r)return(0,_t.jsx)("div",{className:"loading",children:"Loading submissions..."});if(o)return(0,_t.jsx)("div",{className:"error",children:o});const w=(()=>{let e=[...s];return"all"!==c&&(e=e.filter(e=>e.status===c)),e.sort((e,t)=>{if("name"===u){const n="".concat(e.firstName," ").concat(e.lastName).toLowerCase(),s="".concat(t.firstName," ").concat(t.lastName).toLowerCase();return"asc"===f?n.localeCompare(s):s.localeCompare(n)}if("date"===u){const n=e.submittedAt||"",s=t.submittedAt||"";return"asc"===f?n.localeCompare(s):s.localeCompare(n)}return 0}),e})(),S=(()=>{const e=s.length,t=s.filter(e=>"submitted"===e.status).length;return{total:e,submitted:t,percentage:e>0?Math.round(t/e*100):0}})();return(0,_t.jsxs)("div",{className:"assignment-submissions-page",children:[(0,_t.jsx)("div",{className:"submissions-stats",children:(0,_t.jsxs)("div",{className:"stat-card",children:[(0,_t.jsx)("h3",{children:"Submission Statistics"}),(0,_t.jsxs)("p",{children:[S.submitted," submitted out of ",S.total," total students"]}),(0,_t.jsxs)("p",{className:"percentage",children:[S.percentage,"% submission rate"]})]})}),(0,_t.jsxs)("div",{className:"filters-section",children:[(0,_t.jsxs)("div",{className:"filter-group",children:[(0,_t.jsx)("label",{children:"Status:"}),(0,_t.jsxs)("select",{value:c,onChange:e=>h(e.target.value),children:[(0,_t.jsx)("option",{value:"all",children:"All"}),(0,_t.jsx)("option",{value:"submitted",children:"Submitted"}),(0,_t.jsx)("option",{value:"not submitted",children:"Not Submitted"})]})]}),(0,_t.jsxs)("div",{className:"filter-group",children:[(0,_t.jsx)("label",{children:"Sort by:"}),(0,_t.jsxs)("select",{value:u,onChange:e=>d(e.target.value),children:[(0,_t.jsx)("option",{value:"name",children:"Name"}),(0,_t.jsx)("option",{value:"date",children:"Submission Date"})]}),(0,_t.jsx)("button",{className:"sort-order-btn",onClick:()=>p("asc"===f?"desc":"asc"),children:"asc"===f?"\u2191":"\u2193"})]})]}),(0,_t.jsx)("div",{className:"submissions-table-container",children:(0,_t.jsxs)("table",{className:"submissions-table",children:[(0,_t.jsx)("thead",{children:(0,_t.jsxs)("tr",{children:[(0,_t.jsx)("th",{children:"Student Name"}),(0,_t.jsx)("th",{children:"Status"}),(0,_t.jsx)("th",{children:"Submission Date"}),(0,_t.jsx)("th",{children:"Student Notes"}),(0,_t.jsx)("th",{children:"Feedback"}),(0,_t.jsx)("th",{children:"Grade"}),(0,_t.jsx)("th",{children:"Actions"})]})}),(0,_t.jsx)("tbody",{children:w.map(t=>(0,_t.jsxs)("tr",{children:[(0,_t.jsxs)("td",{children:[t.firstName," ",t.lastName]}),(0,_t.jsx)("td",{children:(0,_t.jsx)("span",{className:"status-badge ".concat("submitted"===t.status?"submitted":"not-submitted"),children:t.status})}),(0,_t.jsx)("td",{children:t.submittedAt?new Date(t.submittedAt).toLocaleDateString():"-"}),(0,_t.jsx)("td",{children:t.notes||"-"}),(0,_t.jsx)("td",{children:t.teacherFeedback||"-"}),(0,_t.jsx)("td",{children:t.score||"-"}),(0,_t.jsx)("td",{children:(0,_t.jsx)("div",{className:"action-buttons",children:(0,_t.jsx)("button",{className:"mark-btn",onClick:()=>(async t=>{try{const s=localStorage.getItem("token")||sessionStorage.getItem("token"),i=await fetch("".concat(Et,"/exams/submissions?examId=").concat(n,"&studentId=").concat(t,"&groupId=").concat(e),{headers:{authorization:"MonaEdu ".concat(s)}}),r=await i.json();if(console.log("api call : ","".concat(Et,"/exams/submissions?examId=").concat(n,"&groupId=").concat(e,"&studentId=").concat(t)),console.log(r),"Student submission statuses fetched successfully."===r.message&&r.data.length>0){const e=r.data[0];e.submissions[0].filePath?(y(e),m(!0)):alert("No PDF file found for this submission.")}else alert("No submission found for this student.")}catch(o){console.error("Error in handleOpenMarkEditor: ",o),alert("Error fetching submission. Please try again.")}})(t._id),disabled:"submitted"!==t.status,children:"Mark / View"})})})]},t._id))})]})}),v&&(0,_t.jsxs)(Bt(),{isOpen:g,onRequestClose:x,contentLabel:"Mark Exam Submission PDF",className:"pdf-editor-modal",overlayClassName:"pdf-editor-modal-overlay",children:[(0,_t.jsxs)("div",{className:"modal-header",children:[(0,_t.jsxs)("h2",{children:["Marking: ",v.studentId.firstName," ",v.studentId.lastName,"'s Submission"]}),(0,_t.jsx)("button",{onClick:x,className:"close-modal-btn",children:"\xd7"})]}),(0,_t.jsx)("div",{className:"modal-body",children:(0,_t.jsx)(aE,{pdfUrl:v.filePath,submissionId:v._id,initialAnnotationData:v.annotationData,initialScore:v.score,onSaveSuccess:()=>{x(),b()},markType:"exam"})})]})]})},cE=()=>{const e=fe(),[n,s]=(0,t.useState)(""),[i,r]=(0,t.useState)([]),[a,o]=(0,t.useState)(null),[l,h]=(0,t.useState)([]),[u,d]=(0,t.useState)([]),[f,p]=(0,t.useState)(""),[g,m]=(0,t.useState)(!1),[v,y]=(0,t.useState)(!1),[b,x]=(0,t.useState)(null),[w,S]=(0,t.useState)(""),[_,C]=(0,t.useState)({description:"",name:"",file:null,startDate:"",endDate:""}),k=[12,11,10,9],A=e=>{const t=e.target.value;s(t),r([]),t?(async e=>{m(!0),x(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/group/grades?grade=").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Groups fetched successfully"===s.Message?(h(s.groups),s.groups.length>0&&p(s.groups[0].gradeid)):x("Failed to fetch groups")}catch(t){x("Error loading groups")}finally{m(!1)}})(t):h([])},E=async e=>{o(e),y(!0),x(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/sections?gradeId=").concat(f,"&groupIds=").concat(e),{method:"GET",headers:{Authorization:"MonaEdu ".concat(t)}}),s=await n.json();"Sections fetched successfully"===s.message?d(s.data||[]):"No sections found for this student."===s.message?x("No sessions found!"):(x("Failed to fetch sessions"),d([]))}catch(t){console.error("Error fetching exams:",t),x("Error loading sessions"),d([])}finally{y(!1)}};return(0,_t.jsxs)("div",{className:"exams-page",children:[(0,_t.jsxs)("div",{className:"exams-left",children:[(0,_t.jsx)("h2",{children:"Select Grade"}),(0,_t.jsx)("div",{className:"grades-list",children:k.map(e=>(0,_t.jsx)("div",{className:"grade-card ".concat(n===e?"selected":""),onClick:()=>A({target:{value:e}}),children:(0,_t.jsxs)("h3",{children:["Grade ",e]})},e))}),n&&(0,_t.jsxs)("div",{className:"groups-section",children:[(0,_t.jsxs)("h3",{children:["Groups in Grade ",n]}),g?(0,_t.jsx)("div",{className:"loading",children:"Loading groups..."}):b?(0,_t.jsx)("div",{className:"error",children:b}):(0,_t.jsx)("div",{className:"groups-list",children:l.map(e=>(0,_t.jsx)("div",{className:"group-item ".concat(a===e._id?"selected":""),onClick:()=>E(e._id),children:e.groupname},e._id))})]}),(u.length>0||v)&&(0,_t.jsxs)("div",{className:"sessions-section",children:[(0,_t.jsx)("h3",{children:"Sessions"}),v?(0,_t.jsx)("div",{className:"loading",children:"Loading sessions..."}):(0,_t.jsx)("ul",{className:"sessions-list",children:(Array.isArray(u)?u:[]).map(t=>(0,_t.jsxs)("li",{className:"session-card",onClick:()=>(t=>{a?e("/dashboard/sessions/".concat(t._id)):x("No group selected")})(t),children:[(0,_t.jsxs)("div",{className:"exam-info",children:[(0,_t.jsx)("span",{className:"exam-name",children:t.name}),(0,_t.jsx)("span",{className:"exam-dates",children:t.description})]}),(0,_t.jsx)("button",{className:"delete-btn",onClick:e=>{e.stopPropagation(),(async e=>{if(window.confirm("Are you sure you want to delete this session?"))try{const t=localStorage.getItem("token")||sessionStorage.getItem("token");if(!(await fetch("".concat(Et,"/sections/").concat(e),{method:"DELETE",headers:{Authorization:"MonaEdu ".concat(t)}})).ok)throw new Error("Failed to delete session");alert("Section container deleted successfully."),a&&E(a)}catch(t){console.error("Error deleting session:",t),alert("An error occurred while deleting the session.")}})(t._id)},children:" Delete "})]},t._id))})]})]}),(0,_t.jsxs)("div",{className:"exams-right",children:[(0,_t.jsx)("h2",{children:"Create new Session"}),(0,_t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),n&&0!==i.length&&_.name&&_.description){S("Creating session..."),x(null);try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t={name:_.name,description:_.description,gradeId:f,groupIds:i},n=await fetch("".concat(Et,"/sections/create"),{method:"POST",headers:{Authorization:"MonaEdu ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await n.json();if(!n.ok)throw new Error(s.message||"Failed to create session");if("Section container created successfully."!==s.message)throw new Error("Unexpected response format from server");S('Session "'.concat(s.data.name,'" created successfully')),C({name:"",description:""}),r([]),a&&E(a)}catch(t){console.error("Error creating session:",t),x(t.message||"Error creating session. Please try again."),S("")}}else x("Please select grade, group(s), and provide a session name and description.")},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Grade:"}),(0,_t.jsxs)("select",{value:n,onChange:A,required:!0,children:[(0,_t.jsx)("option",{value:"",children:"Select Grade"}),k.map(e=>(0,_t.jsxs)("option",{value:e,children:["Grade ",e]},e))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Groups:"}),g?(0,_t.jsx)("div",{children:"Loading groups..."}):(0,_t.jsxs)("div",{className:"groups-list",children:[(0,_t.jsx)("div",{className:"select-all group-checkbox-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",checked:i.length===l.length&&l.length>0,onChange:()=>{i.length===l.length?r([]):r(l.map(e=>e._id))}}),"Select All Groups"]})}),l.map(e=>(0,_t.jsx)("div",{className:"group-checkbox-row",children:(0,_t.jsxs)("label",{children:[(0,_t.jsx)("input",{type:"checkbox",checked:i.includes(e._id),onChange:()=>{r(t=>t.includes(e._id)?t.filter(t=>t!==e._id):[...t,e._id])}}),e.groupname]})},e._id))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Session Name:"}),(0,_t.jsx)("input",{type:"text",value:_.name,onChange:e=>C(c(c({},_),{},{name:e.target.value})),placeholder:"Enter Session Name",required:!0})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Description:"}),(0,_t.jsx)("textarea",{value:_.description,onChange:e=>C(c(c({},_),{},{description:e.target.value})),placeholder:"Enter a description for the session",required:!0})]}),b&&(0,_t.jsx)("div",{className:"error-message",children:b}),w&&(0,_t.jsx)("div",{className:"submit-status",children:w}),(0,_t.jsx)("button",{type:"submit",disabled:"Uploading exam..."===w,children:"Uploading exam..."===w?"Uploading...":"Submit"})]})]})]})},hE=()=>{const{sessionId:e}=pe(),[n,s]=(0,t.useState)(null),[i,r]=(0,t.useState)([]),[a,o]=(0,t.useState)([]),[l,h]=(0,t.useState)([]),u=fe(),d=he(),[f,p]=(0,t.useState)({exams:new Set,assignments:new Set,materials:new Set}),[g,m]=(0,t.useState)({exams:new Set,assignments:new Set,materials:new Set}),[v,y]=(0,t.useState)(!0),[b,x]=(0,t.useState)(null),[w,S]=(0,t.useState)(!1),_=(0,t.useCallback)(async()=>{try{y(!0),x(null);const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/sections/").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}});if(!n.ok)throw new Error("Failed to fetch session details.");const i=await n.json();if("Section content fetched successfully."!==i.message)throw new Error(i.message||"Could not fetch session data");s(i.data);const a=i.data.gradeId,l=new Set,c=new Set,u=new Set;i.data.content.forEach(e=>{"exam"===e.type?l.add(e.id):"assignment"===e.type?c.add(e.id):"material"===e.type&&u.add(e.id)}),p({exams:new Set(l),assignments:new Set(c),materials:new Set(u)}),m({exams:new Set(l),assignments:new Set(c),materials:new Set(u)});const[d,f,g]=await Promise.all([fetch("".concat(Et,"/exams?gradeId=").concat(a),{headers:{Authorization:"MonaEdu ".concat(t)}}),fetch("".concat(Et,"/assignments/all?gradeId=").concat(a),{headers:{Authorization:"MonaEdu ".concat(t)}}),fetch("".concat(Et,"/material?gradeId=").concat(a),{headers:{Authorization:"MonaEdu ".concat(t)}})]),v=await d.json(),b=await f.json(),w=await g.json();r(v.exams||[]),o(b.assignments||[]),h(w.materials||[])}catch(t){x(t.message)}finally{y(!1)}},[e,d.state]);(0,t.useEffect)(()=>{_()},[_]);if(v)return(0,_t.jsx)("div",{className:"loading",children:"Loading Session Details..."});if(b)return(0,_t.jsxs)("div",{className:"error",children:["Error: ",b]});if(!n)return(0,_t.jsx)("div",{className:"loading",children:"No session data found."});const C=(e,t,n)=>(0,_t.jsxs)("div",{className:"items-column",children:[(0,_t.jsx)("h3",{children:n}),(0,_t.jsx)("ul",{className:"items-list",children:e.length>0?e.map(e=>{const n=f[t].has(e._id);return(0,_t.jsxs)("li",{className:"item-card ".concat(n?"linked":""),children:[(0,_t.jsxs)("div",{className:"item-info",children:[(0,_t.jsx)("div",{className:"item-name",children:e.name||e.Name}),"exams"===t&&(0,_t.jsxs)("div",{className:"item-meta",children:[e.startdate&&(0,_t.jsxs)("span",{children:["Start: ",new Date(e.startdate).toLocaleString()]}),e.startdate&&e.enddate&&(0,_t.jsx)("span",{children:" | "}),e.enddate&&(0,_t.jsxs)("span",{children:["End: ",new Date(e.enddate).toLocaleString()]})]}),"assignments"===t&&(0,_t.jsxs)("div",{className:"item-meta",children:[e.startDate&&(0,_t.jsxs)("span",{children:["Start: ",new Date(e.startDate).toLocaleString()]}),e.startDate&&e.endDate&&(0,_t.jsx)("span",{children:" | "}),e.endDate&&(0,_t.jsxs)("span",{children:["End: ",new Date(e.endDate).toLocaleString()]})]})]}),(0,_t.jsx)("button",{className:"link-button ".concat(n?"remove":"add"),onClick:()=>((e,t)=>{p(n=>{const s=new Set(n[t]);return s.has(e)?s.delete(e):s.add(e),c(c({},n),{},{[t]:s})})})(e._id,t),children:n?"Unlink":"Link"})]},e._id)}):(0,_t.jsxs)("p",{children:["No ",t," available for this grade."]})})]});return(0,_t.jsxs)("div",{className:"session-details-page",children:[(0,_t.jsx)("div",{className:"session-header",children:(0,_t.jsxs)("div",{className:"session-title-header",children:[(0,_t.jsx)("h2",{className:"session-name",children:n.name}),(0,_t.jsx)("button",{className:"delete-session-btn",onClick:async()=>{if(window.confirm("Are you sure you want to permanently delete this session? This will not delete the linked items, but it will remove the session itself."))try{const t=localStorage.getItem("token")||sessionStorage.getItem("token");if(!(await fetch("".concat(Et,"/sections/").concat(e),{method:"DELETE",headers:{Authorization:"MonaEdu ".concat(t)}})).ok)throw new Error("Failed to delete session");alert("Session deleted successfully."),u("/dashboard/sessions")}catch(t){console.error("Error deleting session:",t),alert("An error occurred while deleting the session.")}},children:"Delete Session"})]})}),(0,_t.jsx)("p",{className:"session-description",children:n.description}),(0,_t.jsxs)("div",{className:"linking-container",children:[C(a,"assignments","Available Assignments"),C(i,"exams","Available Exams"),C(l,"materials","Available Materials")]}),(0,_t.jsx)("div",{className:"actions-footer",children:(0,_t.jsx)("button",{onClick:async()=>{S(!0),x(null);const t=f.exams,n=g.exams,s=[...t].filter(e=>!n.has(e)),i=[...n].filter(e=>!t.has(e)),r=f.assignments,a=g.assignments,o=[...r].filter(e=>!a.has(e)),l=[...a].filter(e=>!r.has(e)),c=f.materials,h=g.materials,u=[...c].filter(e=>!h.has(e)),d=[...h].filter(e=>!c.has(e)),p=[...s.map(e=>({type:"exam",id:e})),...o.map(e=>({type:"assignment",id:e})),...u.map(e=>({type:"material",id:e}))],m=[...i.map(e=>({type:"exam",id:e})),...l.map(e=>({type:"assignment",id:e})),...d.map(e=>({type:"material",id:e}))];try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/sections/").concat(e,"/update-links"),{method:"PUT",headers:{Authorization:"MonaEdu ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({itemsToAdd:p,itemsToRemove:m})}),s=await n.json();if(!n.ok){if("No valid items provided to add or remove."===s.message)return void alert("No changes to save.");throw new Error(s.message||"Failed to save changes.")}alert("Session updated successfully!"),_()}catch(v){x(v.message)}finally{S(!1)}},disabled:w,className:"save-button",children:w?"Saving...":"Save Changes"})})]})},uE=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)(null),[c,h]=(0,t.useState)(""),[u,d]=(0,t.useState)(""),[f,p]=(0,t.useState)(null),[g,m]=(0,t.useState)("");(0,t.useEffect)(()=>{v()},[]);const v=async()=>{try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=await fetch("".concat(Et,"/assignments/all"),{headers:{Authorization:"MonaEdu ".concat(e)}}),s=await t.json();"Assignments fetched successfully"===s.message?n(s.assignments):l("Failed to fetch assignments")}catch(e){l("Error loading assignments")}finally{i(!1)}},y=e=>{if(!e)return"No date set";try{const t=new Date(e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"UTC"})}catch(o){return"Invalid Date"}};return s?(0,_t.jsx)("div",{className:"loading",children:"Loading assignments..."}):o?(0,_t.jsx)("div",{className:"error",children:o}):(0,_t.jsxs)("div",{className:"exams-page",children:[(0,_t.jsxs)("div",{className:"exams-list",children:[(0,_t.jsx)("h2",{children:"Available Assigments"}),0===e.length?(0,_t.jsx)("div",{className:"no-exams",children:"No Assigments yet"}):(0,_t.jsx)("div",{className:"exam-cards",children:e.map(e=>(0,_t.jsxs)("div",{className:"exam-card",children:[(0,_t.jsx)("h3",{children:e.name}),(0,_t.jsxs)("div",{className:"exam-dates",children:[(0,_t.jsxs)("p",{children:["Start: ",y(e.startDate)]}),(0,_t.jsxs)("p",{children:["End: ",y(e.endDate)]})]}),(0,_t.jsx)("button",{className:"download-btn",onClick:()=>(async e=>{try{const n=localStorage.getItem("token")||sessionStorage.getItem("token");console.log("Download assignment: assignmentId =",e);const s=await fetch("https://backend-edu-site-5cnm.vercel.app/assignments/download?assignmentId=".concat(e),{method:"GET",headers:{Authorization:"MonaEdu ".concat(n)}});if(!s.ok){try{const e=await s.json();if(console.log("Backend error response:",e),e&&e.message&&e.message.includes("This Assignment is not available at this time"))return void window.alert("This assignment is out of range");e&&e.message?l(e.message):l("Failed to download assignment")}catch(t){console.log("Error parsing error response as JSON:",t),l("Failed to download assignment")}throw new Error("Failed to download assignment")}const i=s.headers.get("content-type");if(i&&i.includes("application/json")){const e=await s.json();if(e&&e.message&&e.message.includes("This Assignment is not available at this time"))return void window.alert("This Assignment is not available at this time");if(e&&e.message)return void l(e.message)}const r=await s.blob(),a=window.URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download="assignment-".concat(e,".pdf"),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a)}catch(o){console.error("Error downloading assignment:",o),l("Failed to download assignment")}})(e._id),children:"Download Assignment"})]},e._id))})]}),(0,_t.jsxs)("div",{className:"upload-exam",children:[(0,_t.jsx)("h2",{children:"Submit Assignment"}),o&&(0,_t.jsx)("div",{className:"error",children:o}),g&&(0,_t.jsx)("div",{className:"submit-status",children:g}),(0,_t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),c&&f){a(!0),m("");try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=new FormData;t.append("assignmentId",c),t.append("notes",u||""),t.append("file",f),console.log("Submitting assignment:",{assignmentId:c,notes:u||"",fileName:f.name,fileType:f.type,fileSize:f.size});const n=await fetch("https://backend-edu-site-5cnm.vercel.app/assignments/submit",{method:"POST",headers:{Authorization:"MonaEdu ".concat(e)},body:t}),s=await n.json();console.log("Server response:",s),"Cannot submit because the deadline has passed."===s.message?(alert("Submission deadline has passed!"),h(""),d(""),p(null)):"Assignment submitted successfully"===s.message||"Assignment submitted successfully."===s.message?(m("Assignment submitted successfully"),h(""),d(""),p(null)):"The submission window for your group is closed."===s.message?alert("This assignment is not available yet!"):(l(s.message||"Failed to submit Assignment"),m(""))}catch(t){console.error("Error submitting assignment:",t),l(t.message||"Error submitting assignment"),m("")}finally{a(!1)}}else m("Please select an assignment and upload a file")},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Select Assignment:"}),(0,_t.jsxs)("select",{value:c,onChange:e=>h(e.target.value),required:!0,disabled:r,children:[(0,_t.jsx)("option",{value:"",children:"Select an assignment"}),e.map(e=>(0,_t.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Notes:"}),(0,_t.jsx)("textarea",{value:u,onChange:e=>d(e.target.value),placeholder:"Add any notes here...",disabled:r})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Upload Solution (PDF):"}),(0,_t.jsx)("input",{type:"file",accept:".pdf",onChange:e=>p(e.target.files[0]),required:!0,disabled:r})]}),(0,_t.jsx)("button",{type:"submit",className:"submit-btn ".concat(r?"loading":""),disabled:r,children:r?(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsx)("div",{className:"loading-spinner"}),"Uploading..."]}):"Submit Assignment"})]})]})]})},dE=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)(null),[c,h]=(0,t.useState)(""),[u,d]=(0,t.useState)(""),[f,p]=(0,t.useState)(null),[g,m]=(0,t.useState)("");(0,t.useEffect)(()=>{v()},[]);const v=async()=>{try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=await fetch("https://backend-edu-site-5cnm.vercel.app/exams",{headers:{Authorization:"MonaEdu ".concat(e)}}),s=await t.json();console.log(s),"Exams fetched successfully"===s.message?n(s.data):l("Failed to fetch exams")}catch(e){l("Error loading exams")}finally{i(!1)}},y=e=>{if(!e)return"No date set";try{const t=new Date(e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"UTC"})}catch(o){return"Invalid Date"}};return s?(0,_t.jsx)("div",{className:"loading",children:"Loading exams..."}):o?(0,_t.jsx)("div",{className:"error",children:o}):(0,_t.jsxs)("div",{className:"exams-page",children:[(0,_t.jsxs)("div",{className:"exams-list",children:[(0,_t.jsx)("h2",{children:"Available Exams"}),0===e.length?(0,_t.jsx)("div",{className:"no-exams",children:"No Exams yet"}):(0,_t.jsx)("div",{className:"exam-cards",children:e.map(e=>(0,_t.jsxs)("div",{className:"exam-card",children:[(0,_t.jsx)("h3",{children:e.Name}),(0,_t.jsxs)("div",{className:"exam-dates",children:[(0,_t.jsxs)("p",{children:["Start: ",y(e.startdate)]}),(0,_t.jsxs)("p",{children:["End: ",y(e.enddate)]})]}),(0,_t.jsx)("button",{className:"download-btn",onClick:()=>(async e=>{try{const n=localStorage.getItem("token")||sessionStorage.getItem("token");console.log("Download exam: examId =",e);const s=await fetch("https://backend-edu-site-5cnm.vercel.app/exams/download?examId=".concat(e),{method:"GET",headers:{authorization:"MonaEdu ".concat(n)}});if(console.log("Response status:",s.status),console.log("Response headers:",s.headers),!s.ok){try{const e=await s.json();console.log("Backend error response:",e),e&&e.message?l(e.message):l("Failed to download exam")}catch(t){console.log("Error parsing error response as JSON:",t),l("Failed to download exam")}throw new Error("Failed to download exam")}const i=s.headers.get("content-type");if(i&&i.includes("application/json")){const e=await s.json();if(console.log("Backend JSON response (200):",e),e&&e.message&&e.message.includes("This exam is not available at this time"))return void window.alert("This Exam is not available at this time");if(e&&e.message)return void l(e.message)}const r=await s.blob();console.log("Blob:",r);const a=window.URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download="exam-".concat(e,".pdf"),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a)}catch(o){console.error("Error downloading exam:",o),l("Failed to download exam")}})(e._id),children:"Download Exam"})]},e._id))})]}),(0,_t.jsxs)("div",{className:"upload-exam",children:[(0,_t.jsx)("h2",{children:"Submit Exam"}),g&&(0,_t.jsx)("div",{className:"submit-status",children:g}),(0,_t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),c&&f){a(!0),m("");try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=new FormData;t.append("examId",c),t.append("notes",u),t.append("file",f),console.log(t);const n=await fetch("https://backend-edu-site-5cnm.vercel.app/exams/submit",{method:"POST",headers:{Authorization:"MonaEdu ".concat(e)},body:t}),s=await n.json();"Cannot submit because the submission deadline has passed."===s.message?(alert("Submission deadline has passed!"),h(""),d(""),p(null)):"Exam submitted successfully."===s.message?(m("Exam submitted successfully"),h(""),d(""),p(null)):"Exam submission window is closed."===s.message?alert("This exam is not available yet!"):l("Failed to submit exam")}catch(t){console.error("Error submitting exam:",t),m("Error submitting exam")}finally{a(!1)}}else m("Please select an exam and upload a file")},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Select Exam:"}),(0,_t.jsxs)("select",{value:c,onChange:e=>h(e.target.value),required:!0,disabled:r,children:[(0,_t.jsx)("option",{value:"",children:"Select an exam"}),e.map(e=>(0,_t.jsx)("option",{value:e._id,children:e.Name},e._id))]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Notes:"}),(0,_t.jsx)("textarea",{value:u,onChange:e=>d(e.target.value),placeholder:"Add any notes here...",disabled:r})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Upload Solution (PDF):"}),(0,_t.jsx)("input",{type:"file",accept:".pdf",onChange:e=>p(e.target.files[0]),required:!0,disabled:r})]}),(0,_t.jsx)("button",{type:"submit",className:"submit-btn ".concat(r?"loading":""),disabled:r,children:r?(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsx)("div",{className:"loading-spinner"}),"Uploading..."]}):"Submit Exam"})]})]})]})},fE=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)(null),[o,l]=(0,t.useState)(!1),[c,h]=(0,t.useState)(""),[u,d]=(0,t.useState)(""),[f,p]=(0,t.useState)([]),[g,m]=(0,t.useState)([]),[v,y]=(0,t.useState)(0),[b,x]=(0,t.useState)("");(0,t.useEffect)(()=>{w()},[]);const w=async()=>{try{i(!0),a(null);const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=await fetch("".concat(Et,"/material"),{headers:{Authorization:"MonaEdu ".concat(e)}}),s=await t.json();"Materials retrieved successfully"===s.message?n(s.materials):"Student has no group assigned"===s.message?(a("You are not in group yet"),n([])):(a(s.message||"Failed to fetch materials"),n([]))}catch(e){console.error("Error fetching materials:",e),a("Error loading materials. Please try again."),n([])}finally{i(!1)}},S=()=>{l(!1),h(""),d(""),p([]),m([]),y(0),x("")};return s?(0,_t.jsx)("div",{className:"loading",children:"Loading materials..."}):r&&0===e.length?(0,_t.jsx)("div",{className:"error",children:r}):(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsx)("div",{className:"exams-page",children:(0,_t.jsxs)("div",{className:"exams-list",children:[(0,_t.jsx)("h2",{children:"Available Materials"}),r&&e.length>0&&(0,_t.jsx)("div",{className:"error-inline",children:r}),0!==e.length||s?(0,_t.jsxs)("div",{className:"exam-cards",children:[" ",e.map(e=>(0,_t.jsxs)("div",{className:"exam-card",children:[(0,_t.jsx)("h3",{children:e.name}),(0,_t.jsx)("div",{className:"exam-dates",children:(0,_t.jsx)("p",{children:e.description})}),(0,_t.jsx)("button",{className:"download-btn",onClick:()=>(async(e,t)=>{try{const n=localStorage.getItem("token")||sessionStorage.getItem("token"),s=await fetch("".concat(Et,"/material/").concat(e),{method:"GET",headers:{Authorization:"MonaEdu ".concat(n)}});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to fetch material details (status: ".concat(s.status,")"))}const i=await s.json();if(console.log(i.Links),!(i.files&&Array.isArray(i.files)&&i.files.length>0))throw new Error("No file available for this material.");p(i.files),h(i.files[0].url),y(0),d(t||"View Material"),x(i.description||""),l(!0),m(i.Links)}catch(r){console.error("Error opening material in viewer:",r),alert("An error occurred while preparing the material for viewing: "+r.message)}})(e._id,e.name),children:"Open Material"})]},e._id))]}):(0,_t.jsx)("div",{className:"no-exams",children:r||"No Materials yet"})]})}),o&&(0,_t.jsxs)(Bt(),{isOpen:o,onRequestClose:S,contentLabel:"View Material PDF",style:{overlay:{backgroundColor:"rgba(0, 0, 0, 0.75)",zIndex:1e3},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"90vw",maxWidth:"1000px",height:"90vh",padding:"0",border:"none",display:"flex",flexDirection:"column"}},children:[(0,_t.jsxs)("div",{style:{padding:"15px 20px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,_t.jsx)("h2",{style:{margin:0,fontSize:"1.2em"},children:u}),(0,_t.jsx)("button",{onClick:S,style:{background:"none",border:"none",fontSize:"1.5em",cursor:"pointer"},children:"\xd7"})]}),b&&(0,_t.jsx)("div",{style:{padding:"10px 20px",color:"#34495e",fontSize:"1rem",borderBottom:"1px solid #eee"},children:b}),f.length>1&&(0,_t.jsx)("div",{style:{padding:"10px 20px",borderBottom:"1px solid #eee",display:"flex",gap:"10px",flexWrap:"wrap"},children:f.map((e,t)=>(0,_t.jsx)("button",{style:{background:t===v?"#3498db":"#f4f4f4",color:t===v?"white":"#333",border:"1px solid #ccc",borderRadius:"4px",padding:"6px 12px",cursor:"pointer",fontWeight:500},onClick:()=>{h(e.url),y(t)},children:e.originalName||"File ".concat(t+1)},t))}),(0,_t.jsxs)("div",{className:"resource-section",children:[(0,_t.jsx)("h3",{children:"Links"}),g&&g.length>0?(0,_t.jsx)("ul",{className:"resource-list",children:g.map((e,t)=>(0,_t.jsx)("li",{className:"resource-item link-item",children:(0,_t.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e})},t))}):(0,_t.jsx)("p",{className:"no-resources-message",children:"No links provided."})]}),(0,_t.jsx)("div",{style:{flexGrow:1,overflow:"hidden"},children:(0,_t.jsx)(py,{pdfUrl:c})})]})]})},pE=()=>{var e,n,s,i;const[r,a]=(0,t.useState)(null),[o,l]=(0,t.useState)(!0),[c,h]=(0,t.useState)(""),u=async()=>{try{const e=localStorage.getItem("token")||sessionStorage.getItem("token"),t=await fetch("".concat(Et,"/student/profile"),{headers:{Authorization:"MonaEdu ".concat(e)}}),n=await t.json();"Profile information fetched successfully."===n.message?a(n.data):h("Failed to fetch user data")}catch(e){h("Error loading user data")}finally{l(!1)}};(0,t.useEffect)(()=>{u()},[]);const d=async(e,t,n)=>{if(window.confirm("Are you sure you want to delete this submission".concat(n?" for ".concat(n):"","?")))try{const n=localStorage.getItem("token")||sessionStorage.getItem("token");console.log("".concat(Et,"/").concat(t));const s=await fetch("".concat(Et,"/").concat(t),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"MonaEdu ".concat(n)},body:JSON.stringify({submissionId:e})}),i=await s.json();"Submission deleted successfully."===i.message?(u(),alert("Submission deleted successfully")):(console.error("Failed to delete submission:",i.message),alert("Failed to delete submission"))}catch(c){console.error("Error deleting submission:",c),alert("Error deleting submission")}};return o?(0,_t.jsx)("div",{children:"Loading..."}):r?(0,_t.jsxs)("div",{className:"profile-container",children:[(0,_t.jsx)("h2",{children:"Profile"}),c&&(0,_t.jsx)("div",{className:"error-message",children:c}),(0,_t.jsxs)("div",{className:"profile-info",children:[(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"First Name:"}),(0,_t.jsx)("span",{children:r.firstName})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Last Name:"}),(0,_t.jsx)("span",{children:r.lastName})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Username:"}),(0,_t.jsx)("span",{children:r.userName})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Email:"}),(0,_t.jsx)("span",{children:r.email})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Parent Email:"}),(0,_t.jsx)("span",{children:r.parentemail})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Phone:"}),(0,_t.jsx)("span",{children:r.phone})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Parent Phone:"}),(0,_t.jsx)("span",{children:r.parentPhone})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Grade:"}),(0,_t.jsx)("span",{children:null===(e=r.gradeId)||void 0===e?void 0:e.grade})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Group:"}),(0,_t.jsx)("span",{children:null===(n=r.groupId)||void 0===n?void 0:n.groupname})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Email Confirmed:"}),(0,_t.jsx)("span",{children:r.confirmEmail?"Yes":"No"})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Submitted Assignments:"}),(0,_t.jsx)("span",{children:(null===(s=r.assignmentSubmissions)||void 0===s?void 0:s.length)||0})]}),(0,_t.jsxs)("div",{className:"info-group",children:[(0,_t.jsx)("label",{children:"Submitted Exams:"}),(0,_t.jsx)("span",{children:(null===(i=r.examSubmissions)||void 0===i?void 0:i.length)||0})]})]}),r.assignmentSubmissions&&r.assignmentSubmissions.length>0&&(0,_t.jsxs)("div",{className:"submissions-section",children:[(0,_t.jsx)("h3",{children:"Assignment Submissions"}),(0,_t.jsx)("div",{className:"submissions-list",children:r.assignmentSubmissions.map((e,t)=>(0,_t.jsxs)("div",{className:"submission-item",children:[(0,_t.jsxs)("div",{className:"submission-header",children:[(0,_t.jsxs)("h4",{children:["Assignment: ",e.assignmentname||"Submission #".concat(t+1)]}),(0,_t.jsx)("span",{className:"status ".concat(void 0!==e.score?"marked":"pending"),children:void 0!==e.score?"Score: ".concat(e.score):"Pending"})]}),(0,_t.jsxs)("div",{className:"submission-details",children:[(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Submitted:"})," ",new Date(e.SubmitDate).toLocaleDateString()]}),e.notes&&(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Notes:"})," ",e.notes]}),e.teacherFeedback&&(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Feedback:"})," ",e.teacherFeedback]})]}),(0,_t.jsxs)("div",{className:"submission-actions",children:[(0,_t.jsx)("button",{className:"action-btn view",onClick:()=>window.open(e.path,"_blank"),children:"View"}),(0,_t.jsx)("button",{className:"action-btn delete",onClick:()=>d(e._id,"assignments/submission/delete",e.assignmentname),disabled:void 0!==e.score,children:"Delete"})]})]},e._id))})]}),r.examSubmissions&&r.examSubmissions.length>0&&(0,_t.jsxs)("div",{className:"submissions-section",children:[(0,_t.jsx)("h3",{children:"Exam Submissions"}),(0,_t.jsx)("div",{className:"submissions-list",children:r.examSubmissions.map((e,t)=>(0,_t.jsxs)("div",{className:"submission-item",children:[(0,_t.jsxs)("div",{className:"submission-header",children:[(0,_t.jsxs)("h4",{children:["Exam: ",e.examname||"Submission #".concat(t+1)]}),(0,_t.jsx)("span",{className:"status ".concat(null!==e.score?"scored":"pending"),children:null!==e.score?"Score: ".concat(e.score):"Pending"})]}),(0,_t.jsxs)("div",{className:"submission-details",children:[(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Submitted:"})," ",new Date(e.createdAt).toLocaleDateString()]}),e.notes&&(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Notes:"})," ",e.notes]}),e.teacherFeedback&&(0,_t.jsxs)("p",{children:[(0,_t.jsx)("strong",{children:"Feedback:"})," ",e.teacherFeedback]})]}),(0,_t.jsxs)("div",{className:"submission-actions",children:[(0,_t.jsx)("button",{className:"action-btn view",onClick:()=>window.open(e.filePath,"_blank"),children:"View"}),(0,_t.jsx)("button",{className:"action-btn delete",onClick:()=>d(e._id,"exams/deleteSub",e.examname),disabled:null!==e.score,children:"Delete"})]})]},e._id))})]})]}):(0,_t.jsx)("div",{children:"Error loading profile"})};Bt().setAppElement("#root");const gE=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)(null),[o,l]=(0,t.useState)(null),[c,h]=(0,t.useState)([]),[u,d]=(0,t.useState)(!1),[f,p]=(0,t.useState)(!1),[g,m]=(0,t.useState)(null),[v,y]=(0,t.useState)(""),[b,x]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{var e,t;const s=localStorage.getItem("token")||sessionStorage.getItem("token"),i=await fetch("".concat(Et,"/student/profile"),{headers:{Authorization:"MonaEdu ".concat(s)}});if(!i.ok)throw new Error("Could not fetch student profile.");const r=null===(e=(await i.json()).data)||void 0===e||null===(t=e.groupId)||void 0===t?void 0:t._id;if(!r)throw new Error("Student is not assigned to a group.");const a=await fetch("".concat(Et,"/sections?groupId=").concat(r),{headers:{Authorization:"MonaEdu ".concat(s)}});if(!a.ok)throw new Error("Could not fetch sessions for your group.");const o=await a.json();n(o.data||[])}catch(s){a(s.message)}finally{i(!1)}})()},[]);const w=()=>{p(!1),m(null),y("")},S=e=>{switch(e.type){case"material":(async e=>{p(!0),x(!0),a(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/material/").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}});if(!n.ok)throw new Error("Failed to fetch material details.");const s=await n.json();m(s),s.files&&s.files.length>0?y(s.files[0].url):y("")}catch(t){a(t.message)}finally{x(!1)}})(e.id);break;case"assignment":(async e=>{try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/assignments/download?assignmentId=").concat(e),{method:"GET",headers:{Authorization:"MonaEdu ".concat(t)}});if(!n.ok){const e=await n.json().catch(()=>({}));return void(e.message&&e.message.includes("This Assignment is not available at this time")?window.alert("This assignment is currently outside of its scheduled time."):window.alert(e.message||"Failed to download assignment."))}const s=await n.blob(),i=window.URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download="assignment-".concat(e,".pdf"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(i)}catch(r){console.error("Error downloading assignment:",r),a("Failed to download assignment")}})(e.id);break;case"exam":(async e=>{try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/exams/download?examId=").concat(e),{method:"GET",headers:{Authorization:"MonaEdu ".concat(t)}});if(!n.ok){const e=await n.json().catch(()=>({}));return void(e.message&&e.message.includes("This exam is not available at this time")?window.alert("This exam is currently outside of its scheduled time."):window.alert(e.message||"Failed to download exam."))}const s=await n.blob(),i=window.URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download="exam-".concat(e,".pdf"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(i)}catch(r){console.error("Error downloading exam:",r),a("Failed to download exam")}})(e.id);break;default:alert("Unknown item type.")}},_=e=>{switch(e){case"exam":return Ot;case"assignment":return Dt;default:return Nt}};return s?(0,_t.jsx)("div",{className:"loading",children:"Loading your sessions..."}):r?(0,_t.jsx)("div",{className:"error",children:r}):(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsxs)("div",{className:"sessions-student-page",children:[(0,_t.jsx)("h1",{children:"Your Sessions"}),e.length>0?e.map(e=>(0,_t.jsxs)("div",{className:"session-accordion",children:[(0,_t.jsxs)("div",{className:"session-header ".concat(o===e._id?"expanded":""),onClick:()=>(async e=>{if(o===e)return l(null),void h([]);l(e),d(!0),a(null);try{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),n=await fetch("".concat(Et,"/sections/").concat(e),{headers:{Authorization:"MonaEdu ".concat(t)}});if(!n.ok)throw new Error("Failed to load session content.");const s=await n.json();h(s.data.content||[])}catch(t){a(t.message)}finally{d(!1)}})(e._id),children:[(0,_t.jsxs)("div",{className:"session-header-title",children:[(0,_t.jsx)("h2",{children:e.name}),(0,_t.jsx)("p",{children:e.description})]}),(0,_t.jsx)("span",{className:"session-toggle-icon",children:"\u25bc"})]}),o===e._id&&(0,_t.jsx)("div",{className:"session-content",children:u?(0,_t.jsx)("div",{className:"loading",children:"Loading content..."}):(0,_t.jsx)("ul",{className:"session-content-list",children:c.length>0?c.map(e=>(0,_t.jsxs)("li",{className:"session-content-item",children:[(0,_t.jsxs)("div",{className:"item-details",children:[(0,_t.jsx)("img",{src:_(e.type),alt:"".concat(e.type," icon"),className:"item-icon"}),(0,_t.jsx)("span",{className:"item-name",children:e.name})]}),(0,_t.jsx)("button",{className:"view-item-btn",onClick:()=>S(e),children:"material"===e.type?"View":"Download"})]},e.id)):(0,_t.jsx)("p",{children:"No items linked to this session yet."})})})]},e._id)):(0,_t.jsx)("p",{children:"No sessions have been assigned to your group yet."})]}),(0,_t.jsx)(Bt(),{isOpen:f,onRequestClose:w,contentLabel:"View Material",className:"material-modal",overlayClassName:"material-modal-overlay",children:b?(0,_t.jsx)("div",{className:"loading",children:"Loading..."}):g&&(0,_t.jsxs)(_t.Fragment,{children:[(0,_t.jsxs)("div",{className:"material-modal-header",children:[(0,_t.jsx)("h2",{children:g.name}),(0,_t.jsx)("button",{onClick:w,className:"close-modal-btn",children:"\xd7"})]}),(0,_t.jsxs)("div",{className:"material-modal-body",children:[(0,_t.jsxs)("div",{className:"content-sidebar",children:[(0,_t.jsx)("p",{className:"material-description",children:g.description}),(0,_t.jsxs)("div",{className:"resource-section",children:[(0,_t.jsx)("h3",{children:"Files"}),g.files&&g.files.length>0?(0,_t.jsx)("ul",{className:"resource-list",children:g.files.map((e,t)=>(0,_t.jsx)("li",{className:"resource-item",children:(0,_t.jsx)("button",{className:v===e.url?"active":"",onClick:()=>y(e.url),children:e.originalName||"File ".concat(t+1)})},t))}):(0,_t.jsx)("p",{className:"no-resources-message",children:"No files provided."})]}),(0,_t.jsxs)("div",{className:"resource-section",children:[(0,_t.jsx)("h3",{children:"Links"}),g.Links&&g.Links.length>0?(0,_t.jsx)("ul",{className:"resource-list",children:g.Links.map((e,t)=>(0,_t.jsx)("li",{className:"resource-item link-item",children:(0,_t.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e})},t))}):(0,_t.jsx)("p",{className:"no-resources-message",children:"No links provided."})]})]}),(0,_t.jsx)("div",{className:"pdf-viewer-main",children:v?(0,_t.jsx)(py,{pdfUrl:v}):(0,_t.jsx)("div",{className:"loading",children:"No PDF to display."})})]})]})})]})},mE=()=>(0,_t.jsxs)("div",{className:"loading-overlay",children:[(0,_t.jsx)("div",{className:"loading-spinner"}),(0,_t.jsx)("p",{children:"You're already logged in. Redirecting..."})]});var vE={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},yE=t.createContext&&t.createContext(vE),bE=["attr","size","title"];function xE(e,t){if(null==e)return{};var n,s,i=function(e,t){if(null==e)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function wE(){return wE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},wE.apply(this,arguments)}function SE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function _E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SE(Object(n),!0).forEach(function(t){CE(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SE(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function CE(e,t,n){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kE(e){return e&&e.map((e,n)=>t.createElement(e.tag,_E({key:n},e.attr),kE(e.child)))}function AE(e){return n=>t.createElement(EE,wE({attr:_E({},e.attr)},n),kE(e.child))}function EE(e){var n=n=>{var s,{attr:i,size:r,title:a}=e,o=xE(e,bE),l=r||n.size||"1em";return n.className&&(s=n.className),e.className&&(s=(s?s+" ":"")+e.className),t.createElement("svg",wE({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,i,o,{className:s,style:_E(_E({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&t.createElement("title",null,a),e.children)};return void 0!==yE?t.createElement(yE.Consumer,null,e=>n(e)):n(vE)}function TE(e){return AE({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(e)}function ME(e){return AE({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(e)}const jE=()=>{const[e,n]=(0,t.useState)(""),[s,i]=(0,t.useState)(""),[r,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)(""),[c,h]=(0,t.useState)(!1),u=fe(),d=he();(0,t.useEffect)(()=>{var e;null!==(e=d.state)&&void 0!==e&&e.error&&(l(d.state.error),u(d.pathname,{replace:!0,state:{}}))},[d.state,d.pathname,u]);return(0,_t.jsx)("div",{className:"auth-container",children:(0,_t.jsxs)("div",{className:"auth-box",children:[(0,_t.jsx)("h2",{children:"Welcome Back"}),o&&(0,_t.jsx)("div",{className:"error-message",children:o}),(0,_t.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),l("");try{const t=await fetch("".concat(Et,"/student/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),n=await t.json();n.token?(r?localStorage.setItem("token",n.token):sessionStorage.setItem("token",n.token),u("/student/sessions",{replace:!0})):l(n.Message||"Login failed")}catch(n){l("An error occurred during login. Please check your connection."),console.error("Login error:",n)}},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Email:"}),(0,_t.jsx)("input",{type:"email",value:e,onChange:e=>n(e.target.value),required:!0,className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Password:"}),(0,_t.jsxs)("div",{className:"password-input-container",children:[(0,_t.jsx)("input",{type:c?"text":"password",value:s,onChange:e=>i(e.target.value),required:!0,className:"form-input"}),(0,_t.jsx)("span",{className:"password-toggle-icon",onClick:()=>h(!c),children:c?(0,_t.jsx)(TE,{}):(0,_t.jsx)(ME,{})})]})]}),(0,_t.jsx)("div",{className:"form-group remember-me",children:(0,_t.jsxs)("label",{className:"checkbox-label",children:[(0,_t.jsx)("input",{type:"checkbox",checked:r,onChange:e=>a(e.target.checked)}),(0,_t.jsx)("span",{children:"Remember Me"})]})}),(0,_t.jsx)("button",{type:"submit",className:"auth-button",children:"Login"})]}),(0,_t.jsxs)("div",{className:"auth-footer",children:[(0,_t.jsxs)("div",{className:"signup-link",children:["Don't have an account? ",(0,_t.jsx)(gt,{to:"/signup",children:"Sign Up"})]}),(0,_t.jsx)("div",{className:"teacher-login",children:(0,_t.jsx)(gt,{to:"/admin/login",className:"teacher-login-link",children:"Login as Teacher"})})]})]})})},PE=()=>{const e=fe(),[n,s]=(0,t.useState)({username:"",firstName:"",lastName:"",email:"",parentEmail:"",password:"",confirmPassword:"",phoneNumber:"",parentPhoneNumber:"",grade:9}),[i,r]=(0,t.useState)(""),[a,o]=(0,t.useState)({password:!1,confirmPassword:!1}),l=e=>{const t="grade"===e.target.name?parseInt(e.target.value,10):e.target.value;s(c(c({},n),{},{[e.target.name]:t}))},h=e=>{o(t=>c(c({},t),{},{[e]:!t[e]}))};return(0,_t.jsx)("div",{className:"auth-container",children:(0,_t.jsxs)("div",{className:"auth-box",children:[(0,_t.jsx)("h2",{children:"Create Account"}),i&&(0,_t.jsx)("div",{className:"error-message",children:i}),(0,_t.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),r(""),n.password!==n.confirmPassword)return void r("Passwords do not match");const s=/^\d{10}$/;if(!s.test(n.phoneNumber))return void r("Student phone number must be 10 digits");if(!s.test(n.parentPhoneNumber))return void r("Parent phone number must be 10 digits");const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(i.test(n.email)&&i.test(n.parentEmail))try{const t={userName:n.username,firstName:n.firstName,lastName:n.lastName,email:n.email,parentemail:n.parentEmail,password:n.password,cPassword:n.confirmPassword,phone:n.phoneNumber,parentphone:n.parentPhoneNumber,grade:parseInt(n.grade,10)};console.log("Submitting signup data:",t);const s=await fetch("https://backend-edu-site-5cnm.vercel.app/student/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await s.json();"Done "===i.Message||"Done"===i.Message?(alert("Registration successful! Please check your email and proceed to login."),e("/login")):"User with this email, username, or phone already exists."===i.message?r("Email, username, or phone number is already registered"):r(i.Message||"An unknown error occurred.")}catch(a){r(a.message||"An error occurred during registration."),console.error("Registration error:",a)}else r("Please enter valid email addresses")},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"username",children:"Username:"}),(0,_t.jsx)("input",{type:"text",id:"username",name:"username",value:n.username,onChange:l,required:!0,className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"firstName",children:"First Name:"}),(0,_t.jsx)("input",{type:"text",id:"firstName",name:"firstName",value:n.firstName,onChange:l,required:!0,className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"lastName",children:"Last Name:"}),(0,_t.jsx)("input",{type:"text",id:"lastName",name:"lastName",value:n.lastName,onChange:l,required:!0,className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"email",children:"Student Email:"}),(0,_t.jsx)("input",{type:"email",id:"email",name:"email",value:n.email,onChange:l,required:!0,className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"parentEmail",children:"Parent Email:"}),(0,_t.jsx)("input",{type:"email",id:"parentEmail",name:"parentEmail",value:n.parentEmail,onChange:l,required:!0,className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"phoneNumber",children:"Student Phone Number:"}),(0,_t.jsx)("input",{type:"tel",id:"phoneNumber",name:"phoneNumber",value:n.phoneNumber,onChange:l,required:!0,placeholder:"10 digits number",className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"parentPhoneNumber",children:"Parent Phone Number:"}),(0,_t.jsx)("input",{type:"tel",id:"parentPhoneNumber",name:"parentPhoneNumber",value:n.parentPhoneNumber,onChange:l,required:!0,placeholder:"10 digits number",className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"grade",children:"Grade:"}),(0,_t.jsxs)("select",{id:"grade",name:"grade",value:n.grade,onChange:l,required:!0,className:"form-input",children:[(0,_t.jsx)("option",{value:9,children:"Grade 9"}),(0,_t.jsx)("option",{value:10,children:"Grade 10"}),(0,_t.jsx)("option",{value:11,children:"Grade 11"}),(0,_t.jsx)("option",{value:12,children:"Grade 12"})]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"password",children:"Password:"}),(0,_t.jsxs)("div",{className:"password-input-container",children:[(0,_t.jsx)("input",{type:a.password?"text":"password",id:"password",name:"password",value:n.password,onChange:l,required:!0,className:"form-input"}),(0,_t.jsx)("span",{className:"password-toggle-icon",onClick:()=>h("password"),children:a.password?(0,_t.jsx)(TE,{}):(0,_t.jsx)(ME,{})})]})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm Password:"}),(0,_t.jsxs)("div",{className:"password-input-container",children:[(0,_t.jsx)("input",{type:a.confirmPassword?"text":"password",id:"confirmPassword",name:"confirmPassword",value:n.confirmPassword,onChange:l,required:!0,className:"form-input"}),(0,_t.jsx)("span",{className:"password-toggle-icon",onClick:()=>h("confirmPassword"),children:a.confirmPassword?(0,_t.jsx)(TE,{}):(0,_t.jsx)(ME,{})})]})]}),(0,_t.jsx)("button",{type:"submit",className:"auth-button",children:"Sign Up"})]}),(0,_t.jsxs)("div",{className:"auth-footer",children:["Already have an account? ",(0,_t.jsx)(gt,{to:"/login",children:"Login"})]})]})})},OE=()=>{const[e,n]=(0,t.useState)(""),[s,i]=(0,t.useState)(""),[r,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)(!1),[c,h]=(0,t.useState)(""),u=fe();return(0,_t.jsx)("div",{className:"auth-container",children:(0,_t.jsxs)("div",{className:"auth-box",children:[(0,_t.jsx)("h2",{children:"Welcome Back"}),c&&(0,_t.jsx)("div",{className:"error-message",children:c}),(0,_t.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),h("");try{const t=await fetch("".concat(Et,"/student/teacher/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),n=await t.json();console.log("Login response:",n),n.token?(r?localStorage.setItem("token",n.token):sessionStorage.setItem("token",n.token),u("/dashboard/sessions")):h(n.Message||"Login failed")}catch(n){h("An error occurred during login"),console.error("Login error:",n)}},children:[(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Email:"}),(0,_t.jsx)("input",{type:"email",value:e,onChange:e=>n(e.target.value),required:!0,className:"form-input"})]}),(0,_t.jsxs)("div",{className:"form-group",children:[(0,_t.jsx)("label",{children:"Password:"}),(0,_t.jsxs)("div",{className:"password-input-container",children:[(0,_t.jsx)("input",{type:o?"text":"password",value:s,onChange:e=>i(e.target.value),required:!0,className:"form-input"}),(0,_t.jsx)("span",{className:"password-toggle-icon",onClick:()=>l(!o),children:o?(0,_t.jsx)(TE,{}):(0,_t.jsx)(ME,{})})]})]}),(0,_t.jsx)("div",{className:"form-group remember-me",children:(0,_t.jsxs)("label",{className:"checkbox-label",children:[(0,_t.jsx)("input",{type:"checkbox",checked:r,onChange:e=>a(e.target.checked)}),(0,_t.jsx)("span",{children:"Remember Me"})]})}),(0,_t.jsx)("button",{type:"submit",className:"auth-button",children:"Login"})]}),(0,_t.jsxs)("div",{className:"auth-footer",children:[(0,_t.jsxs)("div",{className:"signup-link",children:["Don't have an account? ",(0,_t.jsx)(gt,{to:"/signup",children:"Sign Up"})]}),(0,_t.jsx)("div",{className:"teacher-login",children:(0,_t.jsx)(gt,{to:"/login",className:"teacher-login-link",children:"Login as Student"})})]})]})})};Bt().setAppElement("#root");const DE=()=>(0,_t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"24px",color:"#333"},children:"Loading, please wait..."}),NE=()=>{const[e,n]=(0,t.useState)(!0),s=fe(),i=he();if((0,t.useEffect)(()=>{let e=!0;return(async()=>{const t=localStorage.getItem("token")||sessionStorage.getItem("token"),r=i.pathname;if(t)try{const n=await fetch("".concat(Et,"/student/profile"),{method:"GET",headers:{Authorization:"MonaEdu ".concat(t),"Content-Type":"application/json"}});if(!e)return;if(n.ok){const e=await n.json();if(e.data){const t="main_teacher"===e.data.role,n=(e.data.role,!!e.data.userName);t?["/login","/admin/login","/signup"].includes(r)&&s("/dashboard/",{replace:!0}):n?["/login","/admin/login","/signup","/redirecting"].includes(r)&&s("/student/",{replace:!0}):(localStorage.removeItem("token"),sessionStorage.removeItem("token"),["/login","/admin/login","/signup"].includes(r)||s("/login",{state:{error:"The login credentials aren't right."},replace:!0}))}else localStorage.removeItem("token"),sessionStorage.removeItem("token"),["/login","/admin/login","/signup"].includes(r)||s("/login",{state:{error:"Failed to verify login. Please try again."},replace:!0})}else localStorage.removeItem("token"),sessionStorage.removeItem("token"),["/login","/admin/login","/signup"].includes(r)||s("/login",{replace:!0,state:{error:"Session expired or invalid. Please login again."}})}catch(a){e&&(console.error("Error during initial auth check:",a),localStorage.removeItem("token"),sessionStorage.removeItem("token"),["/login","/admin/login","/signup"].includes(r)||s("/login",{state:{error:"A network error occurred. Please try again."},replace:!0}))}finally{e&&n(!1)}else e&&n(!1)})(),()=>{e=!1}},[s,i.pathname]),e)return(0,_t.jsx)(DE,{});const r=e=>{let{children:t}=e;const n=he();return!(!localStorage.getItem("token")&&!sessionStorage.getItem("token"))?t:(0,_t.jsx)(Me,{to:"/login",state:{from:n},replace:!0})};return(0,_t.jsxs)(Oe,{children:[(0,_t.jsx)(je,{path:"/",element:(0,_t.jsx)(Pt,{})}),(0,_t.jsx)(je,{path:"/redirecting",element:(0,_t.jsx)(mE,{})}),(0,_t.jsx)(je,{path:"/admin/login",element:(0,_t.jsx)(OE,{})}),(0,_t.jsx)(je,{path:"/login",element:(0,_t.jsx)(jE,{})}),(0,_t.jsx)(je,{path:"/signup",element:(0,_t.jsx)(PE,{})}),(0,_t.jsx)(je,{path:"/dashboard/*",element:(0,_t.jsx)(r,{children:(0,_t.jsx)(At,{SidebarComponent:Ft,children:(0,_t.jsxs)(Oe,{children:[(0,_t.jsx)(je,{path:"exams",element:(0,_t.jsx)(Ut,{})}),(0,_t.jsx)(je,{path:"assignments",element:(0,_t.jsx)(Gt,{})}),(0,_t.jsx)(je,{path:"assignments/grade/:grade/group/:groupId/assignment/:assignmentId",element:(0,_t.jsx)(oE,{})}),(0,_t.jsx)(je,{path:"exams/grade/:grade/group/:groupId/exam/:examId",element:(0,_t.jsx)(lE,{})}),(0,_t.jsx)(je,{path:"sessions",element:(0,_t.jsx)(cE,{})}),(0,_t.jsx)(je,{path:"sessions/:sessionId",element:(0,_t.jsx)(hE,{})}),(0,_t.jsx)(je,{path:"materials",element:(0,_t.jsx)(gy,{})}),(0,_t.jsx)(je,{path:"groups",element:(0,_t.jsx)(vy,{})}),(0,_t.jsx)(je,{path:"groups/:grade/:group",element:(0,_t.jsx)(yy,{})})]})})})}),(0,_t.jsx)(je,{path:"/student/*",element:(0,_t.jsx)(r,{children:(0,_t.jsx)(At,{SidebarComponent:zt,children:(0,_t.jsxs)(Oe,{children:[(0,_t.jsx)(je,{index:!0,element:(0,_t.jsx)(gE,{})}),(0,_t.jsx)(je,{path:"assignments",element:(0,_t.jsx)(uE,{})}),(0,_t.jsx)(je,{path:"sessions",element:(0,_t.jsx)(gE,{})}),(0,_t.jsx)(je,{path:"exams",element:(0,_t.jsx)(dE,{})}),(0,_t.jsx)(je,{path:"materials",element:(0,_t.jsx)(fE,{})}),(0,_t.jsx)(je,{path:"profile",element:(0,_t.jsx)(pE,{})})]})})})}),(0,_t.jsx)(je,{path:"*",element:(0,_t.jsx)(Me,{to:"/",replace:!0})})]})},LE=()=>(0,_t.jsx)(ft,{children:(0,_t.jsx)(NE,{})}),RE=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then(t=>{let{getCLS:n,getFID:s,getFCP:i,getLCP:r,getTTFB:a}=t;n(e),s(e),i(e),r(e),a(e)})};s.createRoot(document.getElementById("root")).render((0,_t.jsx)(t.StrictMode,{children:(0,_t.jsx)(LE,{})})),RE()})()})();
//# sourceMappingURL=main.feb1480f.js.map